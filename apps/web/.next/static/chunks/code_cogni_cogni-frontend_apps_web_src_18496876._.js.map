{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/api/workspaceFilesApi.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/browserClient';\n\nconst supabase = createClient();\nconst WORKSPACE_FILES_BUCKET = 'workspace-files';\n\nexport interface WorkspaceFile {\n  id: number; // bigint (database primary key)\n  original_filename: string;\n  file_path: string;\n  file_size: number;\n  mime_type: string;\n  created_at: string;\n}\n\nexport interface UploadedFile {\n  id: number; // workspace_file_id (bigint, database primary key)\n  file_path: string;\n  url: string;\n  original_filename: string;\n  file_size: number;\n  mime_type: string;\n}\n\n/**\n * Upload a file to workspace storage\n */\nexport async function uploadWorkspaceFile(\n  workspaceId: number,\n  file: File\n): Promise<UploadedFile> {\n  // Generate a UUID for the storage path (not the database ID)\n  const storageUuid = crypto.randomUUID();\n  const sanitizedFilename = file.name.replace(/[^a-zA-Z0-9._-]/g, '_');\n\n  // Storage path: workspace-files/{workspace_id}/uploads/{uuid}/{original_filename}\n  const filePath = `${workspaceId}/uploads/${storageUuid}/${sanitizedFilename}`;\n\n  // Upload to Supabase Storage\n  const { error: uploadError } = await supabase.storage\n    .from(WORKSPACE_FILES_BUCKET)\n    .upload(filePath, file, {\n      cacheControl: '3600',\n      upsert: false,\n    });\n\n  if (uploadError) throw uploadError;\n\n  // Insert file metadata into workspace_files table (database ID is auto-generated bigint)\n  const { data: fileData, error: dbError } = await supabase\n    .from('workspace_files')\n    .insert({\n      orginal_file_name: file.name, // Note: schema has typo \"orginal\" instead of \"original\"\n      file_path: filePath,\n      mime_type: file.type,\n      file_size: file.size,\n      workspace_id: workspaceId,\n    })\n    .select()\n    .single();\n\n  if (dbError) throw dbError;\n\n  // Generate signed URL for private bucket (valid for 1 hour)\n  const { data: signedUrlData, error: signedUrlError } = await supabase.storage\n    .from(WORKSPACE_FILES_BUCKET)\n    .createSignedUrl(filePath, 3600); // 1 hour expiration\n\n  if (signedUrlError) {\n    console.warn('Error creating signed URL:', signedUrlError);\n  }\n\n  // Return file info with workspace_file_id\n  return {\n    id: fileData.id,\n    file_path: filePath,\n    url: signedUrlData?.signedUrl || '', // Signed URL for private bucket\n    original_filename: file.name,\n    file_size: file.size,\n    mime_type: file.type,\n  };\n}\n\n/**\n * Get signed file URL from workspace_file_id (bigint)\n * For private buckets, returns a signed URL valid for the specified duration\n */\nexport async function getFileUrl(\n  workspaceFileId: number,\n  expiresIn: number = 3600\n): Promise<string | null> {\n  const { data, error } = await supabase\n    .from('workspace_files')\n    .select('file_path')\n    .eq('id', workspaceFileId)\n    .single();\n\n  if (error || !data) {\n    console.warn('File not found in database:', error);\n    return null;\n  }\n\n  // Create signed URL for private bucket\n  const { data: signedUrlData, error: signedUrlError } = await supabase.storage\n    .from(WORKSPACE_FILES_BUCKET)\n    .createSignedUrl(data.file_path, expiresIn);\n\n  if (signedUrlError || !signedUrlData) {\n    console.warn('Error creating signed URL:', signedUrlError);\n    return null;\n  }\n\n  return signedUrlData.signedUrl;\n}\n\n/**\n * Link files to a message\n */\nexport async function linkFilesToMessage(\n  messageId: number,\n  workspaceFileIds: number[]\n): Promise<void> {\n  if (workspaceFileIds.length === 0) return;\n\n  const rows = workspaceFileIds.map(workspaceFileId => ({\n    message_id: messageId,\n    workspace_file_id: workspaceFileId,\n  }));\n\n  const { error } = await supabase.from('workspace_message_files').insert(rows);\n\n  if (error) throw error;\n}\n\n/**\n * Get all files for a workspace\n */\nexport async function getWorkspaceFiles(\n  workspaceId: number,\n  limit: number = 50\n): Promise<WorkspaceFile[]> {\n  const { data, error } = await supabase\n    .from('workspace_files')\n    .select(\n      'id, orginal_file_name, file_path, file_size, mime_type, created_at'\n    )\n    .eq('workspace_id', workspaceId)\n    .order('created_at', { ascending: false })\n    .limit(limit);\n\n  if (error) throw error;\n\n  // Map the typo field name to correct one\n  return (data || []).map(file => ({\n    id: file.id,\n    original_filename: file.orginal_file_name,\n    file_path: file.file_path,\n    file_size: file.file_size,\n    mime_type: file.mime_type,\n    created_at: file.created_at,\n  }));\n}\n\n/**\n * Delete a workspace file\n */\nexport async function deleteWorkspaceFile(\n  workspaceFileId: number\n): Promise<void> {\n  // First, get the file path from the database\n  const { data: fileData, error: fetchError } = await supabase\n    .from('workspace_files')\n    .select('file_path')\n    .eq('id', workspaceFileId)\n    .single();\n\n  if (fetchError) {\n    console.warn('Error fetching file for deletion:', fetchError);\n  }\n\n  // Delete from storage if we have the path\n  if (fileData?.file_path) {\n    const { error: storageError } = await supabase.storage\n      .from(WORKSPACE_FILES_BUCKET)\n      .remove([fileData.file_path]);\n\n    if (storageError) {\n      console.warn('Error deleting file from storage:', storageError);\n    }\n  }\n\n  // Delete from workspace_files table (CASCADE will handle workspace_message_files)\n  const { error: dbError } = await supabase\n    .from('workspace_files')\n    .delete()\n    .eq('id', workspaceFileId);\n\n  if (dbError) {\n    console.warn('Error deleting file from database:', dbError);\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/api/mentionsApi.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/browserClient';\n\nconst supabase = createClient();\n\nexport interface Mention {\n  id: number;\n  workspace_id: number;\n  created_at: string;\n  source_type: 'note' | 'message';\n  source_id: number;\n  target_type: 'workspace_member' | 'note';\n  target_id: number;\n  created_by: number;\n}\n\n/**\n * Create a mention record\n */\nexport async function createMention(\n  workspaceId: number,\n  sourceType: 'note' | 'message',\n  sourceId: number,\n  targetType: 'workspace_member' | 'note',\n  targetId: number,\n  createdBy: number\n): Promise<Mention> {\n  const { data, error } = await supabase\n    .from('mentions')\n    .insert({\n      workspace_id: workspaceId,\n      source_type: sourceType,\n      source_id: sourceId,\n      target_type: targetType,\n      target_id: targetId,\n      created_by: createdBy,\n    })\n    .select()\n    .single();\n\n  if (error) throw error;\n  return data;\n}\n\n/**\n * Get all mentions for a specific note or message\n */\nexport async function getMentionsForSource(\n  sourceType: 'note' | 'message',\n  sourceId: number\n): Promise<Mention[]> {\n  const { data, error } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', sourceType)\n    .eq('source_id', sourceId);\n\n  if (error) throw error;\n  return data || [];\n}\n\n/**\n * Sync member mentions for a note - compares existing with new and updates accordingly\n */\nexport async function syncNoteMemberMentions(\n  noteId: number,\n  workspaceId: number,\n  mentionedMemberIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing member mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'note')\n    .eq('source_id', noteId)\n    .eq('target_type', 'workspace_member');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedMemberIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedMemberIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'note' as const,\n      source_id: noteId,\n      target_type: 'workspace_member' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Sync note mentions for a note - compares existing with new and updates accordingly\n */\nexport async function syncNoteToNoteMentions(\n  noteId: number,\n  workspaceId: number,\n  mentionedNoteIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing note mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'note')\n    .eq('source_id', noteId)\n    .eq('target_type', 'note');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedNoteIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedNoteIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'note' as const,\n      source_id: noteId,\n      target_type: 'note' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Delete all mentions for a note\n */\nexport async function deleteNoteMentions(noteId: number): Promise<void> {\n  const { error } = await supabase\n    .from('mentions')\n    .delete()\n    .eq('source_type', 'note')\n    .eq('source_id', noteId);\n\n  if (error) throw error;\n}\n\n/**\n * Sync member mentions for a workspace message - compares existing with new and updates accordingly\n */\nexport async function syncWorkspaceMessageMentions(\n  messageId: number,\n  workspaceId: number,\n  mentionedMemberIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing member mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'message')\n    .eq('source_id', messageId)\n    .eq('target_type', 'workspace_member');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedMemberIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedMemberIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'message' as const,\n      source_id: messageId,\n      target_type: 'workspace_member' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Sync file mentions for a workspace message - compares existing with new and updates accordingly\n */\nexport async function syncWorkspaceMessageFileMentions(\n  messageId: number,\n  workspaceId: number,\n  mentionedFileIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing file mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'message')\n    .eq('source_id', messageId)\n    .eq('target_type', 'workspace_file');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedFileIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedFileIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'message' as const,\n      source_id: messageId,\n      target_type: 'workspace_file' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Sync note mentions for a workspace message - compares existing with new and updates accordingly\n */\nexport async function syncWorkspaceMessageNoteMentions(\n  messageId: number,\n  workspaceId: number,\n  mentionedNoteIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing note mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'message')\n    .eq('source_id', messageId)\n    .eq('target_type', 'note');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedNoteIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedNoteIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'message' as const,\n      source_id: messageId,\n      target_type: 'note' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Get all notes/messages where a user is mentioned\n */\nexport async function getUserMentions(\n  workspaceMemberId: number\n): Promise<Mention[]> {\n  const { data, error } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('target_type', 'workspace_member')\n    .eq('target_id', workspaceMemberId)\n    .order('created_at', { ascending: false });\n\n  if (error) throw error;\n  return data || [];\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 317, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/api/workspaceMessagesApi.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/browserClient';\nimport {\n  normalizeWorkspaceProfile,\n  type SupabaseProfile,\n} from '@/lib/api/profileUtils';\nimport type { WorkspaceMessage } from '@/types/workspace';\nimport { linkFilesToMessage } from './workspaceFilesApi';\nimport {\n  syncWorkspaceMessageMentions,\n  syncWorkspaceMessageNoteMentions,\n} from './mentionsApi';\n\nconst supabase = createClient();\n\ntype RawWorkspaceMember = Omit<\n  NonNullable<WorkspaceMessage['workspace_member']>,\n  'user_profile'\n> & {\n  user_profile?: SupabaseProfile;\n};\n\ntype RawWorkspaceMessageRead = {\n  workspace_message_id: number;\n  workspace_member_id: number;\n  read_at?: string;\n  created_at?: string;\n  workspace_member?: RawWorkspaceMember | null;\n};\n\ntype RawWorkspaceMessageFile = {\n  id: number;\n  workspace_file_id: number; // bigint (foreign key to workspace_files.id)\n  workspace_file?: {\n    id: number; // bigint (database primary key)\n    orginal_file_name: string;\n    file_path: string; // Contains UUID in path: {workspace_id}/uploads/{uuid}/{filename}\n    mime_type: string;\n    file_size: number;\n  } | null;\n};\n\ntype RawWorkspaceMessage = WorkspaceMessage & {\n  workspace_member?: RawWorkspaceMember | null;\n  workspace_message_reads?: RawWorkspaceMessageRead[] | null;\n  replied_message?: RawWorkspaceMessage | null;\n  workspace_message_files?: RawWorkspaceMessageFile[] | null;\n};\n\nfunction transformMessageRow(\n  row: RawWorkspaceMessage | null\n): WorkspaceMessage {\n  if (!row) {\n    return row as unknown as WorkspaceMessage;\n  }\n\n  const {\n    workspace_member,\n    workspace_message_reads,\n    replied_message,\n    workspace_message_files,\n    ...rest\n  } = row;\n\n  const workspaceMember = workspace_member\n    ? {\n        ...workspace_member,\n        user_profile:\n          normalizeWorkspaceProfile(workspace_member.user_profile) ?? null,\n      }\n    : undefined;\n\n  const reads = (workspace_message_reads ?? []).map(read => ({\n    workspace_message_id: read.workspace_message_id,\n    workspace_member_id: read.workspace_member_id,\n    read_at: read.read_at ?? read.created_at ?? new Date().toISOString(),\n    workspace_member: read.workspace_member\n      ? {\n          ...read.workspace_member,\n          user_profile:\n            normalizeWorkspaceProfile(read.workspace_member.user_profile) ??\n            null,\n        }\n      : undefined,\n  }));\n\n  // Transform replied message if it exists\n  const transformedRepliedMessage = replied_message\n    ? transformMessageRow(replied_message)\n    : null;\n\n  // Transform files - join through workspace_files table\n  const files = (workspace_message_files ?? [])\n    .filter(fileLink => fileLink.workspace_file)\n    .map(fileLink => ({\n      id: fileLink.workspace_file!.id,\n      original_filename: fileLink.workspace_file!.orginal_file_name, // Note: schema typo\n      file_path: fileLink.workspace_file!.file_path,\n      mime_type: fileLink.workspace_file!.mime_type,\n      file_size: fileLink.workspace_file!.file_size,\n    }));\n\n  return {\n    ...rest,\n    workspace_member: workspaceMember,\n    replied_message: transformedRepliedMessage,\n    reads,\n    read_count: reads.length,\n    files: files.length > 0 ? files : undefined,\n  };\n}\n\nexport async function getWorkspaceMessages(\n  workspaceId: number,\n  limit: number = 50,\n  beforeTimestamp?: string\n): Promise<WorkspaceMessage[]> {\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    throw new Error('User not authenticated');\n  }\n\n  let query = supabase\n    .from('workspace_messages')\n    .select(\n      `\n      *,\n      workspace_member:workspace_member_id(\n        id,\n        user_id,\n        user_profile:user_id(id, name, avatar_url)\n      ),\n      workspace_message_reads(\n        workspace_message_id,\n        workspace_member_id,\n        created_at,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      ),\n      replied_message:reply_to_id(\n        id,\n        text,\n        created_at,\n        workspace_member_id,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      ),\n      workspace_message_files(\n        id,\n        workspace_file_id,\n        workspace_file:workspace_file_id(\n          id,\n          orginal_file_name,\n          file_path,\n          mime_type,\n          file_size\n        )\n      )\n    `\n    )\n    .eq('workspace_id', workspaceId);\n\n  // If beforeTimestamp is provided, get messages older than that timestamp\n  if (beforeTimestamp) {\n    query = query.lt('created_at', beforeTimestamp);\n  }\n\n  const { data, error } = await query\n    .order('created_at', { ascending: false })\n    .limit(limit);\n\n  if (error) throw error;\n\n  // Transform nested structure\n  return (data || []).map(transformMessageRow);\n}\n\nexport async function sendWorkspaceMessage(\n  workspaceId: number,\n  workspaceMemberId: number,\n  text: string,\n  replyToId?: number | null,\n  workspaceFileIds?: number[],\n  mentionedMemberIds?: number[],\n  mentionedNoteIds?: number[]\n): Promise<WorkspaceMessage> {\n  const { data, error } = await supabase\n    .from('workspace_messages')\n    .insert({\n      workspace_id: workspaceId,\n      workspace_member_id: workspaceMemberId,\n      text,\n      reply_to_id: replyToId ?? null,\n    })\n    .select(\n      `\n      *,\n      workspace_member:workspace_member_id(\n        id,\n        user_id,\n        user_profile:user_id(id, name, avatar_url)\n      ),\n      workspace_message_reads(\n        workspace_message_id,\n        workspace_member_id,\n        created_at,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      ),\n      replied_message:reply_to_id(\n        id,\n        text,\n        created_at,\n        workspace_member_id,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      )\n    `\n    )\n    .single();\n\n  if (error) throw error;\n\n  // Link files to message if any\n  if (workspaceFileIds && workspaceFileIds.length > 0) {\n    try {\n      await linkFilesToMessage(data.id, workspaceFileIds);\n    } catch (fileError) {\n      console.error('Error linking files to message:', fileError);\n      // Don't throw - message was created successfully, just file linking failed\n    }\n  }\n\n  // Sync member mentions if any\n  if (mentionedMemberIds && mentionedMemberIds.length > 0) {\n    try {\n      await syncWorkspaceMessageMentions(\n        data.id,\n        workspaceId,\n        mentionedMemberIds,\n        workspaceMemberId\n      );\n    } catch (mentionError) {\n      console.error('Error syncing member mentions:', mentionError);\n      // Don't throw - message was created successfully, just mention syncing failed\n    }\n  }\n\n  // Sync note mentions if any\n  if (mentionedNoteIds && mentionedNoteIds.length > 0) {\n    try {\n      await syncWorkspaceMessageNoteMentions(\n        data.id,\n        workspaceId,\n        mentionedNoteIds,\n        workspaceMemberId\n      );\n    } catch (mentionError) {\n      console.error('Error syncing note mentions:', mentionError);\n      // Don't throw - message was created successfully, just mention syncing failed\n    }\n  }\n\n  // Transform nested structure\n  return transformMessageRow(data);\n}\n\nexport async function updateWorkspaceMessage(\n  messageId: number,\n  text: string\n): Promise<WorkspaceMessage> {\n  const { data, error } = await supabase\n    .from('workspace_messages')\n    .update({ text })\n    .eq('id', messageId)\n    .select(\n      `\n      *,\n      workspace_member:workspace_member_id(\n        id,\n        user_id,\n        user_profile:user_id(id, name, avatar_url)\n      ),\n      workspace_message_reads(\n        workspace_message_id,\n        workspace_member_id,\n        created_at,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      ),\n      replied_message:reply_to_id(\n        id,\n        text,\n        created_at,\n        workspace_member_id,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      )\n    `\n    )\n    .single();\n\n  if (error) throw error;\n\n  return transformMessageRow(data);\n}\n\nexport async function deleteWorkspaceMessage(messageId: number): Promise<void> {\n  const { error } = await supabase\n    .from('workspace_messages')\n    .delete()\n    .eq('id', messageId);\n\n  if (error) throw error;\n}\n\nexport type CurrentWorkspaceMember = {\n  id: number;\n  last_read_message_id: number | null;\n};\n\nexport async function getCurrentWorkspaceMember(\n  workspaceId: number\n): Promise<CurrentWorkspaceMember | null> {\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    throw new Error('User not authenticated');\n  }\n\n  const { data, error } = await supabase\n    .from('workspace_member')\n    .select('id, last_read_message_id')\n    .eq('workspace_id', workspaceId)\n    .eq('user_id', user.id)\n    .maybeSingle();\n\n  if (error) throw error;\n\n  if (!data) {\n    return null;\n  }\n\n  return {\n    id: data.id,\n    last_read_message_id: data.last_read_message_id ?? null,\n  };\n}\n\nexport async function markWorkspaceMessagesAsRead(\n  workspaceId: number,\n  workspaceMemberId: number,\n  messageIds: number[],\n  currentLastRead?: number | null\n): Promise<number | null> {\n  if (messageIds.length === 0) {\n    return currentLastRead ?? null;\n  }\n\n  const uniqueIds = Array.from(new Set(messageIds));\n  const rows = uniqueIds.map(messageId => ({\n    workspace_message_id: messageId,\n    workspace_member_id: workspaceMemberId,\n  }));\n\n  const { error: upsertError } = await supabase\n    .from('workspace_message_reads')\n    .upsert(rows, {\n      onConflict: 'workspace_message_id,workspace_member_id',\n    });\n\n  if (upsertError) throw upsertError;\n\n  const newLastRead = Math.max(...uniqueIds);\n  const lastReadToCompare = currentLastRead ?? null;\n\n  if (lastReadToCompare !== null && newLastRead <= lastReadToCompare) {\n    return lastReadToCompare;\n  }\n\n  const { error: updateError } = await supabase\n    .from('workspace_member')\n    .update({ last_read_message_id: newLastRead })\n    .eq('id', workspaceMemberId)\n    .eq('workspace_id', workspaceId);\n\n  if (updateError) throw updateError;\n\n  return newLastRead;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 495, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/hooks/useWorkspaceChat.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport useSWR from 'swr';\nimport { createClient } from '@/lib/supabase/browserClient';\nimport type { WorkspaceMessage } from '@/types/workspace';\nimport {\n  getWorkspaceMessages,\n  sendWorkspaceMessage,\n  getCurrentWorkspaceMember,\n  markWorkspaceMessagesAsRead,\n  type CurrentWorkspaceMember,\n} from '@/lib/api/workspaceMessagesApi';\n\n// SWR keys\nconst messagesKey = (\n  workspaceId: number,\n  limit?: number,\n  beforeTimestamp?: string\n) => {\n  const params = new URLSearchParams();\n  if (limit) params.set('limit', limit.toString());\n  if (beforeTimestamp) params.set('before', beforeTimestamp);\n  const query = params.toString();\n  return `/workspaces/${workspaceId}/messages${query ? `?${query}` : ''}`;\n};\n\nconst workspaceMemberKey = (workspaceId: number) =>\n  `/workspaces/${workspaceId}/member`;\n\n// Raw message from DB without joins\ntype RawMessage = {\n  id: number;\n  workspace_id: number;\n  workspace_member_id: number;\n  text: string;\n  created_at: string;\n  updated_at: string;\n};\n\nexport function useWorkspaceChat(workspaceId: number) {\n  const supabase = createClient();\n  const channelRef = useRef<ReturnType<typeof supabase.channel> | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const retryCountRef = useRef(0);\n  const lastMarkedMessageIdRef = useRef<number | null>(null);\n  const markInFlightRef = useRef(false);\n  const workspaceMemberRef = useRef<CurrentWorkspaceMember | null>(null);\n  const oldestMessageTimestampRef = useRef<string | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [hasMoreMessages, setHasMoreMessages] = useState(true);\n  const [localMessages, setLocalMessages] = useState<WorkspaceMessage[]>([]);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const [sendError, setSendError] = useState<string | null>(null);\n\n  // Fetch workspace member using SWR\n  const {\n    data: workspaceMember,\n    error: memberError,\n    mutate: mutateMember,\n  } = useSWR<CurrentWorkspaceMember | null>(\n    workspaceMemberKey(workspaceId),\n    () => getCurrentWorkspaceMember(workspaceId),\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  // Fetch initial messages using SWR\n  const {\n    data: initialMessages,\n    error: messagesError,\n    isLoading,\n    mutate: mutateMessages,\n  } = useSWR<WorkspaceMessage[]>(\n    messagesKey(workspaceId, 50),\n    () => getWorkspaceMessages(workspaceId, 50),\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  // Update workspace member ref when it changes\n  useEffect(() => {\n    if (workspaceMember) {\n      workspaceMemberRef.current = workspaceMember;\n    }\n  }, [workspaceMember]);\n\n  // Decorate messages with read status\n  const decorateMessages = useCallback(\n    (\n      rawMessages: WorkspaceMessage[],\n      memberOverride?: CurrentWorkspaceMember | null\n    ) => {\n      const member = memberOverride ?? workspaceMemberRef.current;\n      const memberId = member?.id ?? null;\n      const lastReadId = member?.last_read_message_id ?? null;\n\n      return rawMessages.map(message => {\n        const existingReads = message.reads ? [...message.reads] : [];\n        const readCount = message.read_count ?? existingReads.length;\n        const hasExistingRead =\n          memberId !== null\n            ? existingReads.some(read => read.workspace_member_id === memberId)\n            : false;\n        const withinLastReadRange =\n          memberId !== null && lastReadId !== null && message.id <= lastReadId;\n\n        return {\n          ...message,\n          reads: existingReads,\n          read_count: readCount,\n          is_read_by_current_user: hasExistingRead || withinLastReadRange,\n        };\n      });\n    },\n    []\n  );\n\n  // Initialize local messages from SWR data\n  useEffect(() => {\n    if (initialMessages) {\n      const reversedMessages = [...initialMessages].reverse();\n      const decorated = decorateMessages(reversedMessages, workspaceMember);\n      setLocalMessages(decorated);\n\n      // Track pagination state\n      if (reversedMessages.length > 0) {\n        oldestMessageTimestampRef.current =\n          reversedMessages[0]?.created_at || null;\n      }\n      setHasMoreMessages(initialMessages.length === 50);\n    }\n  }, [initialMessages, workspaceMember, decorateMessages]);\n\n  // Re-decorate messages when workspace member changes\n  useEffect(() => {\n    if (workspaceMember) {\n      setLocalMessages(prev => decorateMessages(prev, workspaceMember));\n    }\n  }, [workspaceMember, decorateMessages]);\n\n  // Set up Realtime subscription with retry logic\n  useEffect(() => {\n    let mounted = true;\n\n    async function setupRealtime() {\n      // Clear existing reconnect timeout\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n        reconnectTimeoutRef.current = null;\n      }\n\n      // Remove existing channel\n      if (channelRef.current) {\n        supabase.removeChannel(channelRef.current);\n        channelRef.current = null;\n      }\n\n      try {\n        // Get current session to ensure we have auth\n        const {\n          data: { session },\n        } = await supabase.auth.getSession();\n\n        if (!session || !mounted) {\n          console.warn('No session available for Realtime');\n          setIsConnected(false);\n          return;\n        }\n\n        // Set auth for Realtime\n        await supabase.realtime.setAuth();\n\n        const channel = supabase.channel(`workspace:${workspaceId}:messages`, {\n          config: { private: true, broadcast: { self: true, ack: true } },\n        });\n\n        channel\n          .on('broadcast', { event: 'INSERT' }, () => {\n            if (!mounted) return;\n            // When broadcast is received, revalidate messages\n            mutateMessages();\n          })\n          .on('broadcast', { event: 'UPDATE' }, () => {\n            if (!mounted) return;\n            // Revalidate on update\n            mutateMessages();\n          })\n          .on('broadcast', { event: 'DELETE' }, ({ payload }) => {\n            if (!mounted) return;\n            const deleted = payload.old as RawMessage;\n            if (deleted && deleted.id) {\n              setLocalMessages(prev =>\n                prev.filter(msg => msg.id !== deleted.id)\n              );\n            }\n          })\n          .subscribe((status, err) => {\n            if (!mounted) return;\n\n            console.log('Realtime status:', status, err ? { err } : '');\n\n            if (status === 'SUBSCRIBED') {\n              setIsConnected(true);\n              retryCountRef.current = 0;\n            } else if (\n              status === 'CHANNEL_ERROR' ||\n              status === 'TIMED_OUT' ||\n              status === 'CLOSED'\n            ) {\n              setIsConnected(false);\n\n              // Retry connection with exponential backoff\n              const maxRetries = 5;\n              if (retryCountRef.current < maxRetries) {\n                retryCountRef.current += 1;\n                const delay = Math.min(\n                  1000 * Math.pow(2, retryCountRef.current),\n                  30000\n                );\n\n                reconnectTimeoutRef.current = setTimeout(() => {\n                  if (mounted) {\n                    console.log(\n                      `Retrying Realtime connection (attempt ${retryCountRef.current})...`\n                    );\n                    setupRealtime();\n                  }\n                }, delay);\n              } else {\n                console.error('Max retries reached for Realtime connection.');\n              }\n            }\n          });\n\n        channelRef.current = channel;\n      } catch (err) {\n        if (!mounted) return;\n        console.error('Error setting up Realtime:', err);\n        setIsConnected(false);\n\n        // Retry after delay\n        if (retryCountRef.current < 5) {\n          retryCountRef.current += 1;\n          const delay = Math.min(\n            1000 * Math.pow(2, retryCountRef.current),\n            30000\n          );\n          reconnectTimeoutRef.current = setTimeout(() => {\n            if (mounted) {\n              setupRealtime();\n            }\n          }, delay);\n        }\n      }\n    }\n\n    // Wait a bit for auth to be ready\n    const initTimeout = setTimeout(() => {\n      setupRealtime();\n    }, 500);\n\n    return () => {\n      mounted = false;\n      clearTimeout(initTimeout);\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (channelRef.current) {\n        supabase.removeChannel(channelRef.current);\n      }\n    };\n  }, [workspaceId, supabase, mutateMessages]);\n\n  const sendMessage = useCallback(\n    async (\n      text: string,\n      replyToId?: number | null,\n      workspaceFileIds?: number[],\n      mentionedMemberIds?: number[],\n      mentionedNoteIds?: number[]\n    ) => {\n      if (!workspaceMember?.id) return;\n      // Allow sending if there's text or files\n      if (!text.trim() && (!workspaceFileIds || workspaceFileIds.length === 0))\n        return;\n\n      setSendError(null);\n\n      try {\n        await sendWorkspaceMessage(\n          workspaceId,\n          workspaceMember.id,\n          text,\n          replyToId,\n          workspaceFileIds,\n          mentionedMemberIds,\n          mentionedNoteIds\n        );\n        // Revalidate messages to get the new one\n        mutateMessages();\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error ? err.message : 'Failed to send message';\n        setSendError(errorMessage);\n        console.error('Error sending message:', err);\n        throw err;\n      }\n    },\n    [workspaceId, workspaceMember, mutateMessages]\n  );\n\n  // Load more messages (for infinite scroll)\n  const loadMoreMessages = useCallback(async () => {\n    if (\n      !hasMoreMessages ||\n      isLoadingMore ||\n      !oldestMessageTimestampRef.current\n    ) {\n      return;\n    }\n\n    setIsLoadingMore(true);\n    setSendError(null);\n\n    try {\n      const olderMessages = await getWorkspaceMessages(\n        workspaceId,\n        50,\n        oldestMessageTimestampRef.current\n      );\n\n      if (olderMessages.length === 0) {\n        setHasMoreMessages(false);\n        setIsLoadingMore(false);\n        return;\n      }\n\n      // Reverse to show oldest first\n      const reversedOlderMessages = [...olderMessages].reverse();\n\n      setLocalMessages(prev => {\n        // Prepend older messages to the beginning\n        const allMessages = [...reversedOlderMessages, ...prev];\n        return decorateMessages(allMessages, workspaceMemberRef.current);\n      });\n\n      // Update oldest message timestamp\n      if (reversedOlderMessages.length > 0) {\n        oldestMessageTimestampRef.current =\n          reversedOlderMessages[0]?.created_at || null;\n      }\n\n      // Check if there are more messages to load\n      setHasMoreMessages(olderMessages.length === 50);\n    } catch (err) {\n      const errorMessage =\n        err instanceof Error ? err.message : 'Failed to load older messages';\n      setSendError(errorMessage);\n      console.error('Error loading older messages:', err);\n    } finally {\n      setIsLoadingMore(false);\n    }\n  }, [workspaceId, hasMoreMessages, isLoadingMore, decorateMessages]);\n\n  // Mark messages as read when they appear\n  useEffect(() => {\n    if (!workspaceMember?.id) return;\n    if (localMessages.length === 0) return;\n    if (markInFlightRef.current) return;\n\n    const lastRead =\n      workspaceMember.last_read_message_id ??\n      lastMarkedMessageIdRef.current ??\n      0;\n\n    const unreadMessages = localMessages.filter(message => {\n      if (message.workspace_member_id === workspaceMember.id) {\n        return false;\n      }\n\n      return !message.is_read_by_current_user && message.id > lastRead;\n    });\n\n    if (unreadMessages.length === 0) return;\n\n    const messageIds = Array.from(\n      new Set(unreadMessages.map(message => message.id))\n    );\n\n    markInFlightRef.current = true;\n    let cancelled = false;\n\n    (async () => {\n      try {\n        const updatedLastRead = await markWorkspaceMessagesAsRead(\n          workspaceId,\n          workspaceMember.id,\n          messageIds,\n          workspaceMember.last_read_message_id ?? lastMarkedMessageIdRef.current\n        );\n\n        if (cancelled) return;\n\n        const newLastReadValue =\n          updatedLastRead ?? workspaceMember.last_read_message_id ?? null;\n\n        lastMarkedMessageIdRef.current =\n          newLastReadValue ?? lastMarkedMessageIdRef.current;\n\n        // Update workspace member in SWR cache\n        mutateMember((current): CurrentWorkspaceMember | null => {\n          if (!current) return current ?? null;\n          return {\n            ...current,\n            last_read_message_id:\n              newLastReadValue ?? current.last_read_message_id ?? null,\n          };\n        }, false);\n\n        // Update local messages state\n        const messageIdSet = new Set(messageIds);\n\n        setLocalMessages(prev =>\n          prev.map(message => {\n            if (!messageIdSet.has(message.id)) {\n              return message;\n            }\n\n            const existingReads = message.reads ?? [];\n            const hasExistingRead = existingReads.some(\n              read => read.workspace_member_id === workspaceMember.id\n            );\n            const baseReadCount = message.read_count ?? existingReads.length;\n\n            const updatedReads = hasExistingRead\n              ? existingReads\n              : [\n                  ...existingReads,\n                  {\n                    workspace_message_id: message.id,\n                    workspace_member_id: workspaceMember.id,\n                    read_at: new Date().toISOString(),\n                    created_at: new Date().toISOString(),\n                    workspace_member: undefined,\n                  },\n                ];\n\n            return {\n              ...message,\n              reads: updatedReads,\n              read_count: hasExistingRead ? baseReadCount : baseReadCount + 1,\n              is_read_by_current_user: true,\n            };\n          })\n        );\n      } catch (err) {\n        console.error('Error marking messages as read:', err);\n      } finally {\n        if (!cancelled) {\n          markInFlightRef.current = false;\n        }\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n      markInFlightRef.current = false;\n    };\n  }, [localMessages, workspaceId, workspaceMember, mutateMember]);\n\n  // Combine errors\n  const error =\n    memberError || messagesError\n      ? memberError?.message ||\n        messagesError?.message ||\n        'Failed to load chat data'\n      : sendError;\n\n  return {\n    messages: localMessages,\n    sendMessage,\n    isLoading,\n    isLoadingMore,\n    error,\n    isConnected,\n    workspaceMember,\n    loadMoreMessages,\n    hasMoreMessages,\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 956, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/VoiceInputButton.tsx"],"sourcesContent":["'use client';\n\nimport { Mic } from 'lucide-react';\nimport {\n  useState,\n  useRef,\n  useEffect,\n  forwardRef,\n  useImperativeHandle,\n} from 'react';\n\n// API\ninterface SpeechRecognitionResult {\n  isFinal: boolean;\n  [index: number]: {\n    transcript: string;\n  };\n}\n\ninterface SpeechRecognitionResultList {\n  length: number;\n  item(index: number): SpeechRecognitionResult;\n  [index: number]: SpeechRecognitionResult;\n}\n\ninterface SpeechRecognitionEvent extends Event {\n  resultIndex: number;\n  results: SpeechRecognitionResultList;\n}\n\ninterface SpeechRecognition extends EventTarget {\n  continuous: boolean;\n  interimResults: boolean;\n  lang: string;\n  start(): void;\n  stop(): void;\n  onresult: (event: SpeechRecognitionEvent) => void;\n  onerror: (event: { error: string; message?: string }) => void;\n  onend: () => void;\n}\n\ndeclare global {\n  interface Window {\n    SpeechRecognition: {\n      new (): SpeechRecognition;\n    };\n    webkitSpeechRecognition: {\n      new (): SpeechRecognition;\n    };\n  }\n}\n\ninterface VoiceInputButtonProps {\n  onTranscriptChange: (text: string) => void;\n  currentText?: string;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport interface VoiceInputButtonRef {\n  restartRecording: () => void;\n}\n\nexport const VoiceInputButton = forwardRef<\n  VoiceInputButtonRef,\n  VoiceInputButtonProps\n>(\n  (\n    { onTranscriptChange, currentText = '', disabled = false, className = '' },\n    ref\n  ) => {\n    const [isRecording, setIsRecording] = useState(false);\n    const recognitionRef = useRef<SpeechRecognition | null>(null);\n    const finalTranscriptRef = useRef<string>('');\n    const lastInterimTranscriptRef = useRef<string>('');\n    const processedResultIndexRef = useRef<number>(0);\n\n    // finalTranscriptRef\n    useEffect(() => {\n      if (!isRecording) {\n        finalTranscriptRef.current = currentText;\n      }\n    }, [currentText, isRecording]);\n\n    // \n    useEffect(() => {\n      return () => {\n        if (recognitionRef.current) {\n          recognitionRef.current.stop();\n        }\n      };\n    }, []);\n\n    // Expose restartRecording method to parent\n    useImperativeHandle(ref, () => ({\n      restartRecording: () => {\n        if (isRecording) {\n          // Stop current recording\n          if (recognitionRef.current) {\n            recognitionRef.current.stop();\n            recognitionRef.current = null;\n          }\n          setIsRecording(false);\n          finalTranscriptRef.current = '';\n\n          onTranscriptChange('');\n          setTimeout(() => {\n            startRecording('');\n          }, 100);\n        }\n      },\n    }));\n\n    const startRecording = (overrideText?: string) => {\n      const SpeechRecognition =\n        window.SpeechRecognition || window.webkitSpeechRecognition;\n      if (!SpeechRecognition) {\n        console.error('API');\n        return;\n      }\n\n      // overrideText\n      finalTranscriptRef.current =\n        overrideText !== undefined ? overrideText : currentText;\n      // \n      lastInterimTranscriptRef.current = '';\n      // \n      processedResultIndexRef.current = 0;\n\n      const recognition = new SpeechRecognition();\n      recognitionRef.current = recognition;\n\n      recognition.lang = 'ja-JP';\n      recognition.continuous = true;\n      recognition.interimResults = true;\n\n      recognition.onresult = (event: SpeechRecognitionEvent) => {\n        // \n        let finalTranscript = finalTranscriptRef.current;\n\n        // \n        // event.results\n        const startIndex = processedResultIndexRef.current;\n        for (let i = startIndex; i < event.results.length; ++i) {\n          const result = event.results[i];\n          if (result.isFinal) {\n            const transcript = result[0].transcript;\n            finalTranscript += transcript;\n            finalTranscriptRef.current = finalTranscript;\n            // \n            processedResultIndexRef.current = i + 1;\n          }\n        }\n\n        // \n        // \n        let currentInterimTranscript = '';\n        const lastProcessedIndex = processedResultIndexRef.current;\n        for (let i = event.results.length - 1; i >= lastProcessedIndex; --i) {\n          const result = event.results[i];\n          if (!result.isFinal) {\n            currentInterimTranscript = result[0].transcript;\n            break; // \n          }\n        }\n\n        // \n        lastInterimTranscriptRef.current = currentInterimTranscript;\n\n        //  + \n        // \n        const fullText = finalTranscript + currentInterimTranscript;\n        onTranscriptChange(fullText);\n      };\n\n      recognition.onerror = event => {\n        console.error(':', event.error);\n        setIsRecording(false);\n      };\n\n      recognition.onend = () => {\n        console.log('');\n        // \n        if (isRecording && recognitionRef.current) {\n          try {\n            recognitionRef.current.start();\n            console.log('');\n          } catch (error) {\n            console.error(':', error);\n            setIsRecording(false);\n            recognitionRef.current = null;\n          }\n        }\n      };\n\n      try {\n        recognition.start();\n        setIsRecording(true);\n        console.log('');\n      } catch (error) {\n        console.error(':', error);\n      }\n    };\n\n    const handleVoiceInput = (event: React.MouseEvent<HTMLButtonElement>) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (!isRecording) {\n        startRecording();\n      } else {\n        // 0.5\n        setTimeout(() => {\n          if (recognitionRef.current) {\n            try {\n              recognitionRef.current.stop();\n              console.log('');\n            } catch (error) {\n              console.error(':', error);\n            }\n            recognitionRef.current = null;\n          }\n          setIsRecording(false);\n        }, 800);\n      }\n    };\n\n    const Icon = isRecording ? Mic : Mic;\n\n    return (\n      <button\n        onClick={handleVoiceInput}\n        disabled={disabled}\n        type='button'\n        title={isRecording ? '' : ''}\n        className={`${className} relative flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300`}\n      >\n        <Icon\n          className={`w-5 h-5 relative z-10 transition-colors duration-300 ${\n            isRecording ? 'text-white' : 'text-white/40'\n          }`}\n          style={isRecording ? { animationDuration: '1.5s' } : undefined}\n        />\n      </button>\n    );\n  }\n);\n\nVoiceInputButton.displayName = 'VoiceInputButton';\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1156, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/MentionExtension.ts"],"sourcesContent":["import { createInlineMarkdownSpec, mergeAttributes } from '@tiptap/core';\nimport Mention from '@tiptap/extension-mention';\n\nexport interface MentionNodeAttrs {\n  id: string;\n  label: string;\n  workspaceMemberId: number;\n}\n\nexport const CustomMention = Mention.extend({\n  name: 'mention',\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-id'),\n        renderHTML: (attributes: { id: string }) => {\n          if (!attributes.id) {\n            return {};\n          }\n          return {\n            'data-id': attributes.id,\n          };\n        },\n      },\n      label: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-label'),\n        renderHTML: (attributes: { label: string }) => {\n          if (!attributes.label) {\n            return {};\n          }\n          return {\n            'data-label': attributes.label,\n          };\n        },\n      },\n      workspaceMemberId: {\n        default: null,\n        parseHTML: (element: HTMLElement) => {\n          const id = element.getAttribute('data-workspace-member-id');\n          return id ? parseInt(id, 10) : null;\n        },\n        renderHTML: (attributes: { workspaceMemberId: number }) => {\n          if (!attributes.workspaceMemberId) {\n            return {};\n          }\n          return {\n            'data-workspace-member-id': attributes.workspaceMemberId,\n          };\n        },\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span[data-type=\"mention\"]',\n      },\n    ];\n  },\n\n  renderHTML({\n    node,\n    HTMLAttributes,\n  }: {\n    node: Node;\n    HTMLAttributes: { [key: string]: string };\n  }) {\n    return [\n      'span',\n      mergeAttributes(\n        { 'data-type': 'mention' },\n        this.options.HTMLAttributes,\n        HTMLAttributes\n      ),\n      `@${HTMLAttributes['data-label'] || ''}`,\n    ];\n  },\n\n  renderText({ node }: { node: any }) {\n    return `@${node.attrs.label}`;\n  },\n\n  // Markdown support using Tiptap utility\n  ...createInlineMarkdownSpec({\n    nodeName: 'mention',\n    name: '@',\n    selfClosing: true,\n    allowedAttributes: ['id', 'label', 'workspaceMemberId'],\n  }),\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () =>\n        this.editor.commands.command(({ tr, state }) => {\n          let isMention = false;\n          const { selection } = state;\n          const { empty, anchor } = selection;\n\n          if (!empty) {\n            return false;\n          }\n\n          state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n            if (node.type.name === this.name) {\n              isMention = true;\n              tr.insertText('', pos, pos + node.nodeSize);\n              return false;\n            }\n          });\n\n          return isMention;\n        }),\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,MAAM,gBAAgB,4aAAO,CAAC,MAAM,CAAC;IAC1C,MAAM;IAEN;QACE,OAAO;YACL,IAAI;gBACF,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,EAAE,EAAE;wBAClB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,WAAW,WAAW,EAAE;oBAC1B;gBACF;YACF;YACA,OAAO;gBACL,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,KAAK,EAAE;wBACrB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,cAAc,WAAW,KAAK;oBAChC;gBACF;YACF;YACA,mBAAmB;gBACjB,SAAS;gBACT,WAAW,CAAC;oBACV,MAAM,KAAK,QAAQ,YAAY,CAAC;oBAChC,OAAO,KAAK,SAAS,IAAI,MAAM;gBACjC;gBACA,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,iBAAiB,EAAE;wBACjC,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,4BAA4B,WAAW,iBAAiB;oBAC1D;gBACF;YACF;QACF;IACF;IAEA;QACE,OAAO;YACL;gBACE,KAAK;YACP;SACD;IACH;IAEA,YAAW,KAMV;YANU,EACT,IAAI,EACJ,cAAc,EAIf,GANU;QAOT,OAAO;YACL;YACA,IAAA,4SAAe,EACb;gBAAE,aAAa;YAAU,GACzB,IAAI,CAAC,OAAO,CAAC,cAAc,EAC3B;YAED,IAAsC,OAAnC,cAAc,CAAC,aAAa,IAAI;SACrC;IACH;IAEA,YAAW,KAAuB;YAAvB,EAAE,IAAI,EAAiB,GAAvB;QACT,OAAO,AAAC,IAAoB,OAAjB,KAAK,KAAK,CAAC,KAAK;IAC7B;IAEA,wCAAwC;IACxC,GAAG,IAAA,qTAAwB,EAAC;QAC1B,UAAU;QACV,MAAM;QACN,aAAa;QACb,mBAAmB;YAAC;YAAM;YAAS;SAAoB;IACzD,EAAE;IAEF;QACE,OAAO;YACL,WAAW,IACT,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;wBAAC,EAAE,EAAE,EAAE,KAAK,EAAE;oBACzC,IAAI,YAAY;oBAChB,MAAM,EAAE,SAAS,EAAE,GAAG;oBACtB,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;oBAE1B,IAAI,CAAC,OAAO;wBACV,OAAO;oBACT;oBAEA,MAAM,GAAG,CAAC,YAAY,CAAC,SAAS,GAAG,QAAQ,CAAC,MAAM;wBAChD,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;4BAChC,YAAY;4BACZ,GAAG,UAAU,CAAC,IAAI,KAAK,MAAM,KAAK,QAAQ;4BAC1C,OAAO;wBACT;oBACF;oBAEA,OAAO;gBACT;QACJ;IACF;AACF","debugId":null}},
    {"offset": {"line": 1270, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/NoteMentionExtension.ts"],"sourcesContent":["import { createInlineMarkdownSpec, mergeAttributes } from '@tiptap/core';\nimport Mention from '@tiptap/extension-mention';\n\nexport interface NoteMentionNodeAttrs {\n  id: string;\n  label: string;\n  noteId: number;\n}\n\nexport const NoteMention = Mention.extend({\n  name: 'noteMention',\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-id'),\n        renderHTML: (attributes: { id: string }) => {\n          if (!attributes.id) {\n            return {};\n          }\n          return {\n            'data-id': attributes.id,\n          };\n        },\n      },\n      label: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-label'),\n        renderHTML: (attributes: { label: string }) => {\n          if (!attributes.label) {\n            return {};\n          }\n          return {\n            'data-label': attributes.label,\n          };\n        },\n      },\n      noteId: {\n        default: null,\n        parseHTML: (element: HTMLElement) => {\n          const id = element.getAttribute('data-note-id');\n          return id ? parseInt(id, 10) : null;\n        },\n        renderHTML: (attributes: { noteId: number }) => {\n          if (!attributes.noteId) {\n            return {};\n          }\n          return {\n            'data-note-id': attributes.noteId,\n          };\n        },\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span[data-type=\"noteMention\"]',\n      },\n    ];\n  },\n\n  renderHTML({\n    node,\n    HTMLAttributes,\n  }: {\n    node: Node;\n    HTMLAttributes: { [key: string]: string };\n  }) {\n    return [\n      'span',\n      mergeAttributes(\n        { 'data-type': 'noteMention' },\n        this.options.HTMLAttributes,\n        HTMLAttributes\n      ),\n      `#${HTMLAttributes['data-label'] || ''}`,\n    ];\n  },\n\n  renderText({ node }: { node: any }) {\n    return `#${node.attrs.label}`;\n  },\n\n  // Markdown support using Tiptap utility\n  ...createInlineMarkdownSpec({\n    nodeName: 'noteMention',\n    name: '#',\n    selfClosing: true,\n    allowedAttributes: ['id', 'label', 'noteId'],\n  }),\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () =>\n        this.editor.commands.command(({ tr, state }) => {\n          let isNoteMention = false;\n          const { selection } = state;\n          const { empty, anchor } = selection;\n\n          if (!empty) {\n            return false;\n          }\n\n          state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n            if (node.type.name === this.name) {\n              isNoteMention = true;\n              tr.insertText('', pos, pos + node.nodeSize);\n              return false;\n            }\n          });\n\n          return isNoteMention;\n        }),\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,MAAM,cAAc,4aAAO,CAAC,MAAM,CAAC;IACxC,MAAM;IAEN;QACE,OAAO;YACL,IAAI;gBACF,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,EAAE,EAAE;wBAClB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,WAAW,WAAW,EAAE;oBAC1B;gBACF;YACF;YACA,OAAO;gBACL,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,KAAK,EAAE;wBACrB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,cAAc,WAAW,KAAK;oBAChC;gBACF;YACF;YACA,QAAQ;gBACN,SAAS;gBACT,WAAW,CAAC;oBACV,MAAM,KAAK,QAAQ,YAAY,CAAC;oBAChC,OAAO,KAAK,SAAS,IAAI,MAAM;gBACjC;gBACA,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,MAAM,EAAE;wBACtB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,gBAAgB,WAAW,MAAM;oBACnC;gBACF;YACF;QACF;IACF;IAEA;QACE,OAAO;YACL;gBACE,KAAK;YACP;SACD;IACH;IAEA,YAAW,KAMV;YANU,EACT,IAAI,EACJ,cAAc,EAIf,GANU;QAOT,OAAO;YACL;YACA,IAAA,4SAAe,EACb;gBAAE,aAAa;YAAc,GAC7B,IAAI,CAAC,OAAO,CAAC,cAAc,EAC3B;YAED,IAAsC,OAAnC,cAAc,CAAC,aAAa,IAAI;SACrC;IACH;IAEA,YAAW,KAAuB;YAAvB,EAAE,IAAI,EAAiB,GAAvB;QACT,OAAO,AAAC,IAAoB,OAAjB,KAAK,KAAK,CAAC,KAAK;IAC7B;IAEA,wCAAwC;IACxC,GAAG,IAAA,qTAAwB,EAAC;QAC1B,UAAU;QACV,MAAM;QACN,aAAa;QACb,mBAAmB;YAAC;YAAM;YAAS;SAAS;IAC9C,EAAE;IAEF;QACE,OAAO;YACL,WAAW,IACT,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;wBAAC,EAAE,EAAE,EAAE,KAAK,EAAE;oBACzC,IAAI,gBAAgB;oBACpB,MAAM,EAAE,SAAS,EAAE,GAAG;oBACtB,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;oBAE1B,IAAI,CAAC,OAAO;wBACV,OAAO;oBACT;oBAEA,MAAM,GAAG,CAAC,YAAY,CAAC,SAAS,GAAG,QAAQ,CAAC,MAAM;wBAChD,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;4BAChC,gBAAgB;4BAChB,GAAG,UAAU,CAAC,IAAI,KAAK,MAAM,KAAK,QAAQ;4BAC1C,OAAO;wBACT;oBACF;oBAEA,OAAO;gBACT;QACJ;IACF;AACF","debugId":null}},
    {"offset": {"line": 1384, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/MentionList.tsx"],"sourcesContent":["'use client';\n\nimport React, {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { WorkspaceMember } from '@/types/workspace';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { User } from 'lucide-react';\n\nexport interface MentionListProps {\n  items: WorkspaceMember[];\n  command: (item: {\n    id: string;\n    label: string;\n    workspaceMemberId: number;\n  }) => void;\n}\n\nexport interface MentionListRef {\n  onKeyDown: (props: { event: KeyboardEvent }) => boolean;\n}\n\nexport const MentionList = forwardRef<MentionListRef, MentionListProps>(\n  (props, ref) => {\n    const [selectedIndex, setSelectedIndex] = useState(0);\n\n    const selectItem = (index: number) => {\n      const item = props.items[index];\n\n      if (item) {\n        props.command({\n          id: `member-${item.id}`,\n          label: item.user_profile?.name || 'Unknown',\n          workspaceMemberId: item.id,\n        });\n      }\n    };\n\n    const upHandler = () => {\n      setSelectedIndex(\n        (selectedIndex + props.items.length - 1) % props.items.length\n      );\n    };\n\n    const downHandler = () => {\n      setSelectedIndex((selectedIndex + 1) % props.items.length);\n    };\n\n    const enterHandler = () => {\n      selectItem(selectedIndex);\n    };\n\n    useEffect(() => setSelectedIndex(0), [props.items]);\n\n    useImperativeHandle(ref, () => ({\n      onKeyDown: ({ event }: { event: KeyboardEvent }) => {\n        if (event.key === 'ArrowUp') {\n          upHandler();\n          return true;\n        }\n\n        if (event.key === 'ArrowDown') {\n          downHandler();\n          return true;\n        }\n\n        if (event.key === 'Enter') {\n          enterHandler();\n          return true;\n        }\n\n        return false;\n      },\n    }));\n\n    return (\n      <div className='bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg shadow-lg overflow-hidden max-h-[300px] overflow-y-auto'>\n        {props.items.length ? (\n          props.items.map((item, index) => (\n            <button\n              className={`flex items-center gap-3 w-full px-4 py-2.5 text-left transition-colors ${\n                index === selectedIndex ? 'bg-white/20' : 'hover:bg-white/10'\n              }`}\n              key={item.id}\n              onClick={() => selectItem(index)}\n              type='button'\n            >\n              <Avatar className='h-8 w-8 border border-white/20 bg-white/10'>\n                {item.user_profile?.avatar_url ? (\n                  <AvatarImage\n                    src={item.user_profile.avatar_url}\n                    alt={item.user_profile.name ?? 'Member'}\n                  />\n                ) : (\n                  <AvatarFallback>\n                    <User className='w-4 h-4 text-gray-300' />\n                  </AvatarFallback>\n                )}\n              </Avatar>\n              <div>\n                <div className='text-white font-medium'>\n                  {item.user_profile?.name || 'Unknown'}\n                </div>\n                <div className='text-xs text-gray-400 capitalize'>\n                  {item.role}\n                </div>\n              </div>\n            </button>\n          ))\n        ) : (\n          <div className='px-4 py-3 text-sm text-gray-400'>\n            No members found\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nMentionList.displayName = 'MentionList';\n"],"names":[],"mappings":";;;;;AAEA;AAOA;AACA;;;AAVA;;;;AAyBO,MAAM,4BAAc,GAAA,IAAA,+ZAAU,UACnC,CAAC,OAAO;;IACN,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,6ZAAQ,EAAC;IAEnD,MAAM,aAAa,CAAC;QAClB,MAAM,OAAO,MAAM,KAAK,CAAC,MAAM;QAE/B,IAAI,MAAM;gBAGC;YAFT,MAAM,OAAO,CAAC;gBACZ,IAAI,AAAC,UAAiB,OAAR,KAAK,EAAE;gBACrB,OAAO,EAAA,qBAAA,KAAK,YAAY,cAAjB,yCAAA,mBAAmB,IAAI,KAAI;gBAClC,mBAAmB,KAAK,EAAE;YAC5B;QACF;IACF;IAEA,MAAM,YAAY;QAChB,iBACE,CAAC,gBAAgB,MAAM,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAEjE;IAEA,MAAM,cAAc;QAClB,iBAAiB,CAAC,gBAAgB,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAC3D;IAEA,MAAM,eAAe;QACnB,WAAW;IACb;IAEA,IAAA,8ZAAS;iCAAC,IAAM,iBAAiB;gCAAI;QAAC,MAAM,KAAK;KAAC;IAElD,IAAA,waAAmB,EAAC;2CAAK,IAAM,CAAC;gBAC9B,SAAS;uDAAE;4BAAC,EAAE,KAAK,EAA4B;wBAC7C,IAAI,MAAM,GAAG,KAAK,WAAW;4BAC3B;4BACA,OAAO;wBACT;wBAEA,IAAI,MAAM,GAAG,KAAK,aAAa;4BAC7B;4BACA,OAAO;wBACT;wBAEA,IAAI,MAAM,GAAG,KAAK,SAAS;4BACzB;4BACA,OAAO;wBACT;wBAEA,OAAO;oBACT;;YACF,CAAC;;IAED,qBACE,ibAAC;QAAI,WAAU;kBACZ,MAAM,KAAK,CAAC,MAAM,GACjB,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM;gBAUhB,oBAaE;gBAVM;iCAZb,ibAAC;gBACC,WAAW,AAAC,0EAEX,OADC,UAAU,gBAAgB,gBAAgB;gBAG5C,SAAS,IAAM,WAAW;gBAC1B,MAAK;;kCAEL,ibAAC,oMAAM;wBAAC,WAAU;kCACf,EAAA,qBAAA,KAAK,YAAY,cAAjB,yCAAA,mBAAmB,UAAU,kBAC5B,ibAAC,yMAAW;4BACV,KAAK,KAAK,YAAY,CAAC,UAAU;4BACjC,KAAK,CAAA,0BAAA,KAAK,YAAY,CAAC,IAAI,cAAtB,qCAAA,0BAA0B;;;;;qFAGjC,ibAAC,4MAAc;sCACb,cAAA,ibAAC,kQAAI;gCAAC,WAAU;;;;;;;;;;;;;;;;kCAItB,ibAAC;;0CACC,ibAAC;gCAAI,WAAU;0CACZ,EAAA,sBAAA,KAAK,YAAY,cAAjB,0CAAA,oBAAmB,IAAI,KAAI;;;;;;0CAE9B,ibAAC;gCAAI,WAAU;0CACZ,KAAK,IAAI;;;;;;;;;;;;;eArBT,KAAK,EAAE;;;;;2BA2BhB,ibAAC;YAAI,WAAU;sBAAkC;;;;;;;;;;;AAMzD;;AAGF,YAAY,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1541, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/mentionSuggestion.ts"],"sourcesContent":["import { ReactRenderer } from '@tiptap/react';\nimport tippy, { Instance as TippyInstance } from 'tippy.js';\nimport { MentionList, MentionListRef } from '@/components/tiptap/MentionList';\nimport { WorkspaceMember } from '@/types/workspace';\nimport { SuggestionOptions, SuggestionProps } from '@tiptap/suggestion';\n\nexport const createMentionSuggestion = (\n  getMembersRef: () => WorkspaceMember[]\n): Omit<SuggestionOptions, 'editor'> => ({\n  items: ({ query }: { query: string }) => {\n    const members = getMembersRef();\n    return members\n      .filter(member => {\n        const name = member.user_profile?.name?.toLowerCase() || '';\n        return name.includes(query.toLowerCase());\n      })\n      .slice(0, 5);\n  },\n\n  render: () => {\n    let component: ReactRenderer<MentionListRef> | undefined;\n    let popup: TippyInstance[] | undefined;\n\n    return {\n      onStart: (props: SuggestionProps) => {\n        component = new ReactRenderer(MentionList, {\n          props,\n          editor: props.editor,\n        });\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup = tippy('body', {\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n          appendTo: () => document.body,\n          content: component.element,\n          showOnCreate: true,\n          interactive: true,\n          trigger: 'manual',\n          placement: 'bottom-start',\n        });\n      },\n\n      onUpdate(props: SuggestionProps) {\n        component?.updateProps(props);\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup?.[0]?.setProps({\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n        });\n      },\n\n      onKeyDown(props: { event: KeyboardEvent }) {\n        if (props.event.key === 'Escape') {\n          popup?.[0]?.hide();\n          return true;\n        }\n\n        return component?.ref?.onKeyDown(props) ?? false;\n      },\n\n      onExit() {\n        popup?.[0]?.destroy();\n        component?.destroy();\n      },\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAIO,MAAM,0BAA0B,CACrC,gBACsC,CAAC;QACvC,OAAO;gBAAC,EAAE,KAAK,EAAqB;YAClC,MAAM,UAAU;YAChB,OAAO,QACJ,MAAM,CAAC,CAAA;oBACO,2BAAA;gBAAb,MAAM,OAAO,EAAA,uBAAA,OAAO,YAAY,cAAnB,4CAAA,4BAAA,qBAAqB,IAAI,cAAzB,gDAAA,0BAA2B,WAAW,OAAM;gBACzD,OAAO,KAAK,QAAQ,CAAC,MAAM,WAAW;YACxC,GACC,KAAK,CAAC,GAAG;QACd;QAEA,QAAQ;YACN,IAAI;YACJ,IAAI;YAEJ,OAAO;gBACL,SAAS,CAAC;oBACR,YAAY,IAAI,sbAAa,CAAC,kNAAW,EAAE;wBACzC;wBACA,QAAQ,MAAM,MAAM;oBACtB;oBAEA,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,QAAQ,IAAA,+PAAK,EAAC,QAAQ;wBACpB,wBAAwB,MAAM,UAAU;wBACxC,UAAU,IAAM,SAAS,IAAI;wBAC7B,SAAS,UAAU,OAAO;wBAC1B,cAAc;wBACd,aAAa;wBACb,SAAS;wBACT,WAAW;oBACb;gBACF;gBAEA,UAAS,KAAsB;wBAO7B;oBANA,sBAAA,gCAAA,UAAW,WAAW,CAAC;oBAEvB,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,kBAAA,6BAAA,UAAA,KAAO,CAAC,EAAE,cAAV,8BAAA,QAAY,QAAQ,CAAC;wBACnB,wBAAwB,MAAM,UAAU;oBAC1C;gBACF;gBAEA,WAAU,KAA+B;wBAMhC;oBALP,IAAI,MAAM,KAAK,CAAC,GAAG,KAAK,UAAU;4BAChC;wBAAA,kBAAA,6BAAA,UAAA,KAAO,CAAC,EAAE,cAAV,8BAAA,QAAY,IAAI;wBAChB,OAAO;oBACT;wBAEO;oBAAP,OAAO,CAAA,2BAAA,sBAAA,iCAAA,iBAAA,UAAW,GAAG,cAAd,qCAAA,eAAgB,SAAS,CAAC,oBAA1B,sCAAA,2BAAoC;gBAC7C;gBAEA;wBACE;oBAAA,kBAAA,6BAAA,UAAA,KAAO,CAAC,EAAE,cAAV,8BAAA,QAAY,OAAO;oBACnB,sBAAA,gCAAA,UAAW,OAAO;gBACpB;YACF;QACF;IACF,CAAC","debugId":null}},
    {"offset": {"line": 1618, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/NoteList.tsx"],"sourcesContent":["'use client';\n\nimport React, {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { NoteWithParsed } from '@/types/note';\nimport { FileText } from 'lucide-react';\n\nexport interface NoteListProps {\n  items: NoteWithParsed[];\n  command: (item: { id: string; label: string; noteId: number }) => void;\n}\n\nexport interface NoteListRef {\n  onKeyDown: (props: { event: KeyboardEvent }) => boolean;\n}\n\nexport const NoteList = forwardRef<NoteListRef, NoteListProps>((props, ref) => {\n  const [selectedIndex, setSelectedIndex] = useState(0);\n\n  const selectItem = (index: number) => {\n    const item = props.items[index];\n\n    if (item) {\n      props.command({\n        id: `note-${item.id}`,\n        label: item.title || 'Untitled',\n        noteId: item.id,\n      });\n    }\n  };\n\n  const upHandler = () => {\n    setSelectedIndex(\n      (selectedIndex + props.items.length - 1) % props.items.length\n    );\n  };\n\n  const downHandler = () => {\n    setSelectedIndex((selectedIndex + 1) % props.items.length);\n  };\n\n  const enterHandler = () => {\n    selectItem(selectedIndex);\n  };\n\n  useEffect(() => setSelectedIndex(0), [props.items]);\n\n  useImperativeHandle(ref, () => ({\n    onKeyDown: ({ event }: { event: KeyboardEvent }) => {\n      if (event.key === 'ArrowUp') {\n        upHandler();\n        return true;\n      }\n\n      if (event.key === 'ArrowDown') {\n        downHandler();\n        return true;\n      }\n\n      if (event.key === 'Enter') {\n        enterHandler();\n        return true;\n      }\n\n      return false;\n    },\n  }));\n\n  return (\n    <div className='bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg shadow-lg overflow-hidden max-h-[300px] overflow-y-auto'>\n      {props.items.length ? (\n        props.items.map((item, index) => (\n          <button\n            className={`flex items-center gap-3 w-full px-4 py-2.5 text-left transition-colors ${\n              index === selectedIndex ? 'bg-white/20' : 'hover:bg-white/10'\n            }`}\n            key={item.id}\n            onClick={() => selectItem(index)}\n            type='button'\n          >\n            <div className='flex items-center justify-center w-8 h-8 rounded bg-green-500/20 border border-green-500/30'>\n              <FileText className='w-4 h-4 text-green-400' />\n            </div>\n            <div className='flex-1 min-w-0'>\n              <div className='text-white font-medium truncate'>\n                {item.title || 'Untitled'}\n              </div>\n              {item.content && (\n                <div className='text-xs text-gray-400 truncate'>\n                  {item.content.substring(0, 60)}\n                  {item.content.length > 60 ? '...' : ''}\n                </div>\n              )}\n            </div>\n          </button>\n        ))\n      ) : (\n        <div className='px-4 py-3 text-sm text-gray-400'>No notes found</div>\n      )}\n    </div>\n  );\n});\n\nNoteList.displayName = 'NoteList';\n"],"names":[],"mappings":";;;;;AAEA;AAOA;;;AATA;;;AAoBO,MAAM,yBAAW,GAAA,IAAA,+ZAAU,UAA6B,CAAC,OAAO;;IACrE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,6ZAAQ,EAAC;IAEnD,MAAM,aAAa,CAAC;QAClB,MAAM,OAAO,MAAM,KAAK,CAAC,MAAM;QAE/B,IAAI,MAAM;YACR,MAAM,OAAO,CAAC;gBACZ,IAAI,AAAC,QAAe,OAAR,KAAK,EAAE;gBACnB,OAAO,KAAK,KAAK,IAAI;gBACrB,QAAQ,KAAK,EAAE;YACjB;QACF;IACF;IAEA,MAAM,YAAY;QAChB,iBACE,CAAC,gBAAgB,MAAM,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAEjE;IAEA,MAAM,cAAc;QAClB,iBAAiB,CAAC,gBAAgB,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAC3D;IAEA,MAAM,eAAe;QACnB,WAAW;IACb;IAEA,IAAA,8ZAAS;8BAAC,IAAM,iBAAiB;6BAAI;QAAC,MAAM,KAAK;KAAC;IAElD,IAAA,waAAmB,EAAC;wCAAK,IAAM,CAAC;gBAC9B,SAAS;oDAAE;4BAAC,EAAE,KAAK,EAA4B;wBAC7C,IAAI,MAAM,GAAG,KAAK,WAAW;4BAC3B;4BACA,OAAO;wBACT;wBAEA,IAAI,MAAM,GAAG,KAAK,aAAa;4BAC7B;4BACA,OAAO;wBACT;wBAEA,IAAI,MAAM,GAAG,KAAK,SAAS;4BACzB;4BACA,OAAO;wBACT;wBAEA,OAAO;oBACT;;YACF,CAAC;;IAED,qBACE,ibAAC;QAAI,WAAU;kBACZ,MAAM,KAAK,CAAC,MAAM,GACjB,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,sBACrB,ibAAC;gBACC,WAAW,AAAC,0EAEX,OADC,UAAU,gBAAgB,gBAAgB;gBAG5C,SAAS,IAAM,WAAW;gBAC1B,MAAK;;kCAEL,ibAAC;wBAAI,WAAU;kCACb,cAAA,ibAAC,kRAAQ;4BAAC,WAAU;;;;;;;;;;;kCAEtB,ibAAC;wBAAI,WAAU;;0CACb,ibAAC;gCAAI,WAAU;0CACZ,KAAK,KAAK,IAAI;;;;;;4BAEhB,KAAK,OAAO,kBACX,ibAAC;gCAAI,WAAU;;oCACZ,KAAK,OAAO,CAAC,SAAS,CAAC,GAAG;oCAC1B,KAAK,OAAO,CAAC,MAAM,GAAG,KAAK,QAAQ;;;;;;;;;;;;;;eAdrC,KAAK,EAAE;;;;0EAqBhB,ibAAC;YAAI,WAAU;sBAAkC;;;;;;;;;;;AAIzD;;AAEA,SAAS,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1759, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/noteMentionSuggestion.ts"],"sourcesContent":["import { ReactRenderer } from '@tiptap/react';\nimport tippy, { Instance as TippyInstance } from 'tippy.js';\nimport { NoteList, NoteListRef } from '@/components/tiptap/NoteList';\nimport { NoteWithParsed } from '@/types/note';\nimport { SuggestionOptions, SuggestionProps } from '@tiptap/suggestion';\n\nexport const createNoteMentionSuggestion = (\n  getNotesRef: () => NoteWithParsed[]\n): Omit<SuggestionOptions, 'editor'> => ({\n  char: '#',\n  items: ({ query }: { query: string }) => {\n    const notes = getNotesRef();\n    return notes\n      .filter(note => {\n        const title = note.title?.toLowerCase() || '';\n        const content = note.content?.toLowerCase() || '';\n        const queryLower = query.toLowerCase();\n        return title.includes(queryLower) || content.includes(queryLower);\n      })\n      .slice(0, 5);\n  },\n\n  render: () => {\n    let component: ReactRenderer<NoteListRef> | undefined;\n    let popup: TippyInstance[] | undefined;\n\n    return {\n      onStart: (props: SuggestionProps) => {\n        component = new ReactRenderer(NoteList, {\n          props,\n          editor: props.editor,\n        });\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup = tippy('body', {\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n          appendTo: () => document.body,\n          content: component.element,\n          showOnCreate: true,\n          interactive: true,\n          trigger: 'manual',\n          placement: 'bottom-start',\n        });\n      },\n\n      onUpdate(props: SuggestionProps) {\n        component?.updateProps(props);\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup?.[0]?.setProps({\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n        });\n      },\n\n      onKeyDown(props: { event: KeyboardEvent }) {\n        if (props.event.key === 'Escape') {\n          popup?.[0]?.hide();\n          return true;\n        }\n\n        return component?.ref?.onKeyDown(props) ?? false;\n      },\n\n      onExit() {\n        popup?.[0]?.destroy();\n        component?.destroy();\n      },\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAIO,MAAM,8BAA8B,CACzC,cACsC,CAAC;QACvC,MAAM;QACN,OAAO;gBAAC,EAAE,KAAK,EAAqB;YAClC,MAAM,QAAQ;YACd,OAAO,MACJ,MAAM,CAAC,CAAA;oBACQ,aACE;gBADhB,MAAM,QAAQ,EAAA,cAAA,KAAK,KAAK,cAAV,kCAAA,YAAY,WAAW,OAAM;gBAC3C,MAAM,UAAU,EAAA,gBAAA,KAAK,OAAO,cAAZ,oCAAA,cAAc,WAAW,OAAM;gBAC/C,MAAM,aAAa,MAAM,WAAW;gBACpC,OAAO,MAAM,QAAQ,CAAC,eAAe,QAAQ,QAAQ,CAAC;YACxD,GACC,KAAK,CAAC,GAAG;QACd;QAEA,QAAQ;YACN,IAAI;YACJ,IAAI;YAEJ,OAAO;gBACL,SAAS,CAAC;oBACR,YAAY,IAAI,sbAAa,CAAC,4MAAQ,EAAE;wBACtC;wBACA,QAAQ,MAAM,MAAM;oBACtB;oBAEA,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,QAAQ,IAAA,+PAAK,EAAC,QAAQ;wBACpB,wBAAwB,MAAM,UAAU;wBACxC,UAAU,IAAM,SAAS,IAAI;wBAC7B,SAAS,UAAU,OAAO;wBAC1B,cAAc;wBACd,aAAa;wBACb,SAAS;wBACT,WAAW;oBACb;gBACF;gBAEA,UAAS,KAAsB;wBAO7B;oBANA,sBAAA,gCAAA,UAAW,WAAW,CAAC;oBAEvB,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,kBAAA,6BAAA,UAAA,KAAO,CAAC,EAAE,cAAV,8BAAA,QAAY,QAAQ,CAAC;wBACnB,wBAAwB,MAAM,UAAU;oBAC1C;gBACF;gBAEA,WAAU,KAA+B;wBAMhC;oBALP,IAAI,MAAM,KAAK,CAAC,GAAG,KAAK,UAAU;4BAChC;wBAAA,kBAAA,6BAAA,UAAA,KAAO,CAAC,EAAE,cAAV,8BAAA,QAAY,IAAI;wBAChB,OAAO;oBACT;wBAEO;oBAAP,OAAO,CAAA,2BAAA,sBAAA,iCAAA,iBAAA,UAAW,GAAG,cAAd,qCAAA,eAAgB,SAAS,CAAC,oBAA1B,sCAAA,2BAAoC;gBAC7C;gBAEA;wBACE;oBAAA,kBAAA,6BAAA,UAAA,KAAO,CAAC,EAAE,cAAV,8BAAA,QAAY,OAAO;oBACnB,sBAAA,gCAAA,UAAW,OAAO;gBACpB;YACF;QACF;IACF,CAAC","debugId":null}},
    {"offset": {"line": 1839, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/extensions/useTiptapExtensions.ts"],"sourcesContent":["import { useRef, useMemo } from 'react';\nimport StarterKit from '@tiptap/starter-kit';\nimport { Markdown } from '@tiptap/markdown';\nimport Placeholder from '@tiptap/extension-placeholder';\nimport { CustomMention } from '@/lib/tiptap/MentionExtension';\nimport { NoteMention } from '@/lib/tiptap/NoteMentionExtension';\nimport { createMentionSuggestion } from '@/lib/tiptap/mentionSuggestion';\nimport { createNoteMentionSuggestion } from '@/lib/tiptap/noteMentionSuggestion';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note, NoteWithParsed } from '@/types/note';\n\nexport type TiptapMode = 'full' | 'chat' | 'minimal' | 'readonly';\n\nexport interface UseTiptapExtensionsConfig {\n  mode: TiptapMode;\n  placeholder?: string;\n  enableMemberMentions?: boolean;\n  enableNoteMentions?: boolean;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[] | NoteWithParsed[];\n}\n\n/**\n * Hook to get configured TipTap extensions based on use case\n */\nexport function useTiptapExtensions({\n  mode,\n  placeholder = 'Start typing...',\n  enableMemberMentions = false,\n  enableNoteMentions = false,\n  workspaceMembers = [],\n  workspaceNotes = [],\n}: UseTiptapExtensionsConfig): any[] {\n  // Use refs to avoid recreating suggestion components on every render\n  const membersRef = useRef<WorkspaceMember[]>([]);\n  const notesRef = useRef<Note[] | NoteWithParsed[]>([]);\n\n  // Update refs when data changes\n  membersRef.current = workspaceMembers;\n  notesRef.current = workspaceNotes;\n\n  // Memoize extensions - recreate when config or data changes\n  return useMemo(() => {\n    const extensions: any[] = [];\n\n    // Base extensions for all modes\n    if (mode === 'readonly' || mode === 'minimal') {\n      // Minimal set for display only\n      extensions.push(\n        StarterKit.configure({\n          heading: { levels: [1, 2, 3] },\n          code: false,\n        }),\n        Markdown\n      );\n    } else if (mode === 'chat') {\n      // Chat mode: basic formatting only (bold, italic, mentions)\n      extensions.push(\n        StarterKit.configure({\n          heading: false, // No headings in chat\n          blockquote: false, // No blockquotes in chat\n          codeBlock: false, // No code blocks in chat\n          horizontalRule: false, // No horizontal rules in chat\n          code: false,\n        }),\n        Placeholder.configure({ placeholder }),\n        Markdown\n      );\n    } else if (mode === 'full') {\n      // Full editor mode (for notes)\n      extensions.push(\n        StarterKit.configure({\n          heading: { levels: [1, 2, 3] },\n          code: false,\n        }),\n        Placeholder.configure({ placeholder }),\n        Markdown\n      );\n    }\n\n    // Add member mentions if enabled\n    if (enableMemberMentions) {\n      extensions.push(\n        CustomMention.configure({\n          HTMLAttributes: {\n            class: 'mention',\n          },\n          suggestion: createMentionSuggestion(() => membersRef.current),\n        })\n      );\n    }\n\n    // Add note mentions if enabled\n    if (enableNoteMentions) {\n      extensions.push(\n        NoteMention.configure({\n          HTMLAttributes: {\n            class: 'note-mention',\n          },\n          suggestion: createNoteMentionSuggestion(\n            () => notesRef.current as NoteWithParsed[]\n          ),\n        })\n      );\n    }\n\n    return extensions;\n  }, [mode, placeholder, enableMemberMentions, enableNoteMentions]);\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AAkBO,SAAS,oBAAoB,KAOR;QAPQ,EAClC,IAAI,EACJ,cAAc,iBAAiB,EAC/B,uBAAuB,KAAK,EAC5B,qBAAqB,KAAK,EAC1B,mBAAmB,EAAE,EACrB,iBAAiB,EAAE,EACO,GAPQ;;IAQlC,qEAAqE;IACrE,MAAM,aAAa,IAAA,2ZAAM,EAAoB,EAAE;IAC/C,MAAM,WAAW,IAAA,2ZAAM,EAA4B,EAAE;IAErD,gCAAgC;IAChC,WAAW,OAAO,GAAG;IACrB,SAAS,OAAO,GAAG;IAEnB,4DAA4D;IAC5D,OAAO,IAAA,4ZAAO;uCAAC;YACb,MAAM,aAAoB,EAAE;YAE5B,gCAAgC;YAChC,IAAI,SAAS,cAAc,SAAS,WAAW;gBAC7C,+BAA+B;gBAC/B,WAAW,IAAI,CACb,uRAAU,CAAC,SAAS,CAAC;oBACnB,SAAS;wBAAE,QAAQ;4BAAC;4BAAG;4BAAG;yBAAE;oBAAC;oBAC7B,MAAM;gBACR,IACA,mXAAQ;YAEZ,OAAO,IAAI,SAAS,QAAQ;gBAC1B,4DAA4D;gBAC5D,WAAW,IAAI,CACb,uRAAU,CAAC,SAAS,CAAC;oBACnB,SAAS;oBACT,YAAY;oBACZ,WAAW;oBACX,gBAAgB;oBAChB,MAAM;gBACR,IACA,4cAAW,CAAC,SAAS,CAAC;oBAAE;gBAAY,IACpC,mXAAQ;YAEZ,OAAO,IAAI,SAAS,QAAQ;gBAC1B,+BAA+B;gBAC/B,WAAW,IAAI,CACb,uRAAU,CAAC,SAAS,CAAC;oBACnB,SAAS;wBAAE,QAAQ;4BAAC;4BAAG;4BAAG;yBAAE;oBAAC;oBAC7B,MAAM;gBACR,IACA,4cAAW,CAAC,SAAS,CAAC;oBAAE;gBAAY,IACpC,mXAAQ;YAEZ;YAEA,iCAAiC;YACjC,IAAI,sBAAsB;gBACxB,WAAW,IAAI,CACb,iNAAa,CAAC,SAAS,CAAC;oBACtB,gBAAgB;wBACd,OAAO;oBACT;oBACA,YAAY,IAAA,4NAAuB;uDAAC,IAAM,WAAW,OAAO;;gBAC9D;YAEJ;YAEA,+BAA+B;YAC/B,IAAI,oBAAoB;gBACtB,WAAW,IAAI,CACb,mNAAW,CAAC,SAAS,CAAC;oBACpB,gBAAgB;wBACd,OAAO;oBACT;oBACA,YAAY,IAAA,oOAA2B;uDACrC,IAAM,SAAS,OAAO;;gBAE1B;YAEJ;YAEA,OAAO;QACT;sCAAG;QAAC;QAAM;QAAa;QAAsB;KAAmB;AAClE;GAnFgB","debugId":null}},
    {"offset": {"line": 1951, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/extractMentions.ts"],"sourcesContent":["import type { Editor } from '@tiptap/core';\n\n/**\n * Extract workspace member IDs from mention nodes in the editor\n */\nexport function extractMemberMentions(editor: Editor | null): number[] {\n  if (!editor) return [];\n\n  const mentionedIds: number[] = [];\n  editor.state.doc.descendants(node => {\n    if (node.type.name === 'mention' && node.attrs.workspaceMemberId) {\n      mentionedIds.push(node.attrs.workspaceMemberId);\n    }\n  });\n\n  return [...new Set(mentionedIds)]; // Remove duplicates\n}\n\n/**\n * Extract note IDs from note mention nodes in the editor\n */\nexport function extractNoteMentions(editor: Editor | null): number[] {\n  if (!editor) return [];\n\n  const mentionedNoteIds: number[] = [];\n  editor.state.doc.descendants(node => {\n    if (node.type.name === 'noteMention' && node.attrs.noteId) {\n      mentionedNoteIds.push(node.attrs.noteId);\n    }\n  });\n\n  return [...new Set(mentionedNoteIds)]; // Remove duplicates\n}\n"],"names":[],"mappings":";;;;;;AAKO,SAAS,sBAAsB,MAAqB;IACzD,IAAI,CAAC,QAAQ,OAAO,EAAE;IAEtB,MAAM,eAAyB,EAAE;IACjC,OAAO,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;QAC3B,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,aAAa,KAAK,KAAK,CAAC,iBAAiB,EAAE;YAChE,aAAa,IAAI,CAAC,KAAK,KAAK,CAAC,iBAAiB;QAChD;IACF;IAEA,OAAO;WAAI,IAAI,IAAI;KAAc,EAAE,oBAAoB;AACzD;AAKO,SAAS,oBAAoB,MAAqB;IACvD,IAAI,CAAC,QAAQ,OAAO,EAAE;IAEtB,MAAM,mBAA6B,EAAE;IACrC,OAAO,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;QAC3B,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,iBAAiB,KAAK,KAAK,CAAC,MAAM,EAAE;YACzD,iBAAiB,IAAI,CAAC,KAAK,KAAK,CAAC,MAAM;QACzC;IACF;IAEA,OAAO;WAAI,IAAI,IAAI;KAAkB,EAAE,oBAAoB;AAC7D","debugId":null}},
    {"offset": {"line": 1988, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/TiptapChatInput.tsx"],"sourcesContent":["'use client';\n\nimport {\n  useRef,\n  useState,\n  useEffect,\n  useImperativeHandle,\n  forwardRef,\n  useCallback,\n} from 'react';\nimport { useEditor, EditorContent } from '@tiptap/react';\nimport { ArrowUp, Square } from 'lucide-react';\nimport { VoiceInputButton } from './VoiceInputButton';\nimport { useUI } from '@/contexts/UIContext';\nimport { useTiptapExtensions } from '@/components/tiptap/extensions/useTiptapExtensions';\nimport {\n  extractMemberMentions,\n  extractNoteMentions,\n} from '@/lib/tiptap/extractMentions';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note } from '@/types/note';\n\ninterface TiptapChatInputProps {\n  onSend: (\n    text: string,\n    mentionedMemberIds: number[],\n    mentionedNoteIds: number[]\n  ) => void | Promise<void>;\n  onStop?: () => void;\n  isLoading?: boolean;\n  placeholder?: string;\n  canStop?: boolean;\n  isUploading?: boolean;\n  hasAttachments?: boolean;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n}\n\nexport type TiptapChatInputRef = {\n  focus: () => void;\n  clearContent: () => void;\n};\n\nconst TiptapChatInput = forwardRef<TiptapChatInputRef, TiptapChatInputProps>(\n  function TiptapChatInput(\n    {\n      onSend,\n      onStop,\n      isLoading = false,\n      placeholder = '...',\n      canStop = true,\n      isUploading = false,\n      hasAttachments = false,\n      workspaceMembers = [],\n      workspaceNotes = [],\n    },\n    ref\n  ) {\n    const [isFocused, setIsFocused] = useState(false);\n    const [isEmpty, setIsEmpty] = useState(true);\n    const { setInputActive } = useUI();\n    const editorRef = useRef<HTMLDivElement>(null);\n\n    // Get extensions for chat mode with member mentions and note mentions\n    const extensions = useTiptapExtensions({\n      mode: 'chat',\n      placeholder,\n      enableMemberMentions: workspaceMembers.length > 0,\n      enableNoteMentions: workspaceNotes.length > 0,\n      workspaceMembers,\n      workspaceNotes,\n    });\n\n    // Initialize TipTap editor\n    // Pass extensions as dependency to recreate editor when they change\n    const editor = useEditor(\n      {\n        immediatelyRender: false,\n        extensions,\n        content: '',\n        contentType: 'markdown',\n        editorProps: {\n          attributes: {\n            class:\n              'w-full bg-transparent text-white px-5 py-3.5 pr-[140px] focus:outline-none resize-none overflow-y-auto chat-input-editor',\n            style: 'max-height: 140px;', // ~7 lines\n          },\n        },\n        onUpdate: ({ editor }) => {\n          const text = editor.getText();\n          setIsEmpty(text.trim().length === 0);\n        },\n        onFocus: () => setIsFocused(true),\n        onBlur: () => setIsFocused(false),\n      },\n      [extensions]\n    );\n\n    useImperativeHandle(ref, () => ({\n      focus: () => {\n        editor?.commands.focus();\n      },\n      clearContent: () => {\n        editor?.commands.clearContent();\n        setIsEmpty(true);\n      },\n    }));\n\n    // Update input active state\n    useEffect(() => {\n      setInputActive(isFocused || !isEmpty);\n    }, [isFocused, isEmpty, setInputActive]);\n\n    const handleSend = useCallback(async () => {\n      if (isLoading || isUploading || !editor) return;\n\n      const text = editor.getMarkdown().trim();\n      const hasText = text.length > 0;\n\n      if (!hasText && !hasAttachments) return;\n\n      // Extract mentions before clearing\n      const mentionedMemberIds = extractMemberMentions(editor);\n      const mentionedNoteIds = extractNoteMentions(editor);\n\n      await onSend(text || '', mentionedMemberIds, mentionedNoteIds);\n\n      // Clear editor content\n      editor.commands.clearContent();\n      setIsEmpty(true);\n    }, [isLoading, isUploading, editor, hasAttachments, onSend]);\n\n    const handleStop = () => {\n      if (onStop && isLoading) {\n        onStop();\n      }\n    };\n\n    // Handle voice input\n    const handleVoiceTranscript = (text: string) => {\n      if (editor) {\n        editor.commands.setContent(text);\n        editor.commands.focus();\n      }\n    };\n\n    // Add keyboard shortcuts\n    useEffect(() => {\n      if (!editor) return;\n\n      const handleKeyDown = (event: Event) => {\n        const keyboardEvent = event as KeyboardEvent;\n\n        // Shift+Enter: newline (default behavior)\n        if (keyboardEvent.key === 'Enter' && keyboardEvent.shiftKey) {\n          return;\n        }\n\n        // Enter (without Shift): send message\n        if (keyboardEvent.key === 'Enter' && !keyboardEvent.shiftKey) {\n          // Don't send during IME composition\n          if (keyboardEvent.isComposing) {\n            return;\n          }\n\n          keyboardEvent.preventDefault();\n          handleSend();\n        }\n      };\n\n      const editorElement = editorRef.current?.querySelector('.ProseMirror');\n      editorElement?.addEventListener('keydown', handleKeyDown);\n\n      return () => {\n        editorElement?.removeEventListener('keydown', handleKeyDown);\n      };\n    }, [editor, handleSend]);\n\n    if (!editor) {\n      return null;\n    }\n\n    return (\n      <div className='flex-1 relative ml-[55px]'>\n        <div\n          ref={editorRef}\n          className='w-full bg-white/8 backdrop-blur-xl rounded-4xl border border-black focus-within:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'\n        >\n          <EditorContent editor={editor} />\n        </div>\n\n        {/*  -  */}\n        <div className='absolute right-[50px] bottom-1.5 z-10'>\n          <VoiceInputButton\n            onTranscriptChange={handleVoiceTranscript}\n            currentText={editor.getText()}\n            disabled={isLoading}\n            className='w-11 h-11 rounded-full bg-transparent border-0 text-white hover:scale-102 transition-all duration-300'\n          />\n        </div>\n\n        {/*  /  */}\n        <button\n          onClick={isLoading && canStop ? handleStop : handleSend}\n          disabled={isLoading || isUploading || (isEmpty && !hasAttachments)}\n          className='absolute right-2.5 bottom-1.5 w-10 h-10 rounded-full bg-white/10 backdrop-blur-xl border border-black text-white flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white/15 hover:scale-102 transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)]'\n        >\n          {isLoading && canStop ? (\n            <Square className='w-4 h-4 fill-current' />\n          ) : (\n            <ArrowUp className='w-4 h-4' />\n          )}\n        </button>\n      </div>\n    );\n  }\n);\n\nexport default TiptapChatInput;\n"],"names":[],"mappings":";;;;;AAEA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;;;AAfA;;;;;;;;AA2CA,MAAM,gCAAkB,GAAA,IAAA,+ZAAU,UAChC,SAAS,gBACP,KAUC,EACD,GAAG;QAXH,EACE,MAAM,EACN,MAAM,EACN,YAAY,KAAK,EACjB,cAAc,aAAa,EAC3B,UAAU,IAAI,EACd,cAAc,KAAK,EACnB,iBAAiB,KAAK,EACtB,mBAAmB,EAAE,EACrB,iBAAiB,EAAE,EACpB,GAVD;;IAaA,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,6ZAAQ,EAAC;IAC3C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,6ZAAQ,EAAC;IACvC,MAAM,EAAE,cAAc,EAAE,GAAG,IAAA,8LAAK;IAChC,MAAM,YAAY,IAAA,2ZAAM,EAAiB;IAEzC,sEAAsE;IACtE,MAAM,aAAa,IAAA,+OAAmB,EAAC;QACrC,MAAM;QACN;QACA,sBAAsB,iBAAiB,MAAM,GAAG;QAChD,oBAAoB,eAAe,MAAM,GAAG;QAC5C;QACA;IACF;IAEA,2BAA2B;IAC3B,oEAAoE;IACpE,MAAM,SAAS,IAAA,kbAAS,EACtB;QACE,mBAAmB;QACnB;QACA,SAAS;QACT,aAAa;QACb,aAAa;YACX,YAAY;gBACV,OACE;gBACF,OAAO;YACT;QACF;QACA,QAAQ;iEAAE;oBAAC,EAAE,MAAM,EAAE;gBACnB,MAAM,OAAO,OAAO,OAAO;gBAC3B,WAAW,KAAK,IAAI,GAAG,MAAM,KAAK;YACpC;;QACA,OAAO;iEAAE,IAAM,aAAa;;QAC5B,MAAM;iEAAE,IAAM,aAAa;;IAC7B,GACA;QAAC;KAAW;IAGd,IAAA,waAAmB,EAAC;+DAAK,IAAM,CAAC;gBAC9B,KAAK;2EAAE;wBACL,mBAAA,6BAAA,OAAQ,QAAQ,CAAC,KAAK;oBACxB;;gBACA,YAAY;2EAAE;wBACZ,mBAAA,6BAAA,OAAQ,QAAQ,CAAC,YAAY;wBAC7B,WAAW;oBACb;;YACF,CAAC;;IAED,4BAA4B;IAC5B,IAAA,8ZAAS;qDAAC;YACR,eAAe,aAAa,CAAC;QAC/B;oDAAG;QAAC;QAAW;QAAS;KAAe;IAEvC,MAAM,aAAa,IAAA,gaAAW;mEAAC;YAC7B,IAAI,aAAa,eAAe,CAAC,QAAQ;YAEzC,MAAM,OAAO,OAAO,WAAW,GAAG,IAAI;YACtC,MAAM,UAAU,KAAK,MAAM,GAAG;YAE9B,IAAI,CAAC,WAAW,CAAC,gBAAgB;YAEjC,mCAAmC;YACnC,MAAM,qBAAqB,IAAA,wNAAqB,EAAC;YACjD,MAAM,mBAAmB,IAAA,sNAAmB,EAAC;YAE7C,MAAM,OAAO,QAAQ,IAAI,oBAAoB;YAE7C,uBAAuB;YACvB,OAAO,QAAQ,CAAC,YAAY;YAC5B,WAAW;QACb;kEAAG;QAAC;QAAW;QAAa;QAAQ;QAAgB;KAAO;IAE3D,MAAM,aAAa;QACjB,IAAI,UAAU,WAAW;YACvB;QACF;IACF;IAEA,qBAAqB;IACrB,MAAM,wBAAwB,CAAC;QAC7B,IAAI,QAAQ;YACV,OAAO,QAAQ,CAAC,UAAU,CAAC;YAC3B,OAAO,QAAQ,CAAC,KAAK;QACvB;IACF;IAEA,yBAAyB;IACzB,IAAA,8ZAAS;qDAAC;gBAuBc;YAtBtB,IAAI,CAAC,QAAQ;YAEb,MAAM;2EAAgB,CAAC;oBACrB,MAAM,gBAAgB;oBAEtB,0CAA0C;oBAC1C,IAAI,cAAc,GAAG,KAAK,WAAW,cAAc,QAAQ,EAAE;wBAC3D;oBACF;oBAEA,sCAAsC;oBACtC,IAAI,cAAc,GAAG,KAAK,WAAW,CAAC,cAAc,QAAQ,EAAE;wBAC5D,oCAAoC;wBACpC,IAAI,cAAc,WAAW,EAAE;4BAC7B;wBACF;wBAEA,cAAc,cAAc;wBAC5B;oBACF;gBACF;;YAEA,MAAM,iBAAgB,qBAAA,UAAU,OAAO,cAAjB,yCAAA,mBAAmB,aAAa,CAAC;YACvD,0BAAA,oCAAA,cAAe,gBAAgB,CAAC,WAAW;YAE3C;6DAAO;oBACL,0BAAA,oCAAA,cAAe,mBAAmB,CAAC,WAAW;gBAChD;;QACF;oDAAG;QAAC;QAAQ;KAAW;IAEvB,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IAEA,qBACE,ibAAC;QAAI,WAAU;;0BACb,ibAAC;gBACC,KAAK;gBACL,WAAU;0BAEV,cAAA,ibAAC,sbAAa;oBAAC,QAAQ;;;;;;;;;;;0BAIzB,ibAAC;gBAAI,WAAU;0BACb,cAAA,ibAAC,mOAAgB;oBACf,oBAAoB;oBACpB,aAAa,OAAO,OAAO;oBAC3B,UAAU;oBACV,WAAU;;;;;;;;;;;0BAKd,ibAAC;gBACC,SAAS,aAAa,UAAU,aAAa;gBAC7C,UAAU,aAAa,eAAgB,WAAW,CAAC;gBACnD,WAAU;0BAET,aAAa,wBACZ,ibAAC,wQAAM;oBAAC,WAAU;;;;;yCAElB,ibAAC,+QAAO;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAK7B;;QA3J6B,8LAAK;QAIb,+OAAmB;QAWvB,kbAAS;;;;QAfG,8LAAK;QAIb,+OAAmB;QAWvB,kbAAS;;;;uCA+Ib","debugId":null}},
    {"offset": {"line": 2240, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/FileUploadMenu.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useState } from 'react';\nimport { Image as ImageIcon, File as FileIcon } from 'lucide-react';\n\ntype FileUploadMenuProps = {\n  onFilesSelected: (files: File[]) => void;\n  maxFiles?: number;\n  disabled?: boolean;\n};\n\nexport default function FileUploadMenu({\n  onFilesSelected,\n  maxFiles = 4,\n  disabled = false,\n}: FileUploadMenuProps) {\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const imageInputRef = useRef<HTMLInputElement>(null);\n  const [isOpen, setIsOpen] = useState(false);\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n\n    if (files.length === 0) return;\n\n    // Limit to maxFiles\n    const selectedFiles = files.slice(0, maxFiles);\n\n    // Validate file count\n    if (files.length > maxFiles) {\n      alert(`You can only upload up to ${maxFiles} files at once.`);\n    }\n\n    onFilesSelected(selectedFiles);\n\n    // Reset input\n    e.target.value = '';\n  };\n\n  const triggerFileInput = (accept: 'image' | 'file') => {\n    const input = accept === 'image' ? imageInputRef : fileInputRef;\n    input.current?.click();\n  };\n\n  useEffect(() => {\n    if (disabled) {\n      setIsOpen(false);\n    }\n  }, [disabled]);\n\n  return (\n    <div className='relative flex flex-col items-center gap-3'>\n      {isOpen && (\n        <div className='absolute bottom-full mb-3 flex flex-col items-center gap-2 bg-white/8 backdrop-blur-xl text-white/80 rounded-full border border-black shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] px-3 py-4'>\n          <button\n            type='button'\n            onClick={() => triggerFileInput('image')}\n            disabled={disabled}\n            className='relative group flex h-8 w-8 items-center justify-center rounded-full bg-white/5 text-white/80 transition-all duration-300 hover:bg-white/15 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed'\n            aria-label='Upload images'\n          >\n            <ImageIcon className='h-4 w-4' />\n            <span className='pointer-events-none absolute left-full ml-2 whitespace-nowrap rounded-md bg-black/80 px-2 py-1 text-xs text-white opacity-0 transition-opacity duration-200 group-hover:opacity-100'>\n              Upload images\n            </span>\n          </button>\n          <button\n            type='button'\n            onClick={() => triggerFileInput('file')}\n            disabled={disabled}\n            className='relative group flex h-8 w-8 items-center justify-center rounded-full bg-white/5 text-white/80 transition-all duration-300 hover:bg-white/15 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed'\n            aria-label='Upload files'\n          >\n            <FileIcon className='h-4 w-4' />\n            <span className='pointer-events-none absolute left-full ml-2 whitespace-nowrap rounded-md bg-black/80 px-2 py-1 text-xs text-white opacity-0 transition-opacity duration-200 group-hover:opacity-100'>\n              Upload files\n            </span>\n          </button>\n        </div>\n      )}\n      <button\n        type='button'\n        onClick={() => {\n          if (disabled) return;\n          setIsOpen(prev => !prev);\n        }}\n        disabled={disabled}\n        className='flex h-[52px] w-[52px] items-center justify-center rounded-full bg-white/8 backdrop-blur-xl text-white/80 border border-black transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:bg-white/15 hover:text-white hover:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] disabled:opacity-50 disabled:cursor-not-allowed'\n        aria-label='Add files'\n      >\n        <svg\n          xmlns='http://www.w3.org/2000/svg'\n          width='20'\n          height='20'\n          viewBox='0 0 24 24'\n          fill='none'\n          stroke='currentColor'\n          strokeWidth='2'\n          strokeLinecap='round'\n          strokeLinejoin='round'\n        >\n          <line x1='12' y1='5' x2='12' y2='19'></line>\n          <line x1='5' y1='12' x2='19' y2='12'></line>\n        </svg>\n      </button>\n\n      {/* Hidden file inputs */}\n      <input\n        ref={imageInputRef}\n        type='file'\n        accept='image/*'\n        multiple\n        className='hidden'\n        onChange={handleFileSelect}\n      />\n      <input\n        ref={fileInputRef}\n        type='file'\n        multiple\n        className='hidden'\n        onChange={handleFileSelect}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;;;AAHA;;;AAWe,SAAS,eAAe,KAIjB;QAJiB,EACrC,eAAe,EACf,WAAW,CAAC,EACZ,WAAW,KAAK,EACI,GAJiB;;IAKrC,MAAM,eAAe,IAAA,2ZAAM,EAAmB;IAC9C,MAAM,gBAAgB,IAAA,2ZAAM,EAAmB;IAC/C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,6ZAAQ,EAAC;IAErC,MAAM,mBAAmB,CAAC;QACxB,MAAM,QAAQ,MAAM,IAAI,CAAC,EAAE,MAAM,CAAC,KAAK,IAAI,EAAE;QAE7C,IAAI,MAAM,MAAM,KAAK,GAAG;QAExB,oBAAoB;QACpB,MAAM,gBAAgB,MAAM,KAAK,CAAC,GAAG;QAErC,sBAAsB;QACtB,IAAI,MAAM,MAAM,GAAG,UAAU;YAC3B,MAAM,AAAC,6BAAqC,OAAT,UAAS;QAC9C;QAEA,gBAAgB;QAEhB,cAAc;QACd,EAAE,MAAM,CAAC,KAAK,GAAG;IACnB;IAEA,MAAM,mBAAmB,CAAC;YAExB;QADA,MAAM,QAAQ,WAAW,UAAU,gBAAgB;SACnD,iBAAA,MAAM,OAAO,cAAb,qCAAA,eAAe,KAAK;IACtB;IAEA,IAAA,8ZAAS;oCAAC;YACR,IAAI,UAAU;gBACZ,UAAU;YACZ;QACF;mCAAG;QAAC;KAAS;IAEb,qBACE,ibAAC;QAAI,WAAU;;YACZ,wBACC,ibAAC;gBAAI,WAAU;;kCACb,ibAAC;wBACC,MAAK;wBACL,SAAS,IAAM,iBAAiB;wBAChC,UAAU;wBACV,WAAU;wBACV,cAAW;;0CAEX,ibAAC,qQAAS;gCAAC,WAAU;;;;;;0CACrB,ibAAC;gCAAK,WAAU;0CAAsL;;;;;;;;;;;;kCAIxM,ibAAC;wBACC,MAAK;wBACL,SAAS,IAAM,iBAAiB;wBAChC,UAAU;wBACV,WAAU;wBACV,cAAW;;0CAEX,ibAAC,kQAAQ;gCAAC,WAAU;;;;;;0CACpB,ibAAC;gCAAK,WAAU;0CAAsL;;;;;;;;;;;;;;;;;;0BAM5M,ibAAC;gBACC,MAAK;gBACL,SAAS;oBACP,IAAI,UAAU;oBACd,UAAU,CAAA,OAAQ,CAAC;gBACrB;gBACA,UAAU;gBACV,WAAU;gBACV,cAAW;0BAEX,cAAA,ibAAC;oBACC,OAAM;oBACN,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;;sCAEf,ibAAC;4BAAK,IAAG;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;;;;;;sCAChC,ibAAC;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;4BAAK,IAAG;;;;;;;;;;;;;;;;;0BAKpC,ibAAC;gBACC,KAAK;gBACL,MAAK;gBACL,QAAO;gBACP,QAAQ;gBACR,WAAU;gBACV,UAAU;;;;;;0BAEZ,ibAAC;gBACC,KAAK;gBACL,MAAK;gBACL,QAAQ;gBACR,WAAU;gBACV,UAAU;;;;;;;;;;;;AAIlB;GAjHwB;KAAA","debugId":null}},
    {"offset": {"line": 2446, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/FileUploadPreview.tsx"],"sourcesContent":["'use client';\n\nimport Image from 'next/image';\nimport { X, File as FileIcon, Loader2 } from 'lucide-react';\nimport { type UploadedFile } from '@/lib/api/workspaceFilesApi';\n\nexport interface FileUploadItem {\n  file: File;\n  id: string;\n  preview?: string;\n  uploaded?: UploadedFile;\n  error?: string;\n  uploading: boolean;\n  progress: number;\n}\n\ntype FileUploadPreviewProps = {\n  files: FileUploadItem[];\n  workspaceId: number;\n  onRemove: (id: string) => void;\n  onUploadComplete: (id: string, uploadedFile: UploadedFile) => void;\n  onUploadError: (id: string, error: string) => void;\n};\n\nexport default function FileUploadPreview(props: FileUploadPreviewProps) {\n  const { files, onRemove } = props;\n\n  if (files.length === 0) return null;\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  const isImage = (mimeType: string): boolean => {\n    return mimeType.startsWith('image/');\n  };\n\n  return (\n    <div className='px-2 md:px-6 pb-2'>\n      <div className='flex flex-wrap gap-2'>\n        {files.map(item => {\n          const isImg = isImage(item.file.type);\n          const hasError = !!item.error;\n          const isUploading = item.uploading;\n          const isComplete = !!item.uploaded;\n\n          return (\n            <div\n              key={item.id}\n              className='relative group bg-white/8 backdrop-blur-xl border border-black rounded-xl overflow-hidden shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'\n            >\n              {/* Remove button */}\n              {!isUploading && (\n                <button\n                  type='button'\n                  onClick={() => onRemove(item.id)}\n                  className='absolute top-1 right-1 z-10 w-6 h-6 rounded-full bg-black/60 hover:bg-black/80 backdrop-blur-sm flex items-center justify-center transition-all opacity-0 group-hover:opacity-100'\n                  aria-label='Remove file'\n                >\n                  <X className='w-3 h-3 text-white' />\n                </button>\n              )}\n\n              {/* Preview */}\n              <div className='w-20 h-20 relative'>\n                {isImg && item.preview ? (\n                  <Image\n                    src={item.preview}\n                    alt={item.file.name}\n                    fill\n                    sizes='80px'\n                    className='object-cover'\n                    unoptimized\n                  />\n                ) : (\n                  <div className='w-full h-full flex items-center justify-center bg-white/5'>\n                    <FileIcon className='w-8 h-8 text-white/40' />\n                  </div>\n                )}\n\n                {/* Upload progress overlay */}\n                {isUploading && (\n                  <div className='absolute inset-0 bg-black/50 flex items-center justify-center'>\n                    <Loader2 className='w-5 h-5 text-white animate-spin' />\n                  </div>\n                )}\n\n                {/* Error overlay */}\n                {hasError && (\n                  <div className='absolute inset-0 bg-red-900/50 flex items-center justify-center'>\n                    <X className='w-5 h-5 text-red-200' />\n                  </div>\n                )}\n\n                {/* Success indicator */}\n                {isComplete && (\n                  <div className='absolute inset-0 bg-green-900/30 flex items-center justify-center'>\n                    <div className='w-3 h-3 rounded-full bg-green-500' />\n                  </div>\n                )}\n\n                {/* Progress bar */}\n                {isUploading && (\n                  <div className='absolute bottom-0 left-0 right-0 h-1 bg-black/30'>\n                    <div\n                      className='h-full bg-white/60 transition-all duration-300'\n                      style={{ width: `${item.progress}%` }}\n                    />\n                  </div>\n                )}\n              </div>\n\n              {/* File name */}\n              <div className='px-2 py-1 max-w-[80px]'>\n                <p\n                  className='text-xs text-white/80 truncate'\n                  title={item.file.name}\n                >\n                  {item.file.name}\n                </p>\n                <p className='text-xs text-white/40'>\n                  {formatFileSize(item.file.size)}\n                </p>\n              </div>\n\n              {/* Error message */}\n              {hasError && (\n                <div className='px-2 pb-1'>\n                  <p\n                    className='text-xs text-red-300 truncate'\n                    title={item.error}\n                  >\n                    {item.error}\n                  </p>\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAHA;;;;AAwBe,SAAS,kBAAkB,KAA6B;IACrE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;IAE5B,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;IAE/B,MAAM,iBAAiB,CAAC;QACtB,IAAI,UAAU,GAAG,OAAO;QACxB,MAAM,IAAI;QACV,MAAM,QAAQ;YAAC;YAAS;YAAM;YAAM;SAAK;QACzC,MAAM,IAAI,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,SAAS,KAAK,GAAG,CAAC;QAChD,OAAO,KAAK,KAAK,CAAC,AAAC,QAAQ,KAAK,GAAG,CAAC,GAAG,KAAM,OAAO,MAAM,MAAM,KAAK,CAAC,EAAE;IAC1E;IAEA,MAAM,UAAU,CAAC;QACf,OAAO,SAAS,UAAU,CAAC;IAC7B;IAEA,qBACE,ibAAC;QAAI,WAAU;kBACb,cAAA,ibAAC;YAAI,WAAU;sBACZ,MAAM,GAAG,CAAC,CAAA;gBACT,MAAM,QAAQ,QAAQ,KAAK,IAAI,CAAC,IAAI;gBACpC,MAAM,WAAW,CAAC,CAAC,KAAK,KAAK;gBAC7B,MAAM,cAAc,KAAK,SAAS;gBAClC,MAAM,aAAa,CAAC,CAAC,KAAK,QAAQ;gBAElC,qBACE,ibAAC;oBAEC,WAAU;;wBAGT,CAAC,6BACA,ibAAC;4BACC,MAAK;4BACL,SAAS,IAAM,SAAS,KAAK,EAAE;4BAC/B,WAAU;4BACV,cAAW;sCAEX,cAAA,ibAAC,yPAAC;gCAAC,WAAU;;;;;;;;;;;sCAKjB,ibAAC;4BAAI,WAAU;;gCACZ,SAAS,KAAK,OAAO,iBACpB,ibAAC,+XAAK;oCACJ,KAAK,KAAK,OAAO;oCACjB,KAAK,KAAK,IAAI,CAAC,IAAI;oCACnB,IAAI;oCACJ,OAAM;oCACN,WAAU;oCACV,WAAW;;;;;yDAGb,ibAAC;oCAAI,WAAU;8CACb,cAAA,ibAAC,kQAAQ;wCAAC,WAAU;;;;;;;;;;;gCAKvB,6BACC,ibAAC;oCAAI,WAAU;8CACb,cAAA,ibAAC,oRAAO;wCAAC,WAAU;;;;;;;;;;;gCAKtB,0BACC,ibAAC;oCAAI,WAAU;8CACb,cAAA,ibAAC,yPAAC;wCAAC,WAAU;;;;;;;;;;;gCAKhB,4BACC,ibAAC;oCAAI,WAAU;8CACb,cAAA,ibAAC;wCAAI,WAAU;;;;;;;;;;;gCAKlB,6BACC,ibAAC;oCAAI,WAAU;8CACb,cAAA,ibAAC;wCACC,WAAU;wCACV,OAAO;4CAAE,OAAO,AAAC,GAAgB,OAAd,KAAK,QAAQ,EAAC;wCAAG;;;;;;;;;;;;;;;;;sCAO5C,ibAAC;4BAAI,WAAU;;8CACb,ibAAC;oCACC,WAAU;oCACV,OAAO,KAAK,IAAI,CAAC,IAAI;8CAEpB,KAAK,IAAI,CAAC,IAAI;;;;;;8CAEjB,ibAAC;oCAAE,WAAU;8CACV,eAAe,KAAK,IAAI,CAAC,IAAI;;;;;;;;;;;;wBAKjC,0BACC,ibAAC;4BAAI,WAAU;sCACb,cAAA,ibAAC;gCACC,WAAU;gCACV,OAAO,KAAK,KAAK;0CAEhB,KAAK,KAAK;;;;;;;;;;;;mBApFZ,KAAK,EAAE;;;;;YA0FlB;;;;;;;;;;;AAIR;KA1HwB","debugId":null}},
    {"offset": {"line": 2669, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/ReplyIndicator.tsx"],"sourcesContent":["export const ReplyIndicator = ({\n  replyingTo,\n  onCancelReply,\n}: {\n  replyingTo: { id: number; text: string; authorName?: string };\n  onCancelReply?: () => void;\n}) => {\n  return (\n    <div className='flex items-center justify-between bg-white/8 backdrop-blur-xl border border-black rounded-2xl px-4 py-2 shadow-[0_8px_32px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)]'>\n      <div className='flex-1 min-w-0'>\n        <p className='text-xs text-white/60 mb-1'>\n          Replying to {replyingTo.authorName || 'message'}\n        </p>\n        <p className='text-xs text-white/40 truncate'>\n          {replyingTo.text.slice(0, 100)}\n          {replyingTo.text.length > 100 ? '...' : ''}\n        </p>\n      </div>\n      {onCancelReply && (\n        <button\n          onClick={onCancelReply}\n          className='ml-3 text-white/60 hover:text-white/80 transition-colors text-sm'\n        >\n          \n        </button>\n      )}\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,iBAAiB;QAAC,EAC7B,UAAU,EACV,aAAa,EAId;IACC,qBACE,ibAAC;QAAI,WAAU;;0BACb,ibAAC;gBAAI,WAAU;;kCACb,ibAAC;wBAAE,WAAU;;4BAA6B;4BAC3B,WAAW,UAAU,IAAI;;;;;;;kCAExC,ibAAC;wBAAE,WAAU;;4BACV,WAAW,IAAI,CAAC,KAAK,CAAC,GAAG;4BACzB,WAAW,IAAI,CAAC,MAAM,GAAG,MAAM,QAAQ;;;;;;;;;;;;;YAG3C,+BACC,ibAAC;gBACC,SAAS;gBACT,WAAU;0BACX;;;;;;;;;;;;AAMT;KA5Ba","debugId":null}},
    {"offset": {"line": 2737, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/ChatInput.tsx"],"sourcesContent":["'use client';\n\nimport TiptapChatInput from './TiptapChatInput';\nimport {\n  useEffect,\n  useRef,\n  useImperativeHandle,\n  forwardRef,\n  useState,\n  useCallback,\n} from 'react';\nimport FileUploadMenu from './FileUploadMenu';\nimport FileUploadPreview, { type FileUploadItem } from './FileUploadPreview';\nimport {\n  uploadWorkspaceFile,\n  type UploadedFile,\n} from '@/lib/api/workspaceFilesApi';\nimport { ReplyIndicator } from './ReplyIndicator';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note } from '@/types/note';\n\ntype ChatInputProps = {\n  onSend: (\n    content: string,\n    workspaceFileIds?: number[],\n    mentionedMemberIds?: number[],\n    mentionedNoteIds?: number[]\n  ) => void;\n  onStop?: () => void;\n  isLoading?: boolean;\n  placeholder?: string;\n  canStop?: boolean;\n  replyingTo?: { id: number; text: string; authorName?: string } | null;\n  onCancelReply?: () => void;\n  workspaceId?: number;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n};\n\nexport type ChatInputRef = {\n  focus: () => void;\n  clearContent: () => void;\n};\n\nconst ChatInput = forwardRef<ChatInputRef, ChatInputProps>(function ChatInput(\n  {\n    onSend,\n    onStop,\n    isLoading = false,\n    placeholder = 'Ask anything',\n    canStop = true,\n    replyingTo,\n    onCancelReply,\n    workspaceId,\n    workspaceMembers = [],\n    workspaceNotes = [],\n  },\n  ref\n) {\n  const inputRef = useRef<{\n    focus: () => void;\n    clearContent: () => void;\n  } | null>(null);\n  const [uploadItems, setUploadItems] = useState<FileUploadItem[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n\n  const hasAttachments = uploadItems.length > 0;\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      inputRef.current?.focus();\n    },\n    clearContent: () => {\n      inputRef.current?.clearContent();\n    },\n  }));\n\n  // Focus input when replying\n  useEffect(() => {\n    if (replyingTo) {\n      // Small delay to ensure DOM is ready\n      setTimeout(() => {\n        inputRef.current?.focus();\n      }, 100);\n    }\n  }, [replyingTo]);\n\n  const handleFilesSelected = useCallback(\n    (files: File[]) => {\n      if (!workspaceId) return;\n\n      const newItems: FileUploadItem[] = files.map(file => {\n        const id = `${Date.now()}-${Math.random()}`;\n        const isImage = file.type.startsWith('image/');\n        let preview: string | undefined;\n\n        if (isImage) {\n          preview = URL.createObjectURL(file);\n        }\n\n        return {\n          file,\n          id,\n          preview,\n          uploading: false,\n          progress: 0,\n        };\n      });\n\n      setUploadItems(prev => {\n        const combined = [...prev, ...newItems];\n        // Limit to 4 files\n        return combined.slice(0, 4);\n      });\n    },\n    [workspaceId]\n  );\n\n  const handleRemoveFile = useCallback((id: string) => {\n    setUploadItems(prev => {\n      const item = prev.find(entry => entry.id === id);\n      if (item?.preview) {\n        URL.revokeObjectURL(item.preview);\n      }\n      return prev.filter(entry => entry.id !== id);\n    });\n  }, []);\n\n  const handleUploadComplete = useCallback(\n    (id: string, uploadedFile: UploadedFile) => {\n      setUploadItems(prev =>\n        prev.map(item =>\n          item.id === id ? { ...item, uploaded: uploadedFile } : item\n        )\n      );\n    },\n    []\n  );\n\n  const handleUploadError = useCallback((id: string, error: string) => {\n    setUploadItems(prev =>\n      prev.map(item =>\n        item.id === id ? { ...item, error, uploading: false } : item\n      )\n    );\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      uploadItems.forEach(item => {\n        if (item.preview) {\n          URL.revokeObjectURL(item.preview);\n        }\n      });\n    };\n  }, [uploadItems]);\n\n  const handleSend = useCallback(\n    async (\n      content: string,\n      mentionedMemberIds?: number[],\n      mentionedNoteIds?: number[]\n    ) => {\n      if (isLoading || isUploading) return;\n\n      // Allow sending if there's text or files\n      const trimmed = content.trim();\n      const hasText = trimmed.length > 0;\n\n      if (!hasText && uploadItems.length === 0) return;\n\n      let workspaceFileIds: number[] = [];\n\n      if (uploadItems.length > 0 && workspaceId) {\n        setIsUploading(true);\n        try {\n          const uploadPromises = uploadItems.map(async item => {\n            if (item.uploaded) {\n              return item.uploaded.id;\n            }\n\n            const uploaded = await uploadWorkspaceFile(workspaceId, item.file);\n            return uploaded.id;\n          });\n\n          workspaceFileIds = await Promise.all(uploadPromises);\n        } catch (error) {\n          console.error('Error uploading files:', error);\n          alert('Failed to upload files. Please try again.');\n          setIsUploading(false);\n          return;\n        }\n        setIsUploading(false);\n      }\n\n      onSend(\n        trimmed || '',\n        workspaceFileIds.length ? workspaceFileIds : undefined,\n        mentionedMemberIds,\n        mentionedNoteIds\n      );\n\n      setUploadItems(prev => {\n        prev.forEach(item => {\n          if (item.preview) {\n            URL.revokeObjectURL(item.preview);\n          }\n        });\n        return [];\n      });\n    },\n    [isLoading, isUploading, onSend, uploadItems, workspaceId]\n  );\n\n  return (\n    <div className='bg-gradient-to-br from-slate-950 via-black to-slate-950 relative z-10 rounded-t-3xl'>\n      {/* Reply indicator - absolutely positioned above input */}\n      {replyingTo && (\n        <div className='absolute bottom-full left-0 right-0 px-4 md:px-8 pb-2 pointer-events-auto'>\n          <ReplyIndicator\n            replyingTo={replyingTo}\n            onCancelReply={onCancelReply}\n          />\n        </div>\n      )}\n      {/* File Upload Preview */}\n      {workspaceId && uploadItems.length > 0 && (\n        <FileUploadPreview\n          files={uploadItems}\n          workspaceId={workspaceId}\n          onRemove={handleRemoveFile}\n          onUploadComplete={handleUploadComplete}\n          onUploadError={handleUploadError}\n        />\n      )}\n      {/* UI */}\n      <div className='px-2 md:px-6 pt-2'>\n        <div className='w-full md:max-w-4xl md:mx-auto'>\n          <div className='relative'>\n            {/* File Upload Menu - Plus button */}\n            {workspaceId && (\n              <div className='absolute left-0 z-10'>\n                <FileUploadMenu\n                  onFilesSelected={handleFilesSelected}\n                  maxFiles={4}\n                  disabled={isLoading || isUploading || uploadItems.length >= 4}\n                />\n              </div>\n            )}\n            <TiptapChatInput\n              ref={inputRef}\n              placeholder={placeholder}\n              onSend={handleSend}\n              onStop={onStop}\n              isLoading={isLoading}\n              canStop={canStop}\n              isUploading={isUploading}\n              hasAttachments={hasAttachments}\n              workspaceMembers={workspaceMembers}\n              workspaceNotes={workspaceNotes}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n});\n\nexport default ChatInput;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3042, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/index.tsx"],"sourcesContent":["export { default as ChatInput } from './ChatInput';\nexport type { ChatInputRef } from './ChatInput';\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 3061, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/glass-card/GlassButton.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\n\nimport { Button, type ButtonProps } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\n\nexport type GlassButtonProps = ButtonProps;\n\nconst GlassButton = React.forwardRef<HTMLButtonElement, GlassButtonProps>(\n  ({ className, ...props }, ref) => (\n    <Button\n      ref={ref}\n      className={cn(\n        'bg-white/10 backdrop-blur-xl border border-black rounded-full p-2 transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:bg-white/15 hover:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] disabled:hover:shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]',\n        className\n      )}\n      {...props}\n    />\n  )\n);\n\nGlassButton.displayName = 'GlassButton';\n\nexport default GlassButton;\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AALA;;;;;AASA,MAAM,4BAAc,+ZAAgB,MAClC,QAA0B;QAAzB,EAAE,SAAS,EAAE,GAAG,OAAO;yBACtB,ibAAC,oMAAM;QACL,KAAK;QACL,WAAW,IAAA,iLAAE,EACX,uWACA;QAED,GAAG,KAAK;;;;;;;;AAKf,YAAY,WAAW,GAAG;uCAEX","debugId":null}},
    {"offset": {"line": 3099, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/features/workspace/components/MessageContextMenu.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useState } from 'react';\nimport { Reply, Copy, Check } from 'lucide-react';\n\ntype MessageContextMenuProps = {\n  messageText: string;\n  onReply: () => void;\n  onClose: () => void;\n  position: { x: number; y: number };\n};\n\nexport default function MessageContextMenu({\n  messageText,\n  onReply,\n  onClose,\n  position,\n}: MessageContextMenuProps) {\n  const menuRef = useRef<HTMLDivElement>(null);\n  const [copied, setCopied] = useState(false);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent | TouchEvent) => {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        onClose();\n      }\n    };\n\n    const handleEscape = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    document.addEventListener('touchstart', handleClickOutside);\n    document.addEventListener('keydown', handleEscape);\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n      document.removeEventListener('touchstart', handleClickOutside);\n      document.removeEventListener('keydown', handleEscape);\n    };\n  }, [onClose]);\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(messageText);\n      setCopied(true);\n      setTimeout(() => {\n        setCopied(false);\n        onClose();\n      }, 1000);\n    } catch (err) {\n      console.error('Failed to copy text:', err);\n      onClose();\n    }\n  };\n\n  return (\n    <div\n      ref={menuRef}\n      className='fixed z-50 bg-white/15 backdrop-blur-xl border border-black rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] overflow-hidden'\n      style={{\n        left: `${position.x}px`,\n        top: `${position.y}px`,\n      }}\n    >\n      <button\n        onClick={() => {\n          onReply();\n          onClose();\n        }}\n        className='w-full px-4 py-3 flex items-center gap-3 text-white hover:bg-white/10 transition-colors text-sm border-b border-white/10'\n      >\n        <Reply className='w-4 h-4' />\n        <span>Reply</span>\n      </button>\n      <button\n        onClick={handleCopy}\n        className='w-full px-4 py-3 flex items-center gap-3 text-white hover:bg-white/10 transition-colors text-sm'\n      >\n        {copied ? (\n          <>\n            <Check className='w-4 h-4' />\n            <span>Copied!</span>\n          </>\n        ) : (\n          <>\n            <Copy className='w-4 h-4' />\n            <span>Copy</span>\n          </>\n        )}\n      </button>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;;;AAHA;;;AAYe,SAAS,mBAAmB,KAKjB;QALiB,EACzC,WAAW,EACX,OAAO,EACP,OAAO,EACP,QAAQ,EACgB,GALiB;;IAMzC,MAAM,UAAU,IAAA,2ZAAM,EAAiB;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,6ZAAQ,EAAC;IAErC,IAAA,8ZAAS;wCAAC;YACR,MAAM;mEAAqB,CAAC;oBAC1B,IAAI,QAAQ,OAAO,IAAI,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;wBACtE;oBACF;gBACF;;YAEA,MAAM;6DAAe,CAAC;oBACpB,IAAI,MAAM,GAAG,KAAK,UAAU;wBAC1B;oBACF;gBACF;;YAEA,SAAS,gBAAgB,CAAC,aAAa;YACvC,SAAS,gBAAgB,CAAC,cAAc;YACxC,SAAS,gBAAgB,CAAC,WAAW;YAErC;gDAAO;oBACL,SAAS,mBAAmB,CAAC,aAAa;oBAC1C,SAAS,mBAAmB,CAAC,cAAc;oBAC3C,SAAS,mBAAmB,CAAC,WAAW;gBAC1C;;QACF;uCAAG;QAAC;KAAQ;IAEZ,MAAM,aAAa;QACjB,IAAI;YACF,MAAM,UAAU,SAAS,CAAC,SAAS,CAAC;YACpC,UAAU;YACV,WAAW;gBACT,UAAU;gBACV;YACF,GAAG;QACL,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,wBAAwB;YACtC;QACF;IACF;IAEA,qBACE,ibAAC;QACC,KAAK;QACL,WAAU;QACV,OAAO;YACL,MAAM,AAAC,GAAa,OAAX,SAAS,CAAC,EAAC;YACpB,KAAK,AAAC,GAAa,OAAX,SAAS,CAAC,EAAC;QACrB;;0BAEA,ibAAC;gBACC,SAAS;oBACP;oBACA;gBACF;gBACA,WAAU;;kCAEV,ibAAC,qQAAK;wBAAC,WAAU;;;;;;kCACjB,ibAAC;kCAAK;;;;;;;;;;;;0BAER,ibAAC;gBACC,SAAS;gBACT,WAAU;0BAET,uBACC;;sCACE,ibAAC,qQAAK;4BAAC,WAAU;;;;;;sCACjB,ibAAC;sCAAK;;;;;;;iDAGR;;sCACE,ibAAC,kQAAI;4BAAC,WAAU;;;;;;sCAChB,ibAAC;sCAAK;;;;;;;;;;;;;;;;;;;AAMlB;GApFwB;KAAA","debugId":null}},
    {"offset": {"line": 3257, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/features/workspace/components/MessageFiles.tsx"],"sourcesContent":["'use client';\n\nimport Image from 'next/image';\nimport { useState, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport {\n  Image as ImageIcon,\n  File as FileIcon,\n  Download,\n  X,\n} from 'lucide-react';\nimport { createClient } from '@/lib/supabase/browserClient';\n\nconst supabase = createClient();\nconst WORKSPACE_FILES_BUCKET = 'workspace-files';\n\nexport interface MessageFile {\n  id: number; // bigint (database primary key from workspace_files)\n  original_filename: string;\n  file_path: string; // Contains UUID in path: {workspace_id}/uploads/{uuid}/{filename}\n  mime_type: string;\n  file_size: number;\n}\n\ntype MessageFilesProps = {\n  files: MessageFile[];\n};\n\nconst isImage = (mimeType: string): boolean => {\n  return mimeType.startsWith('image/');\n};\n\nexport default function MessageFiles({ files }: MessageFilesProps) {\n  const [selectedImage, setSelectedImage] = useState<string | null>(null);\n  const [imageUrls, setImageUrls] = useState<Map<number, string>>(new Map());\n  const [loadingImages, setLoadingImages] = useState<Set<number>>(new Set());\n  const loadedFilesRef = useRef<Set<number>>(new Set());\n  const loadingFilesRef = useRef<Set<number>>(new Set());\n  const [mounted, setMounted] = useState(false);\n\n  // Ensure component is mounted before using portal (SSR safety)\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // Pre-load image URLs when component mounts or files change\n  useEffect(() => {\n    const loadImageUrls = async () => {\n      const imageFiles = files.filter(file => isImage(file.mime_type));\n\n      for (const file of imageFiles) {\n        // Skip if already loaded or loading\n        if (\n          loadedFilesRef.current.has(file.id) ||\n          loadingFilesRef.current.has(file.id)\n        ) {\n          continue;\n        }\n\n        loadingFilesRef.current.add(file.id);\n        setLoadingImages(prev => new Set(prev).add(file.id));\n\n        try {\n          // Get signed URL for private bucket (valid for 1 hour)\n          const { data: signedUrlData, error: signedUrlError } =\n            await supabase.storage\n              .from(WORKSPACE_FILES_BUCKET)\n              .createSignedUrl(file.file_path, 3600);\n\n          if (!signedUrlError && signedUrlData?.signedUrl) {\n            loadedFilesRef.current.add(file.id);\n            setImageUrls(prev =>\n              new Map(prev).set(file.id, signedUrlData.signedUrl)\n            );\n          }\n        } catch (error) {\n          console.error('Error loading image URL:', error);\n        } finally {\n          loadingFilesRef.current.delete(file.id);\n          setLoadingImages(prev => {\n            const next = new Set(prev);\n            next.delete(file.id);\n            return next;\n          });\n        }\n      }\n    };\n\n    loadImageUrls();\n  }, [files]);\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  // Lock body scroll when image is open\n  useEffect(() => {\n    if (selectedImage) {\n      // Lock body scroll\n      document.body.style.overflow = 'hidden';\n      return () => {\n        // Unlock body scroll when modal closes\n        document.body.style.overflow = '';\n      };\n    }\n  }, [selectedImage]);\n\n  const handleImageClick = async (file: MessageFile) => {\n    if (!imageUrls.has(file.id)) {\n      try {\n        // Get signed URL for private bucket (valid for 1 hour)\n        const { data: signedUrlData, error: signedUrlError } =\n          await supabase.storage\n            .from(WORKSPACE_FILES_BUCKET)\n            .createSignedUrl(file.file_path, 3600);\n\n        if (signedUrlError) {\n          console.error('Error creating signed URL:', signedUrlError);\n          return;\n        }\n\n        if (signedUrlData?.signedUrl) {\n          setImageUrls(prev =>\n            new Map(prev).set(file.id, signedUrlData.signedUrl)\n          );\n          setSelectedImage(signedUrlData.signedUrl);\n        }\n      } catch (error) {\n        console.error('Error loading image:', error);\n      }\n    } else {\n      setSelectedImage(imageUrls.get(file.id) || null);\n    }\n  };\n\n  const handleDownload = async (file: MessageFile) => {\n    try {\n      // Get signed URL for private bucket (valid for 1 hour)\n      const { data: signedUrlData, error: signedUrlError } =\n        await supabase.storage\n          .from(WORKSPACE_FILES_BUCKET)\n          .createSignedUrl(file.file_path, 3600);\n\n      if (signedUrlError) {\n        console.error('Error creating signed URL:', signedUrlError);\n        alert('Failed to download file. Please try again.');\n        return;\n      }\n\n      if (signedUrlData?.signedUrl) {\n        const link = document.createElement('a');\n        link.href = signedUrlData.signedUrl;\n        link.download = file.original_filename;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n    } catch (error) {\n      console.error('Error downloading file:', error);\n      alert('Failed to download file. Please try again.');\n    }\n  };\n\n  if (files.length === 0) return null;\n\n  // Separate files into images and non-images\n  const imageFiles = files.filter(file => isImage(file.mime_type));\n  const nonImageFiles = files.filter(file => !isImage(file.mime_type));\n\n  return (\n    <>\n      <div className='space-y-2 inline-block'>\n        {/* Non-image files - vertical layout */}\n        {nonImageFiles.length > 0 && (\n          <div className='flex flex-col gap-2'>\n            {nonImageFiles.map(file => (\n              <div key={file.id} className='relative group overflow-hidden'>\n                <div className='flex items-center gap-2 bg-white/13 backdrop-blur-xl border border-black rounded-3xl px-4 py-2.5 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:bg-white/16 transition-all min-w-0'>\n                  <FileIcon className='w-5 h-5 text-white/60 flex-shrink-0' />\n                  <div className='flex-1 min-w-0 overflow-hidden'>\n                    <p\n                      className='text-sm text-white truncate'\n                      title={file.original_filename}\n                    >\n                      {file.original_filename}\n                    </p>\n                    <p className='text-xs text-white/40 truncate'>\n                      {formatFileSize(file.file_size)}\n                    </p>\n                  </div>\n                  <button\n                    onClick={() => handleDownload(file)}\n                    className='ml-2 p-1.5 rounded-md hover:bg-white/10 transition-colors flex-shrink-0'\n                    aria-label='Download file'\n                  >\n                    <Download className='w-4 h-4 text-white/60' />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Image files - horizontal wrapping layout */}\n        {imageFiles.length > 0 && (\n          <div className='flex flex-wrap gap-2'>\n            {imageFiles.map(file => {\n              const imageUrl = imageUrls.get(file.id);\n\n              return (\n                <div key={file.id} className='relative group cursor-pointer'>\n                  <div\n                    data-image-clickable\n                    onClick={() => handleImageClick(file)}\n                    onTouchEnd={e => {\n                      // Prevent parent touch handlers from interfering\n                      e.stopPropagation();\n                      // Don't prevent default here - let the click happen naturally\n                      handleImageClick(file);\n                    }}\n                    onTouchStart={e => {\n                      // Stop propagation to prevent parent swipe handlers\n                      e.stopPropagation();\n                    }}\n                    onPointerDown={e => {\n                      // Ensure pointer events work on mobile\n                      e.stopPropagation();\n                    }}\n                    className='relative w-32 h-32 rounded-lg overflow-hidden border border-white/10 bg-white/5 hover:border-white/20 transition-all'\n                    style={{\n                      touchAction: 'manipulation',\n                      WebkitTapHighlightColor: 'transparent',\n                    }}\n                  >\n                    {imageUrl ? (\n                      <Image\n                        src={imageUrl}\n                        alt={file.original_filename}\n                        fill\n                        sizes='128px'\n                        className='object-cover pointer-events-none select-none'\n                        draggable={false}\n                        loading='lazy'\n                      />\n                    ) : loadingImages.has(file.id) ? (\n                      <div className='w-full h-full flex items-center justify-center'>\n                        <div className='animate-spin rounded-full h-6 w-6 border-b-2 border-white/40'></div>\n                      </div>\n                    ) : (\n                      <div className='w-full h-full flex items-center justify-center'>\n                        <ImageIcon className='w-8 h-8 text-white/40' />\n                      </div>\n                    )}\n                    <div className='absolute inset-0 bg-black/0 hover:bg-black/20 transition-colors flex items-center justify-center pointer-events-none'>\n                      <ImageIcon className='w-6 h-6 text-white/60 opacity-0 group-hover:opacity-100 transition-opacity' />\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Full Screen Image View - Rendered via Portal to document.body */}\n      {mounted &&\n        selectedImage &&\n        createPortal(\n          <div\n            className='fixed inset-0 z-[9999] bg-black'\n            style={{\n              position: 'fixed',\n              top: 0,\n              left: 0,\n              right: 0,\n              bottom: 0,\n              width: '100vw',\n              height: '100vh',\n            }}\n            onClick={() => setSelectedImage(null)}\n          >\n            <button\n              onClick={() => setSelectedImage(null)}\n              className='absolute top-4 right-4 z-10 w-10 h-10 rounded-full bg-black/60 hover:bg-black/80 flex items-center justify-center transition-colors'\n              aria-label='Close image'\n            >\n              <X className='w-5 h-5 text-white' />\n            </button>\n            <div\n              className='relative w-full h-full'\n              style={{ width: '100vw', height: '100vh' }}\n              onClick={e => e.stopPropagation()}\n            >\n              <Image\n                src={selectedImage}\n                alt='Preview'\n                fill\n                sizes='100vw'\n                className='object-contain'\n                priority\n              />\n            </div>\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3674, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/TiptapRenderer.tsx"],"sourcesContent":["'use client';\n\nimport { useEditor, EditorContent } from '@tiptap/react';\nimport { useTiptapExtensions } from './extensions/useTiptapExtensions';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note } from '@/types/note';\nimport type { WorkspaceFile } from '@/lib/api/workspaceFilesApi';\n\ninterface TiptapRendererProps {\n  content: string;\n  contentType?: 'markdown' | 'json';\n  className?: string;\n  enableMemberMentions?: boolean;\n  enableNoteMentions?: boolean;\n  enableFileMentions?: boolean;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n  workspaceFiles?: WorkspaceFile[];\n  onMentionClick?: (memberId: number) => void;\n  onNoteMentionClick?: (noteId: number) => void;\n  onFileMentionClick?: (fileId: number) => void;\n}\n\n/**\n * TiptapRenderer - Displays TipTap content in read-only mode\n * Used for rendering messages, previews, etc.\n */\nexport function TiptapRenderer({\n  content,\n  contentType = 'markdown',\n  className = '',\n  enableMemberMentions = false,\n  enableNoteMentions = false,\n  workspaceMembers = [],\n  workspaceNotes = [],\n  workspaceFiles = [],\n  onMentionClick,\n  onNoteMentionClick,\n  onFileMentionClick,\n}: TiptapRendererProps) {\n  const extensions = useTiptapExtensions({\n    mode: 'readonly',\n    enableMemberMentions,\n    enableNoteMentions,\n    workspaceMembers,\n    workspaceNotes,\n  });\n\n  const editor = useEditor({\n    immediatelyRender: false,\n    extensions,\n    content: content || '',\n    contentType: contentType,\n    editable: false,\n    editorProps: {\n      attributes: {\n        class: `tiptap-renderer ${className}`,\n      },\n      handleClickOn: (view, pos, node, nodePos, event) => {\n        // Handle mention clicks\n        if (node.type.name === 'mention' && onMentionClick) {\n          const memberId = node.attrs.workspaceMemberId;\n          if (memberId) {\n            event.preventDefault();\n            onMentionClick(memberId);\n          }\n          return true;\n        }\n        // Handle note mention clicks\n        if (node.type.name === 'noteMention' && onNoteMentionClick) {\n          const noteId = node.attrs.noteId;\n          if (noteId) {\n            event.preventDefault();\n            onNoteMentionClick(noteId);\n          }\n          return true;\n        }\n        // Handle file mention clicks\n        if (node.type.name === 'fileMention' && onFileMentionClick) {\n          const fileId = node.attrs.fileId;\n          if (fileId) {\n            event.preventDefault();\n            onFileMentionClick(fileId);\n          }\n          return true;\n        }\n        return false;\n      },\n    },\n  });\n\n  if (!editor) {\n    return null;\n  }\n\n  return <EditorContent editor={editor} />;\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AA2BO,SAAS,eAAe,KAYT;QAZS,EAC7B,OAAO,EACP,cAAc,UAAU,EACxB,YAAY,EAAE,EACd,uBAAuB,KAAK,EAC5B,qBAAqB,KAAK,EAC1B,mBAAmB,EAAE,EACrB,iBAAiB,EAAE,EACnB,iBAAiB,EAAE,EACnB,cAAc,EACd,kBAAkB,EAClB,kBAAkB,EACE,GAZS;;IAa7B,MAAM,aAAa,IAAA,+OAAmB,EAAC;QACrC,MAAM;QACN;QACA;QACA;QACA;IACF;IAEA,MAAM,SAAS,IAAA,kbAAS,EAAC;QACvB,mBAAmB;QACnB;QACA,SAAS,WAAW;QACpB,aAAa;QACb,UAAU;QACV,aAAa;YACX,YAAY;gBACV,OAAO,AAAC,mBAA4B,OAAV;YAC5B;YACA,aAAa;oDAAE,CAAC,MAAM,KAAK,MAAM,SAAS;oBACxC,wBAAwB;oBACxB,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,aAAa,gBAAgB;wBAClD,MAAM,WAAW,KAAK,KAAK,CAAC,iBAAiB;wBAC7C,IAAI,UAAU;4BACZ,MAAM,cAAc;4BACpB,eAAe;wBACjB;wBACA,OAAO;oBACT;oBACA,6BAA6B;oBAC7B,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,iBAAiB,oBAAoB;wBAC1D,MAAM,SAAS,KAAK,KAAK,CAAC,MAAM;wBAChC,IAAI,QAAQ;4BACV,MAAM,cAAc;4BACpB,mBAAmB;wBACrB;wBACA,OAAO;oBACT;oBACA,6BAA6B;oBAC7B,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,iBAAiB,oBAAoB;wBAC1D,MAAM,SAAS,KAAK,KAAK,CAAC,MAAM;wBAChC,IAAI,QAAQ;4BACV,MAAM,cAAc;4BACpB,mBAAmB;wBACrB;wBACA,OAAO;oBACT;oBACA,OAAO;gBACT;;QACF;IACF;IAEA,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IAEA,qBAAO,ibAAC,sbAAa;QAAC,QAAQ;;;;;;AAChC;GArEgB;;QAaK,+OAAmB;QAQvB,kbAAS;;;KArBV","debugId":null}},
    {"offset": {"line": 3767, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/features/workspace/components/WorkspaceMessageItem.tsx"],"sourcesContent":["import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport type { WorkspaceMessage } from '@/types/workspace';\nimport { format } from 'date-fns';\nimport { User, Reply } from 'lucide-react';\nimport { useState, useRef, useEffect, useCallback, useMemo } from 'react';\nimport { useDrag } from '@use-gesture/react';\nimport MessageContextMenu from './MessageContextMenu';\nimport MessageFiles from './MessageFiles';\nimport { TiptapRenderer } from '@/components/tiptap/TiptapRenderer';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note } from '@/types/note';\n\ntype Props = {\n  message: WorkspaceMessage;\n  isOwnMessage: boolean;\n  onReply?: (messageId: number) => void;\n  onJumpToMessage?: (messageId: number) => void;\n  isHighlighted?: boolean;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n};\n\nfunction ReadStatus({ readCount }: { readCount: number }) {\n  if (readCount <= 0) return null;\n\n  return <p className='text-xs text-gray-500 mt-1'>Read {readCount}</p>;\n}\n\nexport default function WorkspaceMessageItem({\n  message,\n  isOwnMessage,\n  onReply,\n  onJumpToMessage,\n  isHighlighted = false,\n  workspaceMembers = [],\n  workspaceNotes = [],\n}: Props) {\n  const [contextMenu, setContextMenu] = useState<{\n    x: number;\n    y: number;\n  } | null>(null);\n  const [swipeOffset, setSwipeOffset] = useState(0);\n  const [showSwipeIndicator, setShowSwipeIndicator] = useState(false);\n  const messageRef = useRef<HTMLDivElement>(null);\n  const longPressTimer = useRef<NodeJS.Timeout | null>(null);\n  const dragTargetRef = useRef<HTMLElement | null>(null);\n  const startedOnRepliedPreviewRef = useRef(false);\n  const pointerStartRef = useRef<{ x: number; y: number } | null>(null);\n\n  // Close context menu on scroll\n  useEffect(() => {\n    const handleScroll = () => setContextMenu(null);\n    window.addEventListener('scroll', handleScroll, true);\n    return () => window.removeEventListener('scroll', handleScroll, true);\n  }, []);\n\n  // Cleanup long press timer on unmount\n  useEffect(() => {\n    return () => {\n      if (longPressTimer.current) {\n        clearTimeout(longPressTimer.current);\n      }\n    };\n  }, []);\n\n  // Handle right-click (desktop)\n  const handleContextMenu = (e: React.MouseEvent) => {\n    e.preventDefault();\n    setContextMenu({ x: e.clientX, y: e.clientY });\n  };\n\n  const handleReply = useCallback(() => {\n    if (onReply) {\n      onReply(message.id);\n    }\n    setContextMenu(null);\n  }, [onReply, message.id]);\n\n  const cancelLongPress = useCallback(() => {\n    if (longPressTimer.current) {\n      clearTimeout(longPressTimer.current);\n      longPressTimer.current = null;\n    }\n  }, []);\n\n  const scheduleLongPress = useCallback(() => {\n    cancelLongPress();\n    longPressTimer.current = setTimeout(() => {\n      const rect = messageRef.current?.getBoundingClientRect();\n      if (rect) {\n        setContextMenu({\n          x: Math.min(rect.right - 150, window.innerWidth - 200),\n          y: rect.top,\n        });\n      }\n    }, 500);\n  }, [cancelLongPress]);\n\n  const handlePointerDown = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>) => {\n      dragTargetRef.current = event.target as HTMLElement;\n      pointerStartRef.current = { x: event.clientX, y: event.clientY };\n      startedOnRepliedPreviewRef.current =\n        dragTargetRef.current?.closest('[data-replied-preview]') !== null;\n\n      if (!startedOnRepliedPreviewRef.current) {\n        scheduleLongPress();\n      }\n    },\n    [scheduleLongPress]\n  );\n\n  const handlePointerMove = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>) => {\n      const start = pointerStartRef.current;\n      if (!start) return;\n\n      const deltaX = Math.abs(event.clientX - start.x);\n      const deltaY = Math.abs(event.clientY - start.y);\n\n      if (deltaX > 6 || deltaY > 6) {\n        cancelLongPress();\n      }\n    },\n    [cancelLongPress]\n  );\n\n  const resetPointerState = useCallback(() => {\n    cancelLongPress();\n    pointerStartRef.current = null;\n    dragTargetRef.current = null;\n    startedOnRepliedPreviewRef.current = false;\n  }, [cancelLongPress]);\n\n  const handlePointerUp = useCallback(() => {\n    resetPointerState();\n  }, [resetPointerState]);\n\n  const handlePointerCancel = useCallback(() => {\n    resetPointerState();\n    setSwipeOffset(0);\n    setShowSwipeIndicator(false);\n  }, [resetPointerState]);\n\n  type DragHandlerType = Parameters<typeof useDrag>[0];\n\n  const dragHandler = useCallback<DragHandlerType>(\n    state => {\n      const { first, last, movement, tap, event } = state;\n      const movementX = movement[0] ?? 0;\n\n      if (first) {\n        cancelLongPress();\n      }\n\n      const startedOnPreview = startedOnRepliedPreviewRef.current;\n\n      if (last) {\n        const clampedMovement = Math.min(movementX, 0);\n        const swipeDistance = Math.abs(clampedMovement);\n\n        setSwipeOffset(0);\n        setShowSwipeIndicator(false);\n\n        if (\n          tap &&\n          startedOnPreview &&\n          onJumpToMessage &&\n          message.replied_message?.id\n        ) {\n          const nativeEvent = event as Event;\n          if (typeof nativeEvent.stopPropagation === 'function') {\n            nativeEvent.stopPropagation();\n          }\n          onJumpToMessage(message.replied_message.id);\n        } else if (swipeDistance >= 60 && onReply) {\n          handleReply();\n        }\n\n        resetPointerState();\n        return;\n      }\n\n      const clampedMovement = Math.min(movementX, 0);\n\n      if (clampedMovement < 0) {\n        const limitedMovement = Math.max(clampedMovement, -120);\n        setSwipeOffset(limitedMovement);\n        setShowSwipeIndicator(Math.abs(limitedMovement) > 20);\n      } else {\n        setSwipeOffset(0);\n        setShowSwipeIndicator(false);\n      }\n    },\n    [\n      cancelLongPress,\n      handleReply,\n      message.replied_message?.id,\n      onJumpToMessage,\n      onReply,\n      resetPointerState,\n    ]\n  );\n\n  const bindDrag = useDrag(dragHandler, {\n    axis: 'x',\n    filterTaps: true,\n    threshold: 10,\n    preventScroll: false,\n  });\n\n  const dragBindings = bindDrag();\n\n  const gestureBindings = useMemo(() => {\n    return {\n      ...dragBindings,\n      onPointerDown: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerDown(event);\n        dragBindings.onPointerDown?.(event);\n      },\n      onPointerMove: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerMove(event);\n        dragBindings.onPointerMove?.(event);\n      },\n      onPointerUp: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerUp();\n        dragBindings.onPointerUp?.(event);\n      },\n      onPointerCancel: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerCancel();\n        dragBindings.onPointerCancel?.(event);\n      },\n      onPointerLeave: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerCancel();\n        dragBindings.onPointerLeave?.(event);\n      },\n    };\n  }, [\n    dragBindings,\n    handlePointerCancel,\n    handlePointerDown,\n    handlePointerMove,\n    handlePointerUp,\n  ]);\n\n  if (!message) return null;\n\n  const profile = message.workspace_member?.user_profile ?? null;\n  const name = profile?.name ?? 'Unknown';\n  const avatarUrl = profile?.avatar_url ?? '';\n  const readCount = message.read_count ?? message.reads?.length ?? 0;\n\n  const RepliedMessagePreview = ({\n    repliedMessage,\n  }: {\n    repliedMessage: WorkspaceMessage;\n  }) => {\n    const repliedProfile = repliedMessage.workspace_member?.user_profile;\n    const repliedName = repliedProfile?.name ?? 'Unknown';\n    const repliedText =\n      repliedMessage.text.slice(0, 100) +\n      (repliedMessage.text.length > 100 ? '...' : '');\n\n    // Desktop click handler\n    const handleClick = (e: React.MouseEvent) => {\n      e.stopPropagation();\n      if (onJumpToMessage && repliedMessage.id) {\n        onJumpToMessage(repliedMessage.id);\n      }\n    };\n\n    return (\n      <div\n        data-replied-preview\n        className='mb-2 border-white/20 cursor-pointer hover:bg-white/5 rounded transition-colors'\n        onClick={handleClick}\n        style={{ pointerEvents: 'auto' }}\n      >\n        <div className='flex items-start gap-2'>\n          <Avatar className='h-6 w-6 border border-white/15 bg-white/10 text-[10px] font-medium flex-shrink-0'>\n            {repliedProfile?.avatar_url ? (\n              <AvatarImage src={repliedProfile.avatar_url} alt={repliedName} />\n            ) : (\n              <AvatarFallback>\n                <User className='h-3.5 w-3.5' />\n              </AvatarFallback>\n            )}\n          </Avatar>\n          <div className='min-w-0 flex-1'>\n            <p className='text-xs text-white/50 mb-1'>{repliedName}</p>\n            <div className='text-xs text-white/40'>\n              <TiptapRenderer\n                content={repliedText}\n                contentType='markdown'\n                enableMemberMentions={true}\n                enableNoteMentions={true}\n                workspaceMembers={workspaceMembers}\n                workspaceNotes={workspaceNotes}\n                className='tiptap-reply-preview'\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  if (isOwnMessage) {\n    // Own messages on the right (ChatGPT style)\n    return (\n      <>\n        <div\n          ref={messageRef}\n          data-message-id={message.id}\n          className={`flex justify-end items-end w-full relative transition-transform duration-300 ${\n            isHighlighted ? 'animate-bounce-x-right' : ''\n          }`}\n          onContextMenu={handleContextMenu}\n          style={{ userSelect: 'none', WebkitUserSelect: 'none' }}\n          {...gestureBindings}\n        >\n          {/* Reply icon indicator on the right side */}\n          {showSwipeIndicator && (\n            <div\n              className='absolute right-0 top-1/2 -translate-y-1/2 flex items-center transition-opacity duration-200 z-10'\n              style={{\n                opacity: showSwipeIndicator ? 1 : 0,\n              }}\n            >\n              <Reply className='w-5 h-5 text-white/60' />\n            </div>\n          )}\n          <div\n            className='flex gap-2 items-end justify-end min-w-0 max-w-full relative transition-transform duration-75'\n            style={{\n              transform: `translateX(${swipeOffset}px)`,\n            }}\n          >\n            <div className='flex flex-col justify-end flex-shrink-0'>\n              <div className='text-right'>\n                <ReadStatus readCount={readCount} />\n              </div>\n              <p className='text-xs text-gray-500 text-right'>\n                {format(new Date(message.created_at), 'HH:mm')}\n              </p>\n            </div>\n            <div className='flex flex-col gap-2 items-end'>\n              {(message.text || message.replied_message) && (\n                <div className='inline-block bg-white/13 backdrop-blur-xl border border-black rounded-3xl px-4 py-2.5 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'>\n                  {message.replied_message && (\n                    <RepliedMessagePreview\n                      repliedMessage={message.replied_message}\n                    />\n                  )}\n                  {message.text && (\n                    <div className='text-sm text-white'>\n                      <TiptapRenderer\n                        content={message.text}\n                        contentType='markdown'\n                        enableMemberMentions={true}\n                        enableNoteMentions={true}\n                        workspaceMembers={workspaceMembers}\n                        workspaceNotes={workspaceNotes}\n                        className='tiptap-message-content'\n                      />\n                    </div>\n                  )}\n                </div>\n              )}\n              {message.files && message.files.length > 0 && (\n                <MessageFiles files={message.files} />\n              )}\n            </div>\n          </div>\n        </div>\n        {contextMenu && (\n          <MessageContextMenu\n            messageText={message.text}\n            onReply={handleReply}\n            onClose={() => setContextMenu(null)}\n            position={contextMenu}\n          />\n        )}\n      </>\n    );\n  }\n\n  // Other messages on the left\n  return (\n    <>\n      <div\n        ref={messageRef}\n        data-message-id={message.id}\n        className={`flex gap-2 relative transition-transform duration-300 ${\n          isHighlighted ? 'animate-bounce-x-left' : ''\n        }`}\n        onContextMenu={handleContextMenu}\n        style={{ userSelect: 'none', WebkitUserSelect: 'none' }}\n        {...gestureBindings}\n      >\n        {/* Reply icon indicator on the right side */}\n        {showSwipeIndicator && (\n          <div\n            className='absolute right-0 top-1/2 -translate-y-1/2 flex items-center transition-opacity duration-200 z-10'\n            style={{\n              opacity: showSwipeIndicator ? 1 : 0,\n            }}\n          >\n            <Reply className='w-5 h-5 text-white/60' />\n          </div>\n        )}\n        <div\n          className='flex gap-2 flex-shrink-0 transition-transform duration-75'\n          style={{\n            transform: `translateX(${swipeOffset}px)`,\n          }}\n        >\n          <Avatar className='h-8 w-8 border border-white/15 bg-white/10 text-xs font-medium'>\n            {avatarUrl ? (\n              <AvatarImage src={avatarUrl} alt={name} />\n            ) : (\n              <AvatarFallback>\n                <User className='h-4 w-4' />\n              </AvatarFallback>\n            )}\n          </Avatar>\n        </div>\n        <div\n          className='flex flex-col gap-1 min-w-0 relative flex-1 transition-transform duration-75'\n          style={{\n            transform: `translateX(${swipeOffset}px)`,\n          }}\n        >\n          <p className='text-xs text-gray-400 mb-1'>{name}</p>\n          <div className='flex gap-2 items-end'>\n            <div className='flex flex-col gap-2 min-w-0'>\n              {(message.text || message.replied_message) && (\n                <div className='inline-block bg-white/8 backdrop-blur-xl border border-black rounded-3xl px-4 py-2.5 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'>\n                  {message.replied_message && (\n                    <RepliedMessagePreview\n                      repliedMessage={message.replied_message}\n                    />\n                  )}\n                  {message.text && (\n                    <div className='text-sm text-white'>\n                      <TiptapRenderer\n                        content={message.text}\n                        contentType='markdown'\n                        enableMemberMentions={true}\n                        enableNoteMentions={true}\n                        workspaceMembers={workspaceMembers}\n                        workspaceNotes={workspaceNotes}\n                        className='tiptap-message-content'\n                      />\n                    </div>\n                  )}\n                </div>\n              )}\n              {message.files && message.files.length > 0 && (\n                <MessageFiles files={message.files} />\n              )}\n            </div>\n            <p className='text-xs text-gray-500 mt-1'>\n              {format(new Date(message.created_at), 'HH:mm')}\n            </p>\n          </div>\n        </div>\n      </div>\n      {contextMenu && (\n        <MessageContextMenu\n          messageText={message.text}\n          onReply={handleReply}\n          onClose={() => setContextMenu(null)}\n          position={contextMenu}\n        />\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4491, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/features/workspace/components/WorkspaceMessageList.tsx"],"sourcesContent":["import type { WorkspaceMessage, WorkspaceMember } from '@/types/workspace';\nimport WorkspaceMessageItem from '@/features/workspace/components/WorkspaceMessageItem';\nimport type { Note } from '@/types/note';\n\ntype Props = {\n  messages: WorkspaceMessage[];\n  currentUserId: string;\n  onReply?: (messageId: number) => void;\n  onJumpToMessage?: (messageId: number) => void;\n  highlightedMessageId?: number | null;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n};\n\nexport default function WorkspaceMessageList({\n  messages,\n  currentUserId,\n  onReply,\n  onJumpToMessage,\n  highlightedMessageId,\n  workspaceMembers = [],\n  workspaceNotes = [],\n}: Props) {\n  if (messages.length === 0) {\n    return (\n      <div className='flex-1 flex items-center justify-center'>\n        <div className='text-center'>\n          <p className='text-gray-400'>\n            No messages yet. Start the conversation!\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className='flex flex-col gap-3'>\n      {messages\n        .filter(message => message != null)\n        .map(message => (\n          <WorkspaceMessageItem\n            key={message.id}\n            message={message}\n            isOwnMessage={currentUserId === message.workspace_member?.user_id}\n            onReply={onReply}\n            onJumpToMessage={onJumpToMessage}\n            isHighlighted={highlightedMessageId === message.id}\n            workspaceMembers={workspaceMembers}\n            workspaceNotes={workspaceNotes}\n          />\n        ))}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;;;AAae,SAAS,qBAAqB,KAQrC;QARqC,EAC3C,QAAQ,EACR,aAAa,EACb,OAAO,EACP,eAAe,EACf,oBAAoB,EACpB,mBAAmB,EAAE,EACrB,iBAAiB,EAAE,EACb,GARqC;IAS3C,IAAI,SAAS,MAAM,KAAK,GAAG;QACzB,qBACE,ibAAC;YAAI,WAAU;sBACb,cAAA,ibAAC;gBAAI,WAAU;0BACb,cAAA,ibAAC;oBAAE,WAAU;8BAAgB;;;;;;;;;;;;;;;;IAMrC;IAEA,qBACE,ibAAC;QAAI,WAAU;kBACZ,SACE,MAAM,CAAC,CAAA,UAAW,WAAW,MAC7B,GAAG,CAAC,CAAA;gBAI+B;iCAHlC,ibAAC,sOAAoB;gBAEnB,SAAS;gBACT,cAAc,oBAAkB,4BAAA,QAAQ,gBAAgB,cAAxB,gDAAA,0BAA0B,OAAO;gBACjE,SAAS;gBACT,iBAAiB;gBACjB,eAAe,yBAAyB,QAAQ,EAAE;gBAClD,kBAAkB;gBAClB,gBAAgB;eAPX,QAAQ,EAAE;;;;;;;;;;;AAY3B;KAvCwB","debugId":null}},
    {"offset": {"line": 4559, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/hooks/useWorkspace.ts"],"sourcesContent":["'use client';\n\nimport useSWR, { mutate } from 'swr';\nimport {\n  getWorkspaces,\n  getWorkspace,\n  createWorkspace,\n  updateWorkspace,\n  deleteWorkspace,\n  getWorkspaceMembers,\n} from '@/lib/api/workspaceApi';\nimport type { Workspace, WorkspaceMember } from '@/types/workspace';\n\n// SWR keys\nconst WORKSPACES_KEY = '/workspaces';\nconst workspaceKey = (id: number) => `/workspaces/${id}`;\n\n// Hooks\nexport function useWorkspaces() {\n  const { data, error, isLoading } = useSWR<Workspace[]>(\n    WORKSPACES_KEY,\n    getWorkspaces,\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  return {\n    workspaces: data,\n    isLoading,\n    error,\n  };\n}\n\nexport function useWorkspace(id: number | null) {\n  const { data, error, isLoading } = useSWR<Workspace>(\n    id ? workspaceKey(id) : null,\n    () => getWorkspace(id!),\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  return {\n    workspace: data,\n    isLoading,\n    error,\n  };\n}\n\nexport function useWorkspaceMembers(workspaceId: number | null) {\n  const { data, error, isLoading } = useSWR<WorkspaceMember[]>(\n    workspaceId ? `/workspaces/${workspaceId}/members` : null,\n    workspaceId ? async () => await getWorkspaceMembers(workspaceId) : null,\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  return {\n    members: data || [],\n    isLoading,\n    error,\n  };\n}\n\n// Mutation helpers\nexport function useWorkspaceMutations() {\n  const create = async (title: string) => {\n    const workspace = await createWorkspace(title);\n    mutate(WORKSPACES_KEY); // Revalidate list\n    return workspace;\n  };\n\n  const update = async (\n    id: number,\n    updates: Partial<Pick<Workspace, 'title' | 'type' | 'icon_url'>>\n  ) => {\n    const workspace = await updateWorkspace(id, updates);\n    mutate(workspaceKey(id)); // Revalidate specific workspace\n    mutate(WORKSPACES_KEY); // Revalidate list\n    return workspace;\n  };\n\n  const remove = async (id: number) => {\n    await deleteWorkspace(id);\n    mutate(WORKSPACES_KEY); // Revalidate list\n  };\n\n  return { create, update, remove };\n}\n"],"names":[],"mappings":";;;;;;;;;;AAEA;AAAA;AACA;;AAHA;;;AAaA,WAAW;AACX,MAAM,iBAAiB;AACvB,MAAM,eAAe,CAAC,KAAe,AAAC,eAAiB,OAAH;AAG7C,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,wRAAM,EACvC,gBACA,0MAAa,EACb;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,OAAO;QACL,YAAY;QACZ;QACA;IACF;AACF;GAfgB;;QACqB,wRAAM;;;AAgBpC,SAAS,aAAa,EAAiB;;IAC5C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,wRAAM,EACvC,KAAK,aAAa,MAAM;+BACxB,IAAM,IAAA,yMAAY,EAAC;8BACnB;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,OAAO;QACL,WAAW;QACX;QACA;IACF;AACF;IAfgB;;QACqB,wRAAM;;;AAgBpC,SAAS,oBAAoB,WAA0B;;IAC5D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,wRAAM,EACvC,cAAc,AAAC,eAA0B,OAAZ,aAAY,cAAY,MACrD;sCAAc,UAAY,MAAM,IAAA,gNAAmB,EAAC;uCAAe,MACnE;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,OAAO;QACL,SAAS,QAAQ,EAAE;QACnB;QACA;IACF;AACF;IAfgB;;QACqB,wRAAM;;;AAiBpC,SAAS;IACd,MAAM,SAAS,OAAO;QACpB,MAAM,YAAY,MAAM,IAAA,4MAAe,EAAC;QACxC,IAAA,4UAAM,EAAC,iBAAiB,kBAAkB;QAC1C,OAAO;IACT;IAEA,MAAM,SAAS,OACb,IACA;QAEA,MAAM,YAAY,MAAM,IAAA,4MAAe,EAAC,IAAI;QAC5C,IAAA,4UAAM,EAAC,aAAa,MAAM,gCAAgC;QAC1D,IAAA,4UAAM,EAAC,iBAAiB,kBAAkB;QAC1C,OAAO;IACT;IAEA,MAAM,SAAS,OAAO;QACpB,MAAM,IAAA,4MAAe,EAAC;QACtB,IAAA,4UAAM,EAAC,iBAAiB,kBAAkB;IAC5C;IAEA,OAAO;QAAE;QAAQ;QAAQ;IAAO;AAClC","debugId":null}},
    {"offset": {"line": 4663, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/app/%28private%29/workspace/%5Bid%5D/chat/page.tsx"],"sourcesContent":["'use client';\n\nimport { useParams } from 'next/navigation';\nimport { useEffect, useRef, useState, useCallback } from 'react';\nimport { useWorkspaceChat } from '@/hooks/useWorkspaceChat';\nimport { createClient } from '@/lib/supabase/browserClient';\nimport { ChatInput, type ChatInputRef } from '@/components/chat-input';\nimport GlassButton from '@/components/glass-card/GlassButton';\nimport WorkspaceMessageList from '@/features/workspace/components/WorkspaceMessageList';\nimport { ChevronDown } from 'lucide-react';\nimport { useCopilotReadable } from '@copilotkit/react-core';\nimport { useWorkspaceMembers } from '@/hooks/useWorkspace';\nimport { useWorkspaceNotes } from '@/hooks/useWorkspaceNotes';\n\nexport default function WorkspaceChatPage() {\n  const params = useParams();\n  const workspaceId = parseInt(params.id as string);\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n  const [showScrollButton, setShowScrollButton] = useState(false);\n  const prevMessageCountRef = useRef(0);\n  const isUserScrollingRef = useRef(false);\n  const scrollTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isLoadingMoreRef = useRef(false);\n  const prevScrollHeightRef = useRef(0);\n  const lastScrollTopRef = useRef(0);\n  const hasScrolledUpRef = useRef(false);\n  const prevMessagesRef = useRef<typeof messages>([]);\n  const chatInputRef = useRef<ChatInputRef>(null);\n  const [highlightedMessageId, setHighlightedMessageId] = useState<\n    number | null\n  >(null);\n  const [replyingTo, setReplyingTo] = useState<{\n    id: number;\n    text: string;\n    authorName?: string;\n  } | null>(null);\n  const {\n    messages,\n    sendMessage: originalSendMessage,\n    isLoading,\n    isLoadingMore,\n    error,\n    isConnected,\n    loadMoreMessages,\n    hasMoreMessages,\n  } = useWorkspaceChat(workspaceId);\n\n  // Fetch workspace members for mentions\n  const { members } = useWorkspaceMembers(workspaceId);\n\n  // Fetch workspace notes for note mentions\n  const { notes: workspaceNotes } = useWorkspaceNotes(workspaceId);\n\n  useCopilotReadable({\n    description: 'workspace chat history',\n    value: messages\n      .slice(-20)\n      .map(message => message.text)\n      .join('\\n'),\n    categories: ['workspace_chat'],\n  });\n\n  // Scroll to bottom function\n  // Note: With column-reverse, bottom is at scrollTop = 0\n  const scrollToBottom = useCallback((behavior: ScrollBehavior = 'smooth') => {\n    if (scrollContainerRef.current) {\n      scrollContainerRef.current.scrollTo({\n        top: 0,\n        behavior,\n      });\n    }\n  }, []);\n\n  // Track when we send a message to avoid conflicts with useEffect scroll logic\n  const sendingMessageRef = useRef(false);\n\n  // Wrap sendMessage to scroll to bottom after sending\n  const sendMessage = useCallback(\n    async (\n      text: string,\n      workspaceFileIds?: number[],\n      mentionedMemberIds?: number[],\n      mentionedNoteIds?: number[]\n    ) => {\n      sendingMessageRef.current = true;\n      const replyToId = replyingTo?.id ?? null;\n      try {\n        await originalSendMessage(\n          text,\n          replyToId,\n          workspaceFileIds,\n          mentionedMemberIds,\n          mentionedNoteIds\n        );\n        // Clear reply state after sending\n        setReplyingTo(null);\n        // Scroll to bottom after sending message\n        // Use a delay to ensure the message is in the DOM via realtime\n        setTimeout(() => {\n          if (scrollContainerRef.current) {\n            scrollContainerRef.current.scrollTop = 0;\n          }\n          sendingMessageRef.current = false;\n        }, 100);\n      } catch (error) {\n        sendingMessageRef.current = false;\n        throw error;\n      }\n    },\n    [originalSendMessage, replyingTo]\n  );\n\n  // Handle reply action\n  const handleReply = useCallback(\n    (messageId: number) => {\n      const message = messages.find(m => m.id === messageId);\n      if (message) {\n        const authorName =\n          message.workspace_member?.user_profile?.name ?? 'Unknown';\n        setReplyingTo({\n          id: message.id,\n          text: message.text,\n          authorName,\n        });\n        // Focus input after setting reply\n        setTimeout(() => {\n          chatInputRef.current?.focus();\n        }, 100);\n      }\n    },\n    [messages]\n  );\n\n  // Cancel reply\n  const handleCancelReply = useCallback(() => {\n    setReplyingTo(null);\n  }, []);\n\n  // Scroll to a specific message by ID\n  const scrollToMessage = useCallback((messageId: number) => {\n    if (!scrollContainerRef.current) return;\n\n    // Find the message element by data attribute\n    const messageElement = scrollContainerRef.current.querySelector(\n      `[data-message-id=\"${messageId}\"]`\n    ) as HTMLElement;\n\n    if (!messageElement) return;\n\n    // Check if the message is already in view\n    const container = scrollContainerRef.current;\n    const containerRect = container.getBoundingClientRect();\n    const elementRect = messageElement.getBoundingClientRect();\n\n    // Check if element is visible within the container viewport\n    const isInView =\n      elementRect.top >= containerRect.top &&\n      elementRect.bottom <= containerRect.bottom &&\n      elementRect.left >= containerRect.left &&\n      elementRect.right <= containerRect.right;\n\n    // Only scroll if not already in view\n    if (!isInView) {\n      // Use scrollIntoView with block: 'center' to center the message\n      // This works well with column-reverse layout\n      messageElement.scrollIntoView({\n        behavior: 'smooth',\n        block: 'center',\n        inline: 'nearest',\n      });\n\n      // Trigger bounce animation after scroll has started (longer delay for scrolling)\n      setTimeout(() => {\n        setHighlightedMessageId(messageId);\n        // Clear highlight after animation completes\n        setTimeout(() => {\n          setHighlightedMessageId(null);\n        }, 600);\n      }, 300);\n    } else {\n      // Message is already in view - trigger bounce immediately\n      setHighlightedMessageId(messageId);\n      // Clear highlight after animation completes\n      setTimeout(() => {\n        setHighlightedMessageId(null);\n      }, 600);\n    }\n  }, []);\n\n  // Check if user is near bottom (within threshold)\n  // Note: With column-reverse, scrollTop 0 or positive small values are at the bottom\n  const isNearBottom = useCallback(() => {\n    if (!scrollContainerRef.current) {\n      return true;\n    }\n    const container = scrollContainerRef.current;\n    const threshold = 1000;\n    const scrollTop = container.scrollTop;\n    const scrollTopAbs = Math.abs(scrollTop);\n    // With column-reverse, bottom is at scrollTop = 0 or small positive values\n    // Negative values mean we're scrolled away from bottom (toward top)\n    const result = scrollTopAbs <= threshold;\n    return result;\n  }, []);\n\n  // Check if user is near top (within 800px - triggers earlier for faster loading)\n  // Note: With column-reverse, scrollTop can be negative, which means we're at the top\n  const isNearTop = useCallback(() => {\n    if (!scrollContainerRef.current) return false;\n    const container = scrollContainerRef.current;\n    const threshold = 800;\n\n    const scrollTop = container.scrollTop;\n    const scrollHeight = container.scrollHeight;\n    const clientHeight = container.clientHeight;\n\n    // With flex-col-reverse, negative scrollTop means we're scrolled to the top (oldest messages)\n    // This is a browser quirk with flex-col-reverse\n    // From logs: scrollTop is around -628 to -667 when scrolled up, which means we're near the top\n    if (scrollTop < 0) {\n      // If scrollTop is negative, we're scrolled up toward older messages\n      // The more negative, the more we've scrolled up\n      // Trigger if we're scrolled up significantly (absolute value > 200px threshold)\n      return Math.abs(scrollTop) > 200;\n    }\n\n    // Calculate max scroll position\n    const maxScrollTop = scrollHeight - clientHeight;\n\n    // Handle edge case where content is smaller than container\n    if (maxScrollTop <= 0) return false;\n\n    // For positive scrollTop, check if we're within threshold of the max scroll\n    const distanceFromTop = maxScrollTop - scrollTop;\n    return distanceFromTop < threshold;\n  }, []);\n\n  // Handle scroll events to show/hide button\n  useEffect(() => {\n    const container = scrollContainerRef.current;\n    if (!container) return;\n\n    const handleScroll = () => {\n      if (!scrollContainerRef.current) return;\n\n      const container = scrollContainerRef.current;\n      const currentScrollTop = container.scrollTop;\n\n      // Detect if user is scrolling up\n      // With column-reverse, increasing scrollTop means scrolling up (away from bottom)\n      if (currentScrollTop > lastScrollTopRef.current) {\n        hasScrolledUpRef.current = true;\n      }\n\n      // Reset scrolled up flag if user reaches near bottom\n      if (isNearBottom()) {\n        hasScrolledUpRef.current = false;\n      }\n\n      lastScrollTopRef.current = currentScrollTop;\n      isUserScrollingRef.current = true;\n\n      // Clear existing timeout\n      if (scrollTimeoutRef.current) {\n        clearTimeout(scrollTimeoutRef.current);\n      }\n\n      // Set timeout to detect when scrolling stops\n      scrollTimeoutRef.current = setTimeout(() => {\n        isUserScrollingRef.current = false;\n      }, 300); // Increased timeout to be more reliable\n\n      // Check if we should show the scroll button\n      const nearBottom = isNearBottom();\n      setShowScrollButton(!nearBottom);\n\n      // Check if we're near top and should load more messages\n      // With column-reverse, \"top\" (for loading older messages) is at high scrollTop values\n      const nearTop = isNearTop();\n\n      if (\n        nearTop &&\n        hasMoreMessages &&\n        !isLoadingMoreRef.current &&\n        !isLoadingMore\n      ) {\n        isLoadingMoreRef.current = true;\n        // Store current scrollHeight to restore position after loading\n        prevScrollHeightRef.current = container.scrollHeight;\n        loadMoreMessages().finally(() => {\n          isLoadingMoreRef.current = false;\n        });\n      }\n    };\n\n    container.addEventListener('scroll', handleScroll);\n    return () => {\n      container.removeEventListener('scroll', handleScroll);\n      if (scrollTimeoutRef.current) {\n        clearTimeout(scrollTimeoutRef.current);\n      }\n    };\n  }, [\n    isNearBottom,\n    isNearTop,\n    hasMoreMessages,\n    loadMoreMessages,\n    isLoadingMore,\n  ]);\n\n  // No initial scroll needed - CSS column-reverse handles it automatically!\n  // Removed useLayoutEffect and useEffect for initial scroll\n\n  // Preserve scroll position when messages change (from loading older messages or realtime updates)\n  useEffect(() => {\n    const container = scrollContainerRef.current;\n    if (!container) return;\n\n    const prevMessages = prevMessagesRef.current;\n    const messagesChanged =\n      prevMessages.length !== messages.length ||\n      (prevMessages.length > 0 &&\n        messages.length > 0 &&\n        prevMessages[0]?.id !== messages[0]?.id);\n\n    // If messages changed and user has scrolled up, preserve scroll position\n    if (messagesChanged && prevMessages.length > 0) {\n      // Case 1: Loading older messages (prepending) - preserve scroll position\n      // Check if we stored a scrollHeight and messages increased (new messages were prepended)\n      if (\n        prevScrollHeightRef.current > 0 &&\n        messages.length > prevMessages.length\n      ) {\n        // Use double requestAnimationFrame to ensure DOM has fully updated with new messages\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            if (!scrollContainerRef.current) return;\n            const container = scrollContainerRef.current;\n\n            const scrollHeightDifference =\n              container.scrollHeight - prevScrollHeightRef.current;\n\n            if (scrollHeightDifference > 0) {\n              // With flex-col-reverse, when older messages are prepended,\n              // scrollTop may be negative. We need to adjust it to maintain visual position.\n              // Since we're adding content \"above\" (which in flex-col-reverse is at higher scrollTop),\n              // we need to increase the scrollTop value (make it less negative or more positive)\n              const oldScrollTop = container.scrollTop;\n              // Adding the difference maintains the visual position\n              container.scrollTop = oldScrollTop + scrollHeightDifference;\n            }\n\n            // Reset after adjustment\n            prevScrollHeightRef.current = 0;\n          });\n        });\n        // Update prev messages after processing\n        prevMessagesRef.current = messages;\n        return; // Don't process realtime updates when loading more\n      }\n      // Case 2: Realtime update changed messages - preserve scroll if user scrolled up\n      // Skip this if we just sent a message (handled by sendMessage wrapper)\n      else if (\n        messages.length > 0 &&\n        !isLoadingMore &&\n        !sendingMessageRef.current &&\n        !isNearBottom()\n      ) {\n        // Capture scroll position before React updates DOM\n        const scrollTopToPreserve = container.scrollTop;\n\n        // Use double requestAnimationFrame to ensure DOM has fully updated\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            if (!scrollContainerRef.current) return;\n\n            // If user is still not near bottom, restore scroll position\n            if (!isNearBottom()) {\n              scrollContainerRef.current.scrollTop = scrollTopToPreserve;\n            }\n          });\n        });\n      }\n    }\n\n    // Update prev messages after processing\n    prevMessagesRef.current = messages;\n  }, [messages, isLoadingMore, isNearBottom]);\n\n  // Track message count (no auto-scroll - removed as per user request)\n  useEffect(() => {\n    prevMessageCountRef.current = messages.length;\n  }, [messages.length]);\n\n  // Get current user ID\n  const [currentUserId, setCurrentUserId] = useState<string | null>(null);\n\n  useEffect(() => {\n    const supabase = createClient();\n    supabase.auth.getUser().then(({ data: { user } }) => {\n      setCurrentUserId(user?.id || null);\n    });\n  }, []);\n\n  return (\n    <div className='flex flex-col h-full relative'>\n      {/* Error Display */}\n      {error && (\n        <div className='px-4 py-2 mb-2 bg-white/8 backdrop-blur-xl border border-black rounded-4xl text-center text-sm text-white/80 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'>\n          {error}\n        </div>\n      )}\n\n      {/* Messages */}\n      {/* Using flex-direction: column-reverse makes the list naturally start at bottom */}\n      <div\n        ref={scrollContainerRef}\n        className='flex-1 overflow-y-auto relative flex flex-col-reverse'\n      >\n        {/* Loading indicator for older messages - appears at top when scrolling up */}\n        {isLoadingMore && (\n          <div className='flex items-center justify-center py-4'>\n            <div className='flex items-center gap-2 text-gray-400 text-sm'>\n              <div className='animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400'></div>\n              <span>Loading older messages...</span>\n            </div>\n          </div>\n        )}\n\n        {isConnected || messages.length > 0 ? (\n          currentUserId ? (\n            <WorkspaceMessageList\n              messages={messages}\n              currentUserId={currentUserId}\n              onReply={handleReply}\n              onJumpToMessage={scrollToMessage}\n              highlightedMessageId={highlightedMessageId}\n              workspaceMembers={members}\n              workspaceNotes={workspaceNotes}\n            />\n          ) : (\n            <div className='flex-1 flex items-center justify-center'>\n              <div className='text-center'>\n                <p className='text-gray-400'>Loading...</p>\n              </div>\n            </div>\n          )\n        ) : (\n          <div className='flex-1 flex items-center justify-center'>\n            <div className='text-center'>\n              <p className='text-gray-400'>Connecting to real-time chat...</p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Scroll to Bottom Button */}\n      {showScrollButton && (\n        <div className='absolute bottom-24 right-4 z-10'>\n          <GlassButton\n            type='button'\n            onClick={() => scrollToBottom('smooth')}\n            size='icon'\n            className='size-10 hover:scale-102'\n            aria-label='Scroll to bottom'\n          >\n            <ChevronDown className='h-5 w-5' />\n          </GlassButton>\n        </div>\n      )}\n\n      {/* Input */}\n      <ChatInput\n        ref={chatInputRef}\n        onSend={sendMessage}\n        isLoading={isLoading}\n        placeholder='Message'\n        canStop={false}\n        replyingTo={replyingTo}\n        onCancelReply={handleCancelReply}\n        workspaceId={workspaceId}\n        workspaceMembers={members}\n        workspaceNotes={workspaceNotes}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}