{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/code/cogni/cogni-frontend/apps/web/src/lib/supabase/middleware.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from 'next/server';\nimport { createServerClient } from '@supabase/ssr';\n\nexport async function updateSession(request: NextRequest) {\n  const response = NextResponse.next({ request: { headers: request.headers } });\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll: () =>\n          request.cookies.getAll().map(c => ({ name: c.name, value: c.value })),\n        setAll: cookiesToSet => {\n          cookiesToSet.forEach(({ name, value, options }) => {\n            response.cookies.set({ name, value, ...options });\n          });\n        },\n      },\n    }\n  );\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  // Set/update current user ID cookie if user is authenticated\n  if (user?.id) {\n    const existingUserId = request.cookies.get('current_user_id')?.value;\n    // Set cookie if not present or if user ID has changed\n    if (!existingUserId || existingUserId !== user.id) {\n      response.cookies.set({\n        name: 'current_user_id',\n        value: user.id,\n        path: '/',\n        maxAge: 60 * 60 * 24 * 365, // 1 year\n        sameSite: 'lax',\n      });\n    }\n  }\n\n  return { response, user };\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,cAAc,OAAoB;IACtD,MAAM,WAAW,obAAY,CAAC,IAAI,CAAC;QAAE,SAAS;YAAE,SAAS,QAAQ,OAAO;QAAC;IAAE;IAE3E,MAAM,WAAW,IAAA,0VAAkB,sUAGjC;QACE,SAAS;YACP,QAAQ,IACN,QAAQ,OAAO,CAAC,MAAM,GAAG,GAAG,CAAC,CAAA,IAAK,CAAC;wBAAE,MAAM,EAAE,IAAI;wBAAE,OAAO,EAAE,KAAK;oBAAC,CAAC;YACrE,QAAQ,CAAA;gBACN,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;oBAC5C,SAAS,OAAO,CAAC,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBACjD;YACF;QACF;IACF;IAGF,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,6DAA6D;IAC7D,IAAI,MAAM,IAAI;QACZ,MAAM,iBAAiB,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB;QAC/D,sDAAsD;QACtD,IAAI,CAAC,kBAAkB,mBAAmB,KAAK,EAAE,EAAE;YACjD,SAAS,OAAO,CAAC,GAAG,CAAC;gBACnB,MAAM;gBACN,OAAO,KAAK,EAAE;gBACd,MAAM;gBACN,QAAQ,KAAK,KAAK,KAAK;gBACvB,UAAU;YACZ;QACF;IACF;IAEA,OAAO;QAAE;QAAU;IAAK;AAC1B"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/code/cogni/cogni-frontend/apps/web/src/middleware.ts"],"sourcesContent":["// src/middleware.ts\nimport { type NextRequest, NextResponse } from 'next/server';\nimport { updateSession } from '@/lib/supabase/middleware';\n\nexport async function middleware(request: NextRequest) {\n  const { response, user } = await updateSession(request);\n\n  // Define route types\n  const privateRoutes = ['/home', '/notes', '/workspace'];\n  const publicRoutes = ['/invite']; // Allow invite routes for both auth states\n  const authRoutes = ['/login', '/register'];\n\n  const isPrivateRoute = privateRoutes.some(route =>\n    request.nextUrl.pathname.startsWith(route)\n  );\n\n  const isPublicRoute = publicRoutes.some(route =>\n    request.nextUrl.pathname.startsWith(route)\n  );\n\n  const isAuthRoute = authRoutes.some(route =>\n    request.nextUrl.pathname.startsWith(route)\n  );\n\n  // Allow public routes without authentication check\n  if (isPublicRoute) {\n    return response;\n  }\n\n  // Redirect to login if accessing private route without authentication\n  if (!user && isPrivateRoute) {\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n\n  // Redirect to home if authenticated user tries to access auth pages\n  // But check for pending invite first\n  if (user && isAuthRoute) {\n    const inviteToken = request.cookies.get('pending_invite_token')?.value;\n    if (inviteToken) {\n      return NextResponse.redirect(\n        new URL(`/invite/${inviteToken}`, request.url)\n      );\n    }\n    return NextResponse.redirect(new URL('/home', request.url));\n  }\n\n  return response;\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public files (images, etc)\n     */\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n};\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;;;AACpB;AAAA;AACA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,kNAAa,EAAC;IAE/C,qBAAqB;IACrB,MAAM,gBAAgB;QAAC;QAAS;QAAU;KAAa;IACvD,MAAM,eAAe;QAAC;KAAU,EAAE,2CAA2C;IAC7E,MAAM,aAAa;QAAC;QAAU;KAAY;IAE1C,MAAM,iBAAiB,cAAc,IAAI,CAAC,CAAA,QACxC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAGtC,MAAM,gBAAgB,aAAa,IAAI,CAAC,CAAA,QACtC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAGtC,MAAM,cAAc,WAAW,IAAI,CAAC,CAAA,QAClC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAGtC,mDAAmD;IACnD,IAAI,eAAe;QACjB,OAAO;IACT;IAEA,sEAAsE;IACtE,IAAI,CAAC,QAAQ,gBAAgB;QAC3B,OAAO,obAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,oEAAoE;IACpE,qCAAqC;IACrC,IAAI,QAAQ,aAAa;QACvB,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC,yBAAyB;QACjE,IAAI,aAAa;YACf,OAAO,obAAY,CAAC,QAAQ,CAC1B,IAAI,IAAI,CAAC,QAAQ,EAAE,aAAa,EAAE,QAAQ,GAAG;QAEjD;QACA,OAAO,obAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,SAAS,QAAQ,GAAG;IAC3D;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}