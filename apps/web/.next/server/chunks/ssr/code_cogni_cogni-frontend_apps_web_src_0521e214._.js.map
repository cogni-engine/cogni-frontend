{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/api/workspaceFilesApi.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/browserClient';\n\nconst supabase = createClient();\nconst WORKSPACE_FILES_BUCKET = 'workspace-files';\n\nexport interface WorkspaceFile {\n  id: number; // bigint (database primary key)\n  original_filename: string;\n  file_path: string;\n  file_size: number;\n  mime_type: string;\n  created_at: string;\n}\n\nexport interface UploadedFile {\n  id: number; // workspace_file_id (bigint, database primary key)\n  file_path: string;\n  url: string;\n  original_filename: string;\n  file_size: number;\n  mime_type: string;\n}\n\n/**\n * Upload a file to workspace storage\n */\nexport async function uploadWorkspaceFile(\n  workspaceId: number,\n  file: File\n): Promise<UploadedFile> {\n  // Generate a UUID for the storage path (not the database ID)\n  const storageUuid = crypto.randomUUID();\n  const sanitizedFilename = file.name.replace(/[^a-zA-Z0-9._-]/g, '_');\n\n  // Storage path: workspace-files/{workspace_id}/uploads/{uuid}/{original_filename}\n  const filePath = `${workspaceId}/uploads/${storageUuid}/${sanitizedFilename}`;\n\n  // Upload to Supabase Storage\n  const { error: uploadError } = await supabase.storage\n    .from(WORKSPACE_FILES_BUCKET)\n    .upload(filePath, file, {\n      cacheControl: '3600',\n      upsert: false,\n    });\n\n  if (uploadError) throw uploadError;\n\n  // Insert file metadata into workspace_files table (database ID is auto-generated bigint)\n  const { data: fileData, error: dbError } = await supabase\n    .from('workspace_files')\n    .insert({\n      orginal_file_name: file.name, // Note: schema has typo \"orginal\" instead of \"original\"\n      file_path: filePath,\n      mime_type: file.type,\n      file_size: file.size,\n      workspace_id: workspaceId,\n    })\n    .select()\n    .single();\n\n  if (dbError) throw dbError;\n\n  // Generate signed URL for private bucket (valid for 1 hour)\n  const { data: signedUrlData, error: signedUrlError } = await supabase.storage\n    .from(WORKSPACE_FILES_BUCKET)\n    .createSignedUrl(filePath, 3600); // 1 hour expiration\n\n  if (signedUrlError) {\n    console.warn('Error creating signed URL:', signedUrlError);\n  }\n\n  // Return file info with workspace_file_id\n  return {\n    id: fileData.id,\n    file_path: filePath,\n    url: signedUrlData?.signedUrl || '', // Signed URL for private bucket\n    original_filename: file.name,\n    file_size: file.size,\n    mime_type: file.type,\n  };\n}\n\n/**\n * Get signed file URL from workspace_file_id (bigint)\n * For private buckets, returns a signed URL valid for the specified duration\n */\nexport async function getFileUrl(\n  workspaceFileId: number,\n  expiresIn: number = 3600\n): Promise<string | null> {\n  const { data, error } = await supabase\n    .from('workspace_files')\n    .select('file_path')\n    .eq('id', workspaceFileId)\n    .single();\n\n  if (error || !data) {\n    console.warn('File not found in database:', error);\n    return null;\n  }\n\n  // Create signed URL for private bucket\n  const { data: signedUrlData, error: signedUrlError } = await supabase.storage\n    .from(WORKSPACE_FILES_BUCKET)\n    .createSignedUrl(data.file_path, expiresIn);\n\n  if (signedUrlError || !signedUrlData) {\n    console.warn('Error creating signed URL:', signedUrlError);\n    return null;\n  }\n\n  return signedUrlData.signedUrl;\n}\n\n/**\n * Link files to a message\n */\nexport async function linkFilesToMessage(\n  messageId: number,\n  workspaceFileIds: number[]\n): Promise<void> {\n  if (workspaceFileIds.length === 0) return;\n\n  const rows = workspaceFileIds.map(workspaceFileId => ({\n    message_id: messageId,\n    workspace_file_id: workspaceFileId,\n  }));\n\n  const { error } = await supabase.from('workspace_message_files').insert(rows);\n\n  if (error) throw error;\n}\n\n/**\n * Get all files for a workspace\n */\nexport async function getWorkspaceFiles(\n  workspaceId: number,\n  limit: number = 50\n): Promise<WorkspaceFile[]> {\n  const { data, error } = await supabase\n    .from('workspace_files')\n    .select(\n      'id, orginal_file_name, file_path, file_size, mime_type, created_at'\n    )\n    .eq('workspace_id', workspaceId)\n    .order('created_at', { ascending: false })\n    .limit(limit);\n\n  if (error) throw error;\n\n  // Map the typo field name to correct one\n  return (data || []).map(file => ({\n    id: file.id,\n    original_filename: file.orginal_file_name,\n    file_path: file.file_path,\n    file_size: file.file_size,\n    mime_type: file.mime_type,\n    created_at: file.created_at,\n  }));\n}\n\n/**\n * Delete a workspace file\n */\nexport async function deleteWorkspaceFile(\n  workspaceFileId: number\n): Promise<void> {\n  // First, get the file path from the database\n  const { data: fileData, error: fetchError } = await supabase\n    .from('workspace_files')\n    .select('file_path')\n    .eq('id', workspaceFileId)\n    .single();\n\n  if (fetchError) {\n    console.warn('Error fetching file for deletion:', fetchError);\n  }\n\n  // Delete from storage if we have the path\n  if (fileData?.file_path) {\n    const { error: storageError } = await supabase.storage\n      .from(WORKSPACE_FILES_BUCKET)\n      .remove([fileData.file_path]);\n\n    if (storageError) {\n      console.warn('Error deleting file from storage:', storageError);\n    }\n  }\n\n  // Delete from workspace_files table (CASCADE will handle workspace_message_files)\n  const { error: dbError } = await supabase\n    .from('workspace_files')\n    .delete()\n    .eq('id', workspaceFileId);\n\n  if (dbError) {\n    console.warn('Error deleting file from database:', dbError);\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/api/mentionsApi.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/browserClient';\n\nconst supabase = createClient();\n\nexport interface Mention {\n  id: number;\n  workspace_id: number;\n  created_at: string;\n  source_type: 'note' | 'message';\n  source_id: number;\n  target_type: 'workspace_member' | 'note';\n  target_id: number;\n  created_by: number;\n}\n\n/**\n * Create a mention record\n */\nexport async function createMention(\n  workspaceId: number,\n  sourceType: 'note' | 'message',\n  sourceId: number,\n  targetType: 'workspace_member' | 'note',\n  targetId: number,\n  createdBy: number\n): Promise<Mention> {\n  const { data, error } = await supabase\n    .from('mentions')\n    .insert({\n      workspace_id: workspaceId,\n      source_type: sourceType,\n      source_id: sourceId,\n      target_type: targetType,\n      target_id: targetId,\n      created_by: createdBy,\n    })\n    .select()\n    .single();\n\n  if (error) throw error;\n  return data;\n}\n\n/**\n * Get all mentions for a specific note or message\n */\nexport async function getMentionsForSource(\n  sourceType: 'note' | 'message',\n  sourceId: number\n): Promise<Mention[]> {\n  const { data, error } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', sourceType)\n    .eq('source_id', sourceId);\n\n  if (error) throw error;\n  return data || [];\n}\n\n/**\n * Sync member mentions for a note - compares existing with new and updates accordingly\n */\nexport async function syncNoteMemberMentions(\n  noteId: number,\n  workspaceId: number,\n  mentionedMemberIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing member mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'note')\n    .eq('source_id', noteId)\n    .eq('target_type', 'workspace_member');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedMemberIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedMemberIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'note' as const,\n      source_id: noteId,\n      target_type: 'workspace_member' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Sync note mentions for a note - compares existing with new and updates accordingly\n */\nexport async function syncNoteToNoteMentions(\n  noteId: number,\n  workspaceId: number,\n  mentionedNoteIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing note mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'note')\n    .eq('source_id', noteId)\n    .eq('target_type', 'note');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedNoteIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedNoteIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'note' as const,\n      source_id: noteId,\n      target_type: 'note' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Delete all mentions for a note\n */\nexport async function deleteNoteMentions(noteId: number): Promise<void> {\n  const { error } = await supabase\n    .from('mentions')\n    .delete()\n    .eq('source_type', 'note')\n    .eq('source_id', noteId);\n\n  if (error) throw error;\n}\n\n/**\n * Sync member mentions for a workspace message - compares existing with new and updates accordingly\n */\nexport async function syncWorkspaceMessageMentions(\n  messageId: number,\n  workspaceId: number,\n  mentionedMemberIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing member mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'message')\n    .eq('source_id', messageId)\n    .eq('target_type', 'workspace_member');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedMemberIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedMemberIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'message' as const,\n      source_id: messageId,\n      target_type: 'workspace_member' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Sync file mentions for a workspace message - compares existing with new and updates accordingly\n */\nexport async function syncWorkspaceMessageFileMentions(\n  messageId: number,\n  workspaceId: number,\n  mentionedFileIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing file mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'message')\n    .eq('source_id', messageId)\n    .eq('target_type', 'workspace_file');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedFileIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedFileIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'message' as const,\n      source_id: messageId,\n      target_type: 'workspace_file' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Sync note mentions for a workspace message - compares existing with new and updates accordingly\n */\nexport async function syncWorkspaceMessageNoteMentions(\n  messageId: number,\n  workspaceId: number,\n  mentionedNoteIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing note mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'message')\n    .eq('source_id', messageId)\n    .eq('target_type', 'note');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedNoteIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedNoteIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'message' as const,\n      source_id: messageId,\n      target_type: 'note' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Get all notes/messages where a user is mentioned\n */\nexport async function getUserMentions(\n  workspaceMemberId: number\n): Promise<Mention[]> {\n  const { data, error } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('target_type', 'workspace_member')\n    .eq('target_id', workspaceMemberId)\n    .order('created_at', { ascending: false });\n\n  if (error) throw error;\n  return data || [];\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 309, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/api/workspaceMessagesApi.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/browserClient';\nimport {\n  normalizeWorkspaceProfile,\n  type SupabaseProfile,\n} from '@/lib/api/profileUtils';\nimport type { WorkspaceMessage } from '@/types/workspace';\nimport { linkFilesToMessage } from './workspaceFilesApi';\nimport {\n  syncWorkspaceMessageMentions,\n  syncWorkspaceMessageNoteMentions,\n} from './mentionsApi';\n\nconst supabase = createClient();\n\ntype RawWorkspaceMember = Omit<\n  NonNullable<WorkspaceMessage['workspace_member']>,\n  'user_profile'\n> & {\n  user_profile?: SupabaseProfile;\n};\n\ntype RawWorkspaceMessageRead = {\n  workspace_message_id: number;\n  workspace_member_id: number;\n  read_at?: string;\n  created_at?: string;\n  workspace_member?: RawWorkspaceMember | null;\n};\n\ntype RawWorkspaceMessageFile = {\n  id: number;\n  workspace_file_id: number; // bigint (foreign key to workspace_files.id)\n  workspace_file?: {\n    id: number; // bigint (database primary key)\n    orginal_file_name: string;\n    file_path: string; // Contains UUID in path: {workspace_id}/uploads/{uuid}/{filename}\n    mime_type: string;\n    file_size: number;\n  } | null;\n};\n\ntype RawWorkspaceMessage = WorkspaceMessage & {\n  workspace_member?: RawWorkspaceMember | null;\n  workspace_message_reads?: RawWorkspaceMessageRead[] | null;\n  replied_message?: RawWorkspaceMessage | null;\n  workspace_message_files?: RawWorkspaceMessageFile[] | null;\n};\n\nfunction transformMessageRow(\n  row: RawWorkspaceMessage | null\n): WorkspaceMessage {\n  if (!row) {\n    return row as unknown as WorkspaceMessage;\n  }\n\n  const {\n    workspace_member,\n    workspace_message_reads,\n    replied_message,\n    workspace_message_files,\n    ...rest\n  } = row;\n\n  const workspaceMember = workspace_member\n    ? {\n        ...workspace_member,\n        user_profile:\n          normalizeWorkspaceProfile(workspace_member.user_profile) ?? null,\n      }\n    : undefined;\n\n  const reads = (workspace_message_reads ?? []).map(read => ({\n    workspace_message_id: read.workspace_message_id,\n    workspace_member_id: read.workspace_member_id,\n    read_at: read.read_at ?? read.created_at ?? new Date().toISOString(),\n    workspace_member: read.workspace_member\n      ? {\n          ...read.workspace_member,\n          user_profile:\n            normalizeWorkspaceProfile(read.workspace_member.user_profile) ??\n            null,\n        }\n      : undefined,\n  }));\n\n  // Transform replied message if it exists\n  const transformedRepliedMessage = replied_message\n    ? transformMessageRow(replied_message)\n    : null;\n\n  // Transform files - join through workspace_files table\n  const files = (workspace_message_files ?? [])\n    .filter(fileLink => fileLink.workspace_file)\n    .map(fileLink => ({\n      id: fileLink.workspace_file!.id,\n      original_filename: fileLink.workspace_file!.orginal_file_name, // Note: schema typo\n      file_path: fileLink.workspace_file!.file_path,\n      mime_type: fileLink.workspace_file!.mime_type,\n      file_size: fileLink.workspace_file!.file_size,\n    }));\n\n  return {\n    ...rest,\n    workspace_member: workspaceMember,\n    replied_message: transformedRepliedMessage,\n    reads,\n    read_count: reads.length,\n    files: files.length > 0 ? files : undefined,\n  };\n}\n\nexport async function getWorkspaceMessages(\n  workspaceId: number,\n  limit: number = 50,\n  beforeTimestamp?: string\n): Promise<WorkspaceMessage[]> {\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    throw new Error('User not authenticated');\n  }\n\n  let query = supabase\n    .from('workspace_messages')\n    .select(\n      `\n      *,\n      workspace_member:workspace_member_id(\n        id,\n        user_id,\n        user_profile:user_id(id, name, avatar_url)\n      ),\n      workspace_message_reads(\n        workspace_message_id,\n        workspace_member_id,\n        created_at,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      ),\n      replied_message:reply_to_id(\n        id,\n        text,\n        created_at,\n        workspace_member_id,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      ),\n      workspace_message_files(\n        id,\n        workspace_file_id,\n        workspace_file:workspace_file_id(\n          id,\n          orginal_file_name,\n          file_path,\n          mime_type,\n          file_size\n        )\n      )\n    `\n    )\n    .eq('workspace_id', workspaceId);\n\n  // If beforeTimestamp is provided, get messages older than that timestamp\n  if (beforeTimestamp) {\n    query = query.lt('created_at', beforeTimestamp);\n  }\n\n  const { data, error } = await query\n    .order('created_at', { ascending: false })\n    .limit(limit);\n\n  if (error) throw error;\n\n  // Transform nested structure\n  return (data || []).map(transformMessageRow);\n}\n\nexport async function sendWorkspaceMessage(\n  workspaceId: number,\n  workspaceMemberId: number,\n  text: string,\n  replyToId?: number | null,\n  workspaceFileIds?: number[],\n  mentionedMemberIds?: number[],\n  mentionedNoteIds?: number[]\n): Promise<WorkspaceMessage> {\n  const { data, error } = await supabase\n    .from('workspace_messages')\n    .insert({\n      workspace_id: workspaceId,\n      workspace_member_id: workspaceMemberId,\n      text,\n      reply_to_id: replyToId ?? null,\n    })\n    .select(\n      `\n      *,\n      workspace_member:workspace_member_id(\n        id,\n        user_id,\n        user_profile:user_id(id, name, avatar_url)\n      ),\n      workspace_message_reads(\n        workspace_message_id,\n        workspace_member_id,\n        created_at,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      ),\n      replied_message:reply_to_id(\n        id,\n        text,\n        created_at,\n        workspace_member_id,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      )\n    `\n    )\n    .single();\n\n  if (error) throw error;\n\n  // Link files to message if any\n  if (workspaceFileIds && workspaceFileIds.length > 0) {\n    try {\n      await linkFilesToMessage(data.id, workspaceFileIds);\n    } catch (fileError) {\n      console.error('Error linking files to message:', fileError);\n      // Don't throw - message was created successfully, just file linking failed\n    }\n  }\n\n  // Sync member mentions if any\n  if (mentionedMemberIds && mentionedMemberIds.length > 0) {\n    try {\n      await syncWorkspaceMessageMentions(\n        data.id,\n        workspaceId,\n        mentionedMemberIds,\n        workspaceMemberId\n      );\n    } catch (mentionError) {\n      console.error('Error syncing member mentions:', mentionError);\n      // Don't throw - message was created successfully, just mention syncing failed\n    }\n  }\n\n  // Sync note mentions if any\n  if (mentionedNoteIds && mentionedNoteIds.length > 0) {\n    try {\n      await syncWorkspaceMessageNoteMentions(\n        data.id,\n        workspaceId,\n        mentionedNoteIds,\n        workspaceMemberId\n      );\n    } catch (mentionError) {\n      console.error('Error syncing note mentions:', mentionError);\n      // Don't throw - message was created successfully, just mention syncing failed\n    }\n  }\n\n  // Transform nested structure\n  return transformMessageRow(data);\n}\n\nexport async function updateWorkspaceMessage(\n  messageId: number,\n  text: string\n): Promise<WorkspaceMessage> {\n  const { data, error } = await supabase\n    .from('workspace_messages')\n    .update({ text })\n    .eq('id', messageId)\n    .select(\n      `\n      *,\n      workspace_member:workspace_member_id(\n        id,\n        user_id,\n        user_profile:user_id(id, name, avatar_url)\n      ),\n      workspace_message_reads(\n        workspace_message_id,\n        workspace_member_id,\n        created_at,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      ),\n      replied_message:reply_to_id(\n        id,\n        text,\n        created_at,\n        workspace_member_id,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profile:user_id(id, name, avatar_url)\n        )\n      )\n    `\n    )\n    .single();\n\n  if (error) throw error;\n\n  return transformMessageRow(data);\n}\n\nexport async function deleteWorkspaceMessage(messageId: number): Promise<void> {\n  const { error } = await supabase\n    .from('workspace_messages')\n    .delete()\n    .eq('id', messageId);\n\n  if (error) throw error;\n}\n\nexport type CurrentWorkspaceMember = {\n  id: number;\n  last_read_message_id: number | null;\n};\n\nexport async function getCurrentWorkspaceMember(\n  workspaceId: number\n): Promise<CurrentWorkspaceMember | null> {\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    throw new Error('User not authenticated');\n  }\n\n  const { data, error } = await supabase\n    .from('workspace_member')\n    .select('id, last_read_message_id')\n    .eq('workspace_id', workspaceId)\n    .eq('user_id', user.id)\n    .maybeSingle();\n\n  if (error) throw error;\n\n  if (!data) {\n    return null;\n  }\n\n  return {\n    id: data.id,\n    last_read_message_id: data.last_read_message_id ?? null,\n  };\n}\n\nexport async function markWorkspaceMessagesAsRead(\n  workspaceId: number,\n  workspaceMemberId: number,\n  messageIds: number[],\n  currentLastRead?: number | null\n): Promise<number | null> {\n  if (messageIds.length === 0) {\n    return currentLastRead ?? null;\n  }\n\n  const uniqueIds = Array.from(new Set(messageIds));\n  const rows = uniqueIds.map(messageId => ({\n    workspace_message_id: messageId,\n    workspace_member_id: workspaceMemberId,\n  }));\n\n  const { error: upsertError } = await supabase\n    .from('workspace_message_reads')\n    .upsert(rows, {\n      onConflict: 'workspace_message_id,workspace_member_id',\n    });\n\n  if (upsertError) throw upsertError;\n\n  const newLastRead = Math.max(...uniqueIds);\n  const lastReadToCompare = currentLastRead ?? null;\n\n  if (lastReadToCompare !== null && newLastRead <= lastReadToCompare) {\n    return lastReadToCompare;\n  }\n\n  const { error: updateError } = await supabase\n    .from('workspace_member')\n    .update({ last_read_message_id: newLastRead })\n    .eq('id', workspaceMemberId)\n    .eq('workspace_id', workspaceId);\n\n  if (updateError) throw updateError;\n\n  return newLastRead;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 573, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/hooks/useWorkspaceChat.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport useSWR from 'swr';\nimport { createClient } from '@/lib/supabase/browserClient';\nimport type { WorkspaceMessage } from '@/types/workspace';\nimport {\n  getWorkspaceMessages,\n  sendWorkspaceMessage,\n  getCurrentWorkspaceMember,\n  markWorkspaceMessagesAsRead,\n  type CurrentWorkspaceMember,\n} from '@/lib/api/workspaceMessagesApi';\n\n// SWR keys\nconst messagesKey = (\n  workspaceId: number,\n  limit?: number,\n  beforeTimestamp?: string\n) => {\n  const params = new URLSearchParams();\n  if (limit) params.set('limit', limit.toString());\n  if (beforeTimestamp) params.set('before', beforeTimestamp);\n  const query = params.toString();\n  return `/workspaces/${workspaceId}/messages${query ? `?${query}` : ''}`;\n};\n\nconst workspaceMemberKey = (workspaceId: number) =>\n  `/workspaces/${workspaceId}/member`;\n\n// Raw message from DB without joins\ntype RawMessage = {\n  id: number;\n  workspace_id: number;\n  workspace_member_id: number;\n  text: string;\n  created_at: string;\n  updated_at: string;\n};\n\nexport function useWorkspaceChat(workspaceId: number) {\n  const supabase = createClient();\n  const channelRef = useRef<ReturnType<typeof supabase.channel> | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const retryCountRef = useRef(0);\n  const lastMarkedMessageIdRef = useRef<number | null>(null);\n  const markInFlightRef = useRef(false);\n  const workspaceMemberRef = useRef<CurrentWorkspaceMember | null>(null);\n  const oldestMessageTimestampRef = useRef<string | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [hasMoreMessages, setHasMoreMessages] = useState(true);\n  const [localMessages, setLocalMessages] = useState<WorkspaceMessage[]>([]);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const [sendError, setSendError] = useState<string | null>(null);\n\n  // Fetch workspace member using SWR\n  const {\n    data: workspaceMember,\n    error: memberError,\n    mutate: mutateMember,\n  } = useSWR<CurrentWorkspaceMember | null>(\n    workspaceMemberKey(workspaceId),\n    () => getCurrentWorkspaceMember(workspaceId),\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  // Fetch initial messages using SWR\n  const {\n    data: initialMessages,\n    error: messagesError,\n    isLoading,\n    mutate: mutateMessages,\n  } = useSWR<WorkspaceMessage[]>(\n    messagesKey(workspaceId, 50),\n    () => getWorkspaceMessages(workspaceId, 50),\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  // Update workspace member ref when it changes\n  useEffect(() => {\n    if (workspaceMember) {\n      workspaceMemberRef.current = workspaceMember;\n    }\n  }, [workspaceMember]);\n\n  // Decorate messages with read status\n  const decorateMessages = useCallback(\n    (\n      rawMessages: WorkspaceMessage[],\n      memberOverride?: CurrentWorkspaceMember | null\n    ) => {\n      const member = memberOverride ?? workspaceMemberRef.current;\n      const memberId = member?.id ?? null;\n      const lastReadId = member?.last_read_message_id ?? null;\n\n      return rawMessages.map(message => {\n        const existingReads = message.reads ? [...message.reads] : [];\n        const readCount = message.read_count ?? existingReads.length;\n        const hasExistingRead =\n          memberId !== null\n            ? existingReads.some(read => read.workspace_member_id === memberId)\n            : false;\n        const withinLastReadRange =\n          memberId !== null && lastReadId !== null && message.id <= lastReadId;\n\n        return {\n          ...message,\n          reads: existingReads,\n          read_count: readCount,\n          is_read_by_current_user: hasExistingRead || withinLastReadRange,\n        };\n      });\n    },\n    []\n  );\n\n  // Initialize local messages from SWR data\n  useEffect(() => {\n    if (initialMessages) {\n      const reversedMessages = [...initialMessages].reverse();\n      const decorated = decorateMessages(reversedMessages, workspaceMember);\n      setLocalMessages(decorated);\n\n      // Track pagination state\n      if (reversedMessages.length > 0) {\n        oldestMessageTimestampRef.current =\n          reversedMessages[0]?.created_at || null;\n      }\n      setHasMoreMessages(initialMessages.length === 50);\n    }\n  }, [initialMessages, workspaceMember, decorateMessages]);\n\n  // Re-decorate messages when workspace member changes\n  useEffect(() => {\n    if (workspaceMember) {\n      setLocalMessages(prev => decorateMessages(prev, workspaceMember));\n    }\n  }, [workspaceMember, decorateMessages]);\n\n  // Set up Realtime subscription with retry logic\n  useEffect(() => {\n    let mounted = true;\n\n    async function setupRealtime() {\n      // Clear existing reconnect timeout\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n        reconnectTimeoutRef.current = null;\n      }\n\n      // Remove existing channel\n      if (channelRef.current) {\n        supabase.removeChannel(channelRef.current);\n        channelRef.current = null;\n      }\n\n      try {\n        // Get current session to ensure we have auth\n        const {\n          data: { session },\n        } = await supabase.auth.getSession();\n\n        if (!session || !mounted) {\n          console.warn('No session available for Realtime');\n          setIsConnected(false);\n          return;\n        }\n\n        // Set auth for Realtime\n        await supabase.realtime.setAuth();\n\n        const channel = supabase.channel(`workspace:${workspaceId}:messages`, {\n          config: { private: true, broadcast: { self: true, ack: true } },\n        });\n\n        channel\n          .on('broadcast', { event: 'INSERT' }, () => {\n            if (!mounted) return;\n            // When broadcast is received, revalidate messages\n            mutateMessages();\n          })\n          .on('broadcast', { event: 'UPDATE' }, () => {\n            if (!mounted) return;\n            // Revalidate on update\n            mutateMessages();\n          })\n          .on('broadcast', { event: 'DELETE' }, ({ payload }) => {\n            if (!mounted) return;\n            const deleted = payload.old as RawMessage;\n            if (deleted && deleted.id) {\n              setLocalMessages(prev =>\n                prev.filter(msg => msg.id !== deleted.id)\n              );\n            }\n          })\n          .subscribe((status, err) => {\n            if (!mounted) return;\n\n            console.log('Realtime status:', status, err ? { err } : '');\n\n            if (status === 'SUBSCRIBED') {\n              setIsConnected(true);\n              retryCountRef.current = 0;\n            } else if (\n              status === 'CHANNEL_ERROR' ||\n              status === 'TIMED_OUT' ||\n              status === 'CLOSED'\n            ) {\n              setIsConnected(false);\n\n              // Retry connection with exponential backoff\n              const maxRetries = 5;\n              if (retryCountRef.current < maxRetries) {\n                retryCountRef.current += 1;\n                const delay = Math.min(\n                  1000 * Math.pow(2, retryCountRef.current),\n                  30000\n                );\n\n                reconnectTimeoutRef.current = setTimeout(() => {\n                  if (mounted) {\n                    console.log(\n                      `Retrying Realtime connection (attempt ${retryCountRef.current})...`\n                    );\n                    setupRealtime();\n                  }\n                }, delay);\n              } else {\n                console.error('Max retries reached for Realtime connection.');\n              }\n            }\n          });\n\n        channelRef.current = channel;\n      } catch (err) {\n        if (!mounted) return;\n        console.error('Error setting up Realtime:', err);\n        setIsConnected(false);\n\n        // Retry after delay\n        if (retryCountRef.current < 5) {\n          retryCountRef.current += 1;\n          const delay = Math.min(\n            1000 * Math.pow(2, retryCountRef.current),\n            30000\n          );\n          reconnectTimeoutRef.current = setTimeout(() => {\n            if (mounted) {\n              setupRealtime();\n            }\n          }, delay);\n        }\n      }\n    }\n\n    // Wait a bit for auth to be ready\n    const initTimeout = setTimeout(() => {\n      setupRealtime();\n    }, 500);\n\n    return () => {\n      mounted = false;\n      clearTimeout(initTimeout);\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (channelRef.current) {\n        supabase.removeChannel(channelRef.current);\n      }\n    };\n  }, [workspaceId, supabase, mutateMessages]);\n\n  const sendMessage = useCallback(\n    async (\n      text: string,\n      replyToId?: number | null,\n      workspaceFileIds?: number[],\n      mentionedMemberIds?: number[],\n      mentionedNoteIds?: number[]\n    ) => {\n      if (!workspaceMember?.id) return;\n      // Allow sending if there's text or files\n      if (!text.trim() && (!workspaceFileIds || workspaceFileIds.length === 0))\n        return;\n\n      setSendError(null);\n\n      try {\n        await sendWorkspaceMessage(\n          workspaceId,\n          workspaceMember.id,\n          text,\n          replyToId,\n          workspaceFileIds,\n          mentionedMemberIds,\n          mentionedNoteIds\n        );\n        // Revalidate messages to get the new one\n        mutateMessages();\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error ? err.message : 'Failed to send message';\n        setSendError(errorMessage);\n        console.error('Error sending message:', err);\n        throw err;\n      }\n    },\n    [workspaceId, workspaceMember, mutateMessages]\n  );\n\n  // Load more messages (for infinite scroll)\n  const loadMoreMessages = useCallback(async () => {\n    if (\n      !hasMoreMessages ||\n      isLoadingMore ||\n      !oldestMessageTimestampRef.current\n    ) {\n      return;\n    }\n\n    setIsLoadingMore(true);\n    setSendError(null);\n\n    try {\n      const olderMessages = await getWorkspaceMessages(\n        workspaceId,\n        50,\n        oldestMessageTimestampRef.current\n      );\n\n      if (olderMessages.length === 0) {\n        setHasMoreMessages(false);\n        setIsLoadingMore(false);\n        return;\n      }\n\n      // Reverse to show oldest first\n      const reversedOlderMessages = [...olderMessages].reverse();\n\n      setLocalMessages(prev => {\n        // Prepend older messages to the beginning\n        const allMessages = [...reversedOlderMessages, ...prev];\n        return decorateMessages(allMessages, workspaceMemberRef.current);\n      });\n\n      // Update oldest message timestamp\n      if (reversedOlderMessages.length > 0) {\n        oldestMessageTimestampRef.current =\n          reversedOlderMessages[0]?.created_at || null;\n      }\n\n      // Check if there are more messages to load\n      setHasMoreMessages(olderMessages.length === 50);\n    } catch (err) {\n      const errorMessage =\n        err instanceof Error ? err.message : 'Failed to load older messages';\n      setSendError(errorMessage);\n      console.error('Error loading older messages:', err);\n    } finally {\n      setIsLoadingMore(false);\n    }\n  }, [workspaceId, hasMoreMessages, isLoadingMore, decorateMessages]);\n\n  // Mark messages as read when they appear\n  useEffect(() => {\n    if (!workspaceMember?.id) return;\n    if (localMessages.length === 0) return;\n    if (markInFlightRef.current) return;\n\n    const lastRead =\n      workspaceMember.last_read_message_id ??\n      lastMarkedMessageIdRef.current ??\n      0;\n\n    const unreadMessages = localMessages.filter(message => {\n      if (message.workspace_member_id === workspaceMember.id) {\n        return false;\n      }\n\n      return !message.is_read_by_current_user && message.id > lastRead;\n    });\n\n    if (unreadMessages.length === 0) return;\n\n    const messageIds = Array.from(\n      new Set(unreadMessages.map(message => message.id))\n    );\n\n    markInFlightRef.current = true;\n    let cancelled = false;\n\n    (async () => {\n      try {\n        const updatedLastRead = await markWorkspaceMessagesAsRead(\n          workspaceId,\n          workspaceMember.id,\n          messageIds,\n          workspaceMember.last_read_message_id ?? lastMarkedMessageIdRef.current\n        );\n\n        if (cancelled) return;\n\n        const newLastReadValue =\n          updatedLastRead ?? workspaceMember.last_read_message_id ?? null;\n\n        lastMarkedMessageIdRef.current =\n          newLastReadValue ?? lastMarkedMessageIdRef.current;\n\n        // Update workspace member in SWR cache\n        mutateMember((current): CurrentWorkspaceMember | null => {\n          if (!current) return current ?? null;\n          return {\n            ...current,\n            last_read_message_id:\n              newLastReadValue ?? current.last_read_message_id ?? null,\n          };\n        }, false);\n\n        // Update local messages state\n        const messageIdSet = new Set(messageIds);\n\n        setLocalMessages(prev =>\n          prev.map(message => {\n            if (!messageIdSet.has(message.id)) {\n              return message;\n            }\n\n            const existingReads = message.reads ?? [];\n            const hasExistingRead = existingReads.some(\n              read => read.workspace_member_id === workspaceMember.id\n            );\n            const baseReadCount = message.read_count ?? existingReads.length;\n\n            const updatedReads = hasExistingRead\n              ? existingReads\n              : [\n                  ...existingReads,\n                  {\n                    workspace_message_id: message.id,\n                    workspace_member_id: workspaceMember.id,\n                    read_at: new Date().toISOString(),\n                    created_at: new Date().toISOString(),\n                    workspace_member: undefined,\n                  },\n                ];\n\n            return {\n              ...message,\n              reads: updatedReads,\n              read_count: hasExistingRead ? baseReadCount : baseReadCount + 1,\n              is_read_by_current_user: true,\n            };\n          })\n        );\n      } catch (err) {\n        console.error('Error marking messages as read:', err);\n      } finally {\n        if (!cancelled) {\n          markInFlightRef.current = false;\n        }\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n      markInFlightRef.current = false;\n    };\n  }, [localMessages, workspaceId, workspaceMember, mutateMember]);\n\n  // Combine errors\n  const error =\n    memberError || messagesError\n      ? memberError?.message ||\n        messagesError?.message ||\n        'Failed to load chat data'\n      : sendError;\n\n  return {\n    messages: localMessages,\n    sendMessage,\n    isLoading,\n    isLoadingMore,\n    error,\n    isConnected,\n    workspaceMember,\n    loadMoreMessages,\n    hasMoreMessages,\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 947, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/VoiceInputButton.tsx"],"sourcesContent":["'use client';\n\nimport { Mic } from 'lucide-react';\nimport {\n  useState,\n  useRef,\n  useEffect,\n  forwardRef,\n  useImperativeHandle,\n} from 'react';\n\n// API\ninterface SpeechRecognitionResult {\n  isFinal: boolean;\n  [index: number]: {\n    transcript: string;\n  };\n}\n\ninterface SpeechRecognitionResultList {\n  length: number;\n  item(index: number): SpeechRecognitionResult;\n  [index: number]: SpeechRecognitionResult;\n}\n\ninterface SpeechRecognitionEvent extends Event {\n  resultIndex: number;\n  results: SpeechRecognitionResultList;\n}\n\ninterface SpeechRecognition extends EventTarget {\n  continuous: boolean;\n  interimResults: boolean;\n  lang: string;\n  start(): void;\n  stop(): void;\n  onresult: (event: SpeechRecognitionEvent) => void;\n  onerror: (event: { error: string; message?: string }) => void;\n  onend: () => void;\n}\n\ndeclare global {\n  interface Window {\n    SpeechRecognition: {\n      new (): SpeechRecognition;\n    };\n    webkitSpeechRecognition: {\n      new (): SpeechRecognition;\n    };\n  }\n}\n\ninterface VoiceInputButtonProps {\n  onTranscriptChange: (text: string) => void;\n  currentText?: string;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport interface VoiceInputButtonRef {\n  restartRecording: () => void;\n}\n\nexport const VoiceInputButton = forwardRef<\n  VoiceInputButtonRef,\n  VoiceInputButtonProps\n>(\n  (\n    { onTranscriptChange, currentText = '', disabled = false, className = '' },\n    ref\n  ) => {\n    const [isRecording, setIsRecording] = useState(false);\n    const recognitionRef = useRef<SpeechRecognition | null>(null);\n    const finalTranscriptRef = useRef<string>('');\n    const lastInterimTranscriptRef = useRef<string>('');\n    const processedResultIndexRef = useRef<number>(0);\n\n    // finalTranscriptRef\n    useEffect(() => {\n      if (!isRecording) {\n        finalTranscriptRef.current = currentText;\n      }\n    }, [currentText, isRecording]);\n\n    // \n    useEffect(() => {\n      return () => {\n        if (recognitionRef.current) {\n          recognitionRef.current.stop();\n        }\n      };\n    }, []);\n\n    // Expose restartRecording method to parent\n    useImperativeHandle(ref, () => ({\n      restartRecording: () => {\n        if (isRecording) {\n          // Stop current recording\n          if (recognitionRef.current) {\n            recognitionRef.current.stop();\n            recognitionRef.current = null;\n          }\n          setIsRecording(false);\n          finalTranscriptRef.current = '';\n\n          onTranscriptChange('');\n          setTimeout(() => {\n            startRecording('');\n          }, 100);\n        }\n      },\n    }));\n\n    const startRecording = (overrideText?: string) => {\n      const SpeechRecognition =\n        window.SpeechRecognition || window.webkitSpeechRecognition;\n      if (!SpeechRecognition) {\n        console.error('API');\n        return;\n      }\n\n      // overrideText\n      finalTranscriptRef.current =\n        overrideText !== undefined ? overrideText : currentText;\n      // \n      lastInterimTranscriptRef.current = '';\n      // \n      processedResultIndexRef.current = 0;\n\n      const recognition = new SpeechRecognition();\n      recognitionRef.current = recognition;\n\n      recognition.lang = 'ja-JP';\n      recognition.continuous = true;\n      recognition.interimResults = true;\n\n      recognition.onresult = (event: SpeechRecognitionEvent) => {\n        // \n        let finalTranscript = finalTranscriptRef.current;\n\n        // \n        // event.results\n        const startIndex = processedResultIndexRef.current;\n        for (let i = startIndex; i < event.results.length; ++i) {\n          const result = event.results[i];\n          if (result.isFinal) {\n            const transcript = result[0].transcript;\n            finalTranscript += transcript;\n            finalTranscriptRef.current = finalTranscript;\n            // \n            processedResultIndexRef.current = i + 1;\n          }\n        }\n\n        // \n        // \n        let currentInterimTranscript = '';\n        const lastProcessedIndex = processedResultIndexRef.current;\n        for (let i = event.results.length - 1; i >= lastProcessedIndex; --i) {\n          const result = event.results[i];\n          if (!result.isFinal) {\n            currentInterimTranscript = result[0].transcript;\n            break; // \n          }\n        }\n\n        // \n        lastInterimTranscriptRef.current = currentInterimTranscript;\n\n        //  + \n        // \n        const fullText = finalTranscript + currentInterimTranscript;\n        onTranscriptChange(fullText);\n      };\n\n      recognition.onerror = event => {\n        console.error(':', event.error);\n        setIsRecording(false);\n      };\n\n      recognition.onend = () => {\n        console.log('');\n        // \n        if (isRecording && recognitionRef.current) {\n          try {\n            recognitionRef.current.start();\n            console.log('');\n          } catch (error) {\n            console.error(':', error);\n            setIsRecording(false);\n            recognitionRef.current = null;\n          }\n        }\n      };\n\n      try {\n        recognition.start();\n        setIsRecording(true);\n        console.log('');\n      } catch (error) {\n        console.error(':', error);\n      }\n    };\n\n    const handleVoiceInput = (event: React.MouseEvent<HTMLButtonElement>) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (!isRecording) {\n        startRecording();\n      } else {\n        // 0.5\n        setTimeout(() => {\n          if (recognitionRef.current) {\n            try {\n              recognitionRef.current.stop();\n              console.log('');\n            } catch (error) {\n              console.error(':', error);\n            }\n            recognitionRef.current = null;\n          }\n          setIsRecording(false);\n        }, 800);\n      }\n    };\n\n    const Icon = isRecording ? Mic : Mic;\n\n    return (\n      <button\n        onClick={handleVoiceInput}\n        disabled={disabled}\n        type='button'\n        title={isRecording ? '' : ''}\n        className={`${className} relative flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300`}\n      >\n        <Icon\n          className={`w-5 h-5 relative z-10 transition-colors duration-300 ${\n            isRecording ? 'text-white' : 'text-white/40'\n          }`}\n          style={isRecording ? { animationDuration: '1.5s' } : undefined}\n        />\n      </button>\n    );\n  }\n);\n\nVoiceInputButton.displayName = 'VoiceInputButton';\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1125, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/MentionExtension.ts"],"sourcesContent":["import { createInlineMarkdownSpec, mergeAttributes } from '@tiptap/core';\nimport Mention from '@tiptap/extension-mention';\n\nexport interface MentionNodeAttrs {\n  id: string;\n  label: string;\n  workspaceMemberId: number;\n}\n\nexport const CustomMention = Mention.extend({\n  name: 'mention',\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-id'),\n        renderHTML: (attributes: { id: string }) => {\n          if (!attributes.id) {\n            return {};\n          }\n          return {\n            'data-id': attributes.id,\n          };\n        },\n      },\n      label: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-label'),\n        renderHTML: (attributes: { label: string }) => {\n          if (!attributes.label) {\n            return {};\n          }\n          return {\n            'data-label': attributes.label,\n          };\n        },\n      },\n      workspaceMemberId: {\n        default: null,\n        parseHTML: (element: HTMLElement) => {\n          const id = element.getAttribute('data-workspace-member-id');\n          return id ? parseInt(id, 10) : null;\n        },\n        renderHTML: (attributes: { workspaceMemberId: number }) => {\n          if (!attributes.workspaceMemberId) {\n            return {};\n          }\n          return {\n            'data-workspace-member-id': attributes.workspaceMemberId,\n          };\n        },\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span[data-type=\"mention\"]',\n      },\n    ];\n  },\n\n  renderHTML({\n    node,\n    HTMLAttributes,\n  }: {\n    node: Node;\n    HTMLAttributes: { [key: string]: string };\n  }) {\n    return [\n      'span',\n      mergeAttributes(\n        { 'data-type': 'mention' },\n        this.options.HTMLAttributes,\n        HTMLAttributes\n      ),\n      `@${HTMLAttributes['data-label'] || ''}`,\n    ];\n  },\n\n  renderText({ node }: { node: any }) {\n    return `@${node.attrs.label}`;\n  },\n\n  // Markdown support using Tiptap utility\n  ...createInlineMarkdownSpec({\n    nodeName: 'mention',\n    name: '@',\n    selfClosing: true,\n    allowedAttributes: ['id', 'label', 'workspaceMemberId'],\n  }),\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () =>\n        this.editor.commands.command(({ tr, state }) => {\n          let isMention = false;\n          const { selection } = state;\n          const { empty, anchor } = selection;\n\n          if (!empty) {\n            return false;\n          }\n\n          state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n            if (node.type.name === this.name) {\n              isMention = true;\n              tr.insertText('', pos, pos + node.nodeSize);\n              return false;\n            }\n          });\n\n          return isMention;\n        }),\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,MAAM,gBAAgB,yaAAO,CAAC,MAAM,CAAC;IAC1C,MAAM;IAEN;QACE,OAAO;YACL,IAAI;gBACF,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,EAAE,EAAE;wBAClB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,WAAW,WAAW,EAAE;oBAC1B;gBACF;YACF;YACA,OAAO;gBACL,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,KAAK,EAAE;wBACrB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,cAAc,WAAW,KAAK;oBAChC;gBACF;YACF;YACA,mBAAmB;gBACjB,SAAS;gBACT,WAAW,CAAC;oBACV,MAAM,KAAK,QAAQ,YAAY,CAAC;oBAChC,OAAO,KAAK,SAAS,IAAI,MAAM;gBACjC;gBACA,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,iBAAiB,EAAE;wBACjC,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,4BAA4B,WAAW,iBAAiB;oBAC1D;gBACF;YACF;QACF;IACF;IAEA;QACE,OAAO;YACL;gBACE,KAAK;YACP;SACD;IACH;IAEA,YAAW,EACT,IAAI,EACJ,cAAc,EAIf;QACC,OAAO;YACL;YACA,IAAA,ySAAe,EACb;gBAAE,aAAa;YAAU,GACzB,IAAI,CAAC,OAAO,CAAC,cAAc,EAC3B;YAEF,CAAC,CAAC,EAAE,cAAc,CAAC,aAAa,IAAI,IAAI;SACzC;IACH;IAEA,YAAW,EAAE,IAAI,EAAiB;QAChC,OAAO,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,KAAK,EAAE;IAC/B;IAEA,wCAAwC;IACxC,GAAG,IAAA,kTAAwB,EAAC;QAC1B,UAAU;QACV,MAAM;QACN,aAAa;QACb,mBAAmB;YAAC;YAAM;YAAS;SAAoB;IACzD,EAAE;IAEF;QACE,OAAO;YACL,WAAW,IACT,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE;oBACzC,IAAI,YAAY;oBAChB,MAAM,EAAE,SAAS,EAAE,GAAG;oBACtB,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;oBAE1B,IAAI,CAAC,OAAO;wBACV,OAAO;oBACT;oBAEA,MAAM,GAAG,CAAC,YAAY,CAAC,SAAS,GAAG,QAAQ,CAAC,MAAM;wBAChD,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;4BAChC,YAAY;4BACZ,GAAG,UAAU,CAAC,IAAI,KAAK,MAAM,KAAK,QAAQ;4BAC1C,OAAO;wBACT;oBACF;oBAEA,OAAO;gBACT;QACJ;IACF;AACF","debugId":null}},
    {"offset": {"line": 1233, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/NoteMentionExtension.ts"],"sourcesContent":["import { createInlineMarkdownSpec, mergeAttributes } from '@tiptap/core';\nimport Mention from '@tiptap/extension-mention';\n\nexport interface NoteMentionNodeAttrs {\n  id: string;\n  label: string;\n  noteId: number;\n}\n\nexport const NoteMention = Mention.extend({\n  name: 'noteMention',\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-id'),\n        renderHTML: (attributes: { id: string }) => {\n          if (!attributes.id) {\n            return {};\n          }\n          return {\n            'data-id': attributes.id,\n          };\n        },\n      },\n      label: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-label'),\n        renderHTML: (attributes: { label: string }) => {\n          if (!attributes.label) {\n            return {};\n          }\n          return {\n            'data-label': attributes.label,\n          };\n        },\n      },\n      noteId: {\n        default: null,\n        parseHTML: (element: HTMLElement) => {\n          const id = element.getAttribute('data-note-id');\n          return id ? parseInt(id, 10) : null;\n        },\n        renderHTML: (attributes: { noteId: number }) => {\n          if (!attributes.noteId) {\n            return {};\n          }\n          return {\n            'data-note-id': attributes.noteId,\n          };\n        },\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span[data-type=\"noteMention\"]',\n      },\n    ];\n  },\n\n  renderHTML({\n    node,\n    HTMLAttributes,\n  }: {\n    node: Node;\n    HTMLAttributes: { [key: string]: string };\n  }) {\n    return [\n      'span',\n      mergeAttributes(\n        { 'data-type': 'noteMention' },\n        this.options.HTMLAttributes,\n        HTMLAttributes\n      ),\n      `#${HTMLAttributes['data-label'] || ''}`,\n    ];\n  },\n\n  renderText({ node }: { node: any }) {\n    return `#${node.attrs.label}`;\n  },\n\n  // Markdown support using Tiptap utility\n  ...createInlineMarkdownSpec({\n    nodeName: 'noteMention',\n    name: '#',\n    selfClosing: true,\n    allowedAttributes: ['id', 'label', 'noteId'],\n  }),\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () =>\n        this.editor.commands.command(({ tr, state }) => {\n          let isNoteMention = false;\n          const { selection } = state;\n          const { empty, anchor } = selection;\n\n          if (!empty) {\n            return false;\n          }\n\n          state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n            if (node.type.name === this.name) {\n              isNoteMention = true;\n              tr.insertText('', pos, pos + node.nodeSize);\n              return false;\n            }\n          });\n\n          return isNoteMention;\n        }),\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,MAAM,cAAc,yaAAO,CAAC,MAAM,CAAC;IACxC,MAAM;IAEN;QACE,OAAO;YACL,IAAI;gBACF,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,EAAE,EAAE;wBAClB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,WAAW,WAAW,EAAE;oBAC1B;gBACF;YACF;YACA,OAAO;gBACL,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,KAAK,EAAE;wBACrB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,cAAc,WAAW,KAAK;oBAChC;gBACF;YACF;YACA,QAAQ;gBACN,SAAS;gBACT,WAAW,CAAC;oBACV,MAAM,KAAK,QAAQ,YAAY,CAAC;oBAChC,OAAO,KAAK,SAAS,IAAI,MAAM;gBACjC;gBACA,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,MAAM,EAAE;wBACtB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,gBAAgB,WAAW,MAAM;oBACnC;gBACF;YACF;QACF;IACF;IAEA;QACE,OAAO;YACL;gBACE,KAAK;YACP;SACD;IACH;IAEA,YAAW,EACT,IAAI,EACJ,cAAc,EAIf;QACC,OAAO;YACL;YACA,IAAA,ySAAe,EACb;gBAAE,aAAa;YAAc,GAC7B,IAAI,CAAC,OAAO,CAAC,cAAc,EAC3B;YAEF,CAAC,CAAC,EAAE,cAAc,CAAC,aAAa,IAAI,IAAI;SACzC;IACH;IAEA,YAAW,EAAE,IAAI,EAAiB;QAChC,OAAO,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,KAAK,EAAE;IAC/B;IAEA,wCAAwC;IACxC,GAAG,IAAA,kTAAwB,EAAC;QAC1B,UAAU;QACV,MAAM;QACN,aAAa;QACb,mBAAmB;YAAC;YAAM;YAAS;SAAS;IAC9C,EAAE;IAEF;QACE,OAAO;YACL,WAAW,IACT,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE;oBACzC,IAAI,gBAAgB;oBACpB,MAAM,EAAE,SAAS,EAAE,GAAG;oBACtB,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;oBAE1B,IAAI,CAAC,OAAO;wBACV,OAAO;oBACT;oBAEA,MAAM,GAAG,CAAC,YAAY,CAAC,SAAS,GAAG,QAAQ,CAAC,MAAM;wBAChD,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;4BAChC,gBAAgB;4BAChB,GAAG,UAAU,CAAC,IAAI,KAAK,MAAM,KAAK,QAAQ;4BAC1C,OAAO;wBACT;oBACF;oBAEA,OAAO;gBACT;QACJ;IACF;AACF","debugId":null}},
    {"offset": {"line": 1341, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/MentionList.tsx"],"sourcesContent":["'use client';\n\nimport React, {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { WorkspaceMember } from '@/types/workspace';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { User } from 'lucide-react';\n\nexport interface MentionListProps {\n  items: WorkspaceMember[];\n  command: (item: {\n    id: string;\n    label: string;\n    workspaceMemberId: number;\n  }) => void;\n}\n\nexport interface MentionListRef {\n  onKeyDown: (props: { event: KeyboardEvent }) => boolean;\n}\n\nexport const MentionList = forwardRef<MentionListRef, MentionListProps>(\n  (props, ref) => {\n    const [selectedIndex, setSelectedIndex] = useState(0);\n\n    const selectItem = (index: number) => {\n      const item = props.items[index];\n\n      if (item) {\n        props.command({\n          id: `member-${item.id}`,\n          label: item.user_profile?.name || 'Unknown',\n          workspaceMemberId: item.id,\n        });\n      }\n    };\n\n    const upHandler = () => {\n      setSelectedIndex(\n        (selectedIndex + props.items.length - 1) % props.items.length\n      );\n    };\n\n    const downHandler = () => {\n      setSelectedIndex((selectedIndex + 1) % props.items.length);\n    };\n\n    const enterHandler = () => {\n      selectItem(selectedIndex);\n    };\n\n    useEffect(() => setSelectedIndex(0), [props.items]);\n\n    useImperativeHandle(ref, () => ({\n      onKeyDown: ({ event }: { event: KeyboardEvent }) => {\n        if (event.key === 'ArrowUp') {\n          upHandler();\n          return true;\n        }\n\n        if (event.key === 'ArrowDown') {\n          downHandler();\n          return true;\n        }\n\n        if (event.key === 'Enter') {\n          enterHandler();\n          return true;\n        }\n\n        return false;\n      },\n    }));\n\n    return (\n      <div className='bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg shadow-lg overflow-hidden max-h-[300px] overflow-y-auto'>\n        {props.items.length ? (\n          props.items.map((item, index) => (\n            <button\n              className={`flex items-center gap-3 w-full px-4 py-2.5 text-left transition-colors ${\n                index === selectedIndex ? 'bg-white/20' : 'hover:bg-white/10'\n              }`}\n              key={item.id}\n              onClick={() => selectItem(index)}\n              type='button'\n            >\n              <Avatar className='h-8 w-8 border border-white/20 bg-white/10'>\n                {item.user_profile?.avatar_url ? (\n                  <AvatarImage\n                    src={item.user_profile.avatar_url}\n                    alt={item.user_profile.name ?? 'Member'}\n                  />\n                ) : (\n                  <AvatarFallback>\n                    <User className='w-4 h-4 text-gray-300' />\n                  </AvatarFallback>\n                )}\n              </Avatar>\n              <div>\n                <div className='text-white font-medium'>\n                  {item.user_profile?.name || 'Unknown'}\n                </div>\n                <div className='text-xs text-gray-400 capitalize'>\n                  {item.role}\n                </div>\n              </div>\n            </button>\n          ))\n        ) : (\n          <div className='px-4 py-3 text-sm text-gray-400'>\n            No members found\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nMentionList.displayName = 'MentionList';\n"],"names":[],"mappings":";;;;;AAEA;AAOA;AACA;AAVA;;;;;AAyBO,MAAM,4BAAc,IAAA,ucAAU,EACnC,CAAC,OAAO;IACN,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,qcAAQ,EAAC;IAEnD,MAAM,aAAa,CAAC;QAClB,MAAM,OAAO,MAAM,KAAK,CAAC,MAAM;QAE/B,IAAI,MAAM;YACR,MAAM,OAAO,CAAC;gBACZ,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE;gBACvB,OAAO,KAAK,YAAY,EAAE,QAAQ;gBAClC,mBAAmB,KAAK,EAAE;YAC5B;QACF;IACF;IAEA,MAAM,YAAY;QAChB,iBACE,CAAC,gBAAgB,MAAM,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAEjE;IAEA,MAAM,cAAc;QAClB,iBAAiB,CAAC,gBAAgB,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAC3D;IAEA,MAAM,eAAe;QACnB,WAAW;IACb;IAEA,IAAA,scAAS,EAAC,IAAM,iBAAiB,IAAI;QAAC,MAAM,KAAK;KAAC;IAElD,IAAA,gdAAmB,EAAC,KAAK,IAAM,CAAC;YAC9B,WAAW,CAAC,EAAE,KAAK,EAA4B;gBAC7C,IAAI,MAAM,GAAG,KAAK,WAAW;oBAC3B;oBACA,OAAO;gBACT;gBAEA,IAAI,MAAM,GAAG,KAAK,aAAa;oBAC7B;oBACA,OAAO;gBACT;gBAEA,IAAI,MAAM,GAAG,KAAK,SAAS;oBACzB;oBACA,OAAO;gBACT;gBAEA,OAAO;YACT;QACF,CAAC;IAED,qBACE,keAAC;QAAI,WAAU;kBACZ,MAAM,KAAK,CAAC,MAAM,GACjB,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,sBACrB,keAAC;gBACC,WAAW,CAAC,uEAAuE,EACjF,UAAU,gBAAgB,gBAAgB,qBAC1C;gBAEF,SAAS,IAAM,WAAW;gBAC1B,MAAK;;kCAEL,keAAC,iMAAM;wBAAC,WAAU;kCACf,KAAK,YAAY,EAAE,2BAClB,keAAC,sMAAW;4BACV,KAAK,KAAK,YAAY,CAAC,UAAU;4BACjC,KAAK,KAAK,YAAY,CAAC,IAAI,IAAI;;;;;qFAGjC,keAAC,yMAAc;sCACb,cAAA,keAAC,+PAAI;gCAAC,WAAU;;;;;;;;;;;;;;;;kCAItB,keAAC;;0CACC,keAAC;gCAAI,WAAU;0CACZ,KAAK,YAAY,EAAE,QAAQ;;;;;;0CAE9B,keAAC;gCAAI,WAAU;0CACZ,KAAK,IAAI;;;;;;;;;;;;;eArBT,KAAK,EAAE;;;;0EA2BhB,keAAC;YAAI,WAAU;sBAAkC;;;;;;;;;;;AAMzD;AAGF,YAAY,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1477, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/mentionSuggestion.ts"],"sourcesContent":["import { ReactRenderer } from '@tiptap/react';\nimport tippy, { Instance as TippyInstance } from 'tippy.js';\nimport { MentionList, MentionListRef } from '@/components/tiptap/MentionList';\nimport { WorkspaceMember } from '@/types/workspace';\nimport { SuggestionOptions, SuggestionProps } from '@tiptap/suggestion';\n\nexport const createMentionSuggestion = (\n  getMembersRef: () => WorkspaceMember[]\n): Omit<SuggestionOptions, 'editor'> => ({\n  items: ({ query }: { query: string }) => {\n    const members = getMembersRef();\n    return members\n      .filter(member => {\n        const name = member.user_profile?.name?.toLowerCase() || '';\n        return name.includes(query.toLowerCase());\n      })\n      .slice(0, 5);\n  },\n\n  render: () => {\n    let component: ReactRenderer<MentionListRef> | undefined;\n    let popup: TippyInstance[] | undefined;\n\n    return {\n      onStart: (props: SuggestionProps) => {\n        component = new ReactRenderer(MentionList, {\n          props,\n          editor: props.editor,\n        });\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup = tippy('body', {\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n          appendTo: () => document.body,\n          content: component.element,\n          showOnCreate: true,\n          interactive: true,\n          trigger: 'manual',\n          placement: 'bottom-start',\n        });\n      },\n\n      onUpdate(props: SuggestionProps) {\n        component?.updateProps(props);\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup?.[0]?.setProps({\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n        });\n      },\n\n      onKeyDown(props: { event: KeyboardEvent }) {\n        if (props.event.key === 'Escape') {\n          popup?.[0]?.hide();\n          return true;\n        }\n\n        return component?.ref?.onKeyDown(props) ?? false;\n      },\n\n      onExit() {\n        popup?.[0]?.destroy();\n        component?.destroy();\n      },\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAIO,MAAM,0BAA0B,CACrC,gBACsC,CAAC;QACvC,OAAO,CAAC,EAAE,KAAK,EAAqB;YAClC,MAAM,UAAU;YAChB,OAAO,QACJ,MAAM,CAAC,CAAA;gBACN,MAAM,OAAO,OAAO,YAAY,EAAE,MAAM,iBAAiB;gBACzD,OAAO,KAAK,QAAQ,CAAC,MAAM,WAAW;YACxC,GACC,KAAK,CAAC,GAAG;QACd;QAEA,QAAQ;YACN,IAAI;YACJ,IAAI;YAEJ,OAAO;gBACL,SAAS,CAAC;oBACR,YAAY,IAAI,mbAAa,CAAC,+MAAW,EAAE;wBACzC;wBACA,QAAQ,MAAM,MAAM;oBACtB;oBAEA,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,QAAQ,IAAA,4PAAK,EAAC,QAAQ;wBACpB,wBAAwB,MAAM,UAAU;wBACxC,UAAU,IAAM,SAAS,IAAI;wBAC7B,SAAS,UAAU,OAAO;wBAC1B,cAAc;wBACd,aAAa;wBACb,SAAS;wBACT,WAAW;oBACb;gBACF;gBAEA,UAAS,KAAsB;oBAC7B,WAAW,YAAY;oBAEvB,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,OAAO,CAAC,EAAE,EAAE,SAAS;wBACnB,wBAAwB,MAAM,UAAU;oBAC1C;gBACF;gBAEA,WAAU,KAA+B;oBACvC,IAAI,MAAM,KAAK,CAAC,GAAG,KAAK,UAAU;wBAChC,OAAO,CAAC,EAAE,EAAE;wBACZ,OAAO;oBACT;oBAEA,OAAO,WAAW,KAAK,UAAU,UAAU;gBAC7C;gBAEA;oBACE,OAAO,CAAC,EAAE,EAAE;oBACZ,WAAW;gBACb;YACF;QACF;IACF,CAAC","debugId":null}},
    {"offset": {"line": 1544, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/NoteList.tsx"],"sourcesContent":["'use client';\n\nimport React, {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { NoteWithParsed } from '@/types/note';\nimport { FileText } from 'lucide-react';\n\nexport interface NoteListProps {\n  items: NoteWithParsed[];\n  command: (item: { id: string; label: string; noteId: number }) => void;\n}\n\nexport interface NoteListRef {\n  onKeyDown: (props: { event: KeyboardEvent }) => boolean;\n}\n\nexport const NoteList = forwardRef<NoteListRef, NoteListProps>((props, ref) => {\n  const [selectedIndex, setSelectedIndex] = useState(0);\n\n  const selectItem = (index: number) => {\n    const item = props.items[index];\n\n    if (item) {\n      props.command({\n        id: `note-${item.id}`,\n        label: item.title || 'Untitled',\n        noteId: item.id,\n      });\n    }\n  };\n\n  const upHandler = () => {\n    setSelectedIndex(\n      (selectedIndex + props.items.length - 1) % props.items.length\n    );\n  };\n\n  const downHandler = () => {\n    setSelectedIndex((selectedIndex + 1) % props.items.length);\n  };\n\n  const enterHandler = () => {\n    selectItem(selectedIndex);\n  };\n\n  useEffect(() => setSelectedIndex(0), [props.items]);\n\n  useImperativeHandle(ref, () => ({\n    onKeyDown: ({ event }: { event: KeyboardEvent }) => {\n      if (event.key === 'ArrowUp') {\n        upHandler();\n        return true;\n      }\n\n      if (event.key === 'ArrowDown') {\n        downHandler();\n        return true;\n      }\n\n      if (event.key === 'Enter') {\n        enterHandler();\n        return true;\n      }\n\n      return false;\n    },\n  }));\n\n  return (\n    <div className='bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg shadow-lg overflow-hidden max-h-[300px] overflow-y-auto'>\n      {props.items.length ? (\n        props.items.map((item, index) => (\n          <button\n            className={`flex items-center gap-3 w-full px-4 py-2.5 text-left transition-colors ${\n              index === selectedIndex ? 'bg-white/20' : 'hover:bg-white/10'\n            }`}\n            key={item.id}\n            onClick={() => selectItem(index)}\n            type='button'\n          >\n            <div className='flex items-center justify-center w-8 h-8 rounded bg-green-500/20 border border-green-500/30'>\n              <FileText className='w-4 h-4 text-green-400' />\n            </div>\n            <div className='flex-1 min-w-0'>\n              <div className='text-white font-medium truncate'>\n                {item.title || 'Untitled'}\n              </div>\n              {item.content && (\n                <div className='text-xs text-gray-400 truncate'>\n                  {item.content.substring(0, 60)}\n                  {item.content.length > 60 ? '...' : ''}\n                </div>\n              )}\n            </div>\n          </button>\n        ))\n      ) : (\n        <div className='px-4 py-3 text-sm text-gray-400'>No notes found</div>\n      )}\n    </div>\n  );\n});\n\nNoteList.displayName = 'NoteList';\n"],"names":[],"mappings":";;;;;AAEA;AAOA;AATA;;;;AAoBO,MAAM,yBAAW,IAAA,ucAAU,EAA6B,CAAC,OAAO;IACrE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,qcAAQ,EAAC;IAEnD,MAAM,aAAa,CAAC;QAClB,MAAM,OAAO,MAAM,KAAK,CAAC,MAAM;QAE/B,IAAI,MAAM;YACR,MAAM,OAAO,CAAC;gBACZ,IAAI,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE;gBACrB,OAAO,KAAK,KAAK,IAAI;gBACrB,QAAQ,KAAK,EAAE;YACjB;QACF;IACF;IAEA,MAAM,YAAY;QAChB,iBACE,CAAC,gBAAgB,MAAM,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAEjE;IAEA,MAAM,cAAc;QAClB,iBAAiB,CAAC,gBAAgB,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAC3D;IAEA,MAAM,eAAe;QACnB,WAAW;IACb;IAEA,IAAA,scAAS,EAAC,IAAM,iBAAiB,IAAI;QAAC,MAAM,KAAK;KAAC;IAElD,IAAA,gdAAmB,EAAC,KAAK,IAAM,CAAC;YAC9B,WAAW,CAAC,EAAE,KAAK,EAA4B;gBAC7C,IAAI,MAAM,GAAG,KAAK,WAAW;oBAC3B;oBACA,OAAO;gBACT;gBAEA,IAAI,MAAM,GAAG,KAAK,aAAa;oBAC7B;oBACA,OAAO;gBACT;gBAEA,IAAI,MAAM,GAAG,KAAK,SAAS;oBACzB;oBACA,OAAO;gBACT;gBAEA,OAAO;YACT;QACF,CAAC;IAED,qBACE,keAAC;QAAI,WAAU;kBACZ,MAAM,KAAK,CAAC,MAAM,GACjB,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,sBACrB,keAAC;gBACC,WAAW,CAAC,uEAAuE,EACjF,UAAU,gBAAgB,gBAAgB,qBAC1C;gBAEF,SAAS,IAAM,WAAW;gBAC1B,MAAK;;kCAEL,keAAC;wBAAI,WAAU;kCACb,cAAA,keAAC,+QAAQ;4BAAC,WAAU;;;;;;;;;;;kCAEtB,keAAC;wBAAI,WAAU;;0CACb,keAAC;gCAAI,WAAU;0CACZ,KAAK,KAAK,IAAI;;;;;;4BAEhB,KAAK,OAAO,kBACX,keAAC;gCAAI,WAAU;;oCACZ,KAAK,OAAO,CAAC,SAAS,CAAC,GAAG;oCAC1B,KAAK,OAAO,CAAC,MAAM,GAAG,KAAK,QAAQ;;;;;;;;;;;;;;eAdrC,KAAK,EAAE;;;;0EAqBhB,keAAC;YAAI,WAAU;sBAAkC;;;;;;;;;;;AAIzD;AAEA,SAAS,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1669, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/noteMentionSuggestion.ts"],"sourcesContent":["import { ReactRenderer } from '@tiptap/react';\nimport tippy, { Instance as TippyInstance } from 'tippy.js';\nimport { NoteList, NoteListRef } from '@/components/tiptap/NoteList';\nimport { NoteWithParsed } from '@/types/note';\nimport { SuggestionOptions, SuggestionProps } from '@tiptap/suggestion';\n\nexport const createNoteMentionSuggestion = (\n  getNotesRef: () => NoteWithParsed[]\n): Omit<SuggestionOptions, 'editor'> => ({\n  char: '#',\n  items: ({ query }: { query: string }) => {\n    const notes = getNotesRef();\n    return notes\n      .filter(note => {\n        const title = note.title?.toLowerCase() || '';\n        const content = note.content?.toLowerCase() || '';\n        const queryLower = query.toLowerCase();\n        return title.includes(queryLower) || content.includes(queryLower);\n      })\n      .slice(0, 5);\n  },\n\n  render: () => {\n    let component: ReactRenderer<NoteListRef> | undefined;\n    let popup: TippyInstance[] | undefined;\n\n    return {\n      onStart: (props: SuggestionProps) => {\n        component = new ReactRenderer(NoteList, {\n          props,\n          editor: props.editor,\n        });\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup = tippy('body', {\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n          appendTo: () => document.body,\n          content: component.element,\n          showOnCreate: true,\n          interactive: true,\n          trigger: 'manual',\n          placement: 'bottom-start',\n        });\n      },\n\n      onUpdate(props: SuggestionProps) {\n        component?.updateProps(props);\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup?.[0]?.setProps({\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n        });\n      },\n\n      onKeyDown(props: { event: KeyboardEvent }) {\n        if (props.event.key === 'Escape') {\n          popup?.[0]?.hide();\n          return true;\n        }\n\n        return component?.ref?.onKeyDown(props) ?? false;\n      },\n\n      onExit() {\n        popup?.[0]?.destroy();\n        component?.destroy();\n      },\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAIO,MAAM,8BAA8B,CACzC,cACsC,CAAC;QACvC,MAAM;QACN,OAAO,CAAC,EAAE,KAAK,EAAqB;YAClC,MAAM,QAAQ;YACd,OAAO,MACJ,MAAM,CAAC,CAAA;gBACN,MAAM,QAAQ,KAAK,KAAK,EAAE,iBAAiB;gBAC3C,MAAM,UAAU,KAAK,OAAO,EAAE,iBAAiB;gBAC/C,MAAM,aAAa,MAAM,WAAW;gBACpC,OAAO,MAAM,QAAQ,CAAC,eAAe,QAAQ,QAAQ,CAAC;YACxD,GACC,KAAK,CAAC,GAAG;QACd;QAEA,QAAQ;YACN,IAAI;YACJ,IAAI;YAEJ,OAAO;gBACL,SAAS,CAAC;oBACR,YAAY,IAAI,mbAAa,CAAC,yMAAQ,EAAE;wBACtC;wBACA,QAAQ,MAAM,MAAM;oBACtB;oBAEA,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,QAAQ,IAAA,4PAAK,EAAC,QAAQ;wBACpB,wBAAwB,MAAM,UAAU;wBACxC,UAAU,IAAM,SAAS,IAAI;wBAC7B,SAAS,UAAU,OAAO;wBAC1B,cAAc;wBACd,aAAa;wBACb,SAAS;wBACT,WAAW;oBACb;gBACF;gBAEA,UAAS,KAAsB;oBAC7B,WAAW,YAAY;oBAEvB,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,OAAO,CAAC,EAAE,EAAE,SAAS;wBACnB,wBAAwB,MAAM,UAAU;oBAC1C;gBACF;gBAEA,WAAU,KAA+B;oBACvC,IAAI,MAAM,KAAK,CAAC,GAAG,KAAK,UAAU;wBAChC,OAAO,CAAC,EAAE,EAAE;wBACZ,OAAO;oBACT;oBAEA,OAAO,WAAW,KAAK,UAAU,UAAU;gBAC7C;gBAEA;oBACE,OAAO,CAAC,EAAE,EAAE;oBACZ,WAAW;gBACb;YACF;QACF;IACF,CAAC","debugId":null}},
    {"offset": {"line": 1739, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/extensions/useTiptapExtensions.ts"],"sourcesContent":["import { useRef, useMemo } from 'react';\nimport StarterKit from '@tiptap/starter-kit';\nimport { Markdown } from '@tiptap/markdown';\nimport Placeholder from '@tiptap/extension-placeholder';\nimport { CustomMention } from '@/lib/tiptap/MentionExtension';\nimport { NoteMention } from '@/lib/tiptap/NoteMentionExtension';\nimport { createMentionSuggestion } from '@/lib/tiptap/mentionSuggestion';\nimport { createNoteMentionSuggestion } from '@/lib/tiptap/noteMentionSuggestion';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note, NoteWithParsed } from '@/types/note';\n\nexport type TiptapMode = 'full' | 'chat' | 'minimal' | 'readonly';\n\nexport interface UseTiptapExtensionsConfig {\n  mode: TiptapMode;\n  placeholder?: string;\n  enableMemberMentions?: boolean;\n  enableNoteMentions?: boolean;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[] | NoteWithParsed[];\n}\n\n/**\n * Hook to get configured TipTap extensions based on use case\n */\nexport function useTiptapExtensions({\n  mode,\n  placeholder = 'Start typing...',\n  enableMemberMentions = false,\n  enableNoteMentions = false,\n  workspaceMembers = [],\n  workspaceNotes = [],\n}: UseTiptapExtensionsConfig): any[] {\n  // Use refs to avoid recreating suggestion components on every render\n  const membersRef = useRef<WorkspaceMember[]>([]);\n  const notesRef = useRef<Note[] | NoteWithParsed[]>([]);\n\n  // Update refs when data changes\n  membersRef.current = workspaceMembers;\n  notesRef.current = workspaceNotes;\n\n  // Memoize extensions - recreate when config or data changes\n  return useMemo(() => {\n    const extensions: any[] = [];\n\n    // Base extensions for all modes\n    if (mode === 'readonly' || mode === 'minimal') {\n      // Minimal set for display only\n      extensions.push(\n        StarterKit.configure({\n          heading: { levels: [1, 2, 3] },\n          code: false,\n        }),\n        Markdown\n      );\n    } else if (mode === 'chat') {\n      // Chat mode: basic formatting only (bold, italic, mentions)\n      extensions.push(\n        StarterKit.configure({\n          heading: false, // No headings in chat\n          blockquote: false, // No blockquotes in chat\n          codeBlock: false, // No code blocks in chat\n          horizontalRule: false, // No horizontal rules in chat\n          code: false,\n        }),\n        Placeholder.configure({ placeholder }),\n        Markdown\n      );\n    } else if (mode === 'full') {\n      // Full editor mode (for notes)\n      extensions.push(\n        StarterKit.configure({\n          heading: { levels: [1, 2, 3] },\n          code: false,\n        }),\n        Placeholder.configure({ placeholder }),\n        Markdown\n      );\n    }\n\n    // Add member mentions if enabled\n    if (enableMemberMentions) {\n      extensions.push(\n        CustomMention.configure({\n          HTMLAttributes: {\n            class: 'mention',\n          },\n          suggestion: createMentionSuggestion(() => membersRef.current),\n        })\n      );\n    }\n\n    // Add note mentions if enabled\n    if (enableNoteMentions) {\n      extensions.push(\n        NoteMention.configure({\n          HTMLAttributes: {\n            class: 'note-mention',\n          },\n          suggestion: createNoteMentionSuggestion(\n            () => notesRef.current as NoteWithParsed[]\n          ),\n        })\n      );\n    }\n\n    return extensions;\n  }, [mode, placeholder, enableMemberMentions, enableNoteMentions]);\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAkBO,SAAS,oBAAoB,EAClC,IAAI,EACJ,cAAc,iBAAiB,EAC/B,uBAAuB,KAAK,EAC5B,qBAAqB,KAAK,EAC1B,mBAAmB,EAAE,EACrB,iBAAiB,EAAE,EACO;IAC1B,qEAAqE;IACrE,MAAM,aAAa,IAAA,mcAAM,EAAoB,EAAE;IAC/C,MAAM,WAAW,IAAA,mcAAM,EAA4B,EAAE;IAErD,gCAAgC;IAChC,WAAW,OAAO,GAAG;IACrB,SAAS,OAAO,GAAG;IAEnB,4DAA4D;IAC5D,OAAO,IAAA,ocAAO,EAAC;QACb,MAAM,aAAoB,EAAE;QAE5B,gCAAgC;QAChC,IAAI,SAAS,cAAc,SAAS,WAAW;YAC7C,+BAA+B;YAC/B,WAAW,IAAI,CACb,oRAAU,CAAC,SAAS,CAAC;gBACnB,SAAS;oBAAE,QAAQ;wBAAC;wBAAG;wBAAG;qBAAE;gBAAC;gBAC7B,MAAM;YACR,IACA,gXAAQ;QAEZ,OAAO,IAAI,SAAS,QAAQ;YAC1B,4DAA4D;YAC5D,WAAW,IAAI,CACb,oRAAU,CAAC,SAAS,CAAC;gBACnB,SAAS;gBACT,YAAY;gBACZ,WAAW;gBACX,gBAAgB;gBAChB,MAAM;YACR,IACA,ycAAW,CAAC,SAAS,CAAC;gBAAE;YAAY,IACpC,gXAAQ;QAEZ,OAAO,IAAI,SAAS,QAAQ;YAC1B,+BAA+B;YAC/B,WAAW,IAAI,CACb,oRAAU,CAAC,SAAS,CAAC;gBACnB,SAAS;oBAAE,QAAQ;wBAAC;wBAAG;wBAAG;qBAAE;gBAAC;gBAC7B,MAAM;YACR,IACA,ycAAW,CAAC,SAAS,CAAC;gBAAE;YAAY,IACpC,gXAAQ;QAEZ;QAEA,iCAAiC;QACjC,IAAI,sBAAsB;YACxB,WAAW,IAAI,CACb,8MAAa,CAAC,SAAS,CAAC;gBACtB,gBAAgB;oBACd,OAAO;gBACT;gBACA,YAAY,IAAA,yNAAuB,EAAC,IAAM,WAAW,OAAO;YAC9D;QAEJ;QAEA,+BAA+B;QAC/B,IAAI,oBAAoB;YACtB,WAAW,IAAI,CACb,gNAAW,CAAC,SAAS,CAAC;gBACpB,gBAAgB;oBACd,OAAO;gBACT;gBACA,YAAY,IAAA,iOAA2B,EACrC,IAAM,SAAS,OAAO;YAE1B;QAEJ;QAEA,OAAO;IACT,GAAG;QAAC;QAAM;QAAa;QAAsB;KAAmB;AAClE","debugId":null}},
    {"offset": {"line": 1838, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/extractMentions.ts"],"sourcesContent":["import type { Editor } from '@tiptap/core';\n\n/**\n * Extract workspace member IDs from mention nodes in the editor\n */\nexport function extractMemberMentions(editor: Editor | null): number[] {\n  if (!editor) return [];\n\n  const mentionedIds: number[] = [];\n  editor.state.doc.descendants(node => {\n    if (node.type.name === 'mention' && node.attrs.workspaceMemberId) {\n      mentionedIds.push(node.attrs.workspaceMemberId);\n    }\n  });\n\n  return [...new Set(mentionedIds)]; // Remove duplicates\n}\n\n/**\n * Extract note IDs from note mention nodes in the editor\n */\nexport function extractNoteMentions(editor: Editor | null): number[] {\n  if (!editor) return [];\n\n  const mentionedNoteIds: number[] = [];\n  editor.state.doc.descendants(node => {\n    if (node.type.name === 'noteMention' && node.attrs.noteId) {\n      mentionedNoteIds.push(node.attrs.noteId);\n    }\n  });\n\n  return [...new Set(mentionedNoteIds)]; // Remove duplicates\n}\n"],"names":[],"mappings":";;;;;;AAKO,SAAS,sBAAsB,MAAqB;IACzD,IAAI,CAAC,QAAQ,OAAO,EAAE;IAEtB,MAAM,eAAyB,EAAE;IACjC,OAAO,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;QAC3B,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,aAAa,KAAK,KAAK,CAAC,iBAAiB,EAAE;YAChE,aAAa,IAAI,CAAC,KAAK,KAAK,CAAC,iBAAiB;QAChD;IACF;IAEA,OAAO;WAAI,IAAI,IAAI;KAAc,EAAE,oBAAoB;AACzD;AAKO,SAAS,oBAAoB,MAAqB;IACvD,IAAI,CAAC,QAAQ,OAAO,EAAE;IAEtB,MAAM,mBAA6B,EAAE;IACrC,OAAO,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;QAC3B,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,iBAAiB,KAAK,KAAK,CAAC,MAAM,EAAE;YACzD,iBAAiB,IAAI,CAAC,KAAK,KAAK,CAAC,MAAM;QACzC;IACF;IAEA,OAAO;WAAI,IAAI,IAAI;KAAkB,EAAE,oBAAoB;AAC7D","debugId":null}},
    {"offset": {"line": 1872, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/TiptapChatInput.tsx"],"sourcesContent":["'use client';\n\nimport {\n  useRef,\n  useState,\n  useEffect,\n  useImperativeHandle,\n  forwardRef,\n  useCallback,\n} from 'react';\nimport { useEditor, EditorContent } from '@tiptap/react';\nimport { ArrowUp, Square } from 'lucide-react';\nimport { VoiceInputButton } from './VoiceInputButton';\nimport { useUI } from '@/contexts/UIContext';\nimport { useTiptapExtensions } from '@/components/tiptap/extensions/useTiptapExtensions';\nimport {\n  extractMemberMentions,\n  extractNoteMentions,\n} from '@/lib/tiptap/extractMentions';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note } from '@/types/note';\n\ninterface TiptapChatInputProps {\n  onSend: (\n    text: string,\n    mentionedMemberIds: number[],\n    mentionedNoteIds: number[]\n  ) => void | Promise<void>;\n  onStop?: () => void;\n  isLoading?: boolean;\n  placeholder?: string;\n  canStop?: boolean;\n  isUploading?: boolean;\n  hasAttachments?: boolean;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n}\n\nexport type TiptapChatInputRef = {\n  focus: () => void;\n  clearContent: () => void;\n};\n\nconst TiptapChatInput = forwardRef<TiptapChatInputRef, TiptapChatInputProps>(\n  function TiptapChatInput(\n    {\n      onSend,\n      onStop,\n      isLoading = false,\n      placeholder = '...',\n      canStop = true,\n      isUploading = false,\n      hasAttachments = false,\n      workspaceMembers = [],\n      workspaceNotes = [],\n    },\n    ref\n  ) {\n    const [isFocused, setIsFocused] = useState(false);\n    const [isEmpty, setIsEmpty] = useState(true);\n    const { setInputActive } = useUI();\n    const editorRef = useRef<HTMLDivElement>(null);\n\n    // Get extensions for chat mode with member mentions and note mentions\n    const extensions = useTiptapExtensions({\n      mode: 'chat',\n      placeholder,\n      enableMemberMentions: workspaceMembers.length > 0,\n      enableNoteMentions: workspaceNotes.length > 0,\n      workspaceMembers,\n      workspaceNotes,\n    });\n\n    // Initialize TipTap editor\n    // Pass extensions as dependency to recreate editor when they change\n    const editor = useEditor(\n      {\n        immediatelyRender: false,\n        extensions,\n        content: '',\n        contentType: 'markdown',\n        editorProps: {\n          attributes: {\n            class:\n              'w-full bg-transparent text-white px-5 py-3.5 pr-[140px] focus:outline-none resize-none overflow-y-auto chat-input-editor',\n            style: 'max-height: 140px;', // ~7 lines\n          },\n        },\n        onUpdate: ({ editor }) => {\n          const text = editor.getText();\n          setIsEmpty(text.trim().length === 0);\n        },\n        onFocus: () => setIsFocused(true),\n        onBlur: () => setIsFocused(false),\n      },\n      [extensions]\n    );\n\n    useImperativeHandle(ref, () => ({\n      focus: () => {\n        editor?.commands.focus();\n      },\n      clearContent: () => {\n        editor?.commands.clearContent();\n        setIsEmpty(true);\n      },\n    }));\n\n    // Update input active state\n    useEffect(() => {\n      setInputActive(isFocused || !isEmpty);\n    }, [isFocused, isEmpty, setInputActive]);\n\n    const handleSend = useCallback(async () => {\n      if (isLoading || isUploading || !editor) return;\n\n      const text = editor.getMarkdown().trim();\n      const hasText = text.length > 0;\n\n      if (!hasText && !hasAttachments) return;\n\n      // Extract mentions before clearing\n      const mentionedMemberIds = extractMemberMentions(editor);\n      const mentionedNoteIds = extractNoteMentions(editor);\n\n      await onSend(text || '', mentionedMemberIds, mentionedNoteIds);\n\n      // Clear editor content\n      editor.commands.clearContent();\n      setIsEmpty(true);\n    }, [isLoading, isUploading, editor, hasAttachments, onSend]);\n\n    const handleStop = () => {\n      if (onStop && isLoading) {\n        onStop();\n      }\n    };\n\n    // Handle voice input\n    const handleVoiceTranscript = (text: string) => {\n      if (editor) {\n        editor.commands.setContent(text);\n        editor.commands.focus();\n      }\n    };\n\n    // Add keyboard shortcuts\n    useEffect(() => {\n      if (!editor) return;\n\n      const handleKeyDown = (event: Event) => {\n        const keyboardEvent = event as KeyboardEvent;\n\n        // Shift+Enter: newline (default behavior)\n        if (keyboardEvent.key === 'Enter' && keyboardEvent.shiftKey) {\n          return;\n        }\n\n        // Enter (without Shift): send message\n        if (keyboardEvent.key === 'Enter' && !keyboardEvent.shiftKey) {\n          // Don't send during IME composition\n          if (keyboardEvent.isComposing) {\n            return;\n          }\n\n          keyboardEvent.preventDefault();\n          handleSend();\n        }\n      };\n\n      const editorElement = editorRef.current?.querySelector('.ProseMirror');\n      editorElement?.addEventListener('keydown', handleKeyDown);\n\n      return () => {\n        editorElement?.removeEventListener('keydown', handleKeyDown);\n      };\n    }, [editor, handleSend]);\n\n    if (!editor) {\n      return null;\n    }\n\n    return (\n      <div className='flex-1 relative ml-[55px]'>\n        <div\n          ref={editorRef}\n          className='w-full bg-white/8 backdrop-blur-xl rounded-4xl border border-black focus-within:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'\n        >\n          <EditorContent editor={editor} />\n        </div>\n\n        {/*  -  */}\n        <div className='absolute right-[50px] bottom-1.5 z-10'>\n          <VoiceInputButton\n            onTranscriptChange={handleVoiceTranscript}\n            currentText={editor.getText()}\n            disabled={isLoading}\n            className='w-11 h-11 rounded-full bg-transparent border-0 text-white hover:scale-102 transition-all duration-300'\n          />\n        </div>\n\n        {/*  /  */}\n        <button\n          onClick={isLoading && canStop ? handleStop : handleSend}\n          disabled={isLoading || isUploading || (isEmpty && !hasAttachments)}\n          className='absolute right-2.5 bottom-1.5 w-10 h-10 rounded-full bg-white/10 backdrop-blur-xl border border-black text-white flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white/15 hover:scale-102 transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)]'\n        >\n          {isLoading && canStop ? (\n            <Square className='w-4 h-4 fill-current' />\n          ) : (\n            <ArrowUp className='w-4 h-4' />\n          )}\n        </button>\n      </div>\n    );\n  }\n);\n\nexport default TiptapChatInput;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2078, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/FileUploadMenu.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useState } from 'react';\nimport { Image as ImageIcon, File as FileIcon } from 'lucide-react';\n\ntype FileUploadMenuProps = {\n  onFilesSelected: (files: File[]) => void;\n  maxFiles?: number;\n  disabled?: boolean;\n};\n\nexport default function FileUploadMenu({\n  onFilesSelected,\n  maxFiles = 4,\n  disabled = false,\n}: FileUploadMenuProps) {\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const imageInputRef = useRef<HTMLInputElement>(null);\n  const [isOpen, setIsOpen] = useState(false);\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n\n    if (files.length === 0) return;\n\n    // Limit to maxFiles\n    const selectedFiles = files.slice(0, maxFiles);\n\n    // Validate file count\n    if (files.length > maxFiles) {\n      alert(`You can only upload up to ${maxFiles} files at once.`);\n    }\n\n    onFilesSelected(selectedFiles);\n\n    // Reset input\n    e.target.value = '';\n  };\n\n  const triggerFileInput = (accept: 'image' | 'file') => {\n    const input = accept === 'image' ? imageInputRef : fileInputRef;\n    input.current?.click();\n  };\n\n  useEffect(() => {\n    if (disabled) {\n      setIsOpen(false);\n    }\n  }, [disabled]);\n\n  return (\n    <div className='relative flex flex-col items-center gap-3'>\n      {isOpen && (\n        <div className='absolute bottom-full mb-3 flex flex-col items-center gap-2 bg-white/8 backdrop-blur-xl text-white/80 rounded-full border border-black shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] px-3 py-4'>\n          <button\n            type='button'\n            onClick={() => triggerFileInput('image')}\n            disabled={disabled}\n            className='relative group flex h-8 w-8 items-center justify-center rounded-full bg-white/5 text-white/80 transition-all duration-300 hover:bg-white/15 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed'\n            aria-label='Upload images'\n          >\n            <ImageIcon className='h-4 w-4' />\n            <span className='pointer-events-none absolute left-full ml-2 whitespace-nowrap rounded-md bg-black/80 px-2 py-1 text-xs text-white opacity-0 transition-opacity duration-200 group-hover:opacity-100'>\n              Upload images\n            </span>\n          </button>\n          <button\n            type='button'\n            onClick={() => triggerFileInput('file')}\n            disabled={disabled}\n            className='relative group flex h-8 w-8 items-center justify-center rounded-full bg-white/5 text-white/80 transition-all duration-300 hover:bg-white/15 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed'\n            aria-label='Upload files'\n          >\n            <FileIcon className='h-4 w-4' />\n            <span className='pointer-events-none absolute left-full ml-2 whitespace-nowrap rounded-md bg-black/80 px-2 py-1 text-xs text-white opacity-0 transition-opacity duration-200 group-hover:opacity-100'>\n              Upload files\n            </span>\n          </button>\n        </div>\n      )}\n      <button\n        type='button'\n        onClick={() => {\n          if (disabled) return;\n          setIsOpen(prev => !prev);\n        }}\n        disabled={disabled}\n        className='flex h-[52px] w-[52px] items-center justify-center rounded-full bg-white/8 backdrop-blur-xl text-white/80 border border-black transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:bg-white/15 hover:text-white hover:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] disabled:opacity-50 disabled:cursor-not-allowed'\n        aria-label='Add files'\n      >\n        <svg\n          xmlns='http://www.w3.org/2000/svg'\n          width='20'\n          height='20'\n          viewBox='0 0 24 24'\n          fill='none'\n          stroke='currentColor'\n          strokeWidth='2'\n          strokeLinecap='round'\n          strokeLinejoin='round'\n        >\n          <line x1='12' y1='5' x2='12' y2='19'></line>\n          <line x1='5' y1='12' x2='19' y2='12'></line>\n        </svg>\n      </button>\n\n      {/* Hidden file inputs */}\n      <input\n        ref={imageInputRef}\n        type='file'\n        accept='image/*'\n        multiple\n        className='hidden'\n        onChange={handleFileSelect}\n      />\n      <input\n        ref={fileInputRef}\n        type='file'\n        multiple\n        className='hidden'\n        onChange={handleFileSelect}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAHA;;;;AAWe,SAAS,eAAe,EACrC,eAAe,EACf,WAAW,CAAC,EACZ,WAAW,KAAK,EACI;IACpB,MAAM,eAAe,IAAA,mcAAM,EAAmB;IAC9C,MAAM,gBAAgB,IAAA,mcAAM,EAAmB;IAC/C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,qcAAQ,EAAC;IAErC,MAAM,mBAAmB,CAAC;QACxB,MAAM,QAAQ,MAAM,IAAI,CAAC,EAAE,MAAM,CAAC,KAAK,IAAI,EAAE;QAE7C,IAAI,MAAM,MAAM,KAAK,GAAG;QAExB,oBAAoB;QACpB,MAAM,gBAAgB,MAAM,KAAK,CAAC,GAAG;QAErC,sBAAsB;QACtB,IAAI,MAAM,MAAM,GAAG,UAAU;YAC3B,MAAM,CAAC,0BAA0B,EAAE,SAAS,eAAe,CAAC;QAC9D;QAEA,gBAAgB;QAEhB,cAAc;QACd,EAAE,MAAM,CAAC,KAAK,GAAG;IACnB;IAEA,MAAM,mBAAmB,CAAC;QACxB,MAAM,QAAQ,WAAW,UAAU,gBAAgB;QACnD,MAAM,OAAO,EAAE;IACjB;IAEA,IAAA,scAAS,EAAC;QACR,IAAI,UAAU;YACZ,UAAU;QACZ;IACF,GAAG;QAAC;KAAS;IAEb,qBACE,keAAC;QAAI,WAAU;;YACZ,wBACC,keAAC;gBAAI,WAAU;;kCACb,keAAC;wBACC,MAAK;wBACL,SAAS,IAAM,iBAAiB;wBAChC,UAAU;wBACV,WAAU;wBACV,cAAW;;0CAEX,keAAC,kQAAS;gCAAC,WAAU;;;;;;0CACrB,keAAC;gCAAK,WAAU;0CAAsL;;;;;;;;;;;;kCAIxM,keAAC;wBACC,MAAK;wBACL,SAAS,IAAM,iBAAiB;wBAChC,UAAU;wBACV,WAAU;wBACV,cAAW;;0CAEX,keAAC,+PAAQ;gCAAC,WAAU;;;;;;0CACpB,keAAC;gCAAK,WAAU;0CAAsL;;;;;;;;;;;;;;;;;;0BAM5M,keAAC;gBACC,MAAK;gBACL,SAAS;oBACP,IAAI,UAAU;oBACd,UAAU,CAAA,OAAQ,CAAC;gBACrB;gBACA,UAAU;gBACV,WAAU;gBACV,cAAW;0BAEX,cAAA,keAAC;oBACC,OAAM;oBACN,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;;sCAEf,keAAC;4BAAK,IAAG;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;;;;;;sCAChC,keAAC;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;4BAAK,IAAG;;;;;;;;;;;;;;;;;0BAKpC,keAAC;gBACC,KAAK;gBACL,MAAK;gBACL,QAAO;gBACP,QAAQ;gBACR,WAAU;gBACV,UAAU;;;;;;0BAEZ,keAAC;gBACC,KAAK;gBACL,MAAK;gBACL,QAAQ;gBACR,WAAU;gBACV,UAAU;;;;;;;;;;;;AAIlB","debugId":null}},
    {"offset": {"line": 2271, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/FileUploadPreview.tsx"],"sourcesContent":["'use client';\n\nimport Image from 'next/image';\nimport { X, File as FileIcon, Loader2 } from 'lucide-react';\nimport { type UploadedFile } from '@/lib/api/workspaceFilesApi';\n\nexport interface FileUploadItem {\n  file: File;\n  id: string;\n  preview?: string;\n  uploaded?: UploadedFile;\n  error?: string;\n  uploading: boolean;\n  progress: number;\n}\n\ntype FileUploadPreviewProps = {\n  files: FileUploadItem[];\n  workspaceId: number;\n  onRemove: (id: string) => void;\n  onUploadComplete: (id: string, uploadedFile: UploadedFile) => void;\n  onUploadError: (id: string, error: string) => void;\n};\n\nexport default function FileUploadPreview(props: FileUploadPreviewProps) {\n  const { files, onRemove } = props;\n\n  if (files.length === 0) return null;\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  const isImage = (mimeType: string): boolean => {\n    return mimeType.startsWith('image/');\n  };\n\n  return (\n    <div className='px-2 md:px-6 pb-2'>\n      <div className='flex flex-wrap gap-2'>\n        {files.map(item => {\n          const isImg = isImage(item.file.type);\n          const hasError = !!item.error;\n          const isUploading = item.uploading;\n          const isComplete = !!item.uploaded;\n\n          return (\n            <div\n              key={item.id}\n              className='relative group bg-white/8 backdrop-blur-xl border border-black rounded-xl overflow-hidden shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'\n            >\n              {/* Remove button */}\n              {!isUploading && (\n                <button\n                  type='button'\n                  onClick={() => onRemove(item.id)}\n                  className='absolute top-1 right-1 z-10 w-6 h-6 rounded-full bg-black/60 hover:bg-black/80 backdrop-blur-sm flex items-center justify-center transition-all opacity-0 group-hover:opacity-100'\n                  aria-label='Remove file'\n                >\n                  <X className='w-3 h-3 text-white' />\n                </button>\n              )}\n\n              {/* Preview */}\n              <div className='w-20 h-20 relative'>\n                {isImg && item.preview ? (\n                  <Image\n                    src={item.preview}\n                    alt={item.file.name}\n                    fill\n                    sizes='80px'\n                    className='object-cover'\n                    unoptimized\n                  />\n                ) : (\n                  <div className='w-full h-full flex items-center justify-center bg-white/5'>\n                    <FileIcon className='w-8 h-8 text-white/40' />\n                  </div>\n                )}\n\n                {/* Upload progress overlay */}\n                {isUploading && (\n                  <div className='absolute inset-0 bg-black/50 flex items-center justify-center'>\n                    <Loader2 className='w-5 h-5 text-white animate-spin' />\n                  </div>\n                )}\n\n                {/* Error overlay */}\n                {hasError && (\n                  <div className='absolute inset-0 bg-red-900/50 flex items-center justify-center'>\n                    <X className='w-5 h-5 text-red-200' />\n                  </div>\n                )}\n\n                {/* Success indicator */}\n                {isComplete && (\n                  <div className='absolute inset-0 bg-green-900/30 flex items-center justify-center'>\n                    <div className='w-3 h-3 rounded-full bg-green-500' />\n                  </div>\n                )}\n\n                {/* Progress bar */}\n                {isUploading && (\n                  <div className='absolute bottom-0 left-0 right-0 h-1 bg-black/30'>\n                    <div\n                      className='h-full bg-white/60 transition-all duration-300'\n                      style={{ width: `${item.progress}%` }}\n                    />\n                  </div>\n                )}\n              </div>\n\n              {/* File name */}\n              <div className='px-2 py-1 max-w-[80px]'>\n                <p\n                  className='text-xs text-white/80 truncate'\n                  title={item.file.name}\n                >\n                  {item.file.name}\n                </p>\n                <p className='text-xs text-white/40'>\n                  {formatFileSize(item.file.size)}\n                </p>\n              </div>\n\n              {/* Error message */}\n              {hasError && (\n                <div className='px-2 pb-1'>\n                  <p\n                    className='text-xs text-red-300 truncate'\n                    title={item.error}\n                  >\n                    {item.error}\n                  </p>\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAHA;;;;AAwBe,SAAS,kBAAkB,KAA6B;IACrE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;IAE5B,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;IAE/B,MAAM,iBAAiB,CAAC;QACtB,IAAI,UAAU,GAAG,OAAO;QACxB,MAAM,IAAI;QACV,MAAM,QAAQ;YAAC;YAAS;YAAM;YAAM;SAAK;QACzC,MAAM,IAAI,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,SAAS,KAAK,GAAG,CAAC;QAChD,OAAO,KAAK,KAAK,CAAC,AAAC,QAAQ,KAAK,GAAG,CAAC,GAAG,KAAM,OAAO,MAAM,MAAM,KAAK,CAAC,EAAE;IAC1E;IAEA,MAAM,UAAU,CAAC;QACf,OAAO,SAAS,UAAU,CAAC;IAC7B;IAEA,qBACE,keAAC;QAAI,WAAU;kBACb,cAAA,keAAC;YAAI,WAAU;sBACZ,MAAM,GAAG,CAAC,CAAA;gBACT,MAAM,QAAQ,QAAQ,KAAK,IAAI,CAAC,IAAI;gBACpC,MAAM,WAAW,CAAC,CAAC,KAAK,KAAK;gBAC7B,MAAM,cAAc,KAAK,SAAS;gBAClC,MAAM,aAAa,CAAC,CAAC,KAAK,QAAQ;gBAElC,qBACE,keAAC;oBAEC,WAAU;;wBAGT,CAAC,6BACA,keAAC;4BACC,MAAK;4BACL,SAAS,IAAM,SAAS,KAAK,EAAE;4BAC/B,WAAU;4BACV,cAAW;sCAEX,cAAA,keAAC,sPAAC;gCAAC,WAAU;;;;;;;;;;;sCAKjB,keAAC;4BAAI,WAAU;;gCACZ,SAAS,KAAK,OAAO,iBACpB,keAAC,4XAAK;oCACJ,KAAK,KAAK,OAAO;oCACjB,KAAK,KAAK,IAAI,CAAC,IAAI;oCACnB,IAAI;oCACJ,OAAM;oCACN,WAAU;oCACV,WAAW;;;;;yDAGb,keAAC;oCAAI,WAAU;8CACb,cAAA,keAAC,+PAAQ;wCAAC,WAAU;;;;;;;;;;;gCAKvB,6BACC,keAAC;oCAAI,WAAU;8CACb,cAAA,keAAC,iRAAO;wCAAC,WAAU;;;;;;;;;;;gCAKtB,0BACC,keAAC;oCAAI,WAAU;8CACb,cAAA,keAAC,sPAAC;wCAAC,WAAU;;;;;;;;;;;gCAKhB,4BACC,keAAC;oCAAI,WAAU;8CACb,cAAA,keAAC;wCAAI,WAAU;;;;;;;;;;;gCAKlB,6BACC,keAAC;oCAAI,WAAU;8CACb,cAAA,keAAC;wCACC,WAAU;wCACV,OAAO;4CAAE,OAAO,GAAG,KAAK,QAAQ,CAAC,CAAC,CAAC;wCAAC;;;;;;;;;;;;;;;;;sCAO5C,keAAC;4BAAI,WAAU;;8CACb,keAAC;oCACC,WAAU;oCACV,OAAO,KAAK,IAAI,CAAC,IAAI;8CAEpB,KAAK,IAAI,CAAC,IAAI;;;;;;8CAEjB,keAAC;oCAAE,WAAU;8CACV,eAAe,KAAK,IAAI,CAAC,IAAI;;;;;;;;;;;;wBAKjC,0BACC,keAAC;4BAAI,WAAU;sCACb,cAAA,keAAC;gCACC,WAAU;gCACV,OAAO,KAAK,KAAK;0CAEhB,KAAK,KAAK;;;;;;;;;;;;mBApFZ,KAAK,EAAE;;;;;YA0FlB;;;;;;;;;;;AAIR","debugId":null}},
    {"offset": {"line": 2488, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/ReplyIndicator.tsx"],"sourcesContent":["export const ReplyIndicator = ({\n  replyingTo,\n  onCancelReply,\n}: {\n  replyingTo: { id: number; text: string; authorName?: string };\n  onCancelReply?: () => void;\n}) => {\n  return (\n    <div className='flex items-center justify-between bg-white/8 backdrop-blur-xl border border-black rounded-2xl px-4 py-2 shadow-[0_8px_32px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)]'>\n      <div className='flex-1 min-w-0'>\n        <p className='text-xs text-white/60 mb-1'>\n          Replying to {replyingTo.authorName || 'message'}\n        </p>\n        <p className='text-xs text-white/40 truncate'>\n          {replyingTo.text.slice(0, 100)}\n          {replyingTo.text.length > 100 ? '...' : ''}\n        </p>\n      </div>\n      {onCancelReply && (\n        <button\n          onClick={onCancelReply}\n          className='ml-3 text-white/60 hover:text-white/80 transition-colors text-sm'\n        >\n          \n        </button>\n      )}\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,iBAAiB,CAAC,EAC7B,UAAU,EACV,aAAa,EAId;IACC,qBACE,keAAC;QAAI,WAAU;;0BACb,keAAC;gBAAI,WAAU;;kCACb,keAAC;wBAAE,WAAU;;4BAA6B;4BAC3B,WAAW,UAAU,IAAI;;;;;;;kCAExC,keAAC;wBAAE,WAAU;;4BACV,WAAW,IAAI,CAAC,KAAK,CAAC,GAAG;4BACzB,WAAW,IAAI,CAAC,MAAM,GAAG,MAAM,QAAQ;;;;;;;;;;;;;YAG3C,+BACC,keAAC;gBACC,SAAS;gBACT,WAAU;0BACX;;;;;;;;;;;;AAMT","debugId":null}},
    {"offset": {"line": 2549, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/ChatInput.tsx"],"sourcesContent":["'use client';\n\nimport TiptapChatInput from './TiptapChatInput';\nimport {\n  useEffect,\n  useRef,\n  useImperativeHandle,\n  forwardRef,\n  useState,\n  useCallback,\n} from 'react';\nimport FileUploadMenu from './FileUploadMenu';\nimport FileUploadPreview, { type FileUploadItem } from './FileUploadPreview';\nimport {\n  uploadWorkspaceFile,\n  type UploadedFile,\n} from '@/lib/api/workspaceFilesApi';\nimport { ReplyIndicator } from './ReplyIndicator';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note } from '@/types/note';\n\ntype ChatInputProps = {\n  onSend: (\n    content: string,\n    workspaceFileIds?: number[],\n    mentionedMemberIds?: number[],\n    mentionedNoteIds?: number[]\n  ) => void;\n  onStop?: () => void;\n  isLoading?: boolean;\n  placeholder?: string;\n  canStop?: boolean;\n  replyingTo?: { id: number; text: string; authorName?: string } | null;\n  onCancelReply?: () => void;\n  workspaceId?: number;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n};\n\nexport type ChatInputRef = {\n  focus: () => void;\n  clearContent: () => void;\n};\n\nconst ChatInput = forwardRef<ChatInputRef, ChatInputProps>(function ChatInput(\n  {\n    onSend,\n    onStop,\n    isLoading = false,\n    placeholder = 'Ask anything',\n    canStop = true,\n    replyingTo,\n    onCancelReply,\n    workspaceId,\n    workspaceMembers = [],\n    workspaceNotes = [],\n  },\n  ref\n) {\n  const inputRef = useRef<{\n    focus: () => void;\n    clearContent: () => void;\n  } | null>(null);\n  const [uploadItems, setUploadItems] = useState<FileUploadItem[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n\n  const hasAttachments = uploadItems.length > 0;\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      inputRef.current?.focus();\n    },\n    clearContent: () => {\n      inputRef.current?.clearContent();\n    },\n  }));\n\n  // Focus input when replying\n  useEffect(() => {\n    if (replyingTo) {\n      // Small delay to ensure DOM is ready\n      setTimeout(() => {\n        inputRef.current?.focus();\n      }, 100);\n    }\n  }, [replyingTo]);\n\n  const handleFilesSelected = useCallback(\n    (files: File[]) => {\n      if (!workspaceId) return;\n\n      const newItems: FileUploadItem[] = files.map(file => {\n        const id = `${Date.now()}-${Math.random()}`;\n        const isImage = file.type.startsWith('image/');\n        let preview: string | undefined;\n\n        if (isImage) {\n          preview = URL.createObjectURL(file);\n        }\n\n        return {\n          file,\n          id,\n          preview,\n          uploading: false,\n          progress: 0,\n        };\n      });\n\n      setUploadItems(prev => {\n        const combined = [...prev, ...newItems];\n        // Limit to 4 files\n        return combined.slice(0, 4);\n      });\n    },\n    [workspaceId]\n  );\n\n  const handleRemoveFile = useCallback((id: string) => {\n    setUploadItems(prev => {\n      const item = prev.find(entry => entry.id === id);\n      if (item?.preview) {\n        URL.revokeObjectURL(item.preview);\n      }\n      return prev.filter(entry => entry.id !== id);\n    });\n  }, []);\n\n  const handleUploadComplete = useCallback(\n    (id: string, uploadedFile: UploadedFile) => {\n      setUploadItems(prev =>\n        prev.map(item =>\n          item.id === id ? { ...item, uploaded: uploadedFile } : item\n        )\n      );\n    },\n    []\n  );\n\n  const handleUploadError = useCallback((id: string, error: string) => {\n    setUploadItems(prev =>\n      prev.map(item =>\n        item.id === id ? { ...item, error, uploading: false } : item\n      )\n    );\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      uploadItems.forEach(item => {\n        if (item.preview) {\n          URL.revokeObjectURL(item.preview);\n        }\n      });\n    };\n  }, [uploadItems]);\n\n  const handleSend = useCallback(\n    async (\n      content: string,\n      mentionedMemberIds?: number[],\n      mentionedNoteIds?: number[]\n    ) => {\n      if (isLoading || isUploading) return;\n\n      // Allow sending if there's text or files\n      const trimmed = content.trim();\n      const hasText = trimmed.length > 0;\n\n      if (!hasText && uploadItems.length === 0) return;\n\n      let workspaceFileIds: number[] = [];\n\n      if (uploadItems.length > 0 && workspaceId) {\n        setIsUploading(true);\n        try {\n          const uploadPromises = uploadItems.map(async item => {\n            if (item.uploaded) {\n              return item.uploaded.id;\n            }\n\n            const uploaded = await uploadWorkspaceFile(workspaceId, item.file);\n            return uploaded.id;\n          });\n\n          workspaceFileIds = await Promise.all(uploadPromises);\n        } catch (error) {\n          console.error('Error uploading files:', error);\n          alert('Failed to upload files. Please try again.');\n          setIsUploading(false);\n          return;\n        }\n        setIsUploading(false);\n      }\n\n      onSend(\n        trimmed || '',\n        workspaceFileIds.length ? workspaceFileIds : undefined,\n        mentionedMemberIds,\n        mentionedNoteIds\n      );\n\n      setUploadItems(prev => {\n        prev.forEach(item => {\n          if (item.preview) {\n            URL.revokeObjectURL(item.preview);\n          }\n        });\n        return [];\n      });\n    },\n    [isLoading, isUploading, onSend, uploadItems, workspaceId]\n  );\n\n  return (\n    <div className='bg-gradient-to-br from-slate-950 via-black to-slate-950 relative z-10 rounded-t-3xl'>\n      {/* Reply indicator - absolutely positioned above input */}\n      {replyingTo && (\n        <div className='absolute bottom-full left-0 right-0 px-4 md:px-8 pb-2 pointer-events-auto'>\n          <ReplyIndicator\n            replyingTo={replyingTo}\n            onCancelReply={onCancelReply}\n          />\n        </div>\n      )}\n      {/* File Upload Preview */}\n      {workspaceId && uploadItems.length > 0 && (\n        <FileUploadPreview\n          files={uploadItems}\n          workspaceId={workspaceId}\n          onRemove={handleRemoveFile}\n          onUploadComplete={handleUploadComplete}\n          onUploadError={handleUploadError}\n        />\n      )}\n      {/* UI */}\n      <div className='px-2 md:px-6 pt-2'>\n        <div className='w-full md:max-w-4xl md:mx-auto'>\n          <div className='relative'>\n            {/* File Upload Menu - Plus button */}\n            {workspaceId && (\n              <div className='absolute left-0 z-10'>\n                <FileUploadMenu\n                  onFilesSelected={handleFilesSelected}\n                  maxFiles={4}\n                  disabled={isLoading || isUploading || uploadItems.length >= 4}\n                />\n              </div>\n            )}\n            <TiptapChatInput\n              ref={inputRef}\n              placeholder={placeholder}\n              onSend={handleSend}\n              onStop={onStop}\n              isLoading={isLoading}\n              canStop={canStop}\n              isUploading={isUploading}\n              hasAttachments={hasAttachments}\n              workspaceMembers={workspaceMembers}\n              workspaceNotes={workspaceNotes}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n});\n\nexport default ChatInput;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2791, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/chat-input/index.tsx"],"sourcesContent":["export { default as ChatInput } from './ChatInput';\nexport type { ChatInputRef } from './ChatInput';\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 2807, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/glass-card/GlassButton.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\n\nimport { Button, type ButtonProps } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\n\nexport type GlassButtonProps = ButtonProps;\n\nconst GlassButton = React.forwardRef<HTMLButtonElement, GlassButtonProps>(\n  ({ className, ...props }, ref) => (\n    <Button\n      ref={ref}\n      className={cn(\n        'bg-white/10 backdrop-blur-xl border border-black rounded-full p-2 transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:bg-white/15 hover:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] disabled:hover:shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]',\n        className\n      )}\n      {...props}\n    />\n  )\n);\n\nGlassButton.displayName = 'GlassButton';\n\nexport default GlassButton;\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AALA;;;;;AASA,MAAM,4BAAc,ucAAgB,CAClC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,keAAC,iMAAM;QACL,KAAK;QACL,WAAW,IAAA,8KAAE,EACX,uWACA;QAED,GAAG,KAAK;;;;;;AAKf,YAAY,WAAW,GAAG;uCAEX","debugId":null}},
    {"offset": {"line": 2835, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/features/workspace/components/MessageContextMenu.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useState } from 'react';\nimport { Reply, Copy, Check } from 'lucide-react';\n\ntype MessageContextMenuProps = {\n  messageText: string;\n  onReply: () => void;\n  onClose: () => void;\n  position: { x: number; y: number };\n};\n\nexport default function MessageContextMenu({\n  messageText,\n  onReply,\n  onClose,\n  position,\n}: MessageContextMenuProps) {\n  const menuRef = useRef<HTMLDivElement>(null);\n  const [copied, setCopied] = useState(false);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent | TouchEvent) => {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        onClose();\n      }\n    };\n\n    const handleEscape = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    document.addEventListener('touchstart', handleClickOutside);\n    document.addEventListener('keydown', handleEscape);\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n      document.removeEventListener('touchstart', handleClickOutside);\n      document.removeEventListener('keydown', handleEscape);\n    };\n  }, [onClose]);\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(messageText);\n      setCopied(true);\n      setTimeout(() => {\n        setCopied(false);\n        onClose();\n      }, 1000);\n    } catch (err) {\n      console.error('Failed to copy text:', err);\n      onClose();\n    }\n  };\n\n  return (\n    <div\n      ref={menuRef}\n      className='fixed z-50 bg-white/15 backdrop-blur-xl border border-black rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] overflow-hidden'\n      style={{\n        left: `${position.x}px`,\n        top: `${position.y}px`,\n      }}\n    >\n      <button\n        onClick={() => {\n          onReply();\n          onClose();\n        }}\n        className='w-full px-4 py-3 flex items-center gap-3 text-white hover:bg-white/10 transition-colors text-sm border-b border-white/10'\n      >\n        <Reply className='w-4 h-4' />\n        <span>Reply</span>\n      </button>\n      <button\n        onClick={handleCopy}\n        className='w-full px-4 py-3 flex items-center gap-3 text-white hover:bg-white/10 transition-colors text-sm'\n      >\n        {copied ? (\n          <>\n            <Check className='w-4 h-4' />\n            <span>Copied!</span>\n          </>\n        ) : (\n          <>\n            <Copy className='w-4 h-4' />\n            <span>Copy</span>\n          </>\n        )}\n      </button>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAHA;;;;AAYe,SAAS,mBAAmB,EACzC,WAAW,EACX,OAAO,EACP,OAAO,EACP,QAAQ,EACgB;IACxB,MAAM,UAAU,IAAA,mcAAM,EAAiB;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,qcAAQ,EAAC;IAErC,IAAA,scAAS,EAAC;QACR,MAAM,qBAAqB,CAAC;YAC1B,IAAI,QAAQ,OAAO,IAAI,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;gBACtE;YACF;QACF;QAEA,MAAM,eAAe,CAAC;YACpB,IAAI,MAAM,GAAG,KAAK,UAAU;gBAC1B;YACF;QACF;QAEA,SAAS,gBAAgB,CAAC,aAAa;QACvC,SAAS,gBAAgB,CAAC,cAAc;QACxC,SAAS,gBAAgB,CAAC,WAAW;QAErC,OAAO;YACL,SAAS,mBAAmB,CAAC,aAAa;YAC1C,SAAS,mBAAmB,CAAC,cAAc;YAC3C,SAAS,mBAAmB,CAAC,WAAW;QAC1C;IACF,GAAG;QAAC;KAAQ;IAEZ,MAAM,aAAa;QACjB,IAAI;YACF,MAAM,UAAU,SAAS,CAAC,SAAS,CAAC;YACpC,UAAU;YACV,WAAW;gBACT,UAAU;gBACV;YACF,GAAG;QACL,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,wBAAwB;YACtC;QACF;IACF;IAEA,qBACE,keAAC;QACC,KAAK;QACL,WAAU;QACV,OAAO;YACL,MAAM,GAAG,SAAS,CAAC,CAAC,EAAE,CAAC;YACvB,KAAK,GAAG,SAAS,CAAC,CAAC,EAAE,CAAC;QACxB;;0BAEA,keAAC;gBACC,SAAS;oBACP;oBACA;gBACF;gBACA,WAAU;;kCAEV,keAAC,kQAAK;wBAAC,WAAU;;;;;;kCACjB,keAAC;kCAAK;;;;;;;;;;;;0BAER,keAAC;gBACC,SAAS;gBACT,WAAU;0BAET,uBACC;;sCACE,keAAC,kQAAK;4BAAC,WAAU;;;;;;sCACjB,keAAC;sCAAK;;;;;;;iDAGR;;sCACE,keAAC,+PAAI;4BAAC,WAAU;;;;;;sCAChB,keAAC;sCAAK;;;;;;;;;;;;;;;;;;;AAMlB","debugId":null}},
    {"offset": {"line": 2975, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/features/workspace/components/MessageFiles.tsx"],"sourcesContent":["'use client';\n\nimport Image from 'next/image';\nimport { useState, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport {\n  Image as ImageIcon,\n  File as FileIcon,\n  Download,\n  X,\n} from 'lucide-react';\nimport { createClient } from '@/lib/supabase/browserClient';\n\nconst supabase = createClient();\nconst WORKSPACE_FILES_BUCKET = 'workspace-files';\n\nexport interface MessageFile {\n  id: number; // bigint (database primary key from workspace_files)\n  original_filename: string;\n  file_path: string; // Contains UUID in path: {workspace_id}/uploads/{uuid}/{filename}\n  mime_type: string;\n  file_size: number;\n}\n\ntype MessageFilesProps = {\n  files: MessageFile[];\n};\n\nconst isImage = (mimeType: string): boolean => {\n  return mimeType.startsWith('image/');\n};\n\nexport default function MessageFiles({ files }: MessageFilesProps) {\n  const [selectedImage, setSelectedImage] = useState<string | null>(null);\n  const [imageUrls, setImageUrls] = useState<Map<number, string>>(new Map());\n  const [loadingImages, setLoadingImages] = useState<Set<number>>(new Set());\n  const loadedFilesRef = useRef<Set<number>>(new Set());\n  const loadingFilesRef = useRef<Set<number>>(new Set());\n  const [mounted, setMounted] = useState(false);\n\n  // Ensure component is mounted before using portal (SSR safety)\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // Pre-load image URLs when component mounts or files change\n  useEffect(() => {\n    const loadImageUrls = async () => {\n      const imageFiles = files.filter(file => isImage(file.mime_type));\n\n      for (const file of imageFiles) {\n        // Skip if already loaded or loading\n        if (\n          loadedFilesRef.current.has(file.id) ||\n          loadingFilesRef.current.has(file.id)\n        ) {\n          continue;\n        }\n\n        loadingFilesRef.current.add(file.id);\n        setLoadingImages(prev => new Set(prev).add(file.id));\n\n        try {\n          // Get signed URL for private bucket (valid for 1 hour)\n          const { data: signedUrlData, error: signedUrlError } =\n            await supabase.storage\n              .from(WORKSPACE_FILES_BUCKET)\n              .createSignedUrl(file.file_path, 3600);\n\n          if (!signedUrlError && signedUrlData?.signedUrl) {\n            loadedFilesRef.current.add(file.id);\n            setImageUrls(prev =>\n              new Map(prev).set(file.id, signedUrlData.signedUrl)\n            );\n          }\n        } catch (error) {\n          console.error('Error loading image URL:', error);\n        } finally {\n          loadingFilesRef.current.delete(file.id);\n          setLoadingImages(prev => {\n            const next = new Set(prev);\n            next.delete(file.id);\n            return next;\n          });\n        }\n      }\n    };\n\n    loadImageUrls();\n  }, [files]);\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  // Lock body scroll when image is open\n  useEffect(() => {\n    if (selectedImage) {\n      // Lock body scroll\n      document.body.style.overflow = 'hidden';\n      return () => {\n        // Unlock body scroll when modal closes\n        document.body.style.overflow = '';\n      };\n    }\n  }, [selectedImage]);\n\n  const handleImageClick = async (file: MessageFile) => {\n    if (!imageUrls.has(file.id)) {\n      try {\n        // Get signed URL for private bucket (valid for 1 hour)\n        const { data: signedUrlData, error: signedUrlError } =\n          await supabase.storage\n            .from(WORKSPACE_FILES_BUCKET)\n            .createSignedUrl(file.file_path, 3600);\n\n        if (signedUrlError) {\n          console.error('Error creating signed URL:', signedUrlError);\n          return;\n        }\n\n        if (signedUrlData?.signedUrl) {\n          setImageUrls(prev =>\n            new Map(prev).set(file.id, signedUrlData.signedUrl)\n          );\n          setSelectedImage(signedUrlData.signedUrl);\n        }\n      } catch (error) {\n        console.error('Error loading image:', error);\n      }\n    } else {\n      setSelectedImage(imageUrls.get(file.id) || null);\n    }\n  };\n\n  const handleDownload = async (file: MessageFile) => {\n    try {\n      // Get signed URL for private bucket (valid for 1 hour)\n      const { data: signedUrlData, error: signedUrlError } =\n        await supabase.storage\n          .from(WORKSPACE_FILES_BUCKET)\n          .createSignedUrl(file.file_path, 3600);\n\n      if (signedUrlError) {\n        console.error('Error creating signed URL:', signedUrlError);\n        alert('Failed to download file. Please try again.');\n        return;\n      }\n\n      if (signedUrlData?.signedUrl) {\n        const link = document.createElement('a');\n        link.href = signedUrlData.signedUrl;\n        link.download = file.original_filename;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n    } catch (error) {\n      console.error('Error downloading file:', error);\n      alert('Failed to download file. Please try again.');\n    }\n  };\n\n  if (files.length === 0) return null;\n\n  // Separate files into images and non-images\n  const imageFiles = files.filter(file => isImage(file.mime_type));\n  const nonImageFiles = files.filter(file => !isImage(file.mime_type));\n\n  return (\n    <>\n      <div className='space-y-2 inline-block'>\n        {/* Non-image files - vertical layout */}\n        {nonImageFiles.length > 0 && (\n          <div className='flex flex-col gap-2'>\n            {nonImageFiles.map(file => (\n              <div key={file.id} className='relative group overflow-hidden'>\n                <div className='flex items-center gap-2 bg-white/13 backdrop-blur-xl border border-black rounded-3xl px-4 py-2.5 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:bg-white/16 transition-all min-w-0'>\n                  <FileIcon className='w-5 h-5 text-white/60 flex-shrink-0' />\n                  <div className='flex-1 min-w-0 overflow-hidden'>\n                    <p\n                      className='text-sm text-white truncate'\n                      title={file.original_filename}\n                    >\n                      {file.original_filename}\n                    </p>\n                    <p className='text-xs text-white/40 truncate'>\n                      {formatFileSize(file.file_size)}\n                    </p>\n                  </div>\n                  <button\n                    onClick={() => handleDownload(file)}\n                    className='ml-2 p-1.5 rounded-md hover:bg-white/10 transition-colors flex-shrink-0'\n                    aria-label='Download file'\n                  >\n                    <Download className='w-4 h-4 text-white/60' />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Image files - horizontal wrapping layout */}\n        {imageFiles.length > 0 && (\n          <div className='flex flex-wrap gap-2'>\n            {imageFiles.map(file => {\n              const imageUrl = imageUrls.get(file.id);\n\n              return (\n                <div key={file.id} className='relative group cursor-pointer'>\n                  <div\n                    data-image-clickable\n                    onClick={() => handleImageClick(file)}\n                    onTouchEnd={e => {\n                      // Prevent parent touch handlers from interfering\n                      e.stopPropagation();\n                      // Don't prevent default here - let the click happen naturally\n                      handleImageClick(file);\n                    }}\n                    onTouchStart={e => {\n                      // Stop propagation to prevent parent swipe handlers\n                      e.stopPropagation();\n                    }}\n                    onPointerDown={e => {\n                      // Ensure pointer events work on mobile\n                      e.stopPropagation();\n                    }}\n                    className='relative w-32 h-32 rounded-lg overflow-hidden border border-white/10 bg-white/5 hover:border-white/20 transition-all'\n                    style={{\n                      touchAction: 'manipulation',\n                      WebkitTapHighlightColor: 'transparent',\n                    }}\n                  >\n                    {imageUrl ? (\n                      <Image\n                        src={imageUrl}\n                        alt={file.original_filename}\n                        fill\n                        sizes='128px'\n                        className='object-cover pointer-events-none select-none'\n                        draggable={false}\n                        loading='lazy'\n                      />\n                    ) : loadingImages.has(file.id) ? (\n                      <div className='w-full h-full flex items-center justify-center'>\n                        <div className='animate-spin rounded-full h-6 w-6 border-b-2 border-white/40'></div>\n                      </div>\n                    ) : (\n                      <div className='w-full h-full flex items-center justify-center'>\n                        <ImageIcon className='w-8 h-8 text-white/40' />\n                      </div>\n                    )}\n                    <div className='absolute inset-0 bg-black/0 hover:bg-black/20 transition-colors flex items-center justify-center pointer-events-none'>\n                      <ImageIcon className='w-6 h-6 text-white/60 opacity-0 group-hover:opacity-100 transition-opacity' />\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Full Screen Image View - Rendered via Portal to document.body */}\n      {mounted &&\n        selectedImage &&\n        createPortal(\n          <div\n            className='fixed inset-0 z-[9999] bg-black'\n            style={{\n              position: 'fixed',\n              top: 0,\n              left: 0,\n              right: 0,\n              bottom: 0,\n              width: '100vw',\n              height: '100vh',\n            }}\n            onClick={() => setSelectedImage(null)}\n          >\n            <button\n              onClick={() => setSelectedImage(null)}\n              className='absolute top-4 right-4 z-10 w-10 h-10 rounded-full bg-black/60 hover:bg-black/80 flex items-center justify-center transition-colors'\n              aria-label='Close image'\n            >\n              <X className='w-5 h-5 text-white' />\n            </button>\n            <div\n              className='relative w-full h-full'\n              style={{ width: '100vw', height: '100vh' }}\n              onClick={e => e.stopPropagation()}\n            >\n              <Image\n                src={selectedImage}\n                alt='Preview'\n                fill\n                sizes='100vw'\n                className='object-contain'\n                priority\n              />\n            </div>\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3364, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/TiptapRenderer.tsx"],"sourcesContent":["'use client';\n\nimport { useEditor, EditorContent } from '@tiptap/react';\nimport { useTiptapExtensions } from './extensions/useTiptapExtensions';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note } from '@/types/note';\nimport type { WorkspaceFile } from '@/lib/api/workspaceFilesApi';\n\ninterface TiptapRendererProps {\n  content: string;\n  contentType?: 'markdown' | 'json';\n  className?: string;\n  enableMemberMentions?: boolean;\n  enableNoteMentions?: boolean;\n  enableFileMentions?: boolean;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n  workspaceFiles?: WorkspaceFile[];\n  onMentionClick?: (memberId: number) => void;\n  onNoteMentionClick?: (noteId: number) => void;\n  onFileMentionClick?: (fileId: number) => void;\n}\n\n/**\n * TiptapRenderer - Displays TipTap content in read-only mode\n * Used for rendering messages, previews, etc.\n */\nexport function TiptapRenderer({\n  content,\n  contentType = 'markdown',\n  className = '',\n  enableMemberMentions = false,\n  enableNoteMentions = false,\n  workspaceMembers = [],\n  workspaceNotes = [],\n  workspaceFiles = [],\n  onMentionClick,\n  onNoteMentionClick,\n  onFileMentionClick,\n}: TiptapRendererProps) {\n  const extensions = useTiptapExtensions({\n    mode: 'readonly',\n    enableMemberMentions,\n    enableNoteMentions,\n    workspaceMembers,\n    workspaceNotes,\n  });\n\n  const editor = useEditor({\n    immediatelyRender: false,\n    extensions,\n    content: content || '',\n    contentType: contentType,\n    editable: false,\n    editorProps: {\n      attributes: {\n        class: `tiptap-renderer ${className}`,\n      },\n      handleClickOn: (view, pos, node, nodePos, event) => {\n        // Handle mention clicks\n        if (node.type.name === 'mention' && onMentionClick) {\n          const memberId = node.attrs.workspaceMemberId;\n          if (memberId) {\n            event.preventDefault();\n            onMentionClick(memberId);\n          }\n          return true;\n        }\n        // Handle note mention clicks\n        if (node.type.name === 'noteMention' && onNoteMentionClick) {\n          const noteId = node.attrs.noteId;\n          if (noteId) {\n            event.preventDefault();\n            onNoteMentionClick(noteId);\n          }\n          return true;\n        }\n        // Handle file mention clicks\n        if (node.type.name === 'fileMention' && onFileMentionClick) {\n          const fileId = node.attrs.fileId;\n          if (fileId) {\n            event.preventDefault();\n            onFileMentionClick(fileId);\n          }\n          return true;\n        }\n        return false;\n      },\n    },\n  });\n\n  if (!editor) {\n    return null;\n  }\n\n  return <EditorContent editor={editor} />;\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AA2BO,SAAS,eAAe,EAC7B,OAAO,EACP,cAAc,UAAU,EACxB,YAAY,EAAE,EACd,uBAAuB,KAAK,EAC5B,qBAAqB,KAAK,EAC1B,mBAAmB,EAAE,EACrB,iBAAiB,EAAE,EACnB,iBAAiB,EAAE,EACnB,cAAc,EACd,kBAAkB,EAClB,kBAAkB,EACE;IACpB,MAAM,aAAa,IAAA,4OAAmB,EAAC;QACrC,MAAM;QACN;QACA;QACA;QACA;IACF;IAEA,MAAM,SAAS,IAAA,+aAAS,EAAC;QACvB,mBAAmB;QACnB;QACA,SAAS,WAAW;QACpB,aAAa;QACb,UAAU;QACV,aAAa;YACX,YAAY;gBACV,OAAO,CAAC,gBAAgB,EAAE,WAAW;YACvC;YACA,eAAe,CAAC,MAAM,KAAK,MAAM,SAAS;gBACxC,wBAAwB;gBACxB,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,aAAa,gBAAgB;oBAClD,MAAM,WAAW,KAAK,KAAK,CAAC,iBAAiB;oBAC7C,IAAI,UAAU;wBACZ,MAAM,cAAc;wBACpB,eAAe;oBACjB;oBACA,OAAO;gBACT;gBACA,6BAA6B;gBAC7B,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,iBAAiB,oBAAoB;oBAC1D,MAAM,SAAS,KAAK,KAAK,CAAC,MAAM;oBAChC,IAAI,QAAQ;wBACV,MAAM,cAAc;wBACpB,mBAAmB;oBACrB;oBACA,OAAO;gBACT;gBACA,6BAA6B;gBAC7B,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,iBAAiB,oBAAoB;oBAC1D,MAAM,SAAS,KAAK,KAAK,CAAC,MAAM;oBAChC,IAAI,QAAQ;wBACV,MAAM,cAAc;wBACpB,mBAAmB;oBACrB;oBACA,OAAO;gBACT;gBACA,OAAO;YACT;QACF;IACF;IAEA,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IAEA,qBAAO,keAAC,mbAAa;QAAC,QAAQ;;;;;;AAChC","debugId":null}},
    {"offset": {"line": 3440, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/features/workspace/components/WorkspaceMessageItem.tsx"],"sourcesContent":["import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport type { WorkspaceMessage } from '@/types/workspace';\nimport { format } from 'date-fns';\nimport { User, Reply } from 'lucide-react';\nimport { useState, useRef, useEffect, useCallback, useMemo } from 'react';\nimport { useDrag } from '@use-gesture/react';\nimport MessageContextMenu from './MessageContextMenu';\nimport MessageFiles from './MessageFiles';\nimport { TiptapRenderer } from '@/components/tiptap/TiptapRenderer';\nimport type { WorkspaceMember } from '@/types/workspace';\nimport type { Note } from '@/types/note';\n\ntype Props = {\n  message: WorkspaceMessage;\n  isOwnMessage: boolean;\n  onReply?: (messageId: number) => void;\n  onJumpToMessage?: (messageId: number) => void;\n  isHighlighted?: boolean;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n};\n\nfunction ReadStatus({ readCount }: { readCount: number }) {\n  if (readCount <= 0) return null;\n\n  return <p className='text-xs text-gray-500 mt-1'>Read {readCount}</p>;\n}\n\nexport default function WorkspaceMessageItem({\n  message,\n  isOwnMessage,\n  onReply,\n  onJumpToMessage,\n  isHighlighted = false,\n  workspaceMembers = [],\n  workspaceNotes = [],\n}: Props) {\n  const [contextMenu, setContextMenu] = useState<{\n    x: number;\n    y: number;\n  } | null>(null);\n  const [swipeOffset, setSwipeOffset] = useState(0);\n  const [showSwipeIndicator, setShowSwipeIndicator] = useState(false);\n  const messageRef = useRef<HTMLDivElement>(null);\n  const longPressTimer = useRef<NodeJS.Timeout | null>(null);\n  const dragTargetRef = useRef<HTMLElement | null>(null);\n  const startedOnRepliedPreviewRef = useRef(false);\n  const pointerStartRef = useRef<{ x: number; y: number } | null>(null);\n\n  // Close context menu on scroll\n  useEffect(() => {\n    const handleScroll = () => setContextMenu(null);\n    window.addEventListener('scroll', handleScroll, true);\n    return () => window.removeEventListener('scroll', handleScroll, true);\n  }, []);\n\n  // Cleanup long press timer on unmount\n  useEffect(() => {\n    return () => {\n      if (longPressTimer.current) {\n        clearTimeout(longPressTimer.current);\n      }\n    };\n  }, []);\n\n  // Handle right-click (desktop)\n  const handleContextMenu = (e: React.MouseEvent) => {\n    e.preventDefault();\n    setContextMenu({ x: e.clientX, y: e.clientY });\n  };\n\n  const handleReply = useCallback(() => {\n    if (onReply) {\n      onReply(message.id);\n    }\n    setContextMenu(null);\n  }, [onReply, message.id]);\n\n  const cancelLongPress = useCallback(() => {\n    if (longPressTimer.current) {\n      clearTimeout(longPressTimer.current);\n      longPressTimer.current = null;\n    }\n  }, []);\n\n  const scheduleLongPress = useCallback(() => {\n    cancelLongPress();\n    longPressTimer.current = setTimeout(() => {\n      const rect = messageRef.current?.getBoundingClientRect();\n      if (rect) {\n        setContextMenu({\n          x: Math.min(rect.right - 150, window.innerWidth - 200),\n          y: rect.top,\n        });\n      }\n    }, 500);\n  }, [cancelLongPress]);\n\n  const handlePointerDown = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>) => {\n      dragTargetRef.current = event.target as HTMLElement;\n      pointerStartRef.current = { x: event.clientX, y: event.clientY };\n      startedOnRepliedPreviewRef.current =\n        dragTargetRef.current?.closest('[data-replied-preview]') !== null;\n\n      if (!startedOnRepliedPreviewRef.current) {\n        scheduleLongPress();\n      }\n    },\n    [scheduleLongPress]\n  );\n\n  const handlePointerMove = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>) => {\n      const start = pointerStartRef.current;\n      if (!start) return;\n\n      const deltaX = Math.abs(event.clientX - start.x);\n      const deltaY = Math.abs(event.clientY - start.y);\n\n      if (deltaX > 6 || deltaY > 6) {\n        cancelLongPress();\n      }\n    },\n    [cancelLongPress]\n  );\n\n  const resetPointerState = useCallback(() => {\n    cancelLongPress();\n    pointerStartRef.current = null;\n    dragTargetRef.current = null;\n    startedOnRepliedPreviewRef.current = false;\n  }, [cancelLongPress]);\n\n  const handlePointerUp = useCallback(() => {\n    resetPointerState();\n  }, [resetPointerState]);\n\n  const handlePointerCancel = useCallback(() => {\n    resetPointerState();\n    setSwipeOffset(0);\n    setShowSwipeIndicator(false);\n  }, [resetPointerState]);\n\n  type DragHandlerType = Parameters<typeof useDrag>[0];\n\n  const dragHandler = useCallback<DragHandlerType>(\n    state => {\n      const { first, last, movement, tap, event } = state;\n      const movementX = movement[0] ?? 0;\n\n      if (first) {\n        cancelLongPress();\n      }\n\n      const startedOnPreview = startedOnRepliedPreviewRef.current;\n\n      if (last) {\n        const clampedMovement = Math.min(movementX, 0);\n        const swipeDistance = Math.abs(clampedMovement);\n\n        setSwipeOffset(0);\n        setShowSwipeIndicator(false);\n\n        if (\n          tap &&\n          startedOnPreview &&\n          onJumpToMessage &&\n          message.replied_message?.id\n        ) {\n          const nativeEvent = event as Event;\n          if (typeof nativeEvent.stopPropagation === 'function') {\n            nativeEvent.stopPropagation();\n          }\n          onJumpToMessage(message.replied_message.id);\n        } else if (swipeDistance >= 60 && onReply) {\n          handleReply();\n        }\n\n        resetPointerState();\n        return;\n      }\n\n      const clampedMovement = Math.min(movementX, 0);\n\n      if (clampedMovement < 0) {\n        const limitedMovement = Math.max(clampedMovement, -120);\n        setSwipeOffset(limitedMovement);\n        setShowSwipeIndicator(Math.abs(limitedMovement) > 20);\n      } else {\n        setSwipeOffset(0);\n        setShowSwipeIndicator(false);\n      }\n    },\n    [\n      cancelLongPress,\n      handleReply,\n      message.replied_message?.id,\n      onJumpToMessage,\n      onReply,\n      resetPointerState,\n    ]\n  );\n\n  const bindDrag = useDrag(dragHandler, {\n    axis: 'x',\n    filterTaps: true,\n    threshold: 10,\n    preventScroll: false,\n  });\n\n  const dragBindings = bindDrag();\n\n  const gestureBindings = useMemo(() => {\n    return {\n      ...dragBindings,\n      onPointerDown: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerDown(event);\n        dragBindings.onPointerDown?.(event);\n      },\n      onPointerMove: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerMove(event);\n        dragBindings.onPointerMove?.(event);\n      },\n      onPointerUp: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerUp();\n        dragBindings.onPointerUp?.(event);\n      },\n      onPointerCancel: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerCancel();\n        dragBindings.onPointerCancel?.(event);\n      },\n      onPointerLeave: (event: React.PointerEvent<HTMLDivElement>) => {\n        handlePointerCancel();\n        dragBindings.onPointerLeave?.(event);\n      },\n    };\n  }, [\n    dragBindings,\n    handlePointerCancel,\n    handlePointerDown,\n    handlePointerMove,\n    handlePointerUp,\n  ]);\n\n  if (!message) return null;\n\n  const profile = message.workspace_member?.user_profile ?? null;\n  const name = profile?.name ?? 'Unknown';\n  const avatarUrl = profile?.avatar_url ?? '';\n  const readCount = message.read_count ?? message.reads?.length ?? 0;\n\n  const RepliedMessagePreview = ({\n    repliedMessage,\n  }: {\n    repliedMessage: WorkspaceMessage;\n  }) => {\n    const repliedProfile = repliedMessage.workspace_member?.user_profile;\n    const repliedName = repliedProfile?.name ?? 'Unknown';\n    const repliedText =\n      repliedMessage.text.slice(0, 100) +\n      (repliedMessage.text.length > 100 ? '...' : '');\n\n    // Desktop click handler\n    const handleClick = (e: React.MouseEvent) => {\n      e.stopPropagation();\n      if (onJumpToMessage && repliedMessage.id) {\n        onJumpToMessage(repliedMessage.id);\n      }\n    };\n\n    return (\n      <div\n        data-replied-preview\n        className='mb-2 border-white/20 cursor-pointer hover:bg-white/5 rounded transition-colors'\n        onClick={handleClick}\n        style={{ pointerEvents: 'auto' }}\n      >\n        <div className='flex items-start gap-2'>\n          <Avatar className='h-6 w-6 border border-white/15 bg-white/10 text-[10px] font-medium flex-shrink-0'>\n            {repliedProfile?.avatar_url ? (\n              <AvatarImage src={repliedProfile.avatar_url} alt={repliedName} />\n            ) : (\n              <AvatarFallback>\n                <User className='h-3.5 w-3.5' />\n              </AvatarFallback>\n            )}\n          </Avatar>\n          <div className='min-w-0 flex-1'>\n            <p className='text-xs text-white/50 mb-1'>{repliedName}</p>\n            <div className='text-xs text-white/40'>\n              <TiptapRenderer\n                content={repliedText}\n                contentType='markdown'\n                enableMemberMentions={true}\n                enableNoteMentions={true}\n                workspaceMembers={workspaceMembers}\n                workspaceNotes={workspaceNotes}\n                className='tiptap-reply-preview'\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  if (isOwnMessage) {\n    // Own messages on the right (ChatGPT style)\n    return (\n      <>\n        <div\n          ref={messageRef}\n          data-message-id={message.id}\n          className={`flex justify-end items-end w-full relative transition-transform duration-300 ${\n            isHighlighted ? 'animate-bounce-x-right' : ''\n          }`}\n          onContextMenu={handleContextMenu}\n          style={{ userSelect: 'none', WebkitUserSelect: 'none' }}\n          {...gestureBindings}\n        >\n          {/* Reply icon indicator on the right side */}\n          {showSwipeIndicator && (\n            <div\n              className='absolute right-0 top-1/2 -translate-y-1/2 flex items-center transition-opacity duration-200 z-10'\n              style={{\n                opacity: showSwipeIndicator ? 1 : 0,\n              }}\n            >\n              <Reply className='w-5 h-5 text-white/60' />\n            </div>\n          )}\n          <div\n            className='flex gap-2 items-end justify-end min-w-0 max-w-full relative transition-transform duration-75'\n            style={{\n              transform: `translateX(${swipeOffset}px)`,\n            }}\n          >\n            <div className='flex flex-col justify-end flex-shrink-0'>\n              <div className='text-right'>\n                <ReadStatus readCount={readCount} />\n              </div>\n              <p className='text-xs text-gray-500 text-right'>\n                {format(new Date(message.created_at), 'HH:mm')}\n              </p>\n            </div>\n            <div className='flex flex-col gap-2 items-end'>\n              {(message.text || message.replied_message) && (\n                <div className='inline-block bg-white/13 backdrop-blur-xl border border-black rounded-3xl px-4 py-2.5 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'>\n                  {message.replied_message && (\n                    <RepliedMessagePreview\n                      repliedMessage={message.replied_message}\n                    />\n                  )}\n                  {message.text && (\n                    <div className='text-sm text-white'>\n                      <TiptapRenderer\n                        content={message.text}\n                        contentType='markdown'\n                        enableMemberMentions={true}\n                        enableNoteMentions={true}\n                        workspaceMembers={workspaceMembers}\n                        workspaceNotes={workspaceNotes}\n                        className='tiptap-message-content'\n                      />\n                    </div>\n                  )}\n                </div>\n              )}\n              {message.files && message.files.length > 0 && (\n                <MessageFiles files={message.files} />\n              )}\n            </div>\n          </div>\n        </div>\n        {contextMenu && (\n          <MessageContextMenu\n            messageText={message.text}\n            onReply={handleReply}\n            onClose={() => setContextMenu(null)}\n            position={contextMenu}\n          />\n        )}\n      </>\n    );\n  }\n\n  // Other messages on the left\n  return (\n    <>\n      <div\n        ref={messageRef}\n        data-message-id={message.id}\n        className={`flex gap-2 relative transition-transform duration-300 ${\n          isHighlighted ? 'animate-bounce-x-left' : ''\n        }`}\n        onContextMenu={handleContextMenu}\n        style={{ userSelect: 'none', WebkitUserSelect: 'none' }}\n        {...gestureBindings}\n      >\n        {/* Reply icon indicator on the right side */}\n        {showSwipeIndicator && (\n          <div\n            className='absolute right-0 top-1/2 -translate-y-1/2 flex items-center transition-opacity duration-200 z-10'\n            style={{\n              opacity: showSwipeIndicator ? 1 : 0,\n            }}\n          >\n            <Reply className='w-5 h-5 text-white/60' />\n          </div>\n        )}\n        <div\n          className='flex gap-2 flex-shrink-0 transition-transform duration-75'\n          style={{\n            transform: `translateX(${swipeOffset}px)`,\n          }}\n        >\n          <Avatar className='h-8 w-8 border border-white/15 bg-white/10 text-xs font-medium'>\n            {avatarUrl ? (\n              <AvatarImage src={avatarUrl} alt={name} />\n            ) : (\n              <AvatarFallback>\n                <User className='h-4 w-4' />\n              </AvatarFallback>\n            )}\n          </Avatar>\n        </div>\n        <div\n          className='flex flex-col gap-1 min-w-0 relative flex-1 transition-transform duration-75'\n          style={{\n            transform: `translateX(${swipeOffset}px)`,\n          }}\n        >\n          <p className='text-xs text-gray-400 mb-1'>{name}</p>\n          <div className='flex gap-2 items-end'>\n            <div className='flex flex-col gap-2 min-w-0'>\n              {(message.text || message.replied_message) && (\n                <div className='inline-block bg-white/8 backdrop-blur-xl border border-black rounded-3xl px-4 py-2.5 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'>\n                  {message.replied_message && (\n                    <RepliedMessagePreview\n                      repliedMessage={message.replied_message}\n                    />\n                  )}\n                  {message.text && (\n                    <div className='text-sm text-white'>\n                      <TiptapRenderer\n                        content={message.text}\n                        contentType='markdown'\n                        enableMemberMentions={true}\n                        enableNoteMentions={true}\n                        workspaceMembers={workspaceMembers}\n                        workspaceNotes={workspaceNotes}\n                        className='tiptap-message-content'\n                      />\n                    </div>\n                  )}\n                </div>\n              )}\n              {message.files && message.files.length > 0 && (\n                <MessageFiles files={message.files} />\n              )}\n            </div>\n            <p className='text-xs text-gray-500 mt-1'>\n              {format(new Date(message.created_at), 'HH:mm')}\n            </p>\n          </div>\n        </div>\n      </div>\n      {contextMenu && (\n        <MessageContextMenu\n          messageText={message.text}\n          onReply={handleReply}\n          onClose={() => setContextMenu(null)}\n          position={contextMenu}\n        />\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4088, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/features/workspace/components/WorkspaceMessageList.tsx"],"sourcesContent":["import type { WorkspaceMessage, WorkspaceMember } from '@/types/workspace';\nimport WorkspaceMessageItem from '@/features/workspace/components/WorkspaceMessageItem';\nimport type { Note } from '@/types/note';\n\ntype Props = {\n  messages: WorkspaceMessage[];\n  currentUserId: string;\n  onReply?: (messageId: number) => void;\n  onJumpToMessage?: (messageId: number) => void;\n  highlightedMessageId?: number | null;\n  workspaceMembers?: WorkspaceMember[];\n  workspaceNotes?: Note[];\n};\n\nexport default function WorkspaceMessageList({\n  messages,\n  currentUserId,\n  onReply,\n  onJumpToMessage,\n  highlightedMessageId,\n  workspaceMembers = [],\n  workspaceNotes = [],\n}: Props) {\n  if (messages.length === 0) {\n    return (\n      <div className='flex-1 flex items-center justify-center'>\n        <div className='text-center'>\n          <p className='text-gray-400'>\n            No messages yet. Start the conversation!\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className='flex flex-col gap-3'>\n      {messages\n        .filter(message => message != null)\n        .map(message => (\n          <WorkspaceMessageItem\n            key={message.id}\n            message={message}\n            isOwnMessage={currentUserId === message.workspace_member?.user_id}\n            onReply={onReply}\n            onJumpToMessage={onJumpToMessage}\n            isHighlighted={highlightedMessageId === message.id}\n            workspaceMembers={workspaceMembers}\n            workspaceNotes={workspaceNotes}\n          />\n        ))}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;;;AAae,SAAS,qBAAqB,EAC3C,QAAQ,EACR,aAAa,EACb,OAAO,EACP,eAAe,EACf,oBAAoB,EACpB,mBAAmB,EAAE,EACrB,iBAAiB,EAAE,EACb;IACN,IAAI,SAAS,MAAM,KAAK,GAAG;QACzB,qBACE,keAAC;YAAI,WAAU;sBACb,cAAA,keAAC;gBAAI,WAAU;0BACb,cAAA,keAAC;oBAAE,WAAU;8BAAgB;;;;;;;;;;;;;;;;IAMrC;IAEA,qBACE,keAAC;QAAI,WAAU;kBACZ,SACE,MAAM,CAAC,CAAA,UAAW,WAAW,MAC7B,GAAG,CAAC,CAAA,wBACH,keAAC,mOAAoB;gBAEnB,SAAS;gBACT,cAAc,kBAAkB,QAAQ,gBAAgB,EAAE;gBAC1D,SAAS;gBACT,iBAAiB;gBACjB,eAAe,yBAAyB,QAAQ,EAAE;gBAClD,kBAAkB;gBAClB,gBAAgB;eAPX,QAAQ,EAAE;;;;;;;;;;AAY3B","debugId":null}},
    {"offset": {"line": 4146, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/hooks/useWorkspace.ts"],"sourcesContent":["'use client';\n\nimport useSWR, { mutate } from 'swr';\nimport {\n  getWorkspaces,\n  getWorkspace,\n  createWorkspace,\n  updateWorkspace,\n  deleteWorkspace,\n  getWorkspaceMembers,\n} from '@/lib/api/workspaceApi';\nimport type { Workspace, WorkspaceMember } from '@/types/workspace';\n\n// SWR keys\nconst WORKSPACES_KEY = '/workspaces';\nconst workspaceKey = (id: number) => `/workspaces/${id}`;\n\n// Hooks\nexport function useWorkspaces() {\n  const { data, error, isLoading } = useSWR<Workspace[]>(\n    WORKSPACES_KEY,\n    getWorkspaces,\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  return {\n    workspaces: data,\n    isLoading,\n    error,\n  };\n}\n\nexport function useWorkspace(id: number | null) {\n  const { data, error, isLoading } = useSWR<Workspace>(\n    id ? workspaceKey(id) : null,\n    () => getWorkspace(id!),\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  return {\n    workspace: data,\n    isLoading,\n    error,\n  };\n}\n\nexport function useWorkspaceMembers(workspaceId: number | null) {\n  const { data, error, isLoading } = useSWR<WorkspaceMember[]>(\n    workspaceId ? `/workspaces/${workspaceId}/members` : null,\n    workspaceId ? async () => await getWorkspaceMembers(workspaceId) : null,\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  return {\n    members: data || [],\n    isLoading,\n    error,\n  };\n}\n\n// Mutation helpers\nexport function useWorkspaceMutations() {\n  const create = async (title: string) => {\n    const workspace = await createWorkspace(title);\n    mutate(WORKSPACES_KEY); // Revalidate list\n    return workspace;\n  };\n\n  const update = async (\n    id: number,\n    updates: Partial<Pick<Workspace, 'title' | 'type' | 'icon_url'>>\n  ) => {\n    const workspace = await updateWorkspace(id, updates);\n    mutate(workspaceKey(id)); // Revalidate specific workspace\n    mutate(WORKSPACES_KEY); // Revalidate list\n    return workspace;\n  };\n\n  const remove = async (id: number) => {\n    await deleteWorkspace(id);\n    mutate(WORKSPACES_KEY); // Revalidate list\n  };\n\n  return { create, update, remove };\n}\n"],"names":[],"mappings":";;;;;;;;;;AAEA;AAAA;AACA;AAHA;;;AAaA,WAAW;AACX,MAAM,iBAAiB;AACvB,MAAM,eAAe,CAAC,KAAe,CAAC,YAAY,EAAE,IAAI;AAGjD,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,qRAAM,EACvC,gBACA,uMAAa,EACb;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,OAAO;QACL,YAAY;QACZ;QACA;IACF;AACF;AAEO,SAAS,aAAa,EAAiB;IAC5C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,qRAAM,EACvC,KAAK,aAAa,MAAM,MACxB,IAAM,IAAA,sMAAY,EAAC,KACnB;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,OAAO;QACL,WAAW;QACX;QACA;IACF;AACF;AAEO,SAAS,oBAAoB,WAA0B;IAC5D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,qRAAM,EACvC,cAAc,CAAC,YAAY,EAAE,YAAY,QAAQ,CAAC,GAAG,MACrD,cAAc,UAAY,MAAM,IAAA,6MAAmB,EAAC,eAAe,MACnE;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,OAAO;QACL,SAAS,QAAQ,EAAE;QACnB;QACA;IACF;AACF;AAGO,SAAS;IACd,MAAM,SAAS,OAAO;QACpB,MAAM,YAAY,MAAM,IAAA,yMAAe,EAAC;QACxC,IAAA,yUAAM,EAAC,iBAAiB,kBAAkB;QAC1C,OAAO;IACT;IAEA,MAAM,SAAS,OACb,IACA;QAEA,MAAM,YAAY,MAAM,IAAA,yMAAe,EAAC,IAAI;QAC5C,IAAA,yUAAM,EAAC,aAAa,MAAM,gCAAgC;QAC1D,IAAA,yUAAM,EAAC,iBAAiB,kBAAkB;QAC1C,OAAO;IACT;IAEA,MAAM,SAAS,OAAO;QACpB,MAAM,IAAA,yMAAe,EAAC;QACtB,IAAA,yUAAM,EAAC,iBAAiB,kBAAkB;IAC5C;IAEA,OAAO;QAAE;QAAQ;QAAQ;IAAO;AAClC","debugId":null}},
    {"offset": {"line": 4224, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/app/%28private%29/workspace/%5Bid%5D/chat/page.tsx"],"sourcesContent":["'use client';\n\nimport { useParams } from 'next/navigation';\nimport { useEffect, useRef, useState, useCallback } from 'react';\nimport { useWorkspaceChat } from '@/hooks/useWorkspaceChat';\nimport { createClient } from '@/lib/supabase/browserClient';\nimport { ChatInput, type ChatInputRef } from '@/components/chat-input';\nimport GlassButton from '@/components/glass-card/GlassButton';\nimport WorkspaceMessageList from '@/features/workspace/components/WorkspaceMessageList';\nimport { ChevronDown } from 'lucide-react';\nimport { useCopilotReadable } from '@copilotkit/react-core';\nimport { useWorkspaceMembers } from '@/hooks/useWorkspace';\nimport { useWorkspaceNotes } from '@/hooks/useWorkspaceNotes';\n\nexport default function WorkspaceChatPage() {\n  const params = useParams();\n  const workspaceId = parseInt(params.id as string);\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n  const [showScrollButton, setShowScrollButton] = useState(false);\n  const prevMessageCountRef = useRef(0);\n  const isUserScrollingRef = useRef(false);\n  const scrollTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isLoadingMoreRef = useRef(false);\n  const prevScrollHeightRef = useRef(0);\n  const lastScrollTopRef = useRef(0);\n  const hasScrolledUpRef = useRef(false);\n  const prevMessagesRef = useRef<typeof messages>([]);\n  const chatInputRef = useRef<ChatInputRef>(null);\n  const [highlightedMessageId, setHighlightedMessageId] = useState<\n    number | null\n  >(null);\n  const [replyingTo, setReplyingTo] = useState<{\n    id: number;\n    text: string;\n    authorName?: string;\n  } | null>(null);\n  const {\n    messages,\n    sendMessage: originalSendMessage,\n    isLoading,\n    isLoadingMore,\n    error,\n    isConnected,\n    loadMoreMessages,\n    hasMoreMessages,\n  } = useWorkspaceChat(workspaceId);\n\n  // Fetch workspace members for mentions\n  const { members } = useWorkspaceMembers(workspaceId);\n\n  // Fetch workspace notes for note mentions\n  const { notes: workspaceNotes } = useWorkspaceNotes(workspaceId);\n\n  useCopilotReadable({\n    description: 'workspace chat history',\n    value: messages\n      .slice(-20)\n      .map(message => message.text)\n      .join('\\n'),\n    categories: ['workspace_chat'],\n  });\n\n  // Scroll to bottom function\n  // Note: With column-reverse, bottom is at scrollTop = 0\n  const scrollToBottom = useCallback((behavior: ScrollBehavior = 'smooth') => {\n    if (scrollContainerRef.current) {\n      scrollContainerRef.current.scrollTo({\n        top: 0,\n        behavior,\n      });\n    }\n  }, []);\n\n  // Track when we send a message to avoid conflicts with useEffect scroll logic\n  const sendingMessageRef = useRef(false);\n\n  // Wrap sendMessage to scroll to bottom after sending\n  const sendMessage = useCallback(\n    async (\n      text: string,\n      workspaceFileIds?: number[],\n      mentionedMemberIds?: number[],\n      mentionedNoteIds?: number[]\n    ) => {\n      sendingMessageRef.current = true;\n      const replyToId = replyingTo?.id ?? null;\n      try {\n        await originalSendMessage(\n          text,\n          replyToId,\n          workspaceFileIds,\n          mentionedMemberIds,\n          mentionedNoteIds\n        );\n        // Clear reply state after sending\n        setReplyingTo(null);\n        // Scroll to bottom after sending message\n        // Use a delay to ensure the message is in the DOM via realtime\n        setTimeout(() => {\n          if (scrollContainerRef.current) {\n            scrollContainerRef.current.scrollTop = 0;\n          }\n          sendingMessageRef.current = false;\n        }, 100);\n      } catch (error) {\n        sendingMessageRef.current = false;\n        throw error;\n      }\n    },\n    [originalSendMessage, replyingTo]\n  );\n\n  // Handle reply action\n  const handleReply = useCallback(\n    (messageId: number) => {\n      const message = messages.find(m => m.id === messageId);\n      if (message) {\n        const authorName =\n          message.workspace_member?.user_profile?.name ?? 'Unknown';\n        setReplyingTo({\n          id: message.id,\n          text: message.text,\n          authorName,\n        });\n        // Focus input after setting reply\n        setTimeout(() => {\n          chatInputRef.current?.focus();\n        }, 100);\n      }\n    },\n    [messages]\n  );\n\n  // Cancel reply\n  const handleCancelReply = useCallback(() => {\n    setReplyingTo(null);\n  }, []);\n\n  // Scroll to a specific message by ID\n  const scrollToMessage = useCallback((messageId: number) => {\n    if (!scrollContainerRef.current) return;\n\n    // Find the message element by data attribute\n    const messageElement = scrollContainerRef.current.querySelector(\n      `[data-message-id=\"${messageId}\"]`\n    ) as HTMLElement;\n\n    if (!messageElement) return;\n\n    // Check if the message is already in view\n    const container = scrollContainerRef.current;\n    const containerRect = container.getBoundingClientRect();\n    const elementRect = messageElement.getBoundingClientRect();\n\n    // Check if element is visible within the container viewport\n    const isInView =\n      elementRect.top >= containerRect.top &&\n      elementRect.bottom <= containerRect.bottom &&\n      elementRect.left >= containerRect.left &&\n      elementRect.right <= containerRect.right;\n\n    // Only scroll if not already in view\n    if (!isInView) {\n      // Use scrollIntoView with block: 'center' to center the message\n      // This works well with column-reverse layout\n      messageElement.scrollIntoView({\n        behavior: 'smooth',\n        block: 'center',\n        inline: 'nearest',\n      });\n\n      // Trigger bounce animation after scroll has started (longer delay for scrolling)\n      setTimeout(() => {\n        setHighlightedMessageId(messageId);\n        // Clear highlight after animation completes\n        setTimeout(() => {\n          setHighlightedMessageId(null);\n        }, 600);\n      }, 300);\n    } else {\n      // Message is already in view - trigger bounce immediately\n      setHighlightedMessageId(messageId);\n      // Clear highlight after animation completes\n      setTimeout(() => {\n        setHighlightedMessageId(null);\n      }, 600);\n    }\n  }, []);\n\n  // Check if user is near bottom (within threshold)\n  // Note: With column-reverse, scrollTop 0 or positive small values are at the bottom\n  const isNearBottom = useCallback(() => {\n    if (!scrollContainerRef.current) {\n      return true;\n    }\n    const container = scrollContainerRef.current;\n    const threshold = 1000;\n    const scrollTop = container.scrollTop;\n    const scrollTopAbs = Math.abs(scrollTop);\n    // With column-reverse, bottom is at scrollTop = 0 or small positive values\n    // Negative values mean we're scrolled away from bottom (toward top)\n    const result = scrollTopAbs <= threshold;\n    return result;\n  }, []);\n\n  // Check if user is near top (within 800px - triggers earlier for faster loading)\n  // Note: With column-reverse, scrollTop can be negative, which means we're at the top\n  const isNearTop = useCallback(() => {\n    if (!scrollContainerRef.current) return false;\n    const container = scrollContainerRef.current;\n    const threshold = 800;\n\n    const scrollTop = container.scrollTop;\n    const scrollHeight = container.scrollHeight;\n    const clientHeight = container.clientHeight;\n\n    // With flex-col-reverse, negative scrollTop means we're scrolled to the top (oldest messages)\n    // This is a browser quirk with flex-col-reverse\n    // From logs: scrollTop is around -628 to -667 when scrolled up, which means we're near the top\n    if (scrollTop < 0) {\n      // If scrollTop is negative, we're scrolled up toward older messages\n      // The more negative, the more we've scrolled up\n      // Trigger if we're scrolled up significantly (absolute value > 200px threshold)\n      return Math.abs(scrollTop) > 200;\n    }\n\n    // Calculate max scroll position\n    const maxScrollTop = scrollHeight - clientHeight;\n\n    // Handle edge case where content is smaller than container\n    if (maxScrollTop <= 0) return false;\n\n    // For positive scrollTop, check if we're within threshold of the max scroll\n    const distanceFromTop = maxScrollTop - scrollTop;\n    return distanceFromTop < threshold;\n  }, []);\n\n  // Handle scroll events to show/hide button\n  useEffect(() => {\n    const container = scrollContainerRef.current;\n    if (!container) return;\n\n    const handleScroll = () => {\n      if (!scrollContainerRef.current) return;\n\n      const container = scrollContainerRef.current;\n      const currentScrollTop = container.scrollTop;\n\n      // Detect if user is scrolling up\n      // With column-reverse, increasing scrollTop means scrolling up (away from bottom)\n      if (currentScrollTop > lastScrollTopRef.current) {\n        hasScrolledUpRef.current = true;\n      }\n\n      // Reset scrolled up flag if user reaches near bottom\n      if (isNearBottom()) {\n        hasScrolledUpRef.current = false;\n      }\n\n      lastScrollTopRef.current = currentScrollTop;\n      isUserScrollingRef.current = true;\n\n      // Clear existing timeout\n      if (scrollTimeoutRef.current) {\n        clearTimeout(scrollTimeoutRef.current);\n      }\n\n      // Set timeout to detect when scrolling stops\n      scrollTimeoutRef.current = setTimeout(() => {\n        isUserScrollingRef.current = false;\n      }, 300); // Increased timeout to be more reliable\n\n      // Check if we should show the scroll button\n      const nearBottom = isNearBottom();\n      setShowScrollButton(!nearBottom);\n\n      // Check if we're near top and should load more messages\n      // With column-reverse, \"top\" (for loading older messages) is at high scrollTop values\n      const nearTop = isNearTop();\n\n      if (\n        nearTop &&\n        hasMoreMessages &&\n        !isLoadingMoreRef.current &&\n        !isLoadingMore\n      ) {\n        isLoadingMoreRef.current = true;\n        // Store current scrollHeight to restore position after loading\n        prevScrollHeightRef.current = container.scrollHeight;\n        loadMoreMessages().finally(() => {\n          isLoadingMoreRef.current = false;\n        });\n      }\n    };\n\n    container.addEventListener('scroll', handleScroll);\n    return () => {\n      container.removeEventListener('scroll', handleScroll);\n      if (scrollTimeoutRef.current) {\n        clearTimeout(scrollTimeoutRef.current);\n      }\n    };\n  }, [\n    isNearBottom,\n    isNearTop,\n    hasMoreMessages,\n    loadMoreMessages,\n    isLoadingMore,\n  ]);\n\n  // No initial scroll needed - CSS column-reverse handles it automatically!\n  // Removed useLayoutEffect and useEffect for initial scroll\n\n  // Preserve scroll position when messages change (from loading older messages or realtime updates)\n  useEffect(() => {\n    const container = scrollContainerRef.current;\n    if (!container) return;\n\n    const prevMessages = prevMessagesRef.current;\n    const messagesChanged =\n      prevMessages.length !== messages.length ||\n      (prevMessages.length > 0 &&\n        messages.length > 0 &&\n        prevMessages[0]?.id !== messages[0]?.id);\n\n    // If messages changed and user has scrolled up, preserve scroll position\n    if (messagesChanged && prevMessages.length > 0) {\n      // Case 1: Loading older messages (prepending) - preserve scroll position\n      // Check if we stored a scrollHeight and messages increased (new messages were prepended)\n      if (\n        prevScrollHeightRef.current > 0 &&\n        messages.length > prevMessages.length\n      ) {\n        // Use double requestAnimationFrame to ensure DOM has fully updated with new messages\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            if (!scrollContainerRef.current) return;\n            const container = scrollContainerRef.current;\n\n            const scrollHeightDifference =\n              container.scrollHeight - prevScrollHeightRef.current;\n\n            if (scrollHeightDifference > 0) {\n              // With flex-col-reverse, when older messages are prepended,\n              // scrollTop may be negative. We need to adjust it to maintain visual position.\n              // Since we're adding content \"above\" (which in flex-col-reverse is at higher scrollTop),\n              // we need to increase the scrollTop value (make it less negative or more positive)\n              const oldScrollTop = container.scrollTop;\n              // Adding the difference maintains the visual position\n              container.scrollTop = oldScrollTop + scrollHeightDifference;\n            }\n\n            // Reset after adjustment\n            prevScrollHeightRef.current = 0;\n          });\n        });\n        // Update prev messages after processing\n        prevMessagesRef.current = messages;\n        return; // Don't process realtime updates when loading more\n      }\n      // Case 2: Realtime update changed messages - preserve scroll if user scrolled up\n      // Skip this if we just sent a message (handled by sendMessage wrapper)\n      else if (\n        messages.length > 0 &&\n        !isLoadingMore &&\n        !sendingMessageRef.current &&\n        !isNearBottom()\n      ) {\n        // Capture scroll position before React updates DOM\n        const scrollTopToPreserve = container.scrollTop;\n\n        // Use double requestAnimationFrame to ensure DOM has fully updated\n        requestAnimationFrame(() => {\n          requestAnimationFrame(() => {\n            if (!scrollContainerRef.current) return;\n\n            // If user is still not near bottom, restore scroll position\n            if (!isNearBottom()) {\n              scrollContainerRef.current.scrollTop = scrollTopToPreserve;\n            }\n          });\n        });\n      }\n    }\n\n    // Update prev messages after processing\n    prevMessagesRef.current = messages;\n  }, [messages, isLoadingMore, isNearBottom]);\n\n  // Track message count (no auto-scroll - removed as per user request)\n  useEffect(() => {\n    prevMessageCountRef.current = messages.length;\n  }, [messages.length]);\n\n  // Get current user ID\n  const [currentUserId, setCurrentUserId] = useState<string | null>(null);\n\n  useEffect(() => {\n    const supabase = createClient();\n    supabase.auth.getUser().then(({ data: { user } }) => {\n      setCurrentUserId(user?.id || null);\n    });\n  }, []);\n\n  return (\n    <div className='flex flex-col h-full relative'>\n      {/* Error Display */}\n      {error && (\n        <div className='px-4 py-2 mb-2 bg-white/8 backdrop-blur-xl border border-black rounded-4xl text-center text-sm text-white/80 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)]'>\n          {error}\n        </div>\n      )}\n\n      {/* Messages */}\n      {/* Using flex-direction: column-reverse makes the list naturally start at bottom */}\n      <div\n        ref={scrollContainerRef}\n        className='flex-1 overflow-y-auto relative flex flex-col-reverse'\n      >\n        {/* Loading indicator for older messages - appears at top when scrolling up */}\n        {isLoadingMore && (\n          <div className='flex items-center justify-center py-4'>\n            <div className='flex items-center gap-2 text-gray-400 text-sm'>\n              <div className='animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400'></div>\n              <span>Loading older messages...</span>\n            </div>\n          </div>\n        )}\n\n        {isConnected || messages.length > 0 ? (\n          currentUserId ? (\n            <WorkspaceMessageList\n              messages={messages}\n              currentUserId={currentUserId}\n              onReply={handleReply}\n              onJumpToMessage={scrollToMessage}\n              highlightedMessageId={highlightedMessageId}\n              workspaceMembers={members}\n              workspaceNotes={workspaceNotes}\n            />\n          ) : (\n            <div className='flex-1 flex items-center justify-center'>\n              <div className='text-center'>\n                <p className='text-gray-400'>Loading...</p>\n              </div>\n            </div>\n          )\n        ) : (\n          <div className='flex-1 flex items-center justify-center'>\n            <div className='text-center'>\n              <p className='text-gray-400'>Connecting to real-time chat...</p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Scroll to Bottom Button */}\n      {showScrollButton && (\n        <div className='absolute bottom-24 right-4 z-10'>\n          <GlassButton\n            type='button'\n            onClick={() => scrollToBottom('smooth')}\n            size='icon'\n            className='size-10 hover:scale-102'\n            aria-label='Scroll to bottom'\n          >\n            <ChevronDown className='h-5 w-5' />\n          </GlassButton>\n        </div>\n      )}\n\n      {/* Input */}\n      <ChatInput\n        ref={chatInputRef}\n        onSend={sendMessage}\n        isLoading={isLoading}\n        placeholder='Message'\n        canStop={false}\n        replyingTo={replyingTo}\n        onCancelReply={handleCancelReply}\n        workspaceId={workspaceId}\n        workspaceMembers={members}\n        workspaceNotes={workspaceNotes}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}