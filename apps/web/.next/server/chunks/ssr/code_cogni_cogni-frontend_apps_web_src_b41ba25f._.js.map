{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/api/notesApi.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/browserClient';\nimport type { Note } from '@/types/note';\n\nconst supabase = createClient();\n\n/**\n * Parse note text into title and content\n * First line is title, rest is content\n */\nexport function parseNoteText(text: string): {\n  title: string;\n  content: string;\n} {\n  const lines = text.split('\\n');\n  const title = lines[0] || 'Untitled';\n  const content = lines.slice(1).join('\\n');\n  return { title, content };\n}\n\n/**\n * Combine title and content into text format for storage\n */\nexport function combineNoteText(title: string, content: string): string {\n  return `${title}\\n${content}`;\n}\n\n/**\n * Get all notes for a specific workspace with assignments\n * @param workspaceId - The workspace ID\n * @param includeDeleted - Include soft-deleted notes (default: true)\n */\nexport async function getNotes(\n  workspaceId: number,\n  includeDeleted = true\n): Promise<Note[]> {\n  let query = supabase\n    .from('notes')\n    .select(\n      `\n      *,\n      workspace_member_note(\n        workspace_member_note_role,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profiles!user_id(id, name, avatar_url)\n        )\n      )\n    `\n    )\n    .eq('workspace_id', workspaceId);\n\n  // Filter by deleted_at if not including deleted\n  if (!includeDeleted) {\n    query = query.is('deleted_at', null);\n  }\n\n  const { data, error } = await query.order('updated_at', { ascending: false });\n\n  if (error) throw error;\n\n  // Transform the nested structure to match our types\n  return (data || []).map(note => ({\n    ...note,\n    workspace_member_note: (note.workspace_member_note || []).map(\n      (assignment: { workspace_member?: { user_profiles?: unknown } }) => ({\n        ...assignment,\n        workspace_member: assignment.workspace_member\n          ? {\n              ...assignment.workspace_member,\n              user_profiles: Array.isArray(\n                assignment.workspace_member.user_profiles\n              )\n                ? assignment.workspace_member.user_profiles[0]\n                : assignment.workspace_member.user_profiles,\n            }\n          : undefined,\n      })\n    ),\n  }));\n}\n\n/**\n * Get a single note by ID\n */\nexport async function getNote(id: number): Promise<Note | null> {\n  const { data, error } = await supabase\n    .from('notes')\n    .select('*')\n    .eq('id', id)\n    .single();\n\n  if (error) {\n    if (error.code === 'PGRST116') {\n      // Not found\n      return null;\n    }\n    throw error;\n  }\n\n  return data;\n}\n\n/**\n * Create a new note\n */\nexport async function createNote(\n  workspaceId: number,\n  title: string,\n  content: string\n): Promise<Note> {\n  const text = combineNoteText(title, content);\n\n  const { data, error } = await supabase\n    .from('notes')\n    .insert({\n      workspace_id: workspaceId,\n      text,\n    })\n    .select()\n    .single();\n\n  if (error) throw error;\n  return data;\n}\n\n/**\n * Update an existing note\n */\nexport async function updateNote(\n  id: number,\n  title: string,\n  content: string\n): Promise<Note> {\n  const text = combineNoteText(title, content);\n\n  const { data, error } = await supabase\n    .from('notes')\n    .update({\n      text,\n      updated_at: new Date().toISOString(),\n    })\n    .eq('id', id)\n    .select()\n    .single();\n\n  if (error) throw error;\n  return data;\n}\n\n/**\n * Soft delete a note (move to trash)\n */\nexport async function softDeleteNote(id: number): Promise<Note> {\n  const { data, error } = await supabase\n    .from('notes')\n    .update({ deleted_at: new Date().toISOString() })\n    .eq('id', id)\n    .select()\n    .single();\n\n  if (error) throw error;\n  return data;\n}\n\n/**\n * Restore a soft-deleted note\n */\nexport async function restoreNote(id: number): Promise<Note> {\n  const { data, error } = await supabase\n    .from('notes')\n    .update({ deleted_at: null })\n    .eq('id', id)\n    .select()\n    .single();\n\n  if (error) throw error;\n  return data;\n}\n\n/**\n * Permanently delete a note (hard delete)\n */\nexport async function deleteNote(id: number): Promise<void> {\n  const { error } = await supabase.from('notes').delete().eq('id', id);\n\n  if (error) throw error;\n}\n\n/**\n * Duplicate a note\n */\nexport async function duplicateNote(id: number): Promise<Note> {\n  // First, get the note to duplicate\n  const { data: originalNote, error: fetchError } = await supabase\n    .from('notes')\n    .select('*')\n    .eq('id', id)\n    .single();\n\n  if (fetchError) throw fetchError;\n\n  // Parse the original title\n  const { title, content } = parseNoteText(originalNote.text);\n  const newTitle = `${title} (Copy)`;\n  const newText = combineNoteText(newTitle, content);\n\n  // Create the duplicate\n  const { data, error } = await supabase\n    .from('notes')\n    .insert({\n      workspace_id: originalNote.workspace_id,\n      text: newText,\n    })\n    .select()\n    .single();\n\n  if (error) throw error;\n  return data;\n}\n\n/**\n * Empty trash (permanently delete all soft-deleted notes in a workspace)\n */\nexport async function emptyTrash(workspaceId: number): Promise<void> {\n  const { error } = await supabase\n    .from('notes')\n    .delete()\n    .eq('workspace_id', workspaceId)\n    .not('deleted_at', 'is', null);\n\n  if (error) throw error;\n}\n\n/**\n * Search notes by text content\n */\nexport async function searchNotes(\n  workspaceId: number,\n  searchQuery: string\n): Promise<Note[]> {\n  if (!searchQuery.trim()) {\n    return getNotes(workspaceId);\n  }\n\n  const { data, error } = await supabase\n    .from('notes')\n    .select(\n      `\n      *,\n      workspace:workspace_id(*),\n      workspace_member_note(\n        workspace_member_note_role,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profiles!user_id(id, name, avatar_url)\n        )\n      )\n    `\n    )\n    .eq('workspace_id', workspaceId)\n    .ilike('text', `%${searchQuery}%`)\n    .order('updated_at', { ascending: false });\n\n  if (error) throw error;\n\n  // Transform the nested structure to match our types\n  return (data || []).map(note => ({\n    ...note,\n    workspace_member_note: (note.workspace_member_note || []).map(\n      (assignment: { workspace_member?: { user_profiles?: unknown } }) => ({\n        ...assignment,\n        workspace_member: assignment.workspace_member\n          ? {\n              ...assignment.workspace_member,\n              user_profiles: Array.isArray(\n                assignment.workspace_member.user_profiles\n              )\n                ? assignment.workspace_member.user_profiles[0]\n                : assignment.workspace_member.user_profiles,\n            }\n          : undefined,\n      })\n    ),\n  }));\n}\n\n/**\n * Get notes where current user is assigned as assigner or assignee\n */\nexport async function getUserAssignedNotes(): Promise<Note[]> {\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) throw new Error('Not authenticated');\n\n  // 1. Get all workspace_member records for current user\n  const { data: members, error: memberError } = await supabase\n    .from('workspace_member')\n    .select('id')\n    .eq('user_id', user.id);\n\n  if (memberError) throw memberError;\n  if (!members || members.length === 0) return [];\n\n  const memberIds = members.map(m => m.id);\n\n  // 2. Get note_ids from workspace_member_note\n  const { data: assignments, error: assignmentError } = await supabase\n    .from('workspace_member_note')\n    .select('note_id')\n    .in('workspace_member_id', memberIds);\n\n  if (assignmentError) throw assignmentError;\n  if (!assignments || assignments.length === 0) return [];\n\n  const noteIds = [...new Set(assignments.map(a => a.note_id))];\n\n  // 3. Get notes with workspace info and assignments\n  const { data, error } = await supabase\n    .from('notes')\n    .select(\n      `\n      *,\n      workspace:workspace_id(*),\n      workspace_member_note(\n        workspace_member_note_role,\n        workspace_member:workspace_member_id(\n          id,\n          user_id,\n          user_profiles!user_id(id, name, avatar_url)\n        )\n      )\n    `\n    )\n    .in('id', noteIds)\n    .order('updated_at', { ascending: false });\n\n  if (error) throw error;\n\n  // Transform the nested structure to match our types\n  return (data || []).map(note => ({\n    ...note,\n    workspace_member_note: (note.workspace_member_note || []).map(\n      (assignment: { workspace_member?: { user_profiles?: unknown } }) => ({\n        ...assignment,\n        workspace_member: assignment.workspace_member\n          ? {\n              ...assignment.workspace_member,\n              user_profiles: Array.isArray(\n                assignment.workspace_member.user_profiles\n              )\n                ? assignment.workspace_member.user_profiles[0]\n                : assignment.workspace_member.user_profiles,\n            }\n          : undefined,\n      })\n    ),\n  }));\n}\n\n/**\n * Assign note to workspace members as assigner/assignee\n */\nexport async function assignNoteToMembers(\n  noteId: number,\n  assignerIds: number[],\n  assigneeIds: number[]\n): Promise<void> {\n  // Delete existing assignments\n  const { error: deleteError } = await supabase\n    .from('workspace_member_note')\n    .delete()\n    .eq('note_id', noteId);\n\n  if (deleteError) throw deleteError;\n\n  // Create new assignments\n  const assignments = [\n    ...assignerIds.map(id => ({\n      workspace_member_id: id,\n      note_id: noteId,\n      workspace_member_note_role: 'assigner',\n    })),\n    ...assigneeIds.map(id => ({\n      workspace_member_id: id,\n      note_id: noteId,\n      workspace_member_note_role: 'assignee',\n    })),\n  ];\n\n  if (assignments.length > 0) {\n    const { error } = await supabase\n      .from('workspace_member_note')\n      .insert(assignments);\n    if (error) throw error;\n  }\n}\n\n/**\n * Get note assignment information\n */\ntype NoteAssignmentItem = {\n  workspace_member_note_role: string;\n  workspace_member?: {\n    id?: number;\n    user_id?: string;\n    user_profiles?:\n      | {\n          id?: string;\n          name?: string;\n        }\n      | {\n          id?: string;\n          name?: string;\n        }[];\n  };\n};\n\nexport async function getNoteAssignments(noteId: number): Promise<{\n  assigners: NoteAssignmentItem[];\n  assignees: NoteAssignmentItem[];\n}> {\n  const { data, error } = await supabase\n    .from('workspace_member_note')\n    .select(\n      `\n      workspace_member_note_role,\n      workspace_member:workspace_member_id(\n        id,\n        user_id,\n        user_profiles!user_id(id, name)\n      )\n    `\n    )\n    .eq('note_id', noteId);\n\n  if (error) {\n    throw error;\n  }\n\n  // Transform nested structure (same pattern as workspaceMessagesApi)\n  const transformedData = (data || []).map((item: unknown) => {\n    const typedItem = item as NoteAssignmentItem;\n    return {\n      workspace_member_note_role: typedItem.workspace_member_note_role,\n      workspace_member: typedItem.workspace_member\n        ? {\n            ...typedItem.workspace_member,\n            user_profile: Array.isArray(\n              typedItem.workspace_member.user_profiles\n            )\n              ? typedItem.workspace_member.user_profiles[0]\n              : typedItem.workspace_member.user_profiles,\n          }\n        : undefined,\n    };\n  });\n\n  const result = {\n    assigners:\n      transformedData.filter(\n        d => d.workspace_member_note_role === 'assigner'\n      ) || [],\n    assignees:\n      transformedData.filter(\n        d => d.workspace_member_note_role === 'assignee'\n      ) || [],\n  };\n\n  return result;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 279, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/hooks/useNoteEditor.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport useSWR from 'swr';\nimport { getNote, updateNote, parseNoteText } from '@/lib/api/notesApi';\nimport type { NoteWithParsed } from '@/types/note';\n\nconst AUTOSAVE_DELAY = 700;\n\n/**\n * Hook for editing a single note with automatic saving\n */\nexport function useNoteEditor(noteId: number | null) {\n  // Fetch note data using SWR\n  const {\n    data: note,\n    error,\n    isLoading,\n    mutate: mutateNote,\n  } = useSWR<NoteWithParsed | null>(\n    noteId ? `/notes/${noteId}` : null,\n    async () => {\n      if (!noteId) return null;\n      const data = await getNote(noteId);\n      return data\n        ? { ...data, ...parseNoteText(data.text), preview: '' }\n        : null;\n    },\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  // Local state for editing\n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  const [saving, setSaving] = useState(false);\n  const [hasInitialized, setHasInitialized] = useState(false);\n\n  // Initialize local state when note data loads\n  useEffect(() => {\n    if (note && !hasInitialized) {\n      setTitle(note.title);\n\n      setContent(note.content);\n      setHasInitialized(true);\n    }\n  }, [note, hasInitialized]);\n\n  // Debounced autosave\n  useEffect(() => {\n    if (!noteId || isLoading || !hasInitialized) return;\n\n    const timeout = setTimeout(async () => {\n      try {\n        setSaving(true);\n\n        // Perform actual update (just like the original implementation)\n        const saved = await updateNote(noteId, title, content);\n        const parsedSaved = {\n          ...saved,\n          ...parseNoteText(saved.text),\n          preview: '',\n        };\n\n        // Silently update the current note cache without revalidation\n        await mutateNote(parsedSaved, false);\n      } catch (err) {\n        console.error('Autosave failed:', err);\n      } finally {\n        setSaving(false);\n      }\n    }, AUTOSAVE_DELAY);\n\n    return () => clearTimeout(timeout);\n  }, [title, content, noteId, isLoading, hasInitialized, mutateNote]);\n\n  // Manual save function (if needed)\n  const save = useCallback(async () => {\n    if (!noteId || !hasInitialized) return;\n\n    try {\n      setSaving(true);\n      const saved = await updateNote(noteId, title, content);\n      const parsedSaved = {\n        ...saved,\n        ...parseNoteText(saved.text),\n        preview: '',\n      };\n      // Update the current note cache without revalidation\n      await mutateNote(parsedSaved, false);\n    } catch (err) {\n      console.error('Save failed:', err);\n      throw err;\n    } finally {\n      setSaving(false);\n    }\n  }, [noteId, title, content, hasInitialized, mutateNote]);\n\n  return {\n    note,\n    title,\n    content,\n    saving,\n    loading: isLoading,\n    error: error\n      ? error instanceof Error\n        ? error.message\n        : 'Failed to load note'\n      : null,\n    setTitle,\n    setContent,\n    save,\n    refetch: () => mutateNote(),\n  };\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;AAOA,MAAM,iBAAiB;AAKhB,SAAS,cAAc,MAAqB;IACjD,4BAA4B;IAC5B,MAAM,EACJ,MAAM,IAAI,EACV,KAAK,EACL,SAAS,EACT,QAAQ,UAAU,EACnB,GAAG,IAAA,qRAAM,EACR,SAAS,CAAC,OAAO,EAAE,QAAQ,GAAG,MAC9B;QACE,IAAI,CAAC,QAAQ,OAAO;QACpB,MAAM,OAAO,MAAM,IAAA,6LAAO,EAAC;QAC3B,OAAO,OACH;YAAE,GAAG,IAAI;YAAE,GAAG,IAAA,mMAAa,EAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAG,IACpD;IACN,GACA;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,0BAA0B;IAC1B,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,qcAAQ,EAAC;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,qcAAQ,EAAC;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,qcAAQ,EAAC;IACrC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,qcAAQ,EAAC;IAErD,8CAA8C;IAC9C,IAAA,scAAS,EAAC;QACR,IAAI,QAAQ,CAAC,gBAAgB;YAC3B,SAAS,KAAK,KAAK;YAEnB,WAAW,KAAK,OAAO;YACvB,kBAAkB;QACpB;IACF,GAAG;QAAC;QAAM;KAAe;IAEzB,qBAAqB;IACrB,IAAA,scAAS,EAAC;QACR,IAAI,CAAC,UAAU,aAAa,CAAC,gBAAgB;QAE7C,MAAM,UAAU,WAAW;YACzB,IAAI;gBACF,UAAU;gBAEV,gEAAgE;gBAChE,MAAM,QAAQ,MAAM,IAAA,gMAAU,EAAC,QAAQ,OAAO;gBAC9C,MAAM,cAAc;oBAClB,GAAG,KAAK;oBACR,GAAG,IAAA,mMAAa,EAAC,MAAM,IAAI,CAAC;oBAC5B,SAAS;gBACX;gBAEA,8DAA8D;gBAC9D,MAAM,WAAW,aAAa;YAChC,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,oBAAoB;YACpC,SAAU;gBACR,UAAU;YACZ;QACF,GAAG;QAEH,OAAO,IAAM,aAAa;IAC5B,GAAG;QAAC;QAAO;QAAS;QAAQ;QAAW;QAAgB;KAAW;IAElE,mCAAmC;IACnC,MAAM,OAAO,IAAA,wcAAW,EAAC;QACvB,IAAI,CAAC,UAAU,CAAC,gBAAgB;QAEhC,IAAI;YACF,UAAU;YACV,MAAM,QAAQ,MAAM,IAAA,gMAAU,EAAC,QAAQ,OAAO;YAC9C,MAAM,cAAc;gBAClB,GAAG,KAAK;gBACR,GAAG,IAAA,mMAAa,EAAC,MAAM,IAAI,CAAC;gBAC5B,SAAS;YACX;YACA,qDAAqD;YACrD,MAAM,WAAW,aAAa;QAChC,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,gBAAgB;YAC9B,MAAM;QACR,SAAU;YACR,UAAU;QACZ;IACF,GAAG;QAAC;QAAQ;QAAO;QAAS;QAAgB;KAAW;IAEvD,OAAO;QACL;QACA;QACA;QACA;QACA,SAAS;QACT,OAAO,QACH,iBAAiB,QACf,MAAM,OAAO,GACb,wBACF;QACJ;QACA;QACA;QACA,SAAS,IAAM;IACjB;AACF","debugId":null}},
    {"offset": {"line": 394, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/hooks/useWorkspace.ts"],"sourcesContent":["'use client';\n\nimport useSWR, { mutate } from 'swr';\nimport {\n  getWorkspaces,\n  getWorkspace,\n  createWorkspace,\n  updateWorkspace,\n  deleteWorkspace,\n  getWorkspaceMembers,\n} from '@/lib/api/workspaceApi';\nimport type { Workspace, WorkspaceMember } from '@/types/workspace';\n\n// SWR keys\nconst WORKSPACES_KEY = '/workspaces';\nconst workspaceKey = (id: number) => `/workspaces/${id}`;\n\n// Hooks\nexport function useWorkspaces() {\n  const { data, error, isLoading } = useSWR<Workspace[]>(\n    WORKSPACES_KEY,\n    getWorkspaces,\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  return {\n    workspaces: data,\n    isLoading,\n    error,\n  };\n}\n\nexport function useWorkspace(id: number | null) {\n  const { data, error, isLoading } = useSWR<Workspace>(\n    id ? workspaceKey(id) : null,\n    () => getWorkspace(id!),\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  return {\n    workspace: data,\n    isLoading,\n    error,\n  };\n}\n\nexport function useWorkspaceMembers(workspaceId: number | null) {\n  const { data, error, isLoading } = useSWR<WorkspaceMember[]>(\n    workspaceId ? `/workspaces/${workspaceId}/members` : null,\n    workspaceId ? async () => await getWorkspaceMembers(workspaceId) : null,\n    {\n      revalidateOnFocus: false,\n      revalidateOnReconnect: true,\n    }\n  );\n\n  return {\n    members: data || [],\n    isLoading,\n    error,\n  };\n}\n\n// Mutation helpers\nexport function useWorkspaceMutations() {\n  const create = async (title: string) => {\n    const workspace = await createWorkspace(title);\n    mutate(WORKSPACES_KEY); // Revalidate list\n    return workspace;\n  };\n\n  const update = async (\n    id: number,\n    updates: Partial<Pick<Workspace, 'title' | 'type' | 'icon_url'>>\n  ) => {\n    const workspace = await updateWorkspace(id, updates);\n    mutate(workspaceKey(id)); // Revalidate specific workspace\n    mutate(WORKSPACES_KEY); // Revalidate list\n    return workspace;\n  };\n\n  const remove = async (id: number) => {\n    await deleteWorkspace(id);\n    mutate(WORKSPACES_KEY); // Revalidate list\n  };\n\n  return { create, update, remove };\n}\n"],"names":[],"mappings":";;;;;;;;;;AAEA;AAAA;AACA;AAHA;;;AAaA,WAAW;AACX,MAAM,iBAAiB;AACvB,MAAM,eAAe,CAAC,KAAe,CAAC,YAAY,EAAE,IAAI;AAGjD,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,qRAAM,EACvC,gBACA,uMAAa,EACb;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,OAAO;QACL,YAAY;QACZ;QACA;IACF;AACF;AAEO,SAAS,aAAa,EAAiB;IAC5C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,qRAAM,EACvC,KAAK,aAAa,MAAM,MACxB,IAAM,IAAA,sMAAY,EAAC,KACnB;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,OAAO;QACL,WAAW;QACX;QACA;IACF;AACF;AAEO,SAAS,oBAAoB,WAA0B;IAC5D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,qRAAM,EACvC,cAAc,CAAC,YAAY,EAAE,YAAY,QAAQ,CAAC,GAAG,MACrD,cAAc,UAAY,MAAM,IAAA,6MAAmB,EAAC,eAAe,MACnE;QACE,mBAAmB;QACnB,uBAAuB;IACzB;IAGF,OAAO;QACL,SAAS,QAAQ,EAAE;QACnB;QACA;IACF;AACF;AAGO,SAAS;IACd,MAAM,SAAS,OAAO;QACpB,MAAM,YAAY,MAAM,IAAA,yMAAe,EAAC;QACxC,IAAA,yUAAM,EAAC,iBAAiB,kBAAkB;QAC1C,OAAO;IACT;IAEA,MAAM,SAAS,OACb,IACA;QAEA,MAAM,YAAY,MAAM,IAAA,yMAAe,EAAC,IAAI;QAC5C,IAAA,yUAAM,EAAC,aAAa,MAAM,gCAAgC;QAC1D,IAAA,yUAAM,EAAC,iBAAiB,kBAAkB;QAC1C,OAAO;IACT;IAEA,MAAM,SAAS,OAAO;QACpB,MAAM,IAAA,yMAAe,EAAC;QACtB,IAAA,yUAAM,EAAC,iBAAiB,kBAAkB;IAC5C;IAEA,OAAO;QAAE;QAAQ;QAAQ;IAAO;AAClC","debugId":null}},
    {"offset": {"line": 472, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/hooks/useWorkspaceNotes.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport {\n  getNotes,\n  createNote,\n  updateNote,\n  deleteNote,\n  softDeleteNote,\n  restoreNote,\n  duplicateNote,\n  emptyTrash,\n  searchNotes,\n  parseNoteText,\n} from '@/lib/api/notesApi';\nimport { getWorkspace } from '@/lib/api/workspaceApi';\nimport type { Note, NoteWithParsed } from '@/types/note';\nimport type { Workspace } from '@/types/workspace';\n\n/**\n * Parse note into format with title, content, and preview\n */\nfunction parseNote(note: Note): NoteWithParsed {\n  const { title, content } = parseNoteText(note.text);\n  const preview = content.slice(0, 100) + (content.length > 100 ? '...' : '');\n\n  return {\n    ...note,\n    title,\n    content,\n    preview,\n  };\n}\n\n/**\n * Format date for display\n */\nfunction formatDate(dateString: string): string {\n  const date = new Date(dateString);\n  return date\n    .toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n    })\n    .replace(/\\//g, '/');\n}\n\nexport function useWorkspaceNotes(workspaceId: number) {\n  const [notes, setNotes] = useState<NoteWithParsed[]>([]);\n  const [workspace, setWorkspace] = useState<Workspace | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchNotes = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Fetch workspace info and notes in parallel\n      const [workspaceData, notesData] = await Promise.all([\n        getWorkspace(workspaceId),\n        getNotes(workspaceId),\n      ]);\n\n      setWorkspace(workspaceData);\n      const parsedNotes = notesData.map(parseNote);\n      setNotes(parsedNotes);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch notes');\n      console.error('Error fetching notes:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, [workspaceId]);\n\n  const searchNotesQuery = useCallback(\n    async (query: string) => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        const data = await searchNotes(workspaceId, query);\n        const parsedNotes = data.map(parseNote);\n        setNotes(parsedNotes);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to search notes');\n        console.error('Error searching notes:', err);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [workspaceId]\n  );\n\n  const createNewNote = useCallback(\n    async (title: string, content: string) => {\n      try {\n        setError(null);\n\n        const newNote = await createNote(workspaceId, title, content);\n        const parsedNote = parseNote(newNote);\n        setNotes(prev => [parsedNote, ...prev]);\n        return parsedNote;\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to create note');\n        console.error('Error creating note:', err);\n        throw err;\n      }\n    },\n    [workspaceId]\n  );\n\n  const updateExistingNote = useCallback(\n    async (id: number, title: string, content: string) => {\n      try {\n        setError(null);\n\n        const updatedNote = await updateNote(id, title, content);\n        const parsedNote = parseNote(updatedNote);\n        setNotes(prev =>\n          prev.map(note => (note.id === id ? parsedNote : note))\n        );\n        return parsedNote;\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to update note');\n        console.error('Error updating note:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  const deleteExistingNote = useCallback(async (id: number) => {\n    try {\n      setError(null);\n\n      await deleteNote(id);\n      setNotes(prev => prev.filter(note => note.id !== id));\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to delete note');\n      console.error('Error deleting note:', err);\n      throw err;\n    }\n  }, []);\n\n  const softDeleteExistingNote = useCallback(async (id: number) => {\n    try {\n      setError(null);\n\n      const deletedNote = await softDeleteNote(id);\n      const parsedNote = parseNote(deletedNote);\n      setNotes(prev => prev.map(note => (note.id === id ? parsedNote : note)));\n      return parsedNote;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to delete note');\n      console.error('Error soft deleting note:', err);\n      throw err;\n    }\n  }, []);\n\n  const restoreExistingNote = useCallback(async (id: number) => {\n    try {\n      setError(null);\n\n      const restoredNote = await restoreNote(id);\n      const parsedNote = parseNote(restoredNote);\n      setNotes(prev => prev.map(note => (note.id === id ? parsedNote : note)));\n      return parsedNote;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to restore note');\n      console.error('Error restoring note:', err);\n      throw err;\n    }\n  }, []);\n\n  const duplicateExistingNote = useCallback(async (id: number) => {\n    try {\n      setError(null);\n\n      const newNote = await duplicateNote(id);\n      const parsedNote = parseNote(newNote);\n      setNotes(prev => [parsedNote, ...prev]);\n      return parsedNote;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to duplicate note');\n      console.error('Error duplicating note:', err);\n      throw err;\n    }\n  }, []);\n\n  const emptyWorkspaceTrash = useCallback(async () => {\n    try {\n      setError(null);\n\n      await emptyTrash(workspaceId);\n      setNotes(prev => prev.filter(note => !note.deleted_at));\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to empty trash');\n      console.error('Error emptying trash:', err);\n      throw err;\n    }\n  }, [workspaceId]);\n\n  useEffect(() => {\n    if (workspaceId) {\n      fetchNotes();\n    }\n  }, [fetchNotes, workspaceId]);\n\n  return {\n    notes,\n    workspace,\n    loading,\n    error,\n    refetch: fetchNotes,\n    searchNotes: searchNotesQuery,\n    createNote: createNewNote,\n    updateNote: updateExistingNote,\n    deleteNote: deleteExistingNote,\n    softDeleteNote: softDeleteExistingNote,\n    restoreNote: restoreExistingNote,\n    duplicateNote: duplicateExistingNote,\n    emptyTrash: emptyWorkspaceTrash,\n  };\n}\n\nexport { formatDate };\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 675, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/api/workspaceFilesApi.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/browserClient';\n\nconst supabase = createClient();\nconst WORKSPACE_FILES_BUCKET = 'workspace-files';\n\nexport interface WorkspaceFile {\n  id: number; // bigint (database primary key)\n  original_filename: string;\n  file_path: string;\n  file_size: number;\n  mime_type: string;\n  created_at: string;\n}\n\nexport interface UploadedFile {\n  id: number; // workspace_file_id (bigint, database primary key)\n  file_path: string;\n  url: string;\n  original_filename: string;\n  file_size: number;\n  mime_type: string;\n}\n\n/**\n * Upload a file to workspace storage\n */\nexport async function uploadWorkspaceFile(\n  workspaceId: number,\n  file: File\n): Promise<UploadedFile> {\n  // Generate a UUID for the storage path (not the database ID)\n  const storageUuid = crypto.randomUUID();\n  const sanitizedFilename = file.name.replace(/[^a-zA-Z0-9._-]/g, '_');\n\n  // Storage path: workspace-files/{workspace_id}/uploads/{uuid}/{original_filename}\n  const filePath = `${workspaceId}/uploads/${storageUuid}/${sanitizedFilename}`;\n\n  // Upload to Supabase Storage\n  const { error: uploadError } = await supabase.storage\n    .from(WORKSPACE_FILES_BUCKET)\n    .upload(filePath, file, {\n      cacheControl: '3600',\n      upsert: false,\n    });\n\n  if (uploadError) throw uploadError;\n\n  // Insert file metadata into workspace_files table (database ID is auto-generated bigint)\n  const { data: fileData, error: dbError } = await supabase\n    .from('workspace_files')\n    .insert({\n      orginal_file_name: file.name, // Note: schema has typo \"orginal\" instead of \"original\"\n      file_path: filePath,\n      mime_type: file.type,\n      file_size: file.size,\n      workspace_id: workspaceId,\n    })\n    .select()\n    .single();\n\n  if (dbError) throw dbError;\n\n  // Generate signed URL for private bucket (valid for 1 hour)\n  const { data: signedUrlData, error: signedUrlError } = await supabase.storage\n    .from(WORKSPACE_FILES_BUCKET)\n    .createSignedUrl(filePath, 3600); // 1 hour expiration\n\n  if (signedUrlError) {\n    console.warn('Error creating signed URL:', signedUrlError);\n  }\n\n  // Return file info with workspace_file_id\n  return {\n    id: fileData.id,\n    file_path: filePath,\n    url: signedUrlData?.signedUrl || '', // Signed URL for private bucket\n    original_filename: file.name,\n    file_size: file.size,\n    mime_type: file.type,\n  };\n}\n\n/**\n * Get signed file URL from workspace_file_id (bigint)\n * For private buckets, returns a signed URL valid for the specified duration\n */\nexport async function getFileUrl(\n  workspaceFileId: number,\n  expiresIn: number = 3600\n): Promise<string | null> {\n  const { data, error } = await supabase\n    .from('workspace_files')\n    .select('file_path')\n    .eq('id', workspaceFileId)\n    .single();\n\n  if (error || !data) {\n    console.warn('File not found in database:', error);\n    return null;\n  }\n\n  // Create signed URL for private bucket\n  const { data: signedUrlData, error: signedUrlError } = await supabase.storage\n    .from(WORKSPACE_FILES_BUCKET)\n    .createSignedUrl(data.file_path, expiresIn);\n\n  if (signedUrlError || !signedUrlData) {\n    console.warn('Error creating signed URL:', signedUrlError);\n    return null;\n  }\n\n  return signedUrlData.signedUrl;\n}\n\n/**\n * Link files to a message\n */\nexport async function linkFilesToMessage(\n  messageId: number,\n  workspaceFileIds: number[]\n): Promise<void> {\n  if (workspaceFileIds.length === 0) return;\n\n  const rows = workspaceFileIds.map(workspaceFileId => ({\n    message_id: messageId,\n    workspace_file_id: workspaceFileId,\n  }));\n\n  const { error } = await supabase.from('workspace_message_files').insert(rows);\n\n  if (error) throw error;\n}\n\n/**\n * Get all files for a workspace\n */\nexport async function getWorkspaceFiles(\n  workspaceId: number,\n  limit: number = 50\n): Promise<WorkspaceFile[]> {\n  const { data, error } = await supabase\n    .from('workspace_files')\n    .select(\n      'id, orginal_file_name, file_path, file_size, mime_type, created_at'\n    )\n    .eq('workspace_id', workspaceId)\n    .order('created_at', { ascending: false })\n    .limit(limit);\n\n  if (error) throw error;\n\n  // Map the typo field name to correct one\n  return (data || []).map(file => ({\n    id: file.id,\n    original_filename: file.orginal_file_name,\n    file_path: file.file_path,\n    file_size: file.file_size,\n    mime_type: file.mime_type,\n    created_at: file.created_at,\n  }));\n}\n\n/**\n * Delete a workspace file\n */\nexport async function deleteWorkspaceFile(\n  workspaceFileId: number\n): Promise<void> {\n  // First, get the file path from the database\n  const { data: fileData, error: fetchError } = await supabase\n    .from('workspace_files')\n    .select('file_path')\n    .eq('id', workspaceFileId)\n    .single();\n\n  if (fetchError) {\n    console.warn('Error fetching file for deletion:', fetchError);\n  }\n\n  // Delete from storage if we have the path\n  if (fileData?.file_path) {\n    const { error: storageError } = await supabase.storage\n      .from(WORKSPACE_FILES_BUCKET)\n      .remove([fileData.file_path]);\n\n    if (storageError) {\n      console.warn('Error deleting file from storage:', storageError);\n    }\n  }\n\n  // Delete from workspace_files table (CASCADE will handle workspace_message_files)\n  const { error: dbError } = await supabase\n    .from('workspace_files')\n    .delete()\n    .eq('id', workspaceFileId);\n\n  if (dbError) {\n    console.warn('Error deleting file from database:', dbError);\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAEA,MAAM,WAAW,IAAA,4MAAY;AAC7B,MAAM,yBAAyB;AAuBxB,eAAe,oBACpB,WAAmB,EACnB,IAAU;IAEV,6DAA6D;IAC7D,MAAM,cAAc,OAAO,UAAU;IACrC,MAAM,oBAAoB,KAAK,IAAI,CAAC,OAAO,CAAC,oBAAoB;IAEhE,kFAAkF;IAClF,MAAM,WAAW,GAAG,YAAY,SAAS,EAAE,YAAY,CAAC,EAAE,mBAAmB;IAE7E,6BAA6B;IAC7B,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,OAAO,CAClD,IAAI,CAAC,wBACL,MAAM,CAAC,UAAU,MAAM;QACtB,cAAc;QACd,QAAQ;IACV;IAEF,IAAI,aAAa,MAAM;IAEvB,yFAAyF;IACzF,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,SAC9C,IAAI,CAAC,mBACL,MAAM,CAAC;QACN,mBAAmB,KAAK,IAAI;QAC5B,WAAW;QACX,WAAW,KAAK,IAAI;QACpB,WAAW,KAAK,IAAI;QACpB,cAAc;IAChB,GACC,MAAM,GACN,MAAM;IAET,IAAI,SAAS,MAAM;IAEnB,4DAA4D;IAC5D,MAAM,EAAE,MAAM,aAAa,EAAE,OAAO,cAAc,EAAE,GAAG,MAAM,SAAS,OAAO,CAC1E,IAAI,CAAC,wBACL,eAAe,CAAC,UAAU,OAAO,oBAAoB;IAExD,IAAI,gBAAgB;QAClB,QAAQ,IAAI,CAAC,8BAA8B;IAC7C;IAEA,0CAA0C;IAC1C,OAAO;QACL,IAAI,SAAS,EAAE;QACf,WAAW;QACX,KAAK,eAAe,aAAa;QACjC,mBAAmB,KAAK,IAAI;QAC5B,WAAW,KAAK,IAAI;QACpB,WAAW,KAAK,IAAI;IACtB;AACF;AAMO,eAAe,WACpB,eAAuB,EACvB,YAAoB,IAAI;IAExB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,mBACL,MAAM,CAAC,aACP,EAAE,CAAC,MAAM,iBACT,MAAM;IAET,IAAI,SAAS,CAAC,MAAM;QAClB,QAAQ,IAAI,CAAC,+BAA+B;QAC5C,OAAO;IACT;IAEA,uCAAuC;IACvC,MAAM,EAAE,MAAM,aAAa,EAAE,OAAO,cAAc,EAAE,GAAG,MAAM,SAAS,OAAO,CAC1E,IAAI,CAAC,wBACL,eAAe,CAAC,KAAK,SAAS,EAAE;IAEnC,IAAI,kBAAkB,CAAC,eAAe;QACpC,QAAQ,IAAI,CAAC,8BAA8B;QAC3C,OAAO;IACT;IAEA,OAAO,cAAc,SAAS;AAChC;AAKO,eAAe,mBACpB,SAAiB,EACjB,gBAA0B;IAE1B,IAAI,iBAAiB,MAAM,KAAK,GAAG;IAEnC,MAAM,OAAO,iBAAiB,GAAG,CAAC,CAAA,kBAAmB,CAAC;YACpD,YAAY;YACZ,mBAAmB;QACrB,CAAC;IAED,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,2BAA2B,MAAM,CAAC;IAExE,IAAI,OAAO,MAAM;AACnB;AAKO,eAAe,kBACpB,WAAmB,EACnB,QAAgB,EAAE;IAElB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,mBACL,MAAM,CACL,sEAED,EAAE,CAAC,gBAAgB,aACnB,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM,GACvC,KAAK,CAAC;IAET,IAAI,OAAO,MAAM;IAEjB,yCAAyC;IACzC,OAAO,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAA,OAAQ,CAAC;YAC/B,IAAI,KAAK,EAAE;YACX,mBAAmB,KAAK,iBAAiB;YACzC,WAAW,KAAK,SAAS;YACzB,WAAW,KAAK,SAAS;YACzB,WAAW,KAAK,SAAS;YACzB,YAAY,KAAK,UAAU;QAC7B,CAAC;AACH;AAKO,eAAe,oBACpB,eAAuB;IAEvB,6CAA6C;IAC7C,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SACjD,IAAI,CAAC,mBACL,MAAM,CAAC,aACP,EAAE,CAAC,MAAM,iBACT,MAAM;IAET,IAAI,YAAY;QACd,QAAQ,IAAI,CAAC,qCAAqC;IACpD;IAEA,0CAA0C;IAC1C,IAAI,UAAU,WAAW;QACvB,MAAM,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAAS,OAAO,CACnD,IAAI,CAAC,wBACL,MAAM,CAAC;YAAC,SAAS,SAAS;SAAC;QAE9B,IAAI,cAAc;YAChB,QAAQ,IAAI,CAAC,qCAAqC;QACpD;IACF;IAEA,kFAAkF;IAClF,MAAM,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,mBACL,MAAM,GACN,EAAE,CAAC,MAAM;IAEZ,IAAI,SAAS;QACX,QAAQ,IAAI,CAAC,sCAAsC;IACrD;AACF","debugId":null}},
    {"offset": {"line": 790, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/MentionExtension.ts"],"sourcesContent":["import { createInlineMarkdownSpec, mergeAttributes } from '@tiptap/core';\nimport Mention from '@tiptap/extension-mention';\n\nexport interface MentionNodeAttrs {\n  id: string;\n  label: string;\n  workspaceMemberId: number;\n}\n\nexport const CustomMention = Mention.extend({\n  name: 'mention',\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-id'),\n        renderHTML: (attributes: { id: string }) => {\n          if (!attributes.id) {\n            return {};\n          }\n          return {\n            'data-id': attributes.id,\n          };\n        },\n      },\n      label: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-label'),\n        renderHTML: (attributes: { label: string }) => {\n          if (!attributes.label) {\n            return {};\n          }\n          return {\n            'data-label': attributes.label,\n          };\n        },\n      },\n      workspaceMemberId: {\n        default: null,\n        parseHTML: (element: HTMLElement) => {\n          const id = element.getAttribute('data-workspace-member-id');\n          return id ? parseInt(id, 10) : null;\n        },\n        renderHTML: (attributes: { workspaceMemberId: number }) => {\n          if (!attributes.workspaceMemberId) {\n            return {};\n          }\n          return {\n            'data-workspace-member-id': attributes.workspaceMemberId,\n          };\n        },\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span[data-type=\"mention\"]',\n      },\n    ];\n  },\n\n  renderHTML({\n    node,\n    HTMLAttributes,\n  }: {\n    node: Node;\n    HTMLAttributes: { [key: string]: string };\n  }) {\n    return [\n      'span',\n      mergeAttributes(\n        { 'data-type': 'mention' },\n        this.options.HTMLAttributes,\n        HTMLAttributes\n      ),\n      `@${HTMLAttributes['data-label'] || ''}`,\n    ];\n  },\n\n  renderText({ node }: { node: any }) {\n    return `@${node.attrs.label}`;\n  },\n\n  // Markdown support using Tiptap utility\n  ...createInlineMarkdownSpec({\n    nodeName: 'mention',\n    name: '@',\n    selfClosing: true,\n    allowedAttributes: ['id', 'label', 'workspaceMemberId'],\n  }),\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () =>\n        this.editor.commands.command(({ tr, state }) => {\n          let isMention = false;\n          const { selection } = state;\n          const { empty, anchor } = selection;\n\n          if (!empty) {\n            return false;\n          }\n\n          state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n            if (node.type.name === this.name) {\n              isMention = true;\n              tr.insertText('', pos, pos + node.nodeSize);\n              return false;\n            }\n          });\n\n          return isMention;\n        }),\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,MAAM,gBAAgB,yaAAO,CAAC,MAAM,CAAC;IAC1C,MAAM;IAEN;QACE,OAAO;YACL,IAAI;gBACF,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,EAAE,EAAE;wBAClB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,WAAW,WAAW,EAAE;oBAC1B;gBACF;YACF;YACA,OAAO;gBACL,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,KAAK,EAAE;wBACrB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,cAAc,WAAW,KAAK;oBAChC;gBACF;YACF;YACA,mBAAmB;gBACjB,SAAS;gBACT,WAAW,CAAC;oBACV,MAAM,KAAK,QAAQ,YAAY,CAAC;oBAChC,OAAO,KAAK,SAAS,IAAI,MAAM;gBACjC;gBACA,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,iBAAiB,EAAE;wBACjC,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,4BAA4B,WAAW,iBAAiB;oBAC1D;gBACF;YACF;QACF;IACF;IAEA;QACE,OAAO;YACL;gBACE,KAAK;YACP;SACD;IACH;IAEA,YAAW,EACT,IAAI,EACJ,cAAc,EAIf;QACC,OAAO;YACL;YACA,IAAA,ySAAe,EACb;gBAAE,aAAa;YAAU,GACzB,IAAI,CAAC,OAAO,CAAC,cAAc,EAC3B;YAEF,CAAC,CAAC,EAAE,cAAc,CAAC,aAAa,IAAI,IAAI;SACzC;IACH;IAEA,YAAW,EAAE,IAAI,EAAiB;QAChC,OAAO,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,KAAK,EAAE;IAC/B;IAEA,wCAAwC;IACxC,GAAG,IAAA,kTAAwB,EAAC;QAC1B,UAAU;QACV,MAAM;QACN,aAAa;QACb,mBAAmB;YAAC;YAAM;YAAS;SAAoB;IACzD,EAAE;IAEF;QACE,OAAO;YACL,WAAW,IACT,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE;oBACzC,IAAI,YAAY;oBAChB,MAAM,EAAE,SAAS,EAAE,GAAG;oBACtB,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;oBAE1B,IAAI,CAAC,OAAO;wBACV,OAAO;oBACT;oBAEA,MAAM,GAAG,CAAC,YAAY,CAAC,SAAS,GAAG,QAAQ,CAAC,MAAM;wBAChD,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;4BAChC,YAAY;4BACZ,GAAG,UAAU,CAAC,IAAI,KAAK,MAAM,KAAK,QAAQ;4BAC1C,OAAO;wBACT;oBACF;oBAEA,OAAO;gBACT;QACJ;IACF;AACF","debugId":null}},
    {"offset": {"line": 898, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/MentionList.tsx"],"sourcesContent":["'use client';\n\nimport React, {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { WorkspaceMember } from '@/types/workspace';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { User } from 'lucide-react';\n\nexport interface MentionListProps {\n  items: WorkspaceMember[];\n  command: (item: {\n    id: string;\n    label: string;\n    workspaceMemberId: number;\n  }) => void;\n}\n\nexport interface MentionListRef {\n  onKeyDown: (props: { event: KeyboardEvent }) => boolean;\n}\n\nexport const MentionList = forwardRef<MentionListRef, MentionListProps>(\n  (props, ref) => {\n    const [selectedIndex, setSelectedIndex] = useState(0);\n\n    const selectItem = (index: number) => {\n      const item = props.items[index];\n\n      if (item) {\n        props.command({\n          id: `member-${item.id}`,\n          label: item.user_profile?.name || 'Unknown',\n          workspaceMemberId: item.id,\n        });\n      }\n    };\n\n    const upHandler = () => {\n      setSelectedIndex(\n        (selectedIndex + props.items.length - 1) % props.items.length\n      );\n    };\n\n    const downHandler = () => {\n      setSelectedIndex((selectedIndex + 1) % props.items.length);\n    };\n\n    const enterHandler = () => {\n      selectItem(selectedIndex);\n    };\n\n    useEffect(() => setSelectedIndex(0), [props.items]);\n\n    useImperativeHandle(ref, () => ({\n      onKeyDown: ({ event }: { event: KeyboardEvent }) => {\n        if (event.key === 'ArrowUp') {\n          upHandler();\n          return true;\n        }\n\n        if (event.key === 'ArrowDown') {\n          downHandler();\n          return true;\n        }\n\n        if (event.key === 'Enter') {\n          enterHandler();\n          return true;\n        }\n\n        return false;\n      },\n    }));\n\n    return (\n      <div className='bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg shadow-lg overflow-hidden max-h-[300px] overflow-y-auto'>\n        {props.items.length ? (\n          props.items.map((item, index) => (\n            <button\n              className={`flex items-center gap-3 w-full px-4 py-2.5 text-left transition-colors ${\n                index === selectedIndex ? 'bg-white/20' : 'hover:bg-white/10'\n              }`}\n              key={item.id}\n              onClick={() => selectItem(index)}\n              type='button'\n            >\n              <Avatar className='h-8 w-8 border border-white/20 bg-white/10'>\n                {item.user_profile?.avatar_url ? (\n                  <AvatarImage\n                    src={item.user_profile.avatar_url}\n                    alt={item.user_profile.name ?? 'Member'}\n                  />\n                ) : (\n                  <AvatarFallback>\n                    <User className='w-4 h-4 text-gray-300' />\n                  </AvatarFallback>\n                )}\n              </Avatar>\n              <div>\n                <div className='text-white font-medium'>\n                  {item.user_profile?.name || 'Unknown'}\n                </div>\n                <div className='text-xs text-gray-400 capitalize'>\n                  {item.role}\n                </div>\n              </div>\n            </button>\n          ))\n        ) : (\n          <div className='px-4 py-3 text-sm text-gray-400'>\n            No members found\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nMentionList.displayName = 'MentionList';\n"],"names":[],"mappings":";;;;;AAEA;AAOA;AACA;AAVA;;;;;AAyBO,MAAM,4BAAc,IAAA,ucAAU,EACnC,CAAC,OAAO;IACN,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,qcAAQ,EAAC;IAEnD,MAAM,aAAa,CAAC;QAClB,MAAM,OAAO,MAAM,KAAK,CAAC,MAAM;QAE/B,IAAI,MAAM;YACR,MAAM,OAAO,CAAC;gBACZ,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE;gBACvB,OAAO,KAAK,YAAY,EAAE,QAAQ;gBAClC,mBAAmB,KAAK,EAAE;YAC5B;QACF;IACF;IAEA,MAAM,YAAY;QAChB,iBACE,CAAC,gBAAgB,MAAM,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAEjE;IAEA,MAAM,cAAc;QAClB,iBAAiB,CAAC,gBAAgB,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAC3D;IAEA,MAAM,eAAe;QACnB,WAAW;IACb;IAEA,IAAA,scAAS,EAAC,IAAM,iBAAiB,IAAI;QAAC,MAAM,KAAK;KAAC;IAElD,IAAA,gdAAmB,EAAC,KAAK,IAAM,CAAC;YAC9B,WAAW,CAAC,EAAE,KAAK,EAA4B;gBAC7C,IAAI,MAAM,GAAG,KAAK,WAAW;oBAC3B;oBACA,OAAO;gBACT;gBAEA,IAAI,MAAM,GAAG,KAAK,aAAa;oBAC7B;oBACA,OAAO;gBACT;gBAEA,IAAI,MAAM,GAAG,KAAK,SAAS;oBACzB;oBACA,OAAO;gBACT;gBAEA,OAAO;YACT;QACF,CAAC;IAED,qBACE,keAAC;QAAI,WAAU;kBACZ,MAAM,KAAK,CAAC,MAAM,GACjB,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,sBACrB,keAAC;gBACC,WAAW,CAAC,uEAAuE,EACjF,UAAU,gBAAgB,gBAAgB,qBAC1C;gBAEF,SAAS,IAAM,WAAW;gBAC1B,MAAK;;kCAEL,keAAC,iMAAM;wBAAC,WAAU;kCACf,KAAK,YAAY,EAAE,2BAClB,keAAC,sMAAW;4BACV,KAAK,KAAK,YAAY,CAAC,UAAU;4BACjC,KAAK,KAAK,YAAY,CAAC,IAAI,IAAI;;;;;qFAGjC,keAAC,yMAAc;sCACb,cAAA,keAAC,oUAAI;gCAAC,WAAU;;;;;;;;;;;;;;;;kCAItB,keAAC;;0CACC,keAAC;gCAAI,WAAU;0CACZ,KAAK,YAAY,EAAE,QAAQ;;;;;;0CAE9B,keAAC;gCAAI,WAAU;0CACZ,KAAK,IAAI;;;;;;;;;;;;;eArBT,KAAK,EAAE;;;;0EA2BhB,keAAC;YAAI,WAAU;sBAAkC;;;;;;;;;;;AAMzD;AAGF,YAAY,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1034, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/mentionSuggestion.ts"],"sourcesContent":["import { ReactRenderer } from '@tiptap/react';\nimport tippy, { Instance as TippyInstance } from 'tippy.js';\nimport { MentionList, MentionListRef } from '@/components/tiptap/MentionList';\nimport { WorkspaceMember } from '@/types/workspace';\nimport { SuggestionOptions, SuggestionProps } from '@tiptap/suggestion';\n\nexport const createMentionSuggestion = (\n  getMembersRef: () => WorkspaceMember[]\n): Omit<SuggestionOptions, 'editor'> => ({\n  items: ({ query }: { query: string }) => {\n    const members = getMembersRef();\n    return members\n      .filter(member => {\n        const name = member.user_profile?.name?.toLowerCase() || '';\n        return name.includes(query.toLowerCase());\n      })\n      .slice(0, 5);\n  },\n\n  render: () => {\n    let component: ReactRenderer<MentionListRef> | undefined;\n    let popup: TippyInstance[] | undefined;\n\n    return {\n      onStart: (props: SuggestionProps) => {\n        component = new ReactRenderer(MentionList, {\n          props,\n          editor: props.editor,\n        });\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup = tippy('body', {\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n          appendTo: () => document.body,\n          content: component.element,\n          showOnCreate: true,\n          interactive: true,\n          trigger: 'manual',\n          placement: 'bottom-start',\n        });\n      },\n\n      onUpdate(props: SuggestionProps) {\n        component?.updateProps(props);\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup?.[0]?.setProps({\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n        });\n      },\n\n      onKeyDown(props: { event: KeyboardEvent }) {\n        if (props.event.key === 'Escape') {\n          popup?.[0]?.hide();\n          return true;\n        }\n\n        return component?.ref?.onKeyDown(props) ?? false;\n      },\n\n      onExit() {\n        popup?.[0]?.destroy();\n        component?.destroy();\n      },\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAIO,MAAM,0BAA0B,CACrC,gBACsC,CAAC;QACvC,OAAO,CAAC,EAAE,KAAK,EAAqB;YAClC,MAAM,UAAU;YAChB,OAAO,QACJ,MAAM,CAAC,CAAA;gBACN,MAAM,OAAO,OAAO,YAAY,EAAE,MAAM,iBAAiB;gBACzD,OAAO,KAAK,QAAQ,CAAC,MAAM,WAAW;YACxC,GACC,KAAK,CAAC,GAAG;QACd;QAEA,QAAQ;YACN,IAAI;YACJ,IAAI;YAEJ,OAAO;gBACL,SAAS,CAAC;oBACR,YAAY,IAAI,mbAAa,CAAC,+MAAW,EAAE;wBACzC;wBACA,QAAQ,MAAM,MAAM;oBACtB;oBAEA,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,QAAQ,IAAA,4PAAK,EAAC,QAAQ;wBACpB,wBAAwB,MAAM,UAAU;wBACxC,UAAU,IAAM,SAAS,IAAI;wBAC7B,SAAS,UAAU,OAAO;wBAC1B,cAAc;wBACd,aAAa;wBACb,SAAS;wBACT,WAAW;oBACb;gBACF;gBAEA,UAAS,KAAsB;oBAC7B,WAAW,YAAY;oBAEvB,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,OAAO,CAAC,EAAE,EAAE,SAAS;wBACnB,wBAAwB,MAAM,UAAU;oBAC1C;gBACF;gBAEA,WAAU,KAA+B;oBACvC,IAAI,MAAM,KAAK,CAAC,GAAG,KAAK,UAAU;wBAChC,OAAO,CAAC,EAAE,EAAE;wBACZ,OAAO;oBACT;oBAEA,OAAO,WAAW,KAAK,UAAU,UAAU;gBAC7C;gBAEA;oBACE,OAAO,CAAC,EAAE,EAAE;oBACZ,WAAW;gBACb;YACF;QACF;IACF,CAAC","debugId":null}},
    {"offset": {"line": 1101, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/NoteMentionExtension.ts"],"sourcesContent":["import { createInlineMarkdownSpec, mergeAttributes } from '@tiptap/core';\nimport Mention from '@tiptap/extension-mention';\n\nexport interface NoteMentionNodeAttrs {\n  id: string;\n  label: string;\n  noteId: number;\n}\n\nexport const NoteMention = Mention.extend({\n  name: 'noteMention',\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-id'),\n        renderHTML: (attributes: { id: string }) => {\n          if (!attributes.id) {\n            return {};\n          }\n          return {\n            'data-id': attributes.id,\n          };\n        },\n      },\n      label: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute('data-label'),\n        renderHTML: (attributes: { label: string }) => {\n          if (!attributes.label) {\n            return {};\n          }\n          return {\n            'data-label': attributes.label,\n          };\n        },\n      },\n      noteId: {\n        default: null,\n        parseHTML: (element: HTMLElement) => {\n          const id = element.getAttribute('data-note-id');\n          return id ? parseInt(id, 10) : null;\n        },\n        renderHTML: (attributes: { noteId: number }) => {\n          if (!attributes.noteId) {\n            return {};\n          }\n          return {\n            'data-note-id': attributes.noteId,\n          };\n        },\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span[data-type=\"noteMention\"]',\n      },\n    ];\n  },\n\n  renderHTML({\n    node,\n    HTMLAttributes,\n  }: {\n    node: Node;\n    HTMLAttributes: { [key: string]: string };\n  }) {\n    return [\n      'span',\n      mergeAttributes(\n        { 'data-type': 'noteMention' },\n        this.options.HTMLAttributes,\n        HTMLAttributes\n      ),\n      `#${HTMLAttributes['data-label'] || ''}`,\n    ];\n  },\n\n  renderText({ node }: { node: any }) {\n    return `#${node.attrs.label}`;\n  },\n\n  // Markdown support using Tiptap utility\n  ...createInlineMarkdownSpec({\n    nodeName: 'noteMention',\n    name: '#',\n    selfClosing: true,\n    allowedAttributes: ['id', 'label', 'noteId'],\n  }),\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () =>\n        this.editor.commands.command(({ tr, state }) => {\n          let isNoteMention = false;\n          const { selection } = state;\n          const { empty, anchor } = selection;\n\n          if (!empty) {\n            return false;\n          }\n\n          state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n            if (node.type.name === this.name) {\n              isNoteMention = true;\n              tr.insertText('', pos, pos + node.nodeSize);\n              return false;\n            }\n          });\n\n          return isNoteMention;\n        }),\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,MAAM,cAAc,yaAAO,CAAC,MAAM,CAAC;IACxC,MAAM;IAEN;QACE,OAAO;YACL,IAAI;gBACF,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,EAAE,EAAE;wBAClB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,WAAW,WAAW,EAAE;oBAC1B;gBACF;YACF;YACA,OAAO;gBACL,SAAS;gBACT,WAAW,CAAC,UAAyB,QAAQ,YAAY,CAAC;gBAC1D,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,KAAK,EAAE;wBACrB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,cAAc,WAAW,KAAK;oBAChC;gBACF;YACF;YACA,QAAQ;gBACN,SAAS;gBACT,WAAW,CAAC;oBACV,MAAM,KAAK,QAAQ,YAAY,CAAC;oBAChC,OAAO,KAAK,SAAS,IAAI,MAAM;gBACjC;gBACA,YAAY,CAAC;oBACX,IAAI,CAAC,WAAW,MAAM,EAAE;wBACtB,OAAO,CAAC;oBACV;oBACA,OAAO;wBACL,gBAAgB,WAAW,MAAM;oBACnC;gBACF;YACF;QACF;IACF;IAEA;QACE,OAAO;YACL;gBACE,KAAK;YACP;SACD;IACH;IAEA,YAAW,EACT,IAAI,EACJ,cAAc,EAIf;QACC,OAAO;YACL;YACA,IAAA,ySAAe,EACb;gBAAE,aAAa;YAAc,GAC7B,IAAI,CAAC,OAAO,CAAC,cAAc,EAC3B;YAEF,CAAC,CAAC,EAAE,cAAc,CAAC,aAAa,IAAI,IAAI;SACzC;IACH;IAEA,YAAW,EAAE,IAAI,EAAiB;QAChC,OAAO,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,KAAK,EAAE;IAC/B;IAEA,wCAAwC;IACxC,GAAG,IAAA,kTAAwB,EAAC;QAC1B,UAAU;QACV,MAAM;QACN,aAAa;QACb,mBAAmB;YAAC;YAAM;YAAS;SAAS;IAC9C,EAAE;IAEF;QACE,OAAO;YACL,WAAW,IACT,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE;oBACzC,IAAI,gBAAgB;oBACpB,MAAM,EAAE,SAAS,EAAE,GAAG;oBACtB,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;oBAE1B,IAAI,CAAC,OAAO;wBACV,OAAO;oBACT;oBAEA,MAAM,GAAG,CAAC,YAAY,CAAC,SAAS,GAAG,QAAQ,CAAC,MAAM;wBAChD,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;4BAChC,gBAAgB;4BAChB,GAAG,UAAU,CAAC,IAAI,KAAK,MAAM,KAAK,QAAQ;4BAC1C,OAAO;wBACT;oBACF;oBAEA,OAAO;gBACT;QACJ;IACF;AACF","debugId":null}},
    {"offset": {"line": 1209, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/components/tiptap/NoteList.tsx"],"sourcesContent":["'use client';\n\nimport React, {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { NoteWithParsed } from '@/types/note';\nimport { FileText } from 'lucide-react';\n\nexport interface NoteListProps {\n  items: NoteWithParsed[];\n  command: (item: { id: string; label: string; noteId: number }) => void;\n}\n\nexport interface NoteListRef {\n  onKeyDown: (props: { event: KeyboardEvent }) => boolean;\n}\n\nexport const NoteList = forwardRef<NoteListRef, NoteListProps>((props, ref) => {\n  const [selectedIndex, setSelectedIndex] = useState(0);\n\n  const selectItem = (index: number) => {\n    const item = props.items[index];\n\n    if (item) {\n      props.command({\n        id: `note-${item.id}`,\n        label: item.title || 'Untitled',\n        noteId: item.id,\n      });\n    }\n  };\n\n  const upHandler = () => {\n    setSelectedIndex(\n      (selectedIndex + props.items.length - 1) % props.items.length\n    );\n  };\n\n  const downHandler = () => {\n    setSelectedIndex((selectedIndex + 1) % props.items.length);\n  };\n\n  const enterHandler = () => {\n    selectItem(selectedIndex);\n  };\n\n  useEffect(() => setSelectedIndex(0), [props.items]);\n\n  useImperativeHandle(ref, () => ({\n    onKeyDown: ({ event }: { event: KeyboardEvent }) => {\n      if (event.key === 'ArrowUp') {\n        upHandler();\n        return true;\n      }\n\n      if (event.key === 'ArrowDown') {\n        downHandler();\n        return true;\n      }\n\n      if (event.key === 'Enter') {\n        enterHandler();\n        return true;\n      }\n\n      return false;\n    },\n  }));\n\n  return (\n    <div className='bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg shadow-lg overflow-hidden max-h-[300px] overflow-y-auto'>\n      {props.items.length ? (\n        props.items.map((item, index) => (\n          <button\n            className={`flex items-center gap-3 w-full px-4 py-2.5 text-left transition-colors ${\n              index === selectedIndex ? 'bg-white/20' : 'hover:bg-white/10'\n            }`}\n            key={item.id}\n            onClick={() => selectItem(index)}\n            type='button'\n          >\n            <div className='flex items-center justify-center w-8 h-8 rounded bg-green-500/20 border border-green-500/30'>\n              <FileText className='w-4 h-4 text-green-400' />\n            </div>\n            <div className='flex-1 min-w-0'>\n              <div className='text-white font-medium truncate'>\n                {item.title || 'Untitled'}\n              </div>\n              {item.content && (\n                <div className='text-xs text-gray-400 truncate'>\n                  {item.content.substring(0, 60)}\n                  {item.content.length > 60 ? '...' : ''}\n                </div>\n              )}\n            </div>\n          </button>\n        ))\n      ) : (\n        <div className='px-4 py-3 text-sm text-gray-400'>No notes found</div>\n      )}\n    </div>\n  );\n});\n\nNoteList.displayName = 'NoteList';\n"],"names":[],"mappings":";;;;;AAEA;AAOA;AATA;;;;AAoBO,MAAM,yBAAW,IAAA,ucAAU,EAA6B,CAAC,OAAO;IACrE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,qcAAQ,EAAC;IAEnD,MAAM,aAAa,CAAC;QAClB,MAAM,OAAO,MAAM,KAAK,CAAC,MAAM;QAE/B,IAAI,MAAM;YACR,MAAM,OAAO,CAAC;gBACZ,IAAI,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE;gBACrB,OAAO,KAAK,KAAK,IAAI;gBACrB,QAAQ,KAAK,EAAE;YACjB;QACF;IACF;IAEA,MAAM,YAAY;QAChB,iBACE,CAAC,gBAAgB,MAAM,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAEjE;IAEA,MAAM,cAAc;QAClB,iBAAiB,CAAC,gBAAgB,CAAC,IAAI,MAAM,KAAK,CAAC,MAAM;IAC3D;IAEA,MAAM,eAAe;QACnB,WAAW;IACb;IAEA,IAAA,scAAS,EAAC,IAAM,iBAAiB,IAAI;QAAC,MAAM,KAAK;KAAC;IAElD,IAAA,gdAAmB,EAAC,KAAK,IAAM,CAAC;YAC9B,WAAW,CAAC,EAAE,KAAK,EAA4B;gBAC7C,IAAI,MAAM,GAAG,KAAK,WAAW;oBAC3B;oBACA,OAAO;gBACT;gBAEA,IAAI,MAAM,GAAG,KAAK,aAAa;oBAC7B;oBACA,OAAO;gBACT;gBAEA,IAAI,MAAM,GAAG,KAAK,SAAS;oBACzB;oBACA,OAAO;gBACT;gBAEA,OAAO;YACT;QACF,CAAC;IAED,qBACE,keAAC;QAAI,WAAU;kBACZ,MAAM,KAAK,CAAC,MAAM,GACjB,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,sBACrB,keAAC;gBACC,WAAW,CAAC,uEAAuE,EACjF,UAAU,gBAAgB,gBAAgB,qBAC1C;gBAEF,SAAS,IAAM,WAAW;gBAC1B,MAAK;;kCAEL,keAAC;wBAAI,WAAU;kCACb,cAAA,keAAC,oVAAQ;4BAAC,WAAU;;;;;;;;;;;kCAEtB,keAAC;wBAAI,WAAU;;0CACb,keAAC;gCAAI,WAAU;0CACZ,KAAK,KAAK,IAAI;;;;;;4BAEhB,KAAK,OAAO,kBACX,keAAC;gCAAI,WAAU;;oCACZ,KAAK,OAAO,CAAC,SAAS,CAAC,GAAG;oCAC1B,KAAK,OAAO,CAAC,MAAM,GAAG,KAAK,QAAQ;;;;;;;;;;;;;;eAdrC,KAAK,EAAE;;;;0EAqBhB,keAAC;YAAI,WAAU;sBAAkC;;;;;;;;;;;AAIzD;AAEA,SAAS,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 1334, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/noteMentionSuggestion.ts"],"sourcesContent":["import { ReactRenderer } from '@tiptap/react';\nimport tippy, { Instance as TippyInstance } from 'tippy.js';\nimport { NoteList, NoteListRef } from '@/components/tiptap/NoteList';\nimport { NoteWithParsed } from '@/types/note';\nimport { SuggestionOptions, SuggestionProps } from '@tiptap/suggestion';\n\nexport const createNoteMentionSuggestion = (\n  getNotesRef: () => NoteWithParsed[]\n): Omit<SuggestionOptions, 'editor'> => ({\n  char: '#',\n  items: ({ query }: { query: string }) => {\n    const notes = getNotesRef();\n    return notes\n      .filter(note => {\n        const title = note.title?.toLowerCase() || '';\n        const content = note.content?.toLowerCase() || '';\n        const queryLower = query.toLowerCase();\n        return title.includes(queryLower) || content.includes(queryLower);\n      })\n      .slice(0, 5);\n  },\n\n  render: () => {\n    let component: ReactRenderer<NoteListRef> | undefined;\n    let popup: TippyInstance[] | undefined;\n\n    return {\n      onStart: (props: SuggestionProps) => {\n        component = new ReactRenderer(NoteList, {\n          props,\n          editor: props.editor,\n        });\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup = tippy('body', {\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n          appendTo: () => document.body,\n          content: component.element,\n          showOnCreate: true,\n          interactive: true,\n          trigger: 'manual',\n          placement: 'bottom-start',\n        });\n      },\n\n      onUpdate(props: SuggestionProps) {\n        component?.updateProps(props);\n\n        if (!props.clientRect) {\n          return;\n        }\n\n        popup?.[0]?.setProps({\n          getReferenceClientRect: props.clientRect as () => DOMRect,\n        });\n      },\n\n      onKeyDown(props: { event: KeyboardEvent }) {\n        if (props.event.key === 'Escape') {\n          popup?.[0]?.hide();\n          return true;\n        }\n\n        return component?.ref?.onKeyDown(props) ?? false;\n      },\n\n      onExit() {\n        popup?.[0]?.destroy();\n        component?.destroy();\n      },\n    };\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAIO,MAAM,8BAA8B,CACzC,cACsC,CAAC;QACvC,MAAM;QACN,OAAO,CAAC,EAAE,KAAK,EAAqB;YAClC,MAAM,QAAQ;YACd,OAAO,MACJ,MAAM,CAAC,CAAA;gBACN,MAAM,QAAQ,KAAK,KAAK,EAAE,iBAAiB;gBAC3C,MAAM,UAAU,KAAK,OAAO,EAAE,iBAAiB;gBAC/C,MAAM,aAAa,MAAM,WAAW;gBACpC,OAAO,MAAM,QAAQ,CAAC,eAAe,QAAQ,QAAQ,CAAC;YACxD,GACC,KAAK,CAAC,GAAG;QACd;QAEA,QAAQ;YACN,IAAI;YACJ,IAAI;YAEJ,OAAO;gBACL,SAAS,CAAC;oBACR,YAAY,IAAI,mbAAa,CAAC,yMAAQ,EAAE;wBACtC;wBACA,QAAQ,MAAM,MAAM;oBACtB;oBAEA,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,QAAQ,IAAA,4PAAK,EAAC,QAAQ;wBACpB,wBAAwB,MAAM,UAAU;wBACxC,UAAU,IAAM,SAAS,IAAI;wBAC7B,SAAS,UAAU,OAAO;wBAC1B,cAAc;wBACd,aAAa;wBACb,SAAS;wBACT,WAAW;oBACb;gBACF;gBAEA,UAAS,KAAsB;oBAC7B,WAAW,YAAY;oBAEvB,IAAI,CAAC,MAAM,UAAU,EAAE;wBACrB;oBACF;oBAEA,OAAO,CAAC,EAAE,EAAE,SAAS;wBACnB,wBAAwB,MAAM,UAAU;oBAC1C;gBACF;gBAEA,WAAU,KAA+B;oBACvC,IAAI,MAAM,KAAK,CAAC,GAAG,KAAK,UAAU;wBAChC,OAAO,CAAC,EAAE,EAAE;wBACZ,OAAO;oBACT;oBAEA,OAAO,WAAW,KAAK,UAAU,UAAU;gBAC7C;gBAEA;oBACE,OAAO,CAAC,EAAE,EAAE;oBACZ,WAAW;gBACb;YACF;QACF;IACF,CAAC","debugId":null}},
    {"offset": {"line": 1404, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/api/mentionsApi.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/browserClient';\n\nconst supabase = createClient();\n\nexport interface Mention {\n  id: number;\n  workspace_id: number;\n  created_at: string;\n  source_type: 'note' | 'message';\n  source_id: number;\n  target_type: 'workspace_member' | 'note';\n  target_id: number;\n  created_by: number;\n}\n\n/**\n * Create a mention record\n */\nexport async function createMention(\n  workspaceId: number,\n  sourceType: 'note' | 'message',\n  sourceId: number,\n  targetType: 'workspace_member' | 'note',\n  targetId: number,\n  createdBy: number\n): Promise<Mention> {\n  const { data, error } = await supabase\n    .from('mentions')\n    .insert({\n      workspace_id: workspaceId,\n      source_type: sourceType,\n      source_id: sourceId,\n      target_type: targetType,\n      target_id: targetId,\n      created_by: createdBy,\n    })\n    .select()\n    .single();\n\n  if (error) throw error;\n  return data;\n}\n\n/**\n * Get all mentions for a specific note or message\n */\nexport async function getMentionsForSource(\n  sourceType: 'note' | 'message',\n  sourceId: number\n): Promise<Mention[]> {\n  const { data, error } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', sourceType)\n    .eq('source_id', sourceId);\n\n  if (error) throw error;\n  return data || [];\n}\n\n/**\n * Sync member mentions for a note - compares existing with new and updates accordingly\n */\nexport async function syncNoteMemberMentions(\n  noteId: number,\n  workspaceId: number,\n  mentionedMemberIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing member mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'note')\n    .eq('source_id', noteId)\n    .eq('target_type', 'workspace_member');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedMemberIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedMemberIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'note' as const,\n      source_id: noteId,\n      target_type: 'workspace_member' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Sync note mentions for a note - compares existing with new and updates accordingly\n */\nexport async function syncNoteToNoteMentions(\n  noteId: number,\n  workspaceId: number,\n  mentionedNoteIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing note mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'note')\n    .eq('source_id', noteId)\n    .eq('target_type', 'note');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedNoteIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedNoteIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'note' as const,\n      source_id: noteId,\n      target_type: 'note' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Delete all mentions for a note\n */\nexport async function deleteNoteMentions(noteId: number): Promise<void> {\n  const { error } = await supabase\n    .from('mentions')\n    .delete()\n    .eq('source_type', 'note')\n    .eq('source_id', noteId);\n\n  if (error) throw error;\n}\n\n/**\n * Sync member mentions for a workspace message - compares existing with new and updates accordingly\n */\nexport async function syncWorkspaceMessageMentions(\n  messageId: number,\n  workspaceId: number,\n  mentionedMemberIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing member mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'message')\n    .eq('source_id', messageId)\n    .eq('target_type', 'workspace_member');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedMemberIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedMemberIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'message' as const,\n      source_id: messageId,\n      target_type: 'workspace_member' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Sync file mentions for a workspace message - compares existing with new and updates accordingly\n */\nexport async function syncWorkspaceMessageFileMentions(\n  messageId: number,\n  workspaceId: number,\n  mentionedFileIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing file mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'message')\n    .eq('source_id', messageId)\n    .eq('target_type', 'workspace_file');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedFileIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedFileIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'message' as const,\n      source_id: messageId,\n      target_type: 'workspace_file' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Sync note mentions for a workspace message - compares existing with new and updates accordingly\n */\nexport async function syncWorkspaceMessageNoteMentions(\n  messageId: number,\n  workspaceId: number,\n  mentionedNoteIds: number[],\n  createdBy: number\n): Promise<void> {\n  // Get existing note mentions\n  const { data: existing, error: fetchError } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('source_type', 'message')\n    .eq('source_id', messageId)\n    .eq('target_type', 'note');\n\n  if (fetchError) throw fetchError;\n\n  const existingIds = new Set((existing || []).map(m => m.target_id));\n  const newIds = new Set(mentionedNoteIds);\n\n  // Delete mentions that no longer exist\n  const toDelete = (existing || []).filter(m => !newIds.has(m.target_id));\n  if (toDelete.length > 0) {\n    const { error: deleteError } = await supabase\n      .from('mentions')\n      .delete()\n      .in(\n        'id',\n        toDelete.map(m => m.id)\n      );\n\n    if (deleteError) throw deleteError;\n  }\n\n  // Add new mentions\n  const toAdd = mentionedNoteIds.filter(id => !existingIds.has(id));\n  if (toAdd.length > 0) {\n    const newMentions = toAdd.map(targetId => ({\n      workspace_id: workspaceId,\n      source_type: 'message' as const,\n      source_id: messageId,\n      target_type: 'note' as const,\n      target_id: targetId,\n      created_by: createdBy,\n    }));\n\n    const { error: insertError } = await supabase\n      .from('mentions')\n      .insert(newMentions);\n\n    if (insertError) throw insertError;\n  }\n}\n\n/**\n * Get all notes/messages where a user is mentioned\n */\nexport async function getUserMentions(\n  workspaceMemberId: number\n): Promise<Mention[]> {\n  const { data, error } = await supabase\n    .from('mentions')\n    .select('*')\n    .eq('target_type', 'workspace_member')\n    .eq('target_id', workspaceMemberId)\n    .order('created_at', { ascending: false });\n\n  if (error) throw error;\n  return data || [];\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1594, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/hooks/useAICompletion.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { Editor } from '@tiptap/react';\n\ninterface UseAICompletionOptions {\n  editor: Editor | null;\n  noteId?: number;\n  workspaceId?: number;\n  noteTitle?: string;\n  enabled?: boolean;\n  debounceMs?: number;\n}\n\ninterface AICompletionResult {\n  suggestion: string | null;\n  isLoading: boolean;\n  acceptSuggestion: () => void;\n  dismissSuggestion: () => void;\n  requestSuggestion: (context: string, noteTitle?: string) => void;\n}\n\nexport function useAICompletion({\n  editor,\n  noteId,\n  workspaceId,\n  enabled = true,\n  debounceMs = 4000,\n}: UseAICompletionOptions): AICompletionResult {\n  const [suggestion, setSuggestion] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const debounceTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const lastRequestRef = useRef<string>('');\n  const abortControllerRef = useRef<AbortController | null>(null);\n\n  const generateCompletion = useCallback(\n    async (context: string, noteTitle?: string) => {\n      console.log(' generateCompletion called', {\n        enabled,\n        contextLength: context.length,\n        noteTitle,\n      });\n\n      if (!enabled || !context.trim()) {\n        console.log(' Skipping - not enabled or no context');\n        setSuggestion(null);\n        return;\n      }\n\n      // Cancel any pending request\n      if (abortControllerRef.current) {\n        console.log(' Aborting previous request');\n        abortControllerRef.current.abort();\n      }\n\n      console.log(' Making API request...');\n      setIsLoading(true);\n      abortControllerRef.current = new AbortController();\n\n      try {\n        // Call our AI completion endpoint\n        const response = await fetch('/api/ai-completion', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            context,\n            noteTitle: noteTitle || '',\n          }),\n          signal: abortControllerRef.current.signal,\n        });\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({}));\n          throw new Error(errorData.error || 'Failed to generate completion');\n        }\n\n        const data = await response.json();\n        const completion = data.completion?.trim() || null;\n\n        if (completion && completion.length > 0) {\n          setSuggestion(completion);\n        } else {\n          setSuggestion(null);\n        }\n      } catch (error) {\n        if (error instanceof Error && error.name === 'AbortError') {\n          // Request was cancelled, this is expected\n          return;\n        }\n        console.error('Error generating completion:', error);\n        setSuggestion(null);\n      } finally {\n        setIsLoading(false);\n        abortControllerRef.current = null;\n      }\n    },\n    [enabled]\n  );\n\n  const requestSuggestion = useCallback(\n    (context: string, noteTitle?: string) => {\n      console.log(' requestSuggestion called', {\n        contextLength: context.length,\n        noteTitle,\n      });\n\n      lastRequestRef.current = context;\n\n      // Clear existing timer\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n\n      // Don't suggest for very short text\n      if (context.trim().length < 10) {\n        console.log(' Context too short');\n        setSuggestion(null);\n        return;\n      }\n\n      // Debounce the request\n      console.log(` Scheduling AI request in ${debounceMs}ms`);\n      debounceTimerRef.current = setTimeout(() => {\n        console.log(' Calling generateCompletion now');\n        generateCompletion(context, noteTitle || '');\n      }, debounceMs);\n    },\n    [debounceMs, generateCompletion]\n  );\n\n  const acceptSuggestion = useCallback(() => {\n    if (!editor || !suggestion) {\n      return;\n    }\n\n    // Clear suggestion from React state\n    setSuggestion(null);\n  }, [editor, suggestion]);\n\n  const dismissSuggestion = useCallback(() => {\n    setSuggestion(null);\n    if (debounceTimerRef.current) {\n      clearTimeout(debounceTimerRef.current);\n    }\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n    }\n  }, []);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    };\n  }, []);\n\n  return {\n    suggestion,\n    isLoading,\n    acceptSuggestion,\n    dismissSuggestion,\n    requestSuggestion,\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1732, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/lib/tiptap/AiCompletionExtension.ts"],"sourcesContent":["import { Extension } from '@tiptap/core';\nimport { DOMSerializer, Fragment, Slice } from '@tiptap/pm/model';\nimport { Plugin, PluginKey } from '@tiptap/pm/state';\nimport { Decoration, DecorationSet } from '@tiptap/pm/view';\n\nexport interface AiCompletionOptions {\n  suggestion: string | null;\n  onAccept: () => void;\n  onDismiss: () => void;\n  enabled: boolean;\n}\n\nexport const AiCompletionPluginKey = new PluginKey('aiCompletion');\n\nexport const AiCompletion = Extension.create<AiCompletionOptions>({\n  name: 'aiCompletion',\n\n  priority: 1000, // High priority to capture Tab before other extensions\n\n  addOptions() {\n    return {\n      suggestion: null,\n      onAccept: () => {},\n      onDismiss: () => {},\n      enabled: true,\n    };\n  },\n\n  addProseMirrorPlugins() {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const extensionThis = this;\n\n    return [\n      new Plugin({\n        key: AiCompletionPluginKey,\n\n        state: {\n          init() {\n            return {\n              suggestion: null,\n              enabled: true,\n              decorations: DecorationSet.empty,\n            };\n          },\n\n          apply(tr, oldState) {\n            // Check if there's new metadata in this transaction\n            const metaSuggestion = tr.getMeta('aiCompletionSuggestion');\n            const metaEnabled = tr.getMeta('aiCompletionEnabled');\n\n            // Update state from metadata if present, otherwise keep old values\n            const suggestion =\n              metaSuggestion !== undefined\n                ? metaSuggestion\n                : oldState.suggestion;\n            const enabled =\n              metaEnabled !== undefined ? metaEnabled : oldState.enabled;\n\n            // Removed debug logging for cleaner console\n\n            // Map old decorations through the transaction\n            let decorationSet = oldState.decorations.map(tr.mapping, tr.doc);\n\n            // Clear decorations if no suggestion or not enabled\n            if (!suggestion || !enabled) {\n              return {\n                suggestion,\n                enabled,\n                decorations: DecorationSet.empty,\n              };\n            }\n\n            // Get current cursor position\n            const { selection } = tr;\n            const { from, to } = selection;\n\n            // Only show suggestion at cursor position when cursor is collapsed\n            if (from !== to) {\n              return {\n                suggestion,\n                enabled,\n                decorations: DecorationSet.empty,\n              };\n            }\n\n            // Create a widget decoration for the ghost text\n            const widget = document.createElement('span');\n            widget.className = 'ai-completion-ghost-text';\n            const editorAttributes =\n              extensionThis.editor?.options?.editorProps?.attributes;\n            if (editorAttributes) {\n              const resolvedAttributes =\n                typeof editorAttributes === 'function'\n                  ? editorAttributes(extensionThis.editor?.state)\n                  : editorAttributes;\n              const className = resolvedAttributes?.class;\n              if (className) {\n                widget.className += ` ${className}`;\n              }\n            }\n            const applyMarkdownRendering = () => {\n              try {\n                const editor = extensionThis.editor;\n\n                if (!editor) {\n                  widget.textContent = suggestion;\n                  return;\n                }\n\n                const markdownManager = editor.storage?.markdown?.manager;\n                const schema = editor.schema;\n\n                if (!markdownManager) {\n                  widget.textContent = suggestion;\n                  return;\n                }\n\n                const parsed = markdownManager.parse(suggestion);\n\n                if (!parsed || parsed.type !== 'doc') {\n                  widget.textContent = suggestion;\n                  return;\n                }\n\n                const docNode = schema.nodeFromJSON(parsed);\n                const serializer = DOMSerializer.fromSchema(schema);\n\n                widget.textContent = '';\n\n                let appendedChild = false;\n\n                docNode.forEach((child, _offset, index) => {\n                  const fragment =\n                    child.type.name === 'paragraph'\n                      ? serializer.serializeFragment(child.content)\n                      : serializer.serializeFragment(Fragment.from(child));\n\n                  widget.appendChild(fragment);\n                  appendedChild = true;\n\n                  if (index < docNode.childCount - 1) {\n                    widget.appendChild(document.createElement('br'));\n                  }\n                });\n\n                if (!appendedChild) {\n                  widget.textContent = suggestion;\n                }\n              } catch (error) {\n                console.error('Failed to render AI completion markdown', error);\n                widget.textContent = suggestion;\n              }\n            };\n\n            applyMarkdownRendering();\n            widget.setAttribute('data-suggestion', suggestion);\n            widget.style.cssText = `\n              color: rgb(156, 163, 175) !important;\n              opacity: 0.5 !important;\n              pointer-events: none !important;\n              user-select: none !important;\n              font-style: italic !important;\n              display: inline !important;\n              position: relative !important;\n            `;\n\n            const decoration = Decoration.widget(from, widget, {\n              side: 1,\n              key: 'ai-completion',\n            });\n\n            decorationSet = DecorationSet.create(tr.doc, [decoration]);\n\n            return {\n              suggestion,\n              enabled,\n              decorations: decorationSet,\n            };\n          },\n        },\n\n        props: {\n          decorations(state) {\n            const pluginState = this.getState(state);\n            return pluginState?.decorations || DecorationSet.empty;\n          },\n\n          handleKeyDown(view, event) {\n            // Get suggestion from plugin state\n            const pluginState = this.getState(view.state);\n            const suggestion = pluginState?.suggestion;\n            const enabled = pluginState?.enabled;\n\n            if (!suggestion || !enabled) {\n              return false;\n            }\n\n            // Accept suggestion with Tab\n            if (event.key === 'Tab' && !event.shiftKey) {\n              event.preventDefault();\n              event.stopPropagation();\n\n              const editor = extensionThis.editor;\n              if (editor) {\n                const handled = editor\n                  .chain()\n                  .focus()\n                  .command(({ state, tr, dispatch, editor }) => {\n                    if (!dispatch) {\n                      return true;\n                    }\n\n                    const { from, to } = state.selection;\n                    let transaction = tr;\n                    let inserted = false;\n\n                    const markdownManager = editor.storage?.markdown?.manager;\n\n                    if (markdownManager) {\n                      try {\n                        const parsed = markdownManager.parse(suggestion);\n\n                        if (parsed?.type === 'doc') {\n                          const docNode = editor.schema.nodeFromJSON(parsed);\n\n                          if (\n                            docNode.childCount === 1 &&\n                            docNode.firstChild?.type?.name === 'paragraph'\n                          ) {\n                            const inlineFragment = docNode.firstChild.content;\n\n                            if (inlineFragment.childCount > 0) {\n                              if (from !== to) {\n                                transaction = transaction.deleteRange(from, to);\n                              }\n                              const insertPos = transaction.mapping.map(from);\n                              transaction = transaction.insert(\n                                insertPos,\n                                inlineFragment\n                              );\n                              inserted = true;\n                            }\n                          } else if (docNode.content.childCount > 0) {\n                            const slice = new Slice(docNode.content, 0, 0);\n                            transaction = transaction.replaceRange(\n                              from,\n                              to,\n                              slice\n                            );\n                            inserted = true;\n                          }\n                        }\n                      } catch (error) {\n                        console.error(\n                          'Failed to insert AI completion markdown',\n                          error\n                        );\n                      }\n                    }\n\n                    if (!inserted) {\n                      transaction = transaction.insertText(\n                        suggestion,\n                        from,\n                        to\n                      );\n                    }\n\n                    transaction.setMeta('aiCompletionSuggestion', null);\n                    transaction.setMeta('aiCompletionEnabled', enabled);\n                    dispatch(transaction);\n                    return true;\n                  })\n                  .run();\n\n                if (handled) {\n                  try {\n                    extensionThis.options.onAccept();\n                  } catch (e) {\n                    console.error('Error calling onAccept:', e);\n                  }\n                  return true;\n                }\n              }\n\n              // Fallback if editor instance is unavailable\n              const { from } = view.state.selection;\n              const tr = view.state.tr;\n              tr.insertText(suggestion, from);\n              tr.setMeta('aiCompletionSuggestion', null);\n              tr.setMeta('aiCompletionEnabled', enabled);\n              view.dispatch(tr);\n\n              try {\n                extensionThis.options.onAccept();\n              } catch (e) {\n                console.error('Error calling onAccept:', e);\n              }\n\n              return true;\n            }\n\n            // Dismiss suggestion with Escape\n            if (event.key === 'Escape') {\n              extensionThis.options.onDismiss();\n\n              // Clear via transaction\n              const tr = view.state.tr;\n              tr.setMeta('aiCompletionSuggestion', null);\n              tr.setMeta('aiCompletionEnabled', enabled);\n              view.dispatch(tr);\n\n              return true;\n            }\n\n            // Dismiss on any other typing (will be regenerated if appropriate)\n            if (\n              event.key.length === 1 ||\n              event.key === 'Backspace' ||\n              event.key === 'Delete'\n            ) {\n              extensionThis.options.onDismiss();\n\n              // Clear via transaction\n              const tr = view.state.tr;\n              tr.setMeta('aiCompletionSuggestion', null);\n              tr.setMeta('aiCompletionEnabled', enabled);\n              view.dispatch(tr);\n\n              return false; // Allow the key to be processed normally\n            }\n\n            return false;\n          },\n        },\n      }),\n    ];\n  },\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1992, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/features/notes/components/NoteEditor.tsx"],"sourcesContent":["'use client';\n\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useState, useRef, useCallback } from 'react';\nimport { useNoteEditor } from '@/hooks/useNoteEditor';\nimport {\n  ArrowLeft,\n  Bold,\n  Italic,\n  Strikethrough,\n  List,\n  ListOrdered,\n  Quote,\n  Undo,\n  Redo,\n  Users,\n  Image as ImageIcon,\n  Loader2,\n  CheckSquare,\n  Sparkles,\n} from 'lucide-react';\nimport { useEditor, EditorContent } from '@tiptap/react';\nimport StarterKit from '@tiptap/starter-kit';\nimport { Markdown } from '@tiptap/markdown';\nimport Placeholder from '@tiptap/extension-placeholder';\nimport Image from '@tiptap/extension-image';\nimport TaskList from '@tiptap/extension-task-list';\nimport TaskItem from '@tiptap/extension-task-item';\nimport { getPersonalWorkspaceId } from '@/lib/cookies';\nimport { useWorkspaceMembers } from '@/hooks/useWorkspace';\nimport { useWorkspaceNotes } from '@/hooks/useWorkspaceNotes';\nimport { assignNoteToMembers, getNoteAssignments } from '@/lib/api/notesApi';\nimport { uploadWorkspaceFile, getFileUrl } from '@/lib/api/workspaceFilesApi';\nimport { CustomMention } from '@/lib/tiptap/MentionExtension';\nimport { createMentionSuggestion } from '@/lib/tiptap/mentionSuggestion';\nimport { NoteMention } from '@/lib/tiptap/NoteMentionExtension';\nimport { createNoteMentionSuggestion } from '@/lib/tiptap/noteMentionSuggestion';\nimport {\n  syncNoteMemberMentions,\n  syncNoteToNoteMentions,\n} from '@/lib/api/mentionsApi';\nimport { createClient } from '@/lib/supabase/browserClient';\nimport { useAICompletion } from '@/hooks/useAICompletion';\nimport { AiCompletion } from '@/lib/tiptap/AiCompletionExtension';\nimport { useCopilotReadable } from '@copilotkit/react-core';\n\ninterface ToolbarButtonProps {\n  onClick: () => void;\n  isActive?: boolean;\n  disabled?: boolean;\n  icon: React.ReactNode;\n  title: string;\n}\n\ntype ToggleCommand = {\n  run: () => void;\n};\n\ntype TaskListChain = {\n  toggleTaskList?: () => ToggleCommand;\n};\n\ntype StrikeChain = {\n  toggleStrike?: () => ToggleCommand;\n};\n\nfunction ToolbarButton({\n  onClick,\n  isActive,\n  disabled,\n  icon,\n  title,\n}: ToolbarButtonProps) {\n  return (\n    <button\n      type='button'\n      onClick={onClick}\n      disabled={disabled}\n      title={title}\n      className={`p-2 rounded-lg transition-all ${\n        isActive\n          ? 'bg-white/20 text-white'\n          : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-gray-300'\n      } ${disabled ? 'opacity-50 cursor-not-allowed' : ''}`}\n    >\n      {icon}\n    </button>\n  );\n}\n\nexport default function NoteEditor({ noteId }: { noteId: string }) {\n  const router = useRouter();\n  const id = parseInt(noteId, 10);\n  const isValidId = !isNaN(id);\n\n  const { note, title, content, loading, error, setTitle, setContent } =\n    useNoteEditor(isValidId ? id : null);\n\n  // Check if this is a group workspace note (not personal)\n  const personalWorkspaceId = getPersonalWorkspaceId();\n  const isGroupNote = note?.workspace_id !== personalWorkspaceId;\n\n  // Assignment state\n  const [showAssignmentDropdown, setShowAssignmentDropdown] = useState(false);\n  const [assigneeIds, setAssigneeIds] = useState<number[]>([]);\n  const [savingAssignment, setSavingAssignment] = useState(false);\n\n  // Image upload state\n  const imageInputRef = useRef<HTMLInputElement>(null);\n  const [uploadingImage, setUploadingImage] = useState(false);\n\n  // AI Completion state\n  const [aiSuggestionsEnabled, setAiSuggestionsEnabled] = useState(() => {\n    // Load from localStorage\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem('aiSuggestionsEnabled');\n      return saved !== null ? saved === 'true' : true; // Default to enabled\n    }\n    return true;\n  });\n\n  // Fetch workspace members if this is a group note\n  const { members } = useWorkspaceMembers(\n    isGroupNote && note?.workspace_id ? note.workspace_id : 0\n  );\n\n  // Fetch workspace notes for note mentions\n  const { notes: workspaceNotes } = useWorkspaceNotes(note?.workspace_id || 0);\n\n  // Track initial loaded state to compare against\n  const [initialAssigneeIds, setInitialAssigneeIds] = useState<number[]>([]);\n  const [assignmentsLoaded, setAssignmentsLoaded] = useState(false);\n\n  // Mention state\n  const [currentMemberId, setCurrentMemberId] = useState<number | null>(null);\n  const supabase = createClient();\n\n  // Use a ref to always get the latest members for mention suggestions\n  const membersRef = useRef<typeof members>([]);\n  membersRef.current = members;\n\n  // Use a ref to always get the latest notes for note mention suggestions\n  // Filter out the current note from the suggestions\n  const notesRef = useRef<typeof workspaceNotes>([]);\n  notesRef.current = workspaceNotes.filter(n => n.id !== id);\n\n  // Get current user's workspace member ID\n  useEffect(() => {\n    if (isGroupNote && note?.workspace_id && members.length > 0) {\n      const getCurrentMember = async () => {\n        const {\n          data: { user },\n        } = await supabase.auth.getUser();\n        if (user) {\n          const member = members.find(m => m.user_id === user.id);\n          if (member) {\n            setCurrentMemberId(member.id);\n          }\n        }\n      };\n      getCurrentMember();\n    }\n  }, [isGroupNote, note?.workspace_id, members, supabase.auth]);\n\n  // Load existing assignments\n  useEffect(() => {\n    if (isGroupNote && note?.id) {\n      getNoteAssignments(note.id)\n        .then(({ assignees }) => {\n          const assigneeIdsList = assignees\n            .map((a: { workspace_member?: { id?: number } }) => {\n              return a.workspace_member?.id;\n            })\n            .filter((id): id is number => typeof id === 'number');\n\n          setAssigneeIds(assigneeIdsList);\n          setInitialAssigneeIds(assigneeIdsList);\n          setAssignmentsLoaded(true);\n        })\n        .catch(err => {\n          console.error('Failed to load assignments:', err);\n          setAssignmentsLoaded(true);\n        });\n    }\n  }, [isGroupNote, note?.id]);\n\n  // Auto-save assignments when changed (only if different from initial)\n  useEffect(() => {\n    if (!isGroupNote || !note?.id || savingAssignment || !assignmentsLoaded)\n      return;\n\n    // Check if there's an actual change from the initial state\n    const hasChanged =\n      assigneeIds.length !== initialAssigneeIds.length ||\n      assigneeIds.some(id => !initialAssigneeIds.includes(id)) ||\n      initialAssigneeIds.some(id => !assigneeIds.includes(id));\n\n    if (!hasChanged) return;\n\n    const saveAssignments = async () => {\n      try {\n        setSavingAssignment(true);\n        await assignNoteToMembers(note.id, [], assigneeIds);\n        // Update initial state after successful save\n        setInitialAssigneeIds(assigneeIds);\n      } catch (err) {\n        console.error('Failed to save assignments:', err);\n      } finally {\n        setSavingAssignment(false);\n      }\n    };\n\n    const timeout = setTimeout(saveAssignments, 500);\n    return () => clearTimeout(timeout);\n  }, [\n    assigneeIds,\n    initialAssigneeIds,\n    isGroupNote,\n    note?.id,\n    savingAssignment,\n    assignmentsLoaded,\n  ]);\n\n  const toggleAssignee = (memberId: number) => {\n    if (assigneeIds.includes(memberId)) {\n      setAssigneeIds(assigneeIds.filter(id => id !== memberId));\n    } else {\n      setAssigneeIds([...assigneeIds, memberId]);\n    }\n  };\n\n  // Handle image upload\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file || !editor || !note?.workspace_id) return;\n\n    // Validate it's an image\n    if (!file.type.startsWith('image/')) {\n      alert('Please select an image file');\n      e.target.value = '';\n      return;\n    }\n\n    setUploadingImage(true);\n    try {\n      // Upload to workspace storage\n      const uploaded = await uploadWorkspaceFile(note.workspace_id, file);\n\n      // Insert image into editor at current cursor position\n      // Store file ID in data attribute for later URL refresh\n      const { state, view } = editor;\n      const { from } = state.selection;\n\n      // Insert image with all attributes including data-file-id\n      const imageNode = state.schema.nodes.image.create({\n        src: uploaded.url,\n        alt: uploaded.original_filename,\n        'data-file-id': uploaded.id.toString(),\n      });\n\n      const tr = state.tr.insert(from, imageNode);\n      view.dispatch(tr);\n      editor.commands.focus();\n\n      // Reset input\n      e.target.value = '';\n    } catch (error) {\n      console.error('Error uploading image:', error);\n      alert('Failed to upload image. Please try again.');\n    } finally {\n      setUploadingImage(false);\n    }\n  };\n\n  const triggerImageInput = () => {\n    imageInputRef.current?.click();\n  };\n\n  const handleToggleTaskList = () => {\n    if (!editor) return;\n\n    const chain = editor.chain().focus() as unknown as TaskListChain;\n\n    if (typeof chain.toggleTaskList === 'function') {\n      chain.toggleTaskList().run();\n      return;\n    }\n\n    const commands = editor.commands as unknown as {\n      toggleTaskList?: () => boolean;\n    };\n\n    if (typeof commands.toggleTaskList === 'function') {\n      commands.toggleTaskList();\n    } else {\n      console.warn('Task list command not available');\n    }\n  };\n\n  // Initialize TipTap editor\n  const editor = useEditor({\n    immediatelyRender: false,\n    extensions: [\n      // AI Completion FIRST - needs to capture Tab before other extensions\n      AiCompletion.configure({\n        suggestion: null,\n        onAccept: () => {},\n        onDismiss: () => {},\n        enabled: aiSuggestionsEnabled,\n      }),\n      StarterKit.configure({\n        heading: {\n          levels: [1, 2, 3],\n        },\n        code: false,\n      }),\n      Placeholder.configure({\n        placeholder: '...',\n      }),\n      Image.extend({\n        addAttributes() {\n          return {\n            ...this.parent?.(),\n            'data-file-id': {\n              default: null,\n              parseHTML: element => element.getAttribute('data-file-id'),\n              renderHTML: attributes => {\n                if (!attributes['data-file-id']) {\n                  return {};\n                }\n                return {\n                  'data-file-id': attributes['data-file-id'],\n                };\n              },\n            },\n          };\n        },\n      }).configure({\n        inline: true,\n        allowBase64: false,\n        HTMLAttributes: {\n          class: 'editor-image',\n        },\n      }),\n      TaskList.configure({\n        HTMLAttributes: {\n          class: 'task-list',\n        },\n      }),\n      TaskItem.configure({\n        nested: true,\n        HTMLAttributes: {\n          class: 'task-item',\n        },\n      }),\n      // Add member mention extension only for group notes\n      ...(isGroupNote\n        ? [\n            CustomMention.configure({\n              HTMLAttributes: {\n                class: 'mention',\n              },\n              suggestion: createMentionSuggestion(() => membersRef.current),\n            }),\n          ]\n        : []),\n      // Add note mention extension (available in all workspaces)\n      NoteMention.configure({\n        HTMLAttributes: {\n          class: 'note-mention',\n        },\n        suggestion: createNoteMentionSuggestion(() => notesRef.current),\n      }),\n      Markdown,\n    ],\n    content: content || '',\n    contentType: 'markdown',\n    editorProps: {\n      attributes: {\n        class:\n          'prose prose-invert prose-sm sm:prose-base lg:prose-lg xl:prose-xl focus:outline-none max-w-none min-h-full text-gray-300',\n      },\n    },\n    onUpdate: ({ editor }) => {\n      const markdown = editor.getMarkdown();\n      setContent(markdown);\n    },\n  });\n\n  // Store note title in a ref for AI context\n  const noteTitleRef = useRef(title);\n  useEffect(() => {\n    noteTitleRef.current = title;\n  }, [title]);\n\n  // Expose editor to window for debugging (optional, can be removed in production)\n  useEffect(() => {\n    if (editor && typeof window !== 'undefined') {\n      (window as any).__TIPTAP_EDITOR__ = editor;\n    }\n  }, [editor]);\n\n  // AI Completion hook\n  const {\n    suggestion,\n    isLoading: isSuggestionLoading,\n    acceptSuggestion,\n    dismissSuggestion,\n    requestSuggestion,\n  } = useAICompletion({\n    editor,\n    noteTitle: title,\n    noteId: note?.id,\n    workspaceId: note?.workspace_id,\n    enabled: aiSuggestionsEnabled,\n    debounceMs: 1000, // 1 second after user stops typing\n  });\n\n  // Clear suggestion when cursor moves\n  const lastCursorPosRef = useRef<number | null>(null);\n  useEffect(() => {\n    if (!editor || !aiSuggestionsEnabled) return;\n\n    const updateHandler = () => {\n      const currentPos = editor.state.selection.from;\n\n      // If cursor moved and we have a suggestion, clear it\n      if (\n        lastCursorPosRef.current !== null &&\n        lastCursorPosRef.current !== currentPos &&\n        suggestion\n      ) {\n        console.log(' Cursor moved, clearing suggestion');\n        dismissSuggestion();\n      }\n\n      lastCursorPosRef.current = currentPos;\n    };\n\n    editor.on('selectionUpdate', updateHandler);\n    return () => {\n      editor.off('selectionUpdate', updateHandler);\n    };\n  }, [editor, suggestion, dismissSuggestion, aiSuggestionsEnabled]);\n\n  // Update AI completion extension options when suggestion changes\n  useEffect(() => {\n    if (editor && !editor.isDestroyed) {\n      // Store callbacks in extension options\n      const aiCompletionExt = editor.extensionManager.extensions.find(\n        ext => ext.name === 'aiCompletion'\n      );\n      if (aiCompletionExt) {\n        aiCompletionExt.options.onAccept = acceptSuggestion;\n        aiCompletionExt.options.onDismiss = dismissSuggestion;\n      }\n\n      // Pass suggestion through transaction metadata\n      const tr = editor.state.tr;\n      tr.setMeta('aiCompletionSuggestion', suggestion);\n      tr.setMeta('aiCompletionEnabled', aiSuggestionsEnabled);\n      editor.view.dispatch(tr);\n    }\n  }, [\n    editor,\n    suggestion,\n    acceptSuggestion,\n    dismissSuggestion,\n    aiSuggestionsEnabled,\n  ]);\n\n  // Trigger AI suggestions on content change\n  useEffect(() => {\n    console.log(' AI suggestion effect triggered', {\n      hasEditor: !!editor,\n      aiEnabled: aiSuggestionsEnabled,\n      isLoading: isSuggestionLoading,\n      hasSuggestion: !!suggestion,\n    });\n\n    if (!editor || !aiSuggestionsEnabled || isSuggestionLoading) {\n      console.log(' Skipping - disabled or loading');\n      return;\n    }\n\n    // Don't request new suggestions if we already have one showing (saves tokens)\n    if (suggestion) {\n      console.log(' Skipping - suggestion already showing');\n      return;\n    }\n\n    // Get text around cursor for context\n    const { from } = editor.state.selection;\n    const textBefore = editor.state.doc.textBetween(\n      Math.max(0, from - 500),\n      from,\n      '\\n'\n    );\n\n    console.log(' Text context:', {\n      length: textBefore.trim().length,\n      preview: textBefore.slice(-50),\n    });\n\n    if (textBefore.trim().length > 10) {\n      console.log(' Requesting AI suggestion');\n      requestSuggestion(textBefore, noteTitleRef.current);\n    } else {\n      console.log(' Text too short for suggestion');\n    }\n  }, [\n    content,\n    editor,\n    aiSuggestionsEnabled,\n    isSuggestionLoading,\n    requestSuggestion,\n    suggestion,\n  ]);\n\n  // Persist AI suggestions setting to localStorage\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem(\n        'aiSuggestionsEnabled',\n        String(aiSuggestionsEnabled)\n      );\n    }\n  }, [aiSuggestionsEnabled]);\n\n  // Provide context to CopilotKit\n  useCopilotReadable({\n    description: 'Current note being edited in the editor',\n    value: JSON.stringify({\n      title: title || 'Untitled',\n      content: content?.substring(0, 1000) || '',\n      workspaceId: note?.workspace_id,\n      noteId: note?.id,\n    }),\n    categories: ['note_editor'],\n  });\n\n  // Function to extract mentioned member IDs from editor content\n  const extractMemberMentions = useCallback(() => {\n    if (!editor) return [];\n\n    const mentionedIds: number[] = [];\n    editor.state.doc.descendants(node => {\n      if (node.type.name === 'mention' && node.attrs.workspaceMemberId) {\n        mentionedIds.push(node.attrs.workspaceMemberId);\n      }\n    });\n\n    return [...new Set(mentionedIds)]; // Remove duplicates\n  }, [editor]);\n\n  // Function to extract mentioned note IDs from editor content\n  const extractNoteMentions = useCallback(() => {\n    if (!editor) return [];\n\n    const mentionedNoteIds: number[] = [];\n    editor.state.doc.descendants(node => {\n      if (node.type.name === 'noteMention' && node.attrs.noteId) {\n        mentionedNoteIds.push(node.attrs.noteId);\n      }\n    });\n\n    return [...new Set(mentionedNoteIds)]; // Remove duplicates\n  }, [editor]);\n\n  // Update editor content when content from hook changes (e.g., after loading)\n  useEffect(() => {\n    if (editor && content !== undefined && !editor.isDestroyed) {\n      const currentMarkdown = editor.getMarkdown();\n      // Only update if the content is actually different to avoid cursor jumps\n      if (currentMarkdown !== content) {\n        editor.commands.setContent(content || '', { contentType: 'markdown' });\n\n        // Refresh image URLs after content is loaded (for expired signed URLs)\n        const refreshImageUrls = async () => {\n          const images: Array<{\n            node: { attrs: Record<string, unknown> };\n            pos: number;\n            fileId: number;\n          }> = [];\n\n          editor.state.doc.descendants((node, pos) => {\n            if (node.type.name === 'image') {\n              const fileId = node.attrs['data-file-id'];\n              if (fileId) {\n                images.push({ node, pos, fileId: parseInt(fileId, 10) });\n              }\n            }\n          });\n\n          if (images.length === 0) return;\n\n          // Refresh URLs for all images with file IDs\n          for (const { node, pos, fileId } of images) {\n            try {\n              const newUrl = await getFileUrl(fileId);\n              if (newUrl && newUrl !== node.attrs.src) {\n                // Update the image at this position\n                const tr = editor.state.tr;\n                tr.setNodeMarkup(pos, undefined, {\n                  ...node.attrs,\n                  src: newUrl,\n                });\n                editor.view.dispatch(tr);\n              }\n            } catch (error) {\n              console.error('Error refreshing image URL:', error);\n            }\n          }\n        };\n\n        // Small delay to ensure content is fully loaded\n        setTimeout(refreshImageUrls, 500);\n      }\n    }\n  }, [content, editor]);\n\n  // Auto-save member mentions when content changes\n  useEffect(() => {\n    if (\n      !isGroupNote ||\n      !note?.id ||\n      !note?.workspace_id ||\n      !currentMemberId ||\n      !editor\n    )\n      return;\n\n    const saveMemberMentions = async () => {\n      try {\n        const mentionedMemberIds = extractMemberMentions();\n        await syncNoteMemberMentions(\n          note.id,\n          note.workspace_id,\n          mentionedMemberIds,\n          currentMemberId\n        );\n      } catch (err) {\n        console.error('Failed to save member mentions:', err);\n      }\n    };\n\n    const timeout = setTimeout(saveMemberMentions, 1000);\n    return () => clearTimeout(timeout);\n  }, [\n    content,\n    isGroupNote,\n    note?.id,\n    note?.workspace_id,\n    currentMemberId,\n    extractMemberMentions,\n    editor,\n  ]);\n\n  // Auto-save note mentions when content changes\n  useEffect(() => {\n    if (!note?.id || !note?.workspace_id || !currentMemberId || !editor) return;\n\n    const saveNoteMentions = async () => {\n      try {\n        const mentionedNoteIds = extractNoteMentions();\n        await syncNoteToNoteMentions(\n          note.id,\n          note.workspace_id,\n          mentionedNoteIds,\n          currentMemberId\n        );\n      } catch (err) {\n        console.error('Failed to save note mentions:', err);\n      }\n    };\n\n    const timeout = setTimeout(saveNoteMentions, 1000);\n    return () => clearTimeout(timeout);\n  }, [\n    content,\n    note?.id,\n    note?.workspace_id,\n    currentMemberId,\n    extractNoteMentions,\n    editor,\n  ]);\n\n  // Validate that noteId is a valid number (after hooks)\n  if (!isValidId) {\n    return (\n      <div className='flex flex-col h-full bg-gradient-to-br from-slate-950 via-black to-slate-950 text-gray-100 items-center justify-center p-6'>\n        <div className='bg-red-500/10 border border-red-500/20 rounded-lg p-6 text-red-300 max-w-md'>\n          <h2 className='font-bold mb-2'>Invalid Note ID</h2>\n          <p>The note ID must be a valid number.</p>\n          <button\n            onClick={() => router.push('/notes')}\n            className='mt-4 px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition'\n          >\n            Back to Notes\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (loading) {\n    return (\n      <div className='flex flex-col h-full bg-gradient-to-br from-slate-950 via-black to-slate-950 text-gray-100 items-center justify-center'>\n        <div className='animate-spin rounded-full h-12 w-12 border-b-2 border-white'></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className='flex flex-col h-full bg-gradient-to-br from-slate-950 via-black to-slate-950 text-gray-100 items-center justify-center p-6'>\n        <div className='bg-red-500/10 border border-red-500/20 rounded-lg p-6 text-red-300 max-w-md'>\n          <h2 className='font-bold mb-2'>Error</h2>\n          <p>{error}</p>\n          <button\n            onClick={() => router.push('/notes')}\n            className='mt-4 px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition'\n          >\n            Back to Notes\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!note && !loading) {\n    return (\n      <div className='flex flex-col h-full bg-gradient-to-br from-slate-950 via-black to-slate-950 text-gray-100 items-center justify-center p-6'>\n        <div className='bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-6 text-yellow-300 max-w-md'>\n          <h2 className='font-bold mb-2'>Note Not Found</h2>\n          <p>This note does not exist or you don&apos;t have access to it.</p>\n          <button\n            onClick={() => router.push('/notes')}\n            className='mt-4 px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition'\n          >\n            Back to Notes\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!editor) {\n    return null;\n  }\n\n  return (\n    <div\n      className='flex flex-col h-full bg-gradient-to-br from-slate-950 via-black to-slate-950 text-gray-100 relative overflow-hidden'\n      style={{\n        willChange: 'scroll-position',\n        transform: 'translateZ(0)',\n        WebkitOverflowScrolling: 'touch',\n      }}\n    >\n      {/*  */}\n      <header className='flex items-center gap-3 px-4 md:px-6 py-6 relative z-30'>\n        {/*  -  */}\n        <button\n          onClick={() => router.back()}\n          className='w-[50px] h-[50px] rounded-full bg-white/10 backdrop-blur-xl text-white border border-black transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:bg-white/15 hover:scale-102 hover:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] flex items-center justify-center'\n        >\n          <ArrowLeft className='w-5 h-5' />\n        </button>\n        <input\n          type='text'\n          value={title}\n          onChange={e => setTitle(e.target.value)}\n          placeholder=''\n          className='flex-1 text-2xl font-bold bg-transparent focus:outline-none text-white placeholder-gray-500'\n        />\n        {/* Assignment button for group notes */}\n        {isGroupNote && (\n          <div className='relative'>\n            <button\n              onClick={() => setShowAssignmentDropdown(!showAssignmentDropdown)}\n              className='w-[50px] h-[50px] rounded-full bg-white/10 backdrop-blur-xl text-white border border-black transition-all duration-300 shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] hover:bg-white/15 hover:scale-102 hover:shadow-[0_12px_40px_rgba(0,0,0,0.25),inset_0_1px_0_rgba(255,255,255,0.18)] flex items-center justify-center relative'\n              title=''\n            >\n              <Users className='w-5 h-5' />\n              {assigneeIds.length > 0 && (\n                <span className='absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-medium'>\n                  {assigneeIds.length}\n                </span>\n              )}\n            </button>\n\n            {/* Dropdown */}\n            {showAssignmentDropdown && (\n              <>\n                {/* Backdrop */}\n                <div\n                  className='fixed inset-0 z-30'\n                  onClick={() => setShowAssignmentDropdown(false)}\n                />\n                {/* Dropdown menu */}\n                <div className='absolute right-0 top-full mt-2 w-64 bg-white/10 backdrop-blur-xl border border-black rounded-[20px] shadow-[0_8px_32px_rgba(0,0,0,0.15),inset_0_1px_0_rgba(255,255,255,0.12)] z-40 overflow-hidden'>\n                  <div className='px-4 py-3 border-b border-black'>\n                    <div className='text-sm font-medium text-white'></div>\n                  </div>\n                  <div className='max-h-64 overflow-y-auto'>\n                    {members.length === 0 ? (\n                      <div className='px-4 py-3 text-sm text-gray-400'>\n                        \n                      </div>\n                    ) : (\n                      members.map(member => (\n                        <button\n                          key={member.id}\n                          type='button'\n                          onClick={() => toggleAssignee(member.id)}\n                          className='w-full px-4 py-2.5 text-left text-sm hover:bg-white/10 transition-colors flex items-center gap-3'\n                        >\n                          <div\n                            className={`w-5 h-5 border-2 rounded flex items-center justify-center flex-shrink-0 ${\n                              assigneeIds.includes(member.id)\n                                ? 'bg-blue-500 border-blue-500'\n                                : 'border-gray-600'\n                            }`}\n                          >\n                            {assigneeIds.includes(member.id) && (\n                              <svg\n                                className='w-3.5 h-3.5 text-white'\n                                fill='none'\n                                stroke='currentColor'\n                                viewBox='0 0 24 24'\n                              >\n                                <path\n                                  strokeLinecap='round'\n                                  strokeLinejoin='round'\n                                  strokeWidth={3}\n                                  d='M5 13l4 4L19 7'\n                                />\n                              </svg>\n                            )}\n                          </div>\n                          <span className='text-gray-300'>\n                            {member.user_profile?.name || 'Unknown'}\n                          </span>\n                        </button>\n                      ))\n                    )}\n                  </div>\n                </div>\n              </>\n            )}\n          </div>\n        )}\n      </header>\n      {/* Toolbar */}\n      <div className='sticky top-0 z-20 flex flex-wrap gap-2 mx-2 px-3 py-3 rounded-2xl border border-white/10 bg-white/8 backdrop-blur-xl shadow-[0_10px_40px_rgba(0,0,0,0.35),inset_0_1px_0_rgba(255,255,255,0.12)]'>\n        <ToolbarButton\n          onClick={() => editor.chain().focus().toggleBold().run()}\n          isActive={editor.isActive('bold')}\n          icon={<Bold className='w-4 h-4' />}\n          title='Bold'\n        />\n        <ToolbarButton\n          onClick={() => editor.chain().focus().toggleItalic().run()}\n          isActive={editor.isActive('italic')}\n          icon={<Italic className='w-4 h-4' />}\n          title='Italic'\n        />\n        <ToolbarButton\n          onClick={() => {\n            const chain = editor.chain().focus() as StrikeChain;\n            if (chain.toggleStrike) {\n              chain.toggleStrike().run();\n            }\n          }}\n          isActive={editor.isActive('strike')}\n          icon={<Strikethrough className='w-4 h-4' />}\n          title='Strikethrough'\n        />\n        <div className='w-px h-6 bg-white/10 my-auto' />\n        <ToolbarButton\n          onClick={() => editor.chain().focus().toggleBulletList().run()}\n          isActive={editor.isActive('bulletList')}\n          icon={<List className='w-4 h-4' />}\n          title='Bullet list'\n        />\n        <ToolbarButton\n          onClick={() => editor.chain().focus().toggleOrderedList().run()}\n          isActive={editor.isActive('orderedList')}\n          icon={<ListOrdered className='w-4 h-4' />}\n          title='Numbered list'\n        />\n        <ToolbarButton\n          onClick={handleToggleTaskList}\n          isActive={editor.isActive('taskList')}\n          icon={<CheckSquare className='w-4 h-4' />}\n          title='Task list'\n        />\n        <ToolbarButton\n          onClick={() => editor.chain().focus().toggleBlockquote().run()}\n          isActive={editor.isActive('blockquote')}\n          icon={<Quote className='w-4 h-4' />}\n          title='Quote'\n        />\n        <div className='w-px h-6 bg-white/10 my-auto' />\n        <ToolbarButton\n          onClick={triggerImageInput}\n          disabled={uploadingImage || !note?.workspace_id}\n          icon={\n            uploadingImage ? (\n              <Loader2 className='w-4 h-4 animate-spin' />\n            ) : (\n              <ImageIcon className='w-4 h-4' />\n            )\n          }\n          title='Insert Image'\n        />\n        <div className='w-px h-6 bg-white/10 my-auto' />\n        <ToolbarButton\n          onClick={() => editor.chain().focus().undo().run()}\n          disabled={!editor.can().undo()}\n          icon={<Undo className='w-4 h-4' />}\n          title='Undo'\n        />\n        <ToolbarButton\n          onClick={() => editor.chain().focus().redo().run()}\n          disabled={!editor.can().redo()}\n          icon={<Redo className='w-4 h-4' />}\n          title='Redo'\n        />\n        <div className='w-px h-6 bg-white/10 my-auto' />\n        <ToolbarButton\n          onClick={() => setAiSuggestionsEnabled(!aiSuggestionsEnabled)}\n          isActive={aiSuggestionsEnabled}\n          icon={\n            isSuggestionLoading ? (\n              <Loader2 className='w-4 h-4 animate-spin' />\n            ) : (\n              <Sparkles className='w-4 h-4' />\n            )\n          }\n          title={`AI Suggestions (${aiSuggestionsEnabled ? 'On' : 'Off'}) - Press Tab to accept`}\n        />\n      </div>\n\n      {/*  */}\n      <div\n        className='flex flex-col flex-1 px-4 md:px-6 relative z-10 overflow-auto'\n        style={{\n          willChange: 'scroll-position',\n          transform: 'translateZ(0)',\n          WebkitOverflowScrolling: 'touch',\n        }}\n      >\n        {/* Editor Content */}\n        <div className='flex-1 min-h-0'>\n          <EditorContent editor={editor} />\n        </div>\n      </div>\n\n      {/* Hidden image input */}\n      <input\n        ref={imageInputRef}\n        type='file'\n        accept='image/*'\n        className='hidden'\n        onChange={handleImageUpload}\n      />\n\n      <style jsx global>{`\n        .ProseMirror {\n          outline: none;\n          min-height: 100%;\n          padding: 0;\n        }\n        .ProseMirror p {\n          margin: 0.75em 0;\n        }\n        .ProseMirror p:first-child {\n          margin-top: 0;\n        }\n        .ProseMirror p:last-child {\n          margin-bottom: 0;\n        }\n        .ProseMirror h1,\n        .ProseMirror h2,\n        .ProseMirror h3 {\n          margin-top: 1em;\n          margin-bottom: 0.5em;\n          font-weight: 600;\n          line-height: 1.2;\n        }\n        .ProseMirror h1 {\n          font-size: 2em;\n        }\n        .ProseMirror h2 {\n          font-size: 1.5em;\n        }\n        .ProseMirror h3 {\n          font-size: 1.25em;\n        }\n        .ProseMirror ul,\n        .ProseMirror ol {\n          margin: 0.75em 0;\n          padding-left: 1.5em !important;\n          list-style-position: outside !important;\n        }\n        .ProseMirror ul {\n          list-style-type: disc !important;\n        }\n        .ProseMirror ul li {\n          display: list-item !important;\n          list-style-type: disc !important;\n        }\n        .ProseMirror ol {\n          list-style-type: decimal !important;\n        }\n        .ProseMirror ol li {\n          display: list-item !important;\n          list-style-type: decimal !important;\n        }\n        .ProseMirror li {\n          margin: 0.25em 0;\n        }\n        .ProseMirror ul.task-list,\n        .ProseMirror ul[data-type='taskList'] {\n          list-style: none !important;\n          padding-left: 0 !important;\n          margin: 0.75em 0;\n        }\n        .ProseMirror ul.task-list > li,\n        .ProseMirror ul[data-type='taskList'] > li {\n          list-style: none !important;\n          display: flex !important;\n          align-items: flex-start;\n          gap: 0.6em;\n          margin: 0.3em 0;\n        }\n        .ProseMirror ul.task-list > li::marker,\n        .ProseMirror ul[data-type='taskList'] > li::marker {\n          content: '';\n        }\n        .ProseMirror li.task-item,\n        .ProseMirror li[data-type='taskItem'] {\n          display: flex;\n          align-items: flex-start;\n          gap: 0.6em;\n        }\n        .ProseMirror li.task-item > label,\n        .ProseMirror li[data-type='taskItem'] > label {\n          display: inline-flex;\n          align-items: center;\n          justify-content: center;\n          flex-shrink: 0;\n          cursor: pointer;\n          user-select: none;\n          margin-top: 0.15em;\n        }\n        .ProseMirror li.task-item > label input[type='checkbox'],\n        .ProseMirror li[data-type='taskItem'] > label input[type='checkbox'] {\n          width: 1.1em;\n          height: 1.1em;\n          cursor: pointer;\n          accent-color: rgba(59, 130, 246, 0.8);\n          border-radius: 0.25em;\n          margin: 0;\n        }\n        .ProseMirror li.task-item > div,\n        .ProseMirror li[data-type='taskItem'] > div {\n          flex: 1;\n          min-width: 0;\n        }\n        .ProseMirror li.task-item[data-checked='true'] > div,\n        .ProseMirror li[data-type='taskItem'][data-checked='true'] > div {\n          text-decoration: line-through;\n          opacity: 0.7;\n          color: rgba(255, 255, 255, 0.5);\n        }\n        .ProseMirror blockquote {\n          border-left: 3px solid rgba(255, 255, 255, 0.2);\n          padding-left: 1em;\n          margin: 1em 0;\n          font-style: italic;\n          color: rgba(255, 255, 255, 0.7);\n        }\n        .ProseMirror strong {\n          font-weight: 600;\n        }\n        .ProseMirror em {\n          font-style: italic;\n        }\n        .ProseMirror s {\n          text-decoration: line-through;\n        }\n        .ProseMirror p.is-editor-empty:first-child::before {\n          content: attr(data-placeholder);\n          float: left;\n          color: rgba(156, 163, 175, 0.6);\n          pointer-events: none;\n          height: 0;\n        }\n        .ProseMirror img.editor-image {\n          max-width: 100%;\n          height: auto;\n          border-radius: 0.5rem;\n          margin: 1em 0;\n          display: block;\n          cursor: pointer;\n          border: 1px solid rgba(255, 255, 255, 0.1);\n        }\n        .ProseMirror img.editor-image:hover {\n          border-color: rgba(255, 255, 255, 0.2);\n        }\n        .ProseMirror img.editor-image.ProseMirror-selectednode {\n          outline: 2px solid rgba(59, 130, 246, 0.5);\n          outline-offset: 2px;\n        }\n        /* Member mention styles */\n        .ProseMirror .mention {\n          background-color: rgba(59, 130, 246, 0.2);\n          border-radius: 0.25rem;\n          padding: 0.125rem 0.25rem;\n          color: rgb(147, 197, 253);\n          font-weight: 500;\n          cursor: pointer;\n          transition: background-color 0.2s;\n        }\n        .ProseMirror .mention:hover {\n          background-color: rgba(59, 130, 246, 0.3);\n        }\n        /* Note mention styles */\n        .ProseMirror .note-mention {\n          background-color: rgba(34, 197, 94, 0.2);\n          border-radius: 0.25rem;\n          padding: 0.125rem 0.25rem;\n          color: rgb(134, 239, 172);\n          font-weight: 500;\n          cursor: pointer;\n          transition: background-color 0.2s;\n        }\n        .ProseMirror .note-mention:hover {\n          background-color: rgba(34, 197, 94, 0.3);\n        }\n        /* AI Completion ghost text styles */\n        .ProseMirror .ai-completion-ghost-text {\n          color: rgb(156, 163, 175);\n          opacity: 0.5;\n          pointer-events: none;\n          user-select: none;\n          font-style: italic;\n        }\n      `}</style>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3190, "column": 0}, "map": {"version":3,"sources":["file:///Users/air13/code/cogni/cogni-frontend/apps/web/src/app/%28private%29/notes/%5Bid%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport NoteEditor from '@/features/notes/components/NoteEditor';\nimport { use } from 'react';\n\nexport default function NoteDetailPage({\n  params,\n}: {\n  params: Promise<{ id: string }>;\n}) {\n  const { id } = use(params);\n\n  return <NoteEditor noteId={id} />;\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKe,SAAS,eAAe,EACrC,MAAM,EAGP;IACC,MAAM,EAAE,EAAE,EAAE,GAAG,IAAA,gcAAG,EAAC;IAEnB,qBAAO,keAAC,qNAAU;QAAC,QAAQ;;;;;;AAC7B","debugId":null}}]
}